<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/static/img/favicon.ico" />
    <title>How to Setup an External USB Hard Drive as a ZFS Backup Disk in FreeBSD - Dusko Pijetlovic</title>
    <meta name="author" content="Dusko Pijetlovic" />
    <meta name="description" content="How to Setup an External USB Hard Drive as a ZFS Backup Disk in FreeBSD" />
    <meta name="keywords" content="How to Setup an External USB Hard Drive as a ZFS Backup Disk in FreeBSD, Dusko Pijetlovic, zfs, freebsd, snapshot, backup" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
    <meta content="1749788565247320" property="fb:app_id">
    <meta content="Dusko Pijetlovic" property="og:site_name">

    

    
      <meta content="How to Setup an External USB Hard Drive as a ZFS Backup Disk in FreeBSD" property="og:title">
      <meta content="article" property="og:type">
    

    
      <meta content="Dusko Pijetlovic - My Personal Web Space" property="og:description">
    

    
      <meta content="http://localhost:4000/zfs/freebsd/snapshot/backup/2022/03/19/freebsd-geli-encrypted-usb-external-hdd-zfs-freebsd.html" property="og:url">
    

    
      <meta content="2022-03-19T10:13:21-07:00" property="article:published_time">
      <meta content="http://localhost:4000/about/" property="article:author">
    

    

    
      
        <meta content="zfs" property="article:section">
      
    

    
      
    

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@github.io">
    <meta name="twitter:creator" content="@github.io">

    
      <meta name="twitter:title" content="How to Setup an External USB Hard Drive as a ZFS Backup Disk in FreeBSD">
    

    
      <meta name="twitter:url" content="http://localhost:4000/zfs/freebsd/snapshot/backup/2022/03/19/freebsd-geli-encrypted-usb-external-hdd-zfs-freebsd.html">
    

    
      <meta name="twitter:description" content="Dusko Pijetlovic - My Personal Web Space">
    

    

    <!-- Font awesome icons -->
    <link href="/static/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/static/css/syntax.css">
    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/super-search.css">
    <link rel="stylesheet" href="/static/css/thickbox.css">
    <link rel="stylesheet" href="/static/css/projects.css">
    <link rel="stylesheet" href="/static/css/main.css">

    
  </head>
  <body>
    <div class="container">
      <div class="col-sm-3">
        <div class="fixed-condition">
          <h1 class="author-name"><a href="/">Dusko Pijetlovic</a></h1>
          
            <div class="profile-about">
              My personal notes where I store things I find interesting or might need in the future.
            </div>
          
          <div class="social">
            <ul>
              
                <li><a href="https://twitter.com/duskopijetlovic" target="_blank"><i class="fa fa-twitter"></i></a></li>
              
                <li><a href="https://linkedin.com/in/duskopijetlovic" target="_blank"><i class="fa fa-linkedin"></i></a></li>
              
                <li><a href="https://github.com/duskopijetlovic" target="_blank"><i class="fa fa-github"></i></a></li>
              
            </ul>
          </div>
          <div class="search" id="js-search">
            <input type="text" placeholder="(sitemap)~$ type to search" class="search__input form-control" id="js-search__input">
            <ul class="search__results" id="js-search__results"></ul>
          </div>
          <hr />
          <ul class="sidebar-nav">
            <strong>Navigation</strong>
            <li><a href="/">Home</a></li>
            
              <li><a class="about" href="/about/">About</a></li>
            
              <li><a class="about" href="/feed.xml">XML Feed</a></li>
            
              <li><a class="about" href="/category/categories">Categories</a></li>
            
          </ul>
        </div>
        <!-- end /.fixed-condition -->
      </div>
      <div class="col-sm-8 col-offset-1 main-layout">
        <header class="post-header">
  <h1 class="post-title">How to Setup an External USB Hard Drive as a ZFS Backup Disk in FreeBSD</h1>
</header>

<span class="time">19 Mar 2022</span>

  <span class="categories">
    &raquo; <a href="/category/zfs">zfs</a>, <a href="/category/freebsd">freebsd</a>, <a href="/category/snapshot">snapshot</a>, <a href="/category/backup">backup</a>
  </span>


<div class="content">
  <div class="post"><ul>
  <li>OS:  FreeBSD 13.0</li>
  <li>Shell:  csh</li>
  <li>External hard disk drive: WD (WesternDigital) Easystore 14TB USB 3.0 Desktop External Hard Drive, Model:  <a href="https://www.bestbuy.ca/en-ca/product/wd-easystore-14tb-usb-3-0-desktop-external-hard-drive-wdbama0140hbk-nese-black-only-at-best-buy/14936770">WDBAMA0140HBK-NESE</a>
    <ul>
      <li>Possibly, a variation of a model <a href="https://www.westerndigital.com/products/portable-drives/wd-easystore-desktop-usb-3-0-hdd#WDBAMA0140HBK-NESN">WDBAMA0140HBK-NESN</a></li>
    </ul>
  </li>
</ul>

<hr />

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ freebsd-version
13.0-RELEASE-p7
</code></pre></div></div>

<p>Connect one end of the USB cable to your system and the other end to 
the hard drive.</p>

<p>Use <code class="language-plaintext highlighter-rouge">dmseg</code> to find the external drive’s device node name (in this 
example, <code class="language-plaintext highlighter-rouge">da0</code>) and use <code class="language-plaintext highlighter-rouge">gpart destroy</code> to remove any old partition 
table that might be on the drive.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ dmesg | grep -i easy | grep -i store
ugen0.4: &lt;Western Digital easystore 264D&gt; at usbus0
umass0: &lt;Western Digital easystore 264D, class 0/0, rev 3.10/30.12, addr 3&gt; on usbus0
da0: &lt;WD easystore 264D 3012&gt; Fixed Direct Access SPC-4 SCSI device
ugen0.4: &lt;Western Digital easystore 264D&gt; at usbus0
umass0: &lt;Western Digital easystore 264D, class 0/0, rev 3.10/30.12, addr 3&gt; on usbus0
da0: &lt;WD easystore 264D 3012&gt; Fixed Direct Access SPC-4 SCSI device
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo usbconfig show_ifdrv | grep umass0
ugen0.4.0: umass0: &lt;Western Digital easystore 264D, class 0/0, rev 3.10/30.12, addr 58&gt;
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo usbconfig dump_info | grep ugen0.4
ugen0.4: &lt;Western Digital easystore 264D&gt; at usbus0, cfg=0 md=HOST spd=SUPER (5 Gbps) pwr=ON (2mA)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo usbconfig list | grep ugen0.4
ugen0.4: &lt;Western Digital easystore 264D&gt; at usbus0, cfg=0 md=HOST spd=SUPER (5 Gbps) pwr=ON (2mA)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo camcontrol devlist
---- snip ----
&lt;WD easystore 264D 3012&gt;           at scbus7 target 0 lun 0 (da0,pass3)
---- snip ----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ geom disk list
---- snip ----
Geom name: da0
Providers:
1. Name: da0
   Mediasize: 14000519643136 (13T)
   Sectorsize: 512
   Stripesize: 4096
   Stripeoffset: 0
   Mode: r0w0e0
   descr: WD easystore 264D
   lunname: WD      easystore 264D  9MH60Y1K
   lunid: 5000cca290d0d53f
   ident: 394D48363059314B
   rotationrate: 7200
   fwsectors: 63
   fwheads: 255
---- snip ----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpart list | grep -w da0
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpart show | grep -w da0
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ glabel list | grep da0
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ glabel list da0
glabel: Class 'LABEL' does not have an instance named 'da0'.
</code></pre></div></div>

<p>This is a brand new disk so <code class="language-plaintext highlighter-rouge">gpart destroy</code> complains:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo gpart destroy -F da0
gpart: arg0 'da0': Invalid argument
</code></pre></div></div>

<p>Otherwise, if the disk was previously configured and had a partitioning 
scheme on it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo gpart destroy -F da0
da0 destroyed
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo gpart add -a 1m -l external -t freebsd-zfs "da0"
gpart: No partitioning scheme found on geom da0. Create one first using 'gpart create'.
</code></pre></div></div>

<p>Create the partition table with <strong>gpt</strong> partitioning scheme (on disk <code class="language-plaintext highlighter-rouge">da0</code>).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo gpart create -s gpt da0
da0 created
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpart show da0
=&gt;         40  27344764848  da0  GPT  (13T)
           40  27344764848       - free -  (13T)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpart list da0 | wc -l
      17
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpart list da0
Geom name: da0
---- snip ----
</code></pre></div></div>

<p>Create a new ZFS partition with the GPT label <strong>external</strong>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo gpart add -a 1m -l external -t freebsd-zfs "da0"
da0p1 added
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpart show da0
=&gt;         40  27344764848  da0  GPT  (13T)
           40         2008       - free -  (1.0M)
         2048  27344760832    1  freebsd-zfs  (13T)
  27344762880         2008       - free -  (1.0M)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpart list da0 | wc -l
      34
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gpart list da0
Geom name: da0
---- snip ----
scheme: GPT
Providers:
1. Name: da0p1
   Mediasize: 14000517545984 (13T)
   Sectorsize: 512
   Stripesize: 4096
---- snip ----
   label: external
---- snip -----
   type: freebsd-zfs
---- snip ----
Consumers:
1. Name: da0
   Mediasize: 14000519643136 (13T)
   Sectorsize: 512
   Stripesize: 4096
---- snip ----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -lh /dev/gpt/external
crw-r-----  1 root  operator  0x1dd Mar 19 15:53 /dev/gpt/external 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ date
Sat 19 Mar 2022 15:53:28 PDT
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo geli init -e AES-XTS -l 256 -s 4096 "/dev/gpt/external"
Enter new passphrase:
Reenter new passphrase:
</code></pre></div></div>

<p>Output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Metadata backup for provider /dev/gpt/external can be found in 
  /var/backups/gpt_external.eli
and can be restored with the following command:

        # geli restore /var/backups/gpt_external.eli /dev/gpt/external
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ geli status
geli: Command 'status' not available; try 'load' first.

$ geli load
geli: cannot load geom_eli: Operation not permitted

$ sudo geli status
Password:
geli: Command 'status' not available; try 'load' first.

$ sudo geli load
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ geli status
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo geli attach /dev/gpt/external
Enter passphrase:
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ geli status
            Name  Status  Components
gpt/external.eli  ACTIVE  gpt/external
</code></pre></div></div>

<p>Create a new zpool in the geli partition called <strong>external</strong>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool create external gpt/external.eli
</code></pre></div></div>

<p>It’s possible to use the pool named <strong>external</strong> as the destination for 
<code class="language-plaintext highlighter-rouge">zxfer</code> directly; however, in this example create a new dataset inside 
the pool, and name it after the source machine’s hostname.  This will 
help identify backup data and allow multiple hosts to back up to the 
same drive.  Since the source machine’s hostname in this example 
is <strong>fbsd1</strong>, the backup destination for zxfer will be <strong>backup/fbsd1</strong>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ hostname
fbsd1.mydomain.com
</code></pre></div></div>

<p>Trim off any domain information from the printed name of the current host:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ hostname -s
fbsd1
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zpool list
NAME    SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
zroot   928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool create external gpt/external.eli
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zpool list
NAME       SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
external  12.7T   468K  12.7T        -         -     0%     0%  1.00x    ONLINE  -
zroot      928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zfs list
NAME                 USED  AVAIL     REFER  MOUNTPOINT
external             372K  12.3T       96K  /external
zroot                176G   723G       88K  /zroot
---- snip ----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zfs create external/fbsd1
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zfs list
NAME                 USED  AVAIL     REFER  MOUNTPOINT
external             504K  12.3T       96K  /external
external/fbsd1        96K  12.3T       96K  /external/fbsd1
zroot                189G   710G       88K  /zroot
---- snip ----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool import
no pools available to import
</code></pre></div></div>

<p>Run <code class="language-plaintext highlighter-rouge">zpool export</code> and <code class="language-plaintext highlighter-rouge">geli detach</code> to simulate the drive removal from 
the system.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool export external
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool export external
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zpool list
NAME    SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
zroot   928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool import
   pool: external
     id: 1234567890123456789
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        external            ONLINE
          gpt/external.eli  ONLINE
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo geli detach /dev/gpt/external
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ geli status
</code></pre></div></div>

<p>Disconnect the external drive from the system.</p>

<p>Connect one end of the USB cable to your system and the other end to 
the hard drive.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo geli attach /dev/gpt/external
Enter passphrase: 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ geli status
            Name  Status  Components
gpt/external.eli  ACTIVE  gpt/external
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool import
   pool: external
     id: 1234567890123456789
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        external            ONLINE
          gpt/external.eli  ONLINE
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool import external
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zpool list
NAME       SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
external  12.7T   696K  12.7T        -         -     0%     0%  1.00x    ONLINE  -
zroot      928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zfs list
NAME                 USED  AVAIL     REFER  MOUNTPOINT
external             588K  12.3T       96K  /external
external/fbsd1        96K  12.3T       96K  /external/fbsd1
zroot                189G   710G       88K  /zroot
---- snip ----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -alh /external/
total 10
drwxr-xr-x   3 root  wheel     3B Mar 19 15:59 .
drwxr-xr-x  21 root  wheel    28B Mar 19 16:06 ..
drwxr-xr-x   2 root  wheel     2B Mar 19 15:59 fbsd1

$ ls -alh /external/fbsd1/
total 1
drwxr-xr-x  2 root  wheel     2B Mar 19 15:59 .
drwxr-xr-x  3 root  wheel     3B Mar 19 15:59 ..
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zfs list -H | \
cut -f1 | \
awk '/[[:space:]]/{printf("Error! Dataset name contains spaces: %s\n",$0)}'
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pkg install zxfer 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ set exclude="com.sun:auto-snapshot"
$ set exclude="${exclude},com.sun:auto-snapshot:015m"
$ set exclude="${exclude},objsetid"
$ set exclude="${exclude},keyformat"
$ set exclude="${exclude},keylocation"
$ set exclude="${exclude},pbkdf2iters"
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n "$exclude"
com.sun:auto-snapshot,com.sun:auto-snapshot:015m,objsetid,keyformat,keylocation,pbkdf2iters
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zxfer -dFkPv -I ${exclude} -R zroot external/fbsd1
---- snip ----
</code></pre></div></div>

<p>In this example, it took around five minutes to complete.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -alh /external/fbsd1/
total 34
drwxr-xr-x  3 root  wheel     4B Mar 19 16:53 .
drwxr-xr-x  3 root  wheel     3B Mar 19 15:59 ..
-rw-r--r--  1 root  wheel    28K Mar 19 16:53 .zxfer_backup_info.zroot
drwxr-xr-x  7 root  wheel     7B Mar 19 16:53 zroot
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -alh /external/fbsd1/zroot/
total 12
drwxr-xr-x  7 root  wheel     7B Mar 19 16:53 .
drwxr-xr-x  3 root  wheel     4B Mar 19 16:53 ..
drwxr-xr-x  2 root  wheel     2B Mar 19 16:49 ROOT
drwxr-xr-x  2 root  wheel     2B Mar 19 16:53 tmp
drwxr-xr-x  5 root  wheel     5B Mar 19 16:53 usr
drwxr-xr-x  7 root  wheel     7B Mar 19 16:53 var
drwxr-xr-x  3 root  wheel     3B Mar 19 16:53 vm
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zfs list
NAME                                USED  AVAIL     REFER  MOUNTPOINT
external                           37.7G  12.3T       96K  /external
external/fbsd1                     37.7G  12.3T      136K  /external/fbsd1
external/fbsd1/zroot               37.7G  12.3T      152K  /external/fbsd1/zroot
---- snip ----
zroot                               189G   710G       88K  /zroot
zroot/ROOT                         58.5G   710G       88K  none
---- snip ---
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ df -hT
Filesystem                         Type       Size    Used   Avail Capacity  Mounted on
zroot/ROOT/default                 zfs        763G     53G    710G     7%    /
---- snip ----
external                           zfs         12T     96K     12T     0%    /external
external/fbsd1                     zfs         12T    136K     12T     0%    /external/fbsd1
external/fbsd1/zroot               zfs         12T    152K     12T     0%    /external/fbsd1/zroot
---- snip ----
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n Testing &gt; /external/fbsd1/test
/external/fbsd1/test: Permission denied.

$ printf %s\\n Testing | sudo tee -a /external/fbsd1/test
Testing

$ ls -lh /external/fbsd1/test
-rw-r--r--  1 root  wheel     8B Mar 19 17:13 /external/fbsd1/test

$ date
Sat 19 Mar 2022 17:13:10 PDT

$ cat /external/fbsd1/test
Testing

$ sudo rm -i /external/fbsd1/test
remove /external/fbsd1/test? y

$ ls -lh /external/fbsd1/test
ls: /external/fbsd1/test: No such file or directory
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo zpool scrub external
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zpool status external
  pool: external
 state: ONLINE
  scan: scrub in progress since Sat Mar 19 18:08:51 2022
        37.7G scanned at 1.45G/s, 5.13G issued at 202M/s, 37.7G total
        0B repaired, 13.60% done, 00:02:45 to go
config:

        NAME                STATE     READ WRITE CKSUM
        external            ONLINE       0     0     0
          gpt/external.eli  ONLINE       0     0     0

errors: No known data errors
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zpool list
NAME       SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
external  12.7T  37.7G  12.7T        -         -     0%     0%  1.00x    ONLINE  -
zroot      928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zpool status external
  pool: external
 state: ONLINE
  scan: scrub repaired 0B in 00:03:13 with 0 errors on Sat Mar 19 18:12:04 2022
config:

        NAME                STATE     READ WRITE CKSUM
        external            ONLINE       0     0     0
          gpt/external.eli  ONLINE       0     0     0

errors: No known data errors
</code></pre></div></div>

<hr />

</div>
  <div class="share-page">
  <span style="float: left;">Share this on &rarr;&nbsp;&nbsp;</span>

  <!-- Twitter -->
  <a href="https://twitter.com/share" class="twitter-share-button" data-via="github.io">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <!-- Facebook -->
  <div class="fb-share-button" data-href="http://localhost:4000/zfs/freebsd/snapshot/backup/2022/03/19/freebsd-geli-encrypted-usb-external-hdd-zfs-freebsd.html" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=1749788565247320";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

</div>


  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
            
            <div class="panel-body">
              <h4>Related Posts</h4>
              <ul>
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/font/freebsd/unix/x11/xorg/dotfiles/2022/04/17/x-fonts.html">Fonts in X11 - aka Fonts in X (Xorg)</a>
                  
                    (Categories: <a href="/category/font">font</a>, <a href="/category/freebsd">freebsd</a>, <a href="/category/unix">unix</a>, <a href="/category/x11">x11</a>, <a href="/category/xorg">xorg</a>, <a href="/category/dotfiles">dotfiles</a>)
                  
                </li>
          
          
        
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/wm/x11/xorg/freebsd/unix/dotfiles/2022/04/03/twm.html">TWM - Tab Window Manager for the X Window System</a>
                  
                    (Categories: <a href="/category/wm">wm</a>, <a href="/category/x11">x11</a>, <a href="/category/xorg">xorg</a>, <a href="/category/freebsd">freebsd</a>, <a href="/category/unix">unix</a>, <a href="/category/dotfiles">dotfiles</a>)
                  
                </li>
          
          
        
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/howto/bhyve/virtualization/xorg/x11/freebsd/2022/03/09/bhyve-connect-to-xorg-linux-guest.html">How to Connect to Xorg in Linux Guest from Bhyve</a>
                  
                    (Categories: <a href="/category/howto">howto</a>, <a href="/category/bhyve">bhyve</a>, <a href="/category/virtualization">virtualization</a>, <a href="/category/xorg">xorg</a>, <a href="/category/x11">x11</a>, <a href="/category/freebsd">freebsd</a>)
                  
                </li>
          
          
        
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/unix/freebsd/rhel/linux/howto/oneliner/sed/cli/terminal/shell/script/2022/02/27/sed-stream-editor.html">sed - Stream Editor</a>
                  
                    (Categories: <a href="/category/unix">unix</a>, <a href="/category/freebsd">freebsd</a>, <a href="/category/rhel">rhel</a>, <a href="/category/linux">linux</a>, <a href="/category/howto">howto</a>, <a href="/category/oneliner">oneliner</a>, <a href="/category/sed">sed</a>, <a href="/category/cli">cli</a>, <a href="/category/terminal">terminal</a>, <a href="/category/shell">shell</a>, <a href="/category/script">script</a>)
                  
                </li>
          
          
        
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/freebsd/howto/diagram/java/graph/graphviz/2022/02/26/freebsd-kroki-plantuml-graphviz-diagrams.html">Create Diagrams from Textual Descriptions with Graphviz, PlantUML and Kroki</a>
                  
                    (Categories: <a href="/category/freebsd">freebsd</a>, <a href="/category/howto">howto</a>, <a href="/category/diagram">diagram</a>, <a href="/category/java">java</a>, <a href="/category/graph">graph</a>, <a href="/category/graphviz">graphviz</a>)
                  
                </li>
          
          
        
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/freebsd/howto/diagram/java/2022/02/25/freebsd-java-kroki-diagrams.html">How to Run Kroki on FreeBSD 13 with Java</a>
                  
                    (Categories: <a href="/category/freebsd">freebsd</a>, <a href="/category/howto">howto</a>, <a href="/category/diagram">diagram</a>, <a href="/category/java">java</a>)
                  
                </li>
          
          
        
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
    
  
  
  </ul>
</div>


<div class="PageNavigation">
  
    <a class="prev" href="/unix/shell/script/cli/terminal/perl/sysadmin/2022/03/13/occasionally-revisited-code-shell-script-snippets.html">&laquo; Occasionally Revisited Code and Shell Script Snippets</a>
  
  
    <a class="next" href="/hpc/server/hardware/sysadmin/automation/configmanagement/howto/2022/03/20/xcat.html">HPC with xCAT, PBS/TORQUE, Gaussian and WebMO &raquo;</a>
  
</div>

<div class="disqus-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* <![CDATA[ */
    var disqus_shortname = "";
    var disqus_identifier = "http://localhost:4000_How to Setup an External USB Hard Drive as a ZFS Backup Disk in FreeBSD";
    var disqus_title = "How to Setup an External USB Hard Drive as a ZFS Backup Disk in FreeBSD";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    /* ]]> */
  </script>
</div>

        <footer>
          <!-- &copy; Dusko Pijetlovic -->
          
            <!-- - <a href="https://github.com/duskopijetlovic">https://github.com/duskopijetlovic</a> - Powered by Jekyll. -->
          
          <div class="btn-github" style="float:right;">
            <!-- <iframe src="https://ghbtns.com/github-btn.html?user=agusmakmun&repo=agusmakmun.github.io&type=star&count=true" frameborder="0" scrolling="0" width="100" height="20px"></iframe> -->
            <!-- <iframe src="https://ghbtns.com/github-btn.html?user=agusmakmun&repo=agusmakmun.github.io&type=fork&count=true" frameborder="0" scrolling="0" width="100" height="20px"></iframe> -->
          </div>
        </footer>
      </div>
      <!-- end /.col-sm-8 -->
    </div>
    <!-- end /.container -->

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/super-search.js"></script>
    <script src="/static/js/thickbox-compressed.js"></script>
    <script src="/static/js/projects.js"></script>
  </body>
</html>

