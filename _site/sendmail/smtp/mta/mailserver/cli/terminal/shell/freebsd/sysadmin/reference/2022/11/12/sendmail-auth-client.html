<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="/static/img/favicon.ico" />
    <title>Sendmail SMTP AUTH Running As a Client [HOWTO] - Dusko Pijetlovic</title>
    <meta name="author" content="Dusko Pijetlovic" />
    <meta name="description" content="Sendmail SMTP AUTH Running As a Client [HOWTO]" />
    <meta name="keywords" content="Sendmail SMTP AUTH Running As a Client [HOWTO], Dusko Pijetlovic, sendmail, smtp, mta, mailserver, cli, terminal, shell, freebsd, sysadmin, reference" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
    <meta content="1749788565247320" property="fb:app_id">
    <meta content="Dusko Pijetlovic" property="og:site_name">

    

    
      <meta content="Sendmail SMTP AUTH Running As a Client [HOWTO]" property="og:title">
      <meta content="article" property="og:type">
    

    
      <meta content="Dusko Pijetlovic - My Personal Web Space" property="og:description">
    

    
      <meta content="http://localhost:4000/sendmail/smtp/mta/mailserver/cli/terminal/shell/freebsd/sysadmin/reference/2022/11/12/sendmail-auth-client.html" property="og:url">
    

    
      <meta content="2022-11-12T05:50:18-08:00" property="article:published_time">
      <meta content="http://localhost:4000/about/" property="article:author">
    

    

    
      
        <meta content="sendmail" property="article:section">
      
    

    
      
    

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@github.io">
    <meta name="twitter:creator" content="@github.io">

    
      <meta name="twitter:title" content="Sendmail SMTP AUTH Running As a Client [HOWTO]">
    

    
      <meta name="twitter:url" content="http://localhost:4000/sendmail/smtp/mta/mailserver/cli/terminal/shell/freebsd/sysadmin/reference/2022/11/12/sendmail-auth-client.html">
    

    
      <meta name="twitter:description" content="Dusko Pijetlovic - My Personal Web Space">
    

    

    <!-- Font awesome icons -->
    <link href="/static/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/static/css/syntax.css">
    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,300italic,300,400italic,700&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/super-search.css">
    <link rel="stylesheet" href="/static/css/thickbox.css">
    <link rel="stylesheet" href="/static/css/projects.css">
    <link rel="stylesheet" href="/static/css/main.css">

    
  </head>
  <body>
    <div class="container">
      <div class="col-sm-3">
        <div class="fixed-condition">
          <h1 class="author-name"><a href="/">Dusko Pijetlovic</a></h1>
          
            <div class="profile-about">
              My personal notes where I store things I find interesting or might need in the future.
            </div>
          
          <div class="social">
            <ul>
              
                <li><a href="https://twitter.com/duskopijetlovic" target="_blank"><i class="fa fa-twitter"></i></a></li>
              
                <li><a href="https://linkedin.com/in/duskopijetlovic" target="_blank"><i class="fa fa-linkedin"></i></a></li>
              
                <li><a href="https://github.com/duskopijetlovic" target="_blank"><i class="fa fa-github"></i></a></li>
              
            </ul>
          </div>
          <div class="search" id="js-search">
            <input type="text" placeholder="(sitemap)~$ type to search" class="search__input form-control" id="js-search__input">
            <ul class="search__results" id="js-search__results"></ul>
          </div>
          <hr />
          <ul class="sidebar-nav">
            <strong>Navigation</strong>
            <li><a href="/">Home</a></li>
            
              <li><a class="about" href="/about/">About</a></li>
            
              <li><a class="about" href="/notes/index.html">Notes</a></li>
            
              <li><a class="about" href="/feed.xml">XML Feed</a></li>
            
              <li><a class="about" href="/category/categories">Categories</a></li>
            
          </ul>
        </div>
        <!-- end /.fixed-condition -->
      </div>
      <div class="col-sm-8 col-offset-1 main-layout">
        <header class="post-header">
  <h1 class="post-title">Sendmail SMTP AUTH Running As a Client [HOWTO]</h1>
</header>

<span class="time">12 Nov 2022</span>

  <span class="categories">
    &raquo; <a href="/category/sendmail">sendmail</a>, <a href="/category/smtp">smtp</a>, <a href="/category/mta">mta</a>, <a href="/category/mailserver">mailserver</a>, <a href="/category/cli">cli</a>, <a href="/category/terminal">terminal</a>, <a href="/category/shell">shell</a>, <a href="/category/freebsd">freebsd</a>, <a href="/category/sysadmin">sysadmin</a>, <a href="/category/reference">reference</a>
  </span>


<div class="content">
  <div class="post"><hr />

<p>Also known as: <br />
Sendmail SMTP AUTH client with SSL-or-TLS over port 465
(submissions port) using Stunnel <strong>[<sup><a href="#footnotes"> 1 </a></sup>]</strong></p>

<hr />

<h3 id="word-cloud">Word Cloud</h3>

<!-- Markdown extension for really small tiny text? -->
<!--   https://meta.stackexchange.com/questions/53800/markdown-extension-for-really-small-tiny-text -->

<p><sub><sup>
SMART_HOST, smart host, port 465, Implicit TLS submission on port 465,
TLS (Transport Layer Security), SSL (Secure Sockets Layer),
OpenSSL library, Base64,
SMTP (Simple Mail Transfer Protocol),<br />
SMTP AUTH, RFC2554 (ESMTP AUTH),
authentication, encryption, masquerading, relaying,
TCP, TCP/IP, networking, DNS, MX record, IANA (Internet Assigned Numbers
Authority),<br />
SASL (Simple Authentication and Security Layer), Cyrus SASL
library, sendmail, mailserver, postmaster, unix, CLI (command-line interface),
terminal, shell, csh, sh, FreeBSD, MTA (Mail Transfer Agent),<br />
MTA (Mail Transport Agent), MSP (Message Submission Program),
MSA (Mail Submission Agent), stunnel,  <br />
SMTP/S [SMTPS (SMTP over SSL-or-TLS on port 465)], SMTPS client,
SMTPS (Simple Mail Transfer Protocol Secure)
</sup></sub>
<strong>[<sup><a href="#footnotes"> 2 </a></sup>]</strong></p>

<hr />

<p>OS: <br />
FreeBSD 13.1-RELEASE-p2 with <em>sendmail</em> 8.17.1, Shell: <em>csh</em></p>

<hr />

<p>Setup requirements in this configuration:</p>
<ul>
  <li>Local <em>sendmail</em> server receives mails from local users or internal
applications.</li>
  <li>After receiving the mail from local users or internal applications,
this <em>sendmail</em> server:
    <ul>
      <li>relays the mail to your ISP (<code class="language-plaintext highlighter-rouge">your.isp.net</code>), if it’s addressed
to an external email address (sending a message to non local adresses);</li>
      <li>relays the mail to local system, if it’s addressed to a local user.</li>
    </ul>
  </li>
  <li>The ISP’s server accepts message submission on port 465 (Implicit TLS-or-SSL,
aka Encrypted SMTP). <strong>[<sup><a href="#footnotes"> 3 </a></sup>]</strong>
<strong>[<sup><a href="#footnotes"> 4 </a></sup>]</strong></li>
</ul>

<hr />

<h3 id="why-this-approach-instead-of-usual-with-smart_host-and-relay_mailer_args">Why This Approach Instead of Usual with SMART_HOST and RELAY_MAILER_ARGS?</h3>

<p>I tried this method and it worked but I couldn’t make it work for local mail:</p>

<p>I configured <em>sendmail</em> with SMTPS (SMTP over SSL)/Implicit TLS submission
port 465 by using <em>stunnel</em> on my local machine (a local port; in my case,
<code class="language-plaintext highlighter-rouge">127.0.0.1:1465</code> to my smart host provider, <code class="language-plaintext highlighter-rouge">your.isp.net:465</code>) with
<code class="language-plaintext highlighter-rouge">SMART_HOST</code> and <code class="language-plaintext highlighter-rouge">RELAY_MAILER_ARGS</code> with <code class="language-plaintext highlighter-rouge">TCP $h 1465</code> in <em>submit.mc</em>
(<em>/etc/mail/freebsd.submit.mc</em> on FreeBSD) configuration file for MSP
(Mail Submission Program, which is a command-line <em>sendmail</em> that functions
as a Mail Submission Agent (MTA):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define(`SMART_HOST', `[127.0.0.1]')dnl
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define(`RELAY_MAILER_ARGS', `TCP $h 465')dnl 
</code></pre></div></div>

<p>With <em>stunnel.conf</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[smtps]
accept=127.0.0.1:1465
connect=your.isp.net:465
</code></pre></div></div>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">A=</code> delivery agent equate is usually declared like <code class="language-plaintext highlighter-rouge">A=TCP $h</code>.
The value in <code class="language-plaintext highlighter-rouge">$h</code> is the value returned by the <code class="language-plaintext highlighter-rouge">parse</code> rule set 0’s <code class="language-plaintext highlighter-rouge">$@</code>
operator and is usually the name of the host to which <em>sendmail</em> should connect. 
During delivery the <em>sendmail</em> program expands this hostname into a possible
list of MX records. (Unless (V8.8 and later) the <code class="language-plaintext highlighter-rouge">F=0</code> delivery agent flag
is set (<code class="language-plaintext highlighter-rouge">F=0 (zero)</code>) or unless the hostname is surrounded by square brackets.)</p>

  <p>The host (as <code class="language-plaintext highlighter-rouge">$h</code>) is usually the only argument given to <code class="language-plaintext highlighter-rouge">TCP</code> but <code class="language-plaintext highlighter-rouge">TCP</code>
can accept two arguments, like this:</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A=TCP hostlist port
</code></pre></div>  </div>

  <p>The <code class="language-plaintext highlighter-rouge">port</code> is usually omitted and so defaults to 25.  However, a port number
can be included to force <em>sendmail</em> to connect on a different port.</p>
</blockquote>

<p>The <em>submit.mc</em> (<em>/etc/mail/freebsd.submit.mc</em>) also had:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LOCAL_RULE_0
R$* &lt;@ $=w . $=m&gt; $*    $#local $: $1      @my.local.domain

LOCAL_NET_CONFIG
R $* &lt; @ $+ .$m. &gt; $*   $#local $@ $2.$m $: $1 &lt; @ $2.$m &gt; $3
</code></pre></div></div>

<p>This configuration worked for nonlocal mail but it didn’t work for local
delivery because messages for local users were relayed via smart host.
I made it work for local mail in this setup with masquerading but it was
making a round trip: local mail was delivered but to the smart host, which
is not ideal (e.g. no need for cron mails to go outside.)</p>

<p><strong>NOTE:</strong> <br />
When I configured my workstation’s  <em>sendmail</em> as a client to a different
smart host with STARTTLS port 587 (that is, with a different smart host
server that listens to port 587 for STARTTLS), it worked fine for both
local and nonlocal mail.</p>

<hr />

<h2 id="tldr-version">TL;DR Version</h2>

<p>For <strong>detailed</strong> instructions (<strong>non tl;dr</strong> version), refer to the
section further below <a href="#how-to-setup-sendmail-to-act-as-a-client-with-smtp-auth">How To Setup Sendmail to Act As a Client with SMTP AUTH</a>.</p>

<p>The system-built <em>sendmail</em>:  <code class="language-plaintext highlighter-rouge">/usr/libexec/sendmail/sendmail</code></p>

<p>The package-installed <em>sendmail</em>: <code class="language-plaintext highlighter-rouge">/usr/local/sbin/sendmail</code></p>

<p>From the man page for <code class="language-plaintext highlighter-rouge">mailwrapper(8)</code>:</p>
<blockquote>
  <p>The <em>mailwrapper</em> program is designed to replace <em>/usr/sbin/sendmail</em> and to
invoke an appropriate MTA (Mail Transfer Agent) based on configuration
information placed in
<em>${LOCALBASE}/etc/mail/mailer.conf</em> (LOCALBASE=<em>/usr/local</em>)
<strong>[<sup><a href="#footnotes"> 5 </a></sup>]</strong> falling back on <em>/etc/mail/mailer.conf</em>.
This permits the administrator to configure which MTA is to be invoked on
the system at run time.</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /usr/local/etc/mail/mailer.conf
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail
hoststat        /usr/local/sbin/sendmail
purgestat       /usr/local/sbin/sendmail
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /etc/mail/mailer.conf
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail
hoststat        /usr/local/sbin/sendmail
purgestat       /usr/local/sbin/sendmail
</code></pre></div></div>

<h3 id="install-sendmail-and-cyrus-sasl-packages">Install Sendmail and Cyrus SASL Packages</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pkg install cyrus-sasl cyrus-sasl-saslauthd`

$ printf %s\\n "pwcheck_method: saslauthd" | sudo tee /usr/local/lib/sasl2/Sendmail.conf

$ printf %s\\n 'saslauthd_enable="YES"' | sudo tee -a /etc/rc.conf

$ sudo pkg install sendmail

$ printf %s\\n 'SENDMAIL_CF_DIR=/usr/local/share/sendmail/cf' | sudo tee -a /etc/make.conf

$ printf %s\\n 'sendmail_enable="YES"' | sudo tee -a /etc/rc.conf
</code></pre></div></div>

<h3 id="configure-sendmail-configuration-files---submitcf-and-sendmailcf">Configure Sendmail Configuration Files - submit.cf and sendmail.cf</h3>

<p>Modify  <code class="language-plaintext highlighter-rouge">/etc/mail/freebsd.submit.mc</code>. <br />
Changes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define(`confLOG_LEVEL', `14')dnl

define(`SMART_HOST',`smartrelay:[127.0.0.1]')dnl
FEATURE(`authinfo',`hash /etc/mail/authinfo')dnl

dnl dnl MASQUERADE_AS(`domain.to.masquerade_as')dnl dnl
dnl dnl MASQUERADE_DOMAIN('fbsd1.home.arpa')dnl dnl
dnl # Uncomment the next line (with masquerade_envelope) if 
dnl # you want messages to be delivered to SMART_HOST. 
dnl dnl FEATURE(`masquerade_envelope')dnl
dnl dnl FEATURE(`masquerade_entire_domain')dnl dnl

dnl Disable SMTP AUTH on the loopback interface.
DAEMON_OPTIONS(`Name=NoMTA, Addr=127.0.0.1, M=EA')dnl

MAILER_DEFINITIONS
dnl 
dnl     LR0relayST (Local Rule 0 relay Single Token)
dnl For addresses with only a single token (e.g. a username):  dusko 
MLR0relayST,	P=[IPC], F=mDFMuXa8k, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h

dnl
dnl     LR0relayLH [Local Rule 0 relay Local (AND) Hostname]
dnl For addresses:  dusko@localhost, dusko@&lt;hostname&gt; (that is:  dusko@fbsd1.home.arpa)
MLR0relayLH,	P=[IPC], F=mDFMuXa8k, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h

dnl
dnl     smartrelay 
dnl For nonlocal (external) addresses; for example: dusko@some.external.domain
Msmartrelay,    P=[IPC], F=mDFMuXa8k, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
                T=DNS/RFC822/SMTP,
                A=TCP $h 1465

LOCAL_RULE_0
R$-	$#LR0relayST $@ $j $: $1 &lt; @ $j. &gt;
R$+ &lt; @ $j. &gt;	$#LR0relayLH $@ $j $: $1 &lt; @ $j. &gt;
</code></pre></div></div>

<p><strong>NOTE:</strong>  In two lines below <code class="language-plaintext highlighter-rouge">LOCAL_RULE_0</code>,<br />
           there is a <strong>tab</strong> character before <code class="language-plaintext highlighter-rouge">#LR0relayST</code> and
           before <code class="language-plaintext highlighter-rouge">#LR0relayLH</code>.</p>

<p>Modify <code class="language-plaintext highlighter-rouge">/etc/mail/freebsd.mc</code>. <br />
Changes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define(`confEBINDIR', `/usr/local/libexec')dnl
define(`UUCP_MAILER_PATH', `/usr/local/bin/uux')dnl

FEATURE(`nouucp',`reject')dnl

TRUST_AUTH_MECH(`DIGEST-MD5 CRAM-MD5 EXTERNAL GSSAPI LOGIN PLAIN')dnl
define(`confAUTH_MECHANISMS',`DIGEST-MD5 CRAM-MD5 EXTERNAL GSSAPI LOGIN PLAIN')dnl
define(`confDONT_BLAME_SENDMAIL',`GroupReadableSASLDBFile')dnl

LOCAL_RULESETS
SLocal_trust_auth
R$*     $: $&amp;{auth_authen}
Rsmmsp  $# OK
</code></pre></div></div>

<p><strong>NOTE:</strong>  In the two lines below <code class="language-plaintext highlighter-rouge">SLocal_trust_auth</code>, there is a <strong>tab</strong>
           character before <code class="language-plaintext highlighter-rouge">$:</code> and before <code class="language-plaintext highlighter-rouge">$#</code>.</p>

<h3 id="create-the-authinfo-file-for-storing-auth-authentication-credentials">Create the authinfo File for Storing AUTH Authentication Credentials</h3>

<p>Create the <code class="language-plaintext highlighter-rouge">/etc/mail/authinfo</code> file (for storing AUTH authentication
credentials in a file separate from the <em>access</em> database).</p>

<p>You need to store the client’s authentication credentials in that file
using the same <code class="language-plaintext highlighter-rouge">AuthInfo:</code> tag used in the <em>access</em> database, and you need
to make sure that the <em>authinfo</em> text file and database are not readable
by anyone except the <strong>smmsp</strong> user.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo vi /etc/mail/authinfo
$ sudo chown smmsp:smmsp /etc/mail/authinfo
$ sudo chmod 0640 /etc/mail/authinfo
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cat /etc/mail/authinfo
AuthInfo:[127.0.0.1] "U:smmsp" "I:dusko" "P:YourISPPassword" "M:LOGIN"
AuthInfo:127.0.0.1 "U:smmsp" "I:dusko" "P:YourISPPassword" "M:LOGIN"
</code></pre></div></div>

<h3 id="install-and-configure-stunnel">Install and Configure stunnel</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pkg install stunnel
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /usr/local/etc/stunnel/stunnel.conf
include = /usr/local/etc/stunnel/conf.d

[smarthost]
client = yes
accept = 127.0.0.1:1465 
connect = your.isp.net:465
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n 'stunnel_enable="YES"' | sudo tee -a /etc/rc.conf

$ sudo service stunnel start
</code></pre></div></div>

<hr />
<hr />

<h2 id="how-to-setup-sendmail-to-act-as-a-client-with-smtp-auth">How To Setup Sendmail to Act As a Client with SMTP AUTH</h2>

<p><strong>Sendmail</strong> is the default MTA in FreeBSD base system (as of FreeBSD 13).</p>

<p>FreeBSD 13 comes with <em>sendmail</em>; that is, in FreeBSD 13, <em>sendmail</em> is
in the base system (a.k.a. in the default setup of the base system).
That’s why it’s usually called the <em>system sendmail</em> (or the <em>system-built
sendmail</em>).</p>

<hr />

<p><strong>NOTE:</strong>  <br />
<em>dma(8)</em> (DragonFly Mail Agent) will <strong>replace</strong> <em>sendmail</em> as the
<strong>default MTA</strong> in <strong>FreeBSD 14</strong> <strong>[<sup><a href="#footnotes"> 6 </a></sup>]</strong>:</p>

<p><a href="https://cgit.freebsd.org/src/commit/?id=4d184bd438">RELNOTES: document the switch from sendmail to dma</a>  (Author: Baptiste Daroussin <bapt at="" FreeBSD.org="">  2022-11-07)</bapt></p>

<p>Related <strong><a href="https://cgit.freebsd.org/src/diff/?id=4d184bd438">diff</a></strong>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>diff --git a/RELNOTES b/RELNOTES
index 00d97ea54820..29db15f412dd 100644
--- a/RELNOTES
+++ b/RELNOTES
@@ -10,6 +10,9 @@ newline.  Entries should be separated by a newline.
 
 Changes to this file should not be MFCed.
 
+a67b925ff3e5:
+	The default mail transport agent is now dma(8) replacing sendmail.
+
 22893e584032:
 	L3 filtering on if_bridge will do surprising things which aren't
 	fail-safe, so net.link.bridge.pfil_member and
</code></pre></div></div>

<p><strong>mail: make The Dragonfly Mail Agent (dma) the default mta:</strong> <br />
<a href="https://cgit.freebsd.org/src/commit/?id=a67b925ff3e58b072a60b633e442ee1d33e47f7f">FreeBSD source tree - mail: make The DragonFly Mail Agent (dma) the default mta.</a></p>

<hr />

<h2 id="smtp-auth-support---sendmail-in-base-vs-sendmail-from-packages-ports-in-freebsd-13">SMTP AUTH Support - Sendmail in Base vs. Sendmail from Packages (Ports) in FreeBSD 13</h2>

<p>Support for the SMTP extension AUTH, as defined by RFC2554 (ESMTP AUTH), 
was first included in <em>sendmail</em> beginning with V8.10.</p>

<p><em>Sendmail</em> provides SMTP AUTH via <a href="https://www.cyrusimap.org/sasl/">Cyrus SASL (Simple Authentication and 
Security Layer) library</a>. 
<strong>[<sup><a href="#footnotes"> 7 </a></sup>]</strong></p>

<p>However, the system <em>sendmail</em> in FreeBSD 13 base doesn’t support
SMTP AUTH; that is, it’s not compiled and configured with the Cyrus SASL
library.</p>

<p>To add SMTP AUTH support to <em>sendmail</em> in FreeBSD 13, you can either:</p>
<ul>
  <li>re-compile the system <em>sendmail</em> with SASL support enabled, or</li>
  <li>install <em>sendmail</em> as a package since the package provided <em>sendmail</em>
comes with SASL enabled by default</li>
</ul>

<p>I chose to install <em>sendmail</em> from packages (instructions are further
down below).</p>

<h3 id="managing-mta-mail-transfer-agent-in-freebsd-13-with-mailwrapper8">Managing MTA (Mail Transfer Agent) in FreeBSD 13 with mailwrapper(8)</h3>

<p>FreeBSD 13 uses <code class="language-plaintext highlighter-rouge">mailwrapper(8)</code> program for managing MTA (Mail Transfer Agent)
software and invoking appropriate MTA based on configuration file.</p>

<p>From the man page for <em>mailwrapper</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The mailwrapper program is designed to replace /usr/sbin/sendmail and to
invoke an appropriate MTA based on configuration information placed in
${LOCALBASE}/etc/mail/mailer.conf falling back on /etc/mail/mailer.conf.

This permits the administrator to configure which MTA is to be invoked on
the system at run time.

[ . . . ]

FILES
Configuration for mailwrapper is kept in
${LOCALBASE}/etc/mail/mailer.conf or /etc/mail/mailer.conf.
/usr/sbin/sendmail is typically set up as a symbolic link to mailwrapper
which is not usually invoked on its own.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -lh /usr/sbin/sendmail
lrwxr-xr-x  1 root  wheel    11B Oct 31  2019 /usr/sbin/sendmail -&gt; mailwrapper
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ file /usr/sbin/sendmail
/usr/sbin/sendmail: symbolic link to mailwrapper
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ file /usr/sbin/mailwrapper 
/usr/sbin/mailwrapper: ELF 64-bit LSB pie executable, x86-64, 
  version 1 (FreeBSD), dynamically linked, interpreter /libexec/ld-elf.so.1, 
  for FreeBSD 13.1, FreeBSD-style, stripped
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ command -v sendmail; type sendmail; which sendmail; whereis sendmail
/usr/sbin/sendmail
sendmail is /usr/sbin/sendmail
/usr/sbin/sendmail
sendmail: /usr/sbin/sendmail /usr/share/man/man8/sendmail.8.gz
</code></pre></div></div>

<p>The location of the system <em>sendmail</em> binary file shipped with FreeBSD 13
(provided in base) is <code class="language-plaintext highlighter-rouge">/usr/libexec/sendmail/sendmail</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /usr/local/etc/mail/mailer.conf
# $FreeBSD$
#
# Execute the "real" sendmail program, named /usr/libexec/sendmail/sendmail
# 
# If dma(8) is installed, an example mailer.conf that uses dma(8) instead can
# can be found in /usr/share/examples/dma.
#
sendmail        /usr/libexec/sendmail/sendmail
mailq           /usr/libexec/sendmail/sendmail
newaliases      /usr/libexec/sendmail/sendmail
hoststat        /usr/libexec/sendmail/sendmail
purgestat       /usr/libexec/sendmail/sendmail
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /etc/mail/mailer.conf
# $FreeBSD$
#
# Execute the "real" sendmail program, named /usr/libexec/sendmail/sendmail
#
# If dma(8) is installed, an example mailer.conf that uses dma(8) instead can
# can be found in /usr/share/examples/dma.
#
sendmail        /usr/libexec/sendmail/sendmail
mailq           /usr/libexec/sendmail/sendmail
newaliases      /usr/libexec/sendmail/sendmail
hoststat        /usr/libexec/sendmail/sendmail
purgestat       /usr/libexec/sendmail/sendmail
</code></pre></div></div>

<p><strong>NOTE:</strong> <br />
From the man page for <code class="language-plaintext highlighter-rouge">mailwrapper(8)</code>:</p>
<blockquote>
  <p>The mailwrapper program is designed to replace <code class="language-plaintext highlighter-rouge">/usr/sbin/sendmail</code> and
to invoke an appropriate MTA based on configuration information placed in
<code class="language-plaintext highlighter-rouge">${LOCALBASE}/etc/mail/mailer.conf</code> (LOCALBASE=/usr/local)
<strong>[<sup><a href="#footnotes"> 5 </a></sup>]</strong> falling back on <code class="language-plaintext highlighter-rouge">/etc/mail/mailer.conf</code>.
This permits the administrator to configure which MTA is to be invoked
on the system at run time.</p>
</blockquote>

<p>An example <code class="language-plaintext highlighter-rouge">mailer.conf</code> that uses <code class="language-plaintext highlighter-rouge">dma(8)</code> instead of <em>sendmail</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /usr/share/examples/dma/mailer.conf 
# $FreeBSD$

sendmail  /usr/libexec/dma
mailq     /usr/libexec/dma
</code></pre></div></div>

<h3 id="install-and-configure-cyrus-sasl">Install and Configure Cyrus SASL</h3>

<p>Before installing it, check <em>sendmail</em> dependencies by using
the <code class="language-plaintext highlighter-rouge">pkq rquery</code> command.  [For details: <code class="language-plaintext highlighter-rouge">man pkg-rquery(8)</code>
(<code class="language-plaintext highlighter-rouge">pkg rquery</code> - query information from remote repositories)]:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pkg rquery '%dn' sendmail
cyrus-sasl-saslauthd
cyrus-sasl
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">-d0.1</code> (a.k.a. <code class="language-plaintext highlighter-rouge">-d0</code>) debugging switch tells <em>sendmail</em> to print 
information about its version.  The system-built <em>sendmail</em> version
(on FreeBSD 13) is V8.16.1:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ /usr/libexec/sendmail/sendmail -d0 &lt; /dev/null
Version 8.16.1
 Compiled with: DNSMAP IPV6_FULL LOG MAP_REGEX MATCHGECOS MILTER
                MIME7TO8 MIME8TO7 NAMED_BIND NETINET NETINET6 NETUNIX NEWDB NIS
                PIPELINING SCANF STARTTLS TCPWRAPPERS TLS_EC TLS_VRFY_PER_CTX
                USERDB XDEBUG
 
============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = fbsd1
  (canonical domain name) $j = fbsd1.home.arpa
         (subdomain name) $m = home.arpa
              (node name) $k = fbsd1.home.arpa
========================================================
      
Recipient names must be specified
</code></pre></div></div>

<p>The <strong>base</strong> <em>sendmail</em> in FreeBSD 13 is <strong>not</strong> compiled with the
<strong>Cyrus SASL</strong> library.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ /usr/libexec/sendmail/sendmail -d0 &lt; /dev/null | grep SASL
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -d0 &lt; /dev/null
Version 8.16.1
 Compiled with: DNSMAP IPV6_FULL LOG MAP_REGEX MATCHGECOS MILTER
                MIME7TO8 MIME8TO7 NAMED_BIND NETINET NETINET6 NETUNIX NEWDB NIS
                PIPELINING SCANF STARTTLS TCPWRAPPERS TLS_EC TLS_VRFY_PER_CTX
                USERDB XDEBUG
 
============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = fbsd1
  (canonical domain name) $j = fbsd1.home.arpa
         (subdomain name) $m = home.arpa
              (node name) $k = fbsd1.home.arpa
========================================================

Recipient names must be specified
</code></pre></div></div>

<p>On the other hand, the <em>sendmail</em> package (a.k.a. the packaged version
of <em>sendmail</em>) comes with <strong>SASL</strong> support (and it’s also a slightly newer
version, V8.17.1 - versus V8.16.1 in FreeBSD 13 base). (As of Nov 12, 2022.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pkg search --regex ^sendmail
sendmail-8.17.1_5           Reliable, highly configurable mail transfer agent with utilities
sendmail-devel-8.17.1.20    Reliable, highly configurable mail transfer agent with utilities
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pkg search --regex --full sendmail-8.17.1_5 | grep SASL
        SASL           : on
        SASLAUTHD      : on
</code></pre></div></div>

<p>Query the <em>sendmail</em> package and its SASL options.
[The <code class="language-plaintext highlighter-rouge">--query-modifier</code> option of the <code class="language-plaintext highlighter-rouge">pkg search</code> command displays
a list of the port options and their state (<em>on</em> or <em>off</em>) when the
package was built.]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ pkg search --query-modifier options sendmail-8.17.1_5 | grep SASL
        SASL           : on
        SASLAUTHD      : on
</code></pre></div></div>

<p>Make sure your hostname is set correctly in <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code>.
This is what <em>sendmail</em> uses by default.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ hostname
fbsd1.home.arpa
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ grep hostname /etc/rc.conf
hostname="fbsd1.home.arpa"
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ grep -v \# /etc/hosts
::1                     localhost localhost.my.domain
127.0.0.1               localhost localhost.my.domain
</code></pre></div></div>

<p>First, install <em>sendmail</em>’s dependencies, which are two Cyrus SASL packages:
<em>cyrus-sasl</em> (SASL itself) and <em>cyrus-sasl-saslauthd</em> (SASL authentication
server for Cyrus SASL).  (Refer to the beginning of this section, with<br />
the <code class="language-plaintext highlighter-rouge">pkg rquery</code> command listing <em>sendmail</em>’s dependencies.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pkg install cyrus-sasl cyrus-sasl-saslauthd
</code></pre></div></div>

<p>The <em>cyrus-sasl</em> port is compiled with a default <code class="language-plaintext highlighter-rouge">pwcheck_method</code> of <code class="language-plaintext highlighter-rouge">auxprop</code>.</p>

<p>For directions on how to enable SMTP AUTH with the system <em>sendmail</em>, 
refer to Sendmail.README (<code class="language-plaintext highlighter-rouge">/usr/local/share/doc/cyrus-sasl2/Sendmail.README)</code>
included in <em>cyrus-sasl2</em> documentation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /usr/local/share/doc/cyrus-sasl2/Sendmail.README
How to enable SMTP AUTH with FreeBSD default Sendmail

1) Add the following to  /etc/make.conf:

    # Add SMTP AUTH support to Sendmail
    SENDMAIL_CFLAGS+=   -I/usr/local/include -DSASL=2
    SENDMAIL_LDFLAGS+=  -L/usr/local/lib
    SENDMAIL_LDADD+=    -lsasl2

2) Rebuild FreeBSD (make buildworld, ...)

3) Make sure that the pwcheck_method is correct in Sendmail.conf.

   Sendmail.conf (${PREFIX}/lib/sasl2/Sendmail.conf) is created by
   the cyrus-sasl2 ports during installation.  It may have
   pwcheck_method set to saslauthd by default.  Change this to what is
   appropriate for your site.

4) Add the following to your sendmail.mc file:

   dnl The group needs to be mail in order to read the sasldb2 file
   define(`confRUN_AS_USER',`root:mail')dnl

   TRUST_AUTH_MECH(`DIGEST-MD5 CRAM-MD5')dnl
   define(`confAUTH_MECHANISMS',`DIGEST-MD5 CRAM-MD5')dnl

   define(`confDONT_BLAME_SENDMAIL',`GroupReadableSASLDBFile')dnl

5) Add the following before FEATURE(msp) in your submit.mc file:

   DAEMON_OPTIONS(`Name=NoMTA, Addr=127.0.0.1, M=EA')dnl

   This disables SMTP AUTH on the loopback interface. Otherwise you may get
   the following error in the log:

        error: safesasl(/usr/local/etc/sasldb2) failed: Group readable file

   when sending mail locally (seen when using pine locally on same server).

 ----

   Additional AUTH Mechanisms are LOGIN, PLAIN, GSSAPI, and KERBEROS_V4.
   These can be added to TRUST_AUTH_MECH and confAUTH_MECHANISMS as a space
   seperated list.  You may want to restrict LOGIN, and PLAIN authentication
   methods for use with STARTTLS, as the password is not encrypted when
   passed to sendmail.

   LOGIN is required for Outlook Express users.  "My server requires
   authentication" needs to be checked in the accounts properties to 
   use SASL Authentication.

   PLAIN is required for Netscape Communicator users.  By default Netscape
   Communicator will use SASL Authentication when sendmail is compiled with
   SASL and will cause your users to enter their passwords each time they
   retreive their mail (NS 4.7).

   The DONT_BLAME_SENDMAIL option GroupReadableSASLDBFile is needed when you
   are using cyrus-imapd and sendmail on the same server that requires access
   to the sasldb2 database.

   SASLv2 support of Sendmail is starting with 8.12.4.
</code></pre></div></div>

<p>Since you’ll install the <em>sendmail</em> package and will not use the
system <em>sendmail</em> (a.k.a. FreeBSD default <em>sendmail</em>), you can skip
step 1: adding SENDMAIL_CFLAGS, SENDMAIL_LDFLAGS, SENDMAIL_LDADD, and
step 2: Rebuild FreeBSD (make buildworld, …); however, I performed the
step 1 and edited <code class="language-plaintext highlighter-rouge">/etc/make.conf</code> in case I decide to re-compile the
default <em>sendmail</em> later.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n 'SENDMAIL_CFLAGS+=-I/usr/local/include -DSASL=2' | sudo tee -a /etc/make.conf
$ printf %s\\n 'SENDMAIL_LDFLAGS+=-L/usr/local/lib' | sudo tee -a /etc/make.conf
$ printf %s\\n 'SENDMAIL_LDADD+=-lsasl2' | sudo tee -a /etc/make.conf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /etc/make.conf
SENDMAIL_CFLAGS+=-I/usr/local/include -DSASL=2
SENDMAIL_LDFLAGS+=-L/usr/local/lib
SENDMAIL_LDADD+=-lsasl2
</code></pre></div></div>

<p>You need to tell <em>sendmail</em> what to do about secure authentication.</p>

<p>Since SASL can be used by different applications, you can create
a customized configuration file in the <code class="language-plaintext highlighter-rouge">/usr/local/lib/sasl2/</code> directory 
for every service that uses SASL.  The name of the file must be that of
the service with the <em>conf</em> extension so in this case it’s a <em>Sendmail.conf</em>
file.</p>

<p><strong>NOTE:</strong> <br />
The <em>Sendmail.conf</em> (<em>/usr/local/lib/sasl2/Sendmail.conf</em>) file is created
by the <code class="language-plaintext highlighter-rouge">cyrus-sasl2</code> ports during installation.</p>

<p>At a minimum, one line should appear in that file and that line should
indicate your preferred password verification method.  Here, you need to
make sure that the <code class="language-plaintext highlighter-rouge">pwcheck_method</code> command in that file is set to
<em>saslauthd</em> daemon process (which is called from the Cyrus-SASL libraries,
and is a SASL authentication server for <em>cyrus-sasl2</em>).
This means that <em>sendmail</em> service will use SASL by connecting to the
<code class="language-plaintext highlighter-rouge">saslauthd(8)</code> deamon for all authentication (password verification).</p>

<p>Communication between <em>sendmail</em> and the <code class="language-plaintext highlighter-rouge">saslauthd</code> server takes place
over a UNIX-domain socket.  The <code class="language-plaintext highlighter-rouge">saslauthd</code> usually establishes the UNIX
domain socket in <code class="language-plaintext highlighter-rouge">/var/run/saslauthd/</code> and waits for authentication requests.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo ls -lh /var/run/saslauthd/
total 3
srwxrwxrwx  1 root  mail     0B Nov 12 18:10 mux
-rw-------  1 root  mail     0B Nov 12 18:10 mux.accept
-rw-------  1 root  mail     5B Nov 12 18:10 saslauthd.pid
</code></pre></div></div>

<p>The default communications socket for <em>saslauthd</em> on FreeBSD 13 is
<code class="language-plaintext highlighter-rouge">/var/run/saslauthd/mux</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo file /var/run/saslauthd/mux
/var/run/saslauthd/mux: socket
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cat /var/run/saslauthd/saslauthd.pid
1358
</code></pre></div></div>

<p>Here, <em>saslauthd</em> (from Cyrus SASL) uses the PAM framework to authenticate
credentials:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ps aux | grep -v grep | grep 1358
root    1358   0.0  0.0  18484  6120  -  Is 12Nov22    0:00.03 /usr/local/sbin/saslauthd -a pam
</code></pre></div></div>

<p>From the man page for <code class="language-plaintext highlighter-rouge">saslauthd(8)</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ . . . ]

     Options
       Options named by lower-case letters configure the server itself.
       Upper-case options control the behavior of specific authentication
       mechanisms; their applicability to a particular authentication mechanism
       is described in the AUTHENTICATION MECHANISMS section.

       -a authmech
               Use authmech as the authentication mechanism. (See the
               AUTHENTICATION MECHANISMS section below.) This parameter is
               mandatory.

[ . . . ]

  AUTHENTICATION MECHANISMS
       saslauthd supports one or more "authentication mechanisms", dependent
       upon the facilities provided by the underlying operating system.  The
       mechanism is selected by the -a flag from the following list of choices:

[ . . . ]

       pam        (Linux, Solaris)
  
                  Authenticate using Pluggable Authentication Modules (PAM).
[ . . . ]
</code></pre></div></div>

<p>Refer to 
<strong><a href="#authenticating-with-auth">Authenticating with AUTH</a></strong> section below
for additional information about AUTH protocol and SASL.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n "pwcheck_method: saslauthd" | sudo tee /usr/local/lib/sasl2/Sendmail.conf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /usr/local/lib/sasl2/Sendmail.conf
pwcheck_method: saslauthd
</code></pre></div></div>

<p>To run <em>saslauthd</em> from startup, add <code class="language-plaintext highlighter-rouge">saslauthd_enable="YES"</code> in
your <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n 'saslauthd_enable="YES"' | sudo tee -a /etc/rc.conf
</code></pre></div></div>

<p>From the <a href="https://docs.freebsd.org/en/books/handbook/mail/#SMTP-Auth">FreeBSD Handbook - 30.9. SMTP Authentication</a>:</p>

<blockquote>
  <p>This daemon serves as a broker for <em>sendmail</em> to authenticate against
the FreeBSD <code class="language-plaintext highlighter-rouge">passwd(5)</code> database.  This saves the trouble of creating
a new set of usernames and passwords for each user that needs to use SMTP
authentication, and keeps the login and mail password the same.</p>
</blockquote>

<h3 id="install-and-configure-sendmail-from-packages-ports">Install and Configure Sendmail from Packages (Ports)</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pkg install sendmail
</code></pre></div></div>

<p>Output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ . . . ]

===&gt; Creating groups.
Using existing group 'smmsp'.
===&gt; Creating users
Using existing user 'smmsp'.
===&gt; Creating homedir(s)
[2/2] Extracting sendmail-8.17.1_5: 100%
=====

[ . . . ]

Message from sendmail-8.17.1_5:

--
On install:
you should add in /etc/make.conf:
SENDMAIL_CF_DIR=        /usr/local/share/sendmail/cf
 
To deliver all local mail to your mailhub, edit the last line of submit.mc:
FEATURE(`msp','[mailhub.do.main]`)dnl

To update your configuration look at /usr/local/share/sendmail/cf/README.
---------------------------------------------------
To use the binaries supplied by the port you should add the following lines
to your sendmail.mc file before any mailer or feature definition:

define(`confEBINDIR', `/usr/local/libexec')dnl
define(`UUCP_MAILER_PATH', `/usr/local/bin/uux')dnl

---------------------------------------------------
To activate sendmail as your default mailer, run:
$ cd /usr/local/etc/mail &amp;&amp; cp mailer.conf.sendmail mailer.conf

Your '/usr/local/etc/mail/mailer.conf' should look like this:
#
# Execute the "real" sendmail program, named /usr/libexec/sendmail/sendmail
#
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail
hoststat        /usr/local/sbin/sendmail
purgestat       /usr/local/sbin/sendmail

You may also need to update /etc/rc.conf.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n 'SENDMAIL_CF_DIR=/usr/local/share/sendmail/cf' | sudo tee -a /etc/make.conf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /etc/make.conf
SENDMAIL_CFLAGS+=-I/usr/local/include -DSASL=2
SENDMAIL_LDFLAGS+=-L/usr/local/lib
SENDMAIL_LDADD+=-lsasl2
SENDMAIL_CF_DIR=/usr/local/share/sendmail/cf
</code></pre></div></div>

<p>The package-installed <em>sendmail</em> includes SASL support:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ /usr/local/sbin/sendmail -bt -d0 &lt; /dev/null | grep SASL
                PICKY_HELO_CHECK PIPELINING SASLv2 SCANF STARTTLS TCPWRAPPERS
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ /usr/local/sbin/sendmail -bt -d0 &lt; /dev/null 
Version 8.17.1
 Compiled with: DANE DNSMAP IPV6_FULL LOG MAP_REGEX MATCHGECOS MILTER
                MIME7TO8 MIME8TO7 NAMED_BIND NETINET NETINET6 NETUNIX NEWDB NIS
                PICKY_HELO_CHECK PIPELINING SASLv2 SCANF STARTTLS TCPWRAPPERS
                TLS_EC TLS_VRFY_PER_CTX USERDB XDEBUG

============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = fbsd1
  (canonical domain name) $j = fbsd1.home.arpa
         (subdomain name) $m = home.arpa
              (node name) $k = fbsd1.home.arpa
========================================================

ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &lt;ruleset&gt; &lt;address&gt;
&gt; $ 
$ 
</code></pre></div></div>

<p>To run <em>sendmail</em> from startup, add <code class="language-plaintext highlighter-rouge">sendmail_enable</code> to <code class="language-plaintext highlighter-rouge">YES</code> in
<code class="language-plaintext highlighter-rouge">/etc/rc.conf</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n 'sendmail_enable="YES"' | sudo tee -a /etc/rc.conf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ find /etc/rc* -iname '*sendmail*'
/etc/rc.d/sendmail
/etc/rc.sendmail
</code></pre></div></div>

<p><strong>NOTE:</strong> <br />
The <code class="language-plaintext highlighter-rouge">/etc/rc.d/sendmail</code> file is the actual <em>sendmail</em> startup script.</p>

<p>The <code class="language-plaintext highlighter-rouge">/etc/rc.sendmail</code> file is specific to <em>sendmail</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /etc/rc.sendmail
[ . . . ]
# This script is used by /etc/rc at boot time to start sendmail.  It
# is meant to be sendmail specific and not a generic script for all
# MTAs.  It is only called by /etc/rc if the rc.conf mta_start_script is
# set to /etc/rc.sendmail.  This provides the opportunity for other MTAs
# to provide their own startup script.

# The script is also used by /etc/mail/Makefile to enable the
# start/stop/restart targets.

# The source for the script can be found in src/etc/sendmail/rc.sendmail.
</code></pre></div></div>

<p>To display which <code class="language-plaintext highlighter-rouge">rc.conf(5)</code> variables (<strong>rcvar</strong>) are used to control
the startup of the <em>sendmail</em> service, use the <code class="language-plaintext highlighter-rouge">grep(1)</code> utility to search
the <em>sendmail</em> startup script (<code class="language-plaintext highlighter-rouge">/etc/rc.d/sendmail</code>) for lines  with <strong>rcvar</strong>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ grep 'rcvar=' /etc/rc.d/sendmail
rcvar="sendmail_enable"
        rcvar="sendmail_submit_enable"
        rcvar="sendmail_outbound_enable"
rcvar="sendmail_msp_queue_enable"
</code></pre></div></div>

<p>Yo don’t need to add the other three <em>rcvar</em> variables
(<code class="language-plaintext highlighter-rouge">sendmail_submit_enable</code>, <code class="language-plaintext highlighter-rouge">sendmail_outbound_enable</code>,
<code class="language-plaintext highlighter-rouge">sendmail_msp_queue_enable</code>) to <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code> because they are set 
to <em>YES</em> by default:  The <code class="language-plaintext highlighter-rouge">/etc/defaults/rc.conf</code> file contains
<strong>default</strong> <em>rcvar</em> variables for the default startup behaviour of
your system.  You need to put only your overrides into <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo grep sendmail_enable /etc/defaults/rc.conf
sendmail_enable="NO"    # Run the sendmail inbound daemon (YES/NO).
 
$ sudo grep sendmail_submit_enable /etc/defaults/rc.conf
sendmail_submit_enable="YES"    # Start a localhost-only MTA for mail submission
 
$ sudo grep sendmail_outbound_enable /etc/defaults/rc.conf
sendmail_outbound_enable="YES"  # Dequeue stuck mail (YES/NO).
 
$ sudo grep sendmail_msp_queue_enable /etc/defaults/rc.conf
sendmail_msp_queue_enable="YES" # Dequeue stuck clientmqueue mail (YES/NO).
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -lh /usr/local/share/sendmail/
total 13
drwxr-xr-x  11 root  wheel    13B Nov 12 19:30 cf
-r--r--r--   1 root  wheel   5.9K Sep  5 15:35 helpfile
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -lh /usr/local/share/sendmail/cf/
total 186
drwxr-xr-x  2 root  wheel    49B Nov 12 19:30 cf
drwxr-xr-x  2 root  wheel     8B Nov 12 19:30 domain
drwxr-xr-x  2 root  wheel    68B Nov 12 19:30 feature
drwxr-xr-x  2 root  wheel     4B Nov 12 19:30 hack
drwxr-xr-x  2 root  wheel     6B Nov 12 19:30 m4
drwxr-xr-x  2 root  wheel    14B Nov 12 19:30 mailer
drwxr-xr-x  2 root  wheel    58B Nov 12 19:30 ostype
-rw-r--r--  1 root  wheel   188K Jun  9  2021 README
-rw-r--r--  1 root  wheel   7.9K Apr  5  2021 sendmail.schema
drwxr-xr-x  2 root  wheel     3B Nov 12 19:30 sh
drwxr-xr-x  2 root  wheel     6B Nov 12 19:30 siteconfig
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd /etc/mail
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo su
Password:
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># pwd
/etc/mail
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># head -64 /etc/mail/Makefile
#
# $FreeBSD$
#
# This Makefile provides an easy way to generate the configuration
# file and database maps for the sendmail(8) daemon.
#
# The user-driven targets are:
#
# all     - Build cf, maps and aliases
# cf      - Build the .cf file from .mc file
# maps    - Build the feature maps
# aliases - Build the sendmail aliases
# install - Install the .cf file as /etc/mail/sendmail.cf
#
# For acting on both the MTA daemon and MSP queue running daemon:
# start        - Start both the sendmail MTA daemon and MSP queue running
#                daemon with the flags defined in /etc/defaults/rc.conf or
#                /etc/rc.conf
# stop         - Stop both the sendmail MTA daemon and MSP queue running
#                daemon
# restart      - Restart both the sendmail MTA daemon and MSP queue running
#                daemon
#
# For acting on just the MTA daemon:
# start-mta    - Start the sendmail MTA daemon with the flags defined in
#                /etc/defaults/rc.conf or /etc/rc.conf
# stop-mta     - Stop the sendmail MTA daemon
# restart-mta  - Restart the sendmail MTA daemon
#
# For acting on just the MSP queue running daemon:
# start-mspq   - Start the sendmail MSP queue running daemon with the
#                flags defined in /etc/defaults/rc.conf or /etc/rc.conf
# stop-mspq    - Stop the sendmail MSP queue running daemon
# restart-mspq - Restart the sendmail MSP queue running daemon
#
# Calling `make' will generate the updated versions when either the
# aliases or one of the map files were changed.
#
# A `make install` is only necessary after modifying the .mc file. In
# this case one would normally also call `make restart' to allow the
# running sendmail to pick up the changes as well.
#
# ------------------------------------------------------------------------
# This Makefile uses `&lt;HOSTNAME&gt;.mc' as the default MTA .mc file.  This
# can be changed by defining SENDMAIL_MC in /etc/make.conf, e.g.:
#
#       SENDMAIL_MC=/etc/mail/myconfig.mc
#
# If '&lt;HOSTNAME&gt;.mc' does not exist, it is created using 'freebsd.mc'
# as a template.
#
# It also uses '&lt;HOSTNAME&gt;.submit.mc' as the default mail submission .mc
# file.  This can be changed by defining SENDMAIL_SUBMIT_MC in
# /etc/make.conf, e.g.:
#
#       SENDMAIL_SUBMIT_MC=/etc/mail/mysubmit.mc
#
# If '&lt;HOSTNAME&gt;.submit.mc' does not exist, it is created using
# 'freebsd.submit.mc' as a template.
# ------------------------------------------------------------------------
#
# The Makefile knows about the following maps:
# access, authinfo, bitdomain, domaintable, genericstable, mailertable,
# userdb, uucpdomain, virtusertable
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh /usr/local/etc/sasldb2.db 
-rw-r-----  1 cyrus  mail    16K Nov 12 18:56 /usr/local/etc/sasldb2.db
</code></pre></div></div>

<p>NOTE: <br />
Even though the <code class="language-plaintext highlighter-rouge">/usr/local/share/doc/cyrus-sasl2/Sendmail.README</code> says
that the group needs to be <em>mail</em> in order to read the sasldb2 file,
my tests worked without adding the following line in <code class="language-plaintext highlighter-rouge">sendmail.mc</code> file
(on FreeBSD: <code class="language-plaintext highlighter-rouge">/etc/mail/freebsd.mc</code> and <code class="language-plaintext highlighter-rouge">/etc/mail/&lt;hostname&gt;.mc</code>).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define(`confRUN_AS_USER',`root:mail')dnl
</code></pre></div></div>

<h3 id="the-order-of-mc-lines">The Order Of mc Lines</h3>

<p>From <strong>sendmail</strong>, 4th Edition (a.k.a. <strong>“Bat Book”</strong>) <br />
By Bryan Costales, Claus Assmann, George Jansen, Gregory Neil Shapiro<br />
(Published by: O’Reilly Media, Inc., Publication Date: October 2007):</p>

<blockquote>
  <p>Some <em>mc</em> lines must precede others.  This is necessary partly because
<em><code class="language-plaintext highlighter-rouge">m4(1)</code></em> is a one-pass program, and partly because the order of items in
the final <em>sendmail.cf</em> file is also critical.  The recommended order is:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VERSIONID( )
OSTYPE( )
DOMAIN( )
option definitions
FEATURE( )
macro definitions
MAILER( )
ruleset definitions
</code></pre></div></div>

<p>The general rules about the order of macro definition declarations
in <em>mc</em> files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sed -n 128,152p /usr/local/share/sendmail/cf/README

        MAILER(`local')
        MAILER(`smtp')

These describe the mailers used at the default CS site.  The local
mailer is always included automatically.  Beware: MAILER declarations
should only be followed by LOCAL_* sections.  The general rules are
that the order should be:

        VERSIONID
        OSTYPE
        DOMAIN
        FEATURE
        local macro definitions
        MAILER
        LOCAL_CONFIG
        LOCAL_RULE_*
        LOCAL_RULESETS

There are a few exceptions to this rule.  Local macro definitions which
influence a FEATURE() should be done before that feature.  For example,
a define(`PROCMAIL_MAILER_PATH', ...) should be done before
FEATURE(`local_procmail').

*******************************************************************
</code></pre></div></div>

<p>Also in:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sed -n 128,152p /usr/share/sendmail/cf/README 
# sed -n 128,152p /usr/src/contrib/sendmail/cf/README
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># cp -i /etc/mail/freebsd.mc /etc/mail/freebsd.mc.ORIG
</code></pre></div></div>

<h3 id="edit-sendmailmc-freebsdmc-on-freebsd-file">Edit <strong>sendmail.mc</strong> (<strong>freebsd.mc</strong> on FreeBSD) File</h3>

<p>Continuing with setup, modify <code class="language-plaintext highlighter-rouge">sendmail.mc</code> file
(on FreeBSD this file is: <code class="language-plaintext highlighter-rouge">/etc/mail/freebsd.mc</code>).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vi /etc/mail/freebsd.mc
</code></pre></div></div>

<p>Content of the <code class="language-plaintext highlighter-rouge">freebsd.mc</code> file after editing it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ grep -v ^dnl /etc/mail/freebsd.mc | grep -v \^#
divert(-1)


divert(0)
VERSIONID(`$FreeBSD$')
OSTYPE(freebsd6)
DOMAIN(generic)

define(`confLOG_LEVEL', `14')dnl

define(`confEBINDIR', `/usr/local/libexec')dnl
define(`UUCP_MAILER_PATH', `/usr/local/bin/uux')dnl

FEATURE(`nouucp',`reject')dnl

TRUST_AUTH_MECH(`DIGEST-MD5 CRAM-MD5 EXTERNAL GSSAPI LOGIN PLAIN')dnl
define(`confAUTH_MECHANISMS',`DIGEST-MD5 CRAM-MD5 EXTERNAL GSSAPI LOGIN PLAIN')dnl
define(`confDONT_BLAME_SENDMAIL',`GroupReadableSASLDBFile')dnl

FEATURE(access_db, `hash -o -T&lt;TMPF&gt; /etc/mail/access')
FEATURE(blocklist_recipients)
FEATURE(local_lmtp)

FEATURE(mailertable, `hash -o /etc/mail/mailertable')
FEATURE(virtusertable, `hash -o /etc/mail/virtusertable')

define(`CERT_DIR', `/etc/mail/certs')dnl
define(`confSERVER_CERT', `CERT_DIR/host.cert')dnl
define(`confSERVER_KEY', `CERT_DIR/host.key')dnl
define(`confCLIENT_CERT', `CERT_DIR/host.cert')dnl
define(`confCLIENT_KEY', `CERT_DIR/host.key')dnl
define(`confCACERT', `CERT_DIR/cacert.pem')dnl
define(`confCACERT_PATH', `CERT_DIR')dnl
define(`confDH_PARAMETERS', `CERT_DIR/dh.param')dnl

define(`confCW_FILE', `-o /etc/mail/local-host-names')

DAEMON_OPTIONS(`Name=IPv4, Family=inet')

define(`confBIND_OPTS', `WorkAroundBrokenAAAA')
define(`confNO_RCPT_ACTION', `add-to-undisclosed')
define(`confPRIVACY_FLAGS', `authwarnings,noexpn,novrfy')

MAILER(local)dnl
MAILER(smtp)dnl

LOCAL_RULESETS
SLocal_trust_auth
R$*     $: $&amp;{auth_authen}
Rsmmsp  $# OK
</code></pre></div></div>

<p><strong>NOTE:</strong> 
The LHS (lefthand side) in the two lines below <code class="language-plaintext highlighter-rouge">SLocal_trust_auth</code>
is separated from the RHS (righthand side) by one or more
<strong>tab</strong> characters (space characters will not work).  In this case, for
the first line below <code class="language-plaintext highlighter-rouge">SLocal_trust_auth</code>, <code class="language-plaintext highlighter-rouge">$*</code> ends the left-hand side;
<code class="language-plaintext highlighter-rouge">$:</code> starts the right-hand side so the TAB character is before <code class="language-plaintext highlighter-rouge">$:</code>;
that is: <br />
<code class="language-plaintext highlighter-rouge">R$*</code>[TAB]<code class="language-plaintext highlighter-rouge">$: $&amp;{auth_authen}</code></p>

<p>Similarly, in the second line, there is a TAB after <code class="language-plaintext highlighter-rouge">Rsmmsp</code>; that is:<br />
<code class="language-plaintext highlighter-rouge">Rsmmsp</code>[TAB]<code class="language-plaintext highlighter-rouge">$# OK</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># touch /etc/mail/statistics
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh /etc/mail/statistics
-rw-r--r--  1 root  wheel     0B Nov 12 18:56 /etc/mail/statistics
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># mkdir /etc/mail/host_status
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -ld /etc/mail/host_status
drwxr-xr-x  2 root  wheel  2 Nov 12 18:56 /etc/mail/host_status
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># cp -i /etc/mail/freebsd.submit.mc /etc/mail/freebsd.submit.mc.ORIG
</code></pre></div></div>

<h3 id="edit-submitmc-on-freebsd-freebsdsubmitmc-file">Edit <strong>submit.mc</strong> (on FreeBSD: <strong>freebsd.submit.mc</strong>) File</h3>

<p>Modify the <em>submit.mc</em> file (on FreeBSD: <code class="language-plaintext highlighter-rouge">/etc/mail/freebsd.submit.mc</code>).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vi /etc/mail/freebsd.submit.mc
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># wc -l /etc/mail/freebsd.submit.mc
      46 /etc/mail/freebsd.submit.mc
</code></pre></div></div>

<p>Content of the <strong>freebsd.submit.mc</strong> file after editing it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /etc/mail/freebsd.submit.mc
divert(-1)

#
#  This is the FreeBSD configuration for a set-group-ID sm-msp sendmail
#  that acts as a initial mail submission program.
#

divert(0)dnl

VERSIONID(`$FreeBSD$')
define(`confCF_VERSION', `Submit')dnl
define(`__OSTYPE__',`')dnl dirty hack to keep proto.m4 from complaining
define(`_USE_DECNET_SYNTAX_', `1')dnl support DECnet
define(`confTIME_ZONE', `USE_TZ')dnl
define(`confDONT_INIT_GROUPS', `True')dnl
define(`confBIND_OPTS', `WorkAroundBrokenAAAA')dnl

define(`confLOG_LEVEL', `14')dnl

define(`SMART_HOST',`smartrelay:[127.0.0.1]')dnl
FEATURE(`authinfo',`hash /etc/mail/authinfo')dnl

dnl dnl MASQUERADE_AS(`domain.to.masquerade_as')dnl dnl
dnl dnl MASQUERADE_DOMAIN('fbsd1.home.arpa')dnl dnl
dnl # Uncomment the next line (with masquerade_envelope) if 
dnl # you want messages to be delivered to SMART_HOST. 
dnl dnl FEATURE(`masquerade_envelope')dnl
dnl dnl FEATURE(`masquerade_entire_domain')dnl dnl

dnl Disable SMTP AUTH on the loopback interface.
DAEMON_OPTIONS(`Name=NoMTA, Addr=127.0.0.1, M=EA')dnl

FEATURE(`msp', `[127.0.0.1]')dnl

MAILER_DEFINITIONS
dnl 
dnl     LR0relayST (Local Rule 0 relay Single Token)
dnl For addresses with only a single token (e.g. a username):  dusko 
MLR0relayST,	P=[IPC], F=mDFMuXa8k, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h

dnl
dnl     LR0relayLH [Local Rule 0 relay Local (AND) Hostname]
dnl For addresses:  dusko@localhost, dusko@&lt;hostname&gt; (that is:  dusko@fbsd1.home.arpa)
MLR0relayLH,	P=[IPC], F=mDFMuXa8k, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h

dnl
dnl     smartrelay 
dnl For nonlocal (external) addresses; for example: dusko@some.external.domain
Msmartrelay,	P=[IPC], F=mDFMuXa8k, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
		T=DNS/RFC822/SMTP,
		A=TCP $h 1465

LOCAL_RULE_0
R$-	$#LR0relayST $@ $j $: $1 &lt; @ $j. &gt;
R$+ &lt; @ $j. &gt;	$#LR0relayLH $@ $j $: $1 &lt; @ $j. &gt;
</code></pre></div></div>

<p><strong>NOTE:</strong>  <br />
The LHS (lefthand side) in two lines below <em>LOCAL_RULE_0</em> is separated from
the RHS (righthand side) by a <strong>tab</strong> character (space characters will not
work).  In this case, in the first line under <em>LOCAL_RULE_0</em>, the <code class="language-plaintext highlighter-rouge">-</code> 
character (the minus sign) ends the LHS; <code class="language-plaintext highlighter-rouge">$#</code> starts the RHS; that is: <br />
<code class="language-plaintext highlighter-rouge">R$-</code> [TAB] <code class="language-plaintext highlighter-rouge">$#LR0relayST $@ $j $: $1 &lt; @ $j. &gt;</code>  <br />
On the last line (second line under <em>LOCAL_RULE_0</em>), the <code class="language-plaintext highlighter-rouge">&gt;</code> character
(the greater-than sign) ends the LHS, while <code class="language-plaintext highlighter-rouge">$#</code> starts the RHS; that is:  <br />
<code class="language-plaintext highlighter-rouge">R$+ &lt; @ $j. &gt;</code> [TAB] <code class="language-plaintext highlighter-rouge">$#LR0relayLH $@ $j $: $1 &lt; @ $j. &gt;</code></p>

<p><strong>NOTE:</strong>  <br />
In the MAILER_DEFINITIONS <em>mc</em> configuration macro definitions, you don’t
have to use tabs between mailer names on the lefthand side (LHS) (in this
case, <code class="language-plaintext highlighter-rouge">LR0relayST</code>, <code class="language-plaintext highlighter-rouge">LR0relayLH</code> and <code class="language-plaintext highlighter-rouge">smartrelay</code>) and their definitions
(<strong>delivery agent equates</strong> <strong>[<sup><a href="#footnotes"> 10 </a></sup>]</strong>) on the
righthand side (RHS).</p>

<h3 id="three-new-customized-delivery-agents-mailers---explanation">Three New Customized Delivery Agents (Mailers) - Explanation</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define(`SMART_HOST',`smartrelay:[127.0.0.1]')dnl
</code></pre></div></div>

<p>To enable forwarding of all <strong>nonlocal</strong> mail to a <strong>smart</strong> gateway host,
you need to define <code class="language-plaintext highlighter-rouge">SMART_HOST</code>.</p>

<p>Here, Internet mail (nonlocal mail) will be forwarded to the host
<code class="language-plaintext highlighter-rouge">[127.0.0.1]</code> using the <strong>smartrelay</strong> delivery agent [the delivery agent
name is separated from the domain name by a colon (<code class="language-plaintext highlighter-rouge">:</code>)].
The square brackets (<code class="language-plaintext highlighter-rouge">[</code> and <code class="language-plaintext highlighter-rouge">]</code>) around <code class="language-plaintext highlighter-rouge">127.0.0.1</code> tell <em>sendmail</em> that
it is dealing with an <strong>IP address</strong>, rather than a hostname.  In other words, 
the <strong>square brackets</strong> around <code class="language-plaintext highlighter-rouge">127.0.0.1</code> <strong>suppress</strong> the lookup
of <strong>MX records</strong>.  During canonicalization of a hostname, when the
IP address between the square brackets corresponds to a known host,
the address and the square brackets are replaced with that host’s canonical
name.  <br />
In this case, canonical domain name for my localhost is <em>fbsd1.home.arpa</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -d0 &lt; /dev/null
[ . . . ]
  (canonical domain name) $j = fbsd1.home.arpa 
[ . . . ]
</code></pre></div></div>

<p>As a special case, the [default] delivery agent named <em>local</em> causes
slightly different behaviour in that it allows the name of the target user
to be listed without a host part:  <em>localhost local:dusko</em>; or
<em>fbsd1.home.arpa local:dusko</em>.</p>

<p>For configuration in this article, the smart host is configured to use host
<em>127.0.0.1</em> (<em>localhost</em>) via the newly defined custom delivery
agent (named <em>smartrelay</em>).  I defined the <em>smartrelay</em> delivery agent
in the configuration file for the submission form of <em>sendmail</em>
(a.k.a. <em>msp sendmail</em>), <code class="language-plaintext highlighter-rouge">submit.mc</code>
(in FreeBSD, this file is: <code class="language-plaintext highlighter-rouge">/etc/mail/freebsd.submit.mc</code>)
to use port <em>1465</em> because I earlier chose that port number
in the <em>stunnel.conf</em> configuration file to be a conduit for tunneling
SSL to port <em>465</em> on the external smart host side. <br />
An excerpt from <em>stunnel.conf</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>accept = 127.0.0.1:1465 
connect = your.isp.net:465
</code></pre></div></div>

<p><strong>MSP</strong> (mail submission program) is a command-line <em>sendmail</em> that
functions as a mail submission agent (<strong>MSA</strong>).</p>

<p>All mailer (a.k.a. deliver agent) definitions begin with the <code class="language-plaintext highlighter-rouge">M</code> operator.</p>

<p>All recipient addresses must resolve to a mailer (delivery agent)
in <strong>rulest 0</strong>.</p>

<p>In <em>sendmail</em>, a delivery agent is selected by the RHS of a <em>parse</em> rule
set 0 rule.</p>

<p>In a setup in which the smart host is configured this way [to be
tunneled through the <em>localhost</em> with the <em>stunnel</em> to the actual
(external) smart host] I need to define two new, customized local delivery
agents for delivering local mail.  Otherwise, local mail would be 
forwarded by connecting to <em>[127.0.0.1]</em> via the default MSP <code class="language-plaintext highlighter-rouge">relay</code> delivery
agent, in which case authentication would fail because the client’s
authentication credentials (configured earlier and stored in the
<code class="language-plaintext highlighter-rouge">/etc/mail/authinfo</code> file) are for the smart host; that is, they are not
authentication credentials for your localhost.</p>

<p>Also, I need to define an additional custom delivery agent
for the smart relay.  This delivery agent will use the port number
specified earlier for <em>stunnel</em> on the localhost side (in this case, port
<em>1465</em>) for tunneling mail to the smart relay side (which, in this case
requires authentication on port <em>465</em>).</p>

<p>The three new delivery agents - summarized:</p>

<p><em>MLR0relayST</em> <br />
M = mailer definition <br />
Mailer name: <strong>LR0relayST</strong> <br />
Will be used when the address is a single token (such as <em>dusko</em>)</p>

<p><em>MLR0relayLH</em> <br />
M = mailer definition <br />
Mailer name: <strong>LR0relayLH</strong> <br />
Will be used when the address is the local hostname <br />
(<em>dusko@localhost</em>, or in this case: <em>dusko@fbsd1.home.arpa</em>)</p>

<p><em>Msmartrelay</em> <br />
M = mailer definition  <br />
Mailer name: <strong>smartrelay</strong> <br />
Will be used when the address is a nonlocal (external) addresses<br />
(for example: <em>dusko@some.external.domain</em>)</p>

<p>Three new/customized mailers (a.k.a. delivery agents) are defined under
<code class="language-plaintext highlighter-rouge">MAILER_DEFINITIONS</code>. <br />
The <code class="language-plaintext highlighter-rouge">MAILER_DEFINITIONS</code> <em>m4</em> command is used for grouping delivery agent
definitions.</p>

<h3 id="local_rule_0-mc-macro---explanation">LOCAL_RULE_0 mc Macro - Explanation</h3>

<p><strong>LOCAL_RULE_0</strong> mc macro adds rules to <code class="language-plaintext highlighter-rouge">parse</code> rule set 0.</p>

<p>I will use <em>LOCAL_RULE_0</em> to declare two new rules in the <code class="language-plaintext highlighter-rouge">parse</code> rule set 0.</p>

<ul>
  <li>The first rule detects a <strong>single token</strong> in the address (such as <em>dusko</em>)
and calls the <code class="language-plaintext highlighter-rouge">LR0relayST</code> delivery agent.</li>
  <li>The second rule detects a match with localhost
(such as <em>localhost</em> or <em>local-hostname.some.domain</em>)
and calls the <code class="language-plaintext highlighter-rouge">LR0relayLH</code> delivery agent. <strong>Note:</strong> This check is done
against the local hostname after it went through the process of 
canonicalization.
    <ul>
      <li>In the flow of rules through the parse rule set 0, 
canonicalization is done first.  In this case, the <code class="language-plaintext highlighter-rouge">canonify</code> ruleset
returns <code class="language-plaintext highlighter-rouge">dusko &lt; @ fbsd1 . home . arpa . &gt;</code> for both inputs 
<code class="language-plaintext highlighter-rouge">dusko@localhost</code> and <code class="language-plaintext highlighter-rouge">dusko@fbsd1.home.arpa</code>. <br />
My workstation’s hostname is <em>fbsd1.home.arpa</em>.  Its canonical domain
name (<code class="language-plaintext highlighter-rouge">$j</code>) is <em>fbsd1.home.arpa</em>:</li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -d0 &lt; /dev/null
[ . . . ]
  (canonical domain name) $j = fbsd1.home.arpa
[ . . . ]
</code></pre></div></div>

<p>From <a href="https://sendmail.org/~ca/email/doc8.12/op-sh-5.html">The Whole Scoop on the Configuration File - Claus Aßmann at sendmail.org</a> (Retrieved on Nov 11, 2022):</p>

<blockquote>
  <p>R and S – Rewriting Rules</p>

  <p>The core of address parsing are the rewriting rules.  These are an ordered
production system.  <em>Sendmail</em> scans through the set of rewriting rules
looking for a match on the left hand side (LHS) of the rule.  When a rule
matches, the address is replaced by the right hand side (RHS) of the rule.</p>
</blockquote>

<blockquote>
  <p>The syntax of the R command:</p>

  <p><strong>R</strong> <em>lhs</em> <em>rhs</em> <em>comments</em></p>

  <p>The fields must be separated by at least one <strong>tab character</strong>;
there may be embedded spaces in the fields.  The <em>lhs</em> is a pattern that
is applied to the input.  If it matches, the input is rewritten to the <em>rhs</em>.
The comments are ignored.</p>
</blockquote>

<blockquote>
  <p><strong>The left hand side</strong></p>

  <p>The left hand side of rewriting rules contains a pattern.  Normal words
are simply matched directly.  Metasyntax is introduced using
a <strong>dollar sign</strong>.  The metasymbols are:</p>

  <p><strong>$*</strong>	Match zero or more tokens<br />
<strong>$+</strong>	Match one or more tokens<br />
<strong>$-</strong>	Match exactly one token<br />
<strong>$=</strong><em>x</em>	Match any phrase in class <em>x</em> <br />
<strong>$~</strong><em>x</em>	Match any word not in class <em>x</em></p>

  <p>If any of these match, they are assigned to the symbol <strong>$</strong> <em>n</em> for
replacement on the right hand side, where <em>n</em> is the index in the LHS.
For example, if the LHS:</p>

  <p>$-:$+</p>

  <p>is applied to the input:</p>

  <p>UCBARPA:eric</p>

  <p>the rule will match, and the values passed to the RHS will be:</p>

  <p>$1 UCBARPA <br />
$2 eric</p>

  <p>Additionally, the LHS can include <strong>$@</strong> to match <strong>zero</strong> tokens.
This is not bound to a <strong>$</strong> <em>n</em> on the RHS, and is normally only used
when it stands alone in order to match the <strong>null input</strong>.</p>

  <p><strong>The right hand side</strong></p>

  <p>When the left hand side of a rewriting rule matches, the input is deleted
and replaced by the right hand side.  Tokens are copied directly from the
RHS unless they begin with a dollar sign.  Metasymbols are:</p>

  <p><strong>$</strong><em>n</em>	Substitute indefinite token n from LHS<br />
<strong>$[</strong><em>name</em><strong>$]</strong>	Canonicalize name <br />
<strong>$(</strong><em>map key <strong>$@</strong></em>arguments <strong>$:</strong><em>default</em> <strong>$)</strong> <br />
Generalized keyed mapping function <br />
<strong>$&gt;</strong><em>n</em>	“Call” ruleset <em>n</em> <br />
<strong>$#</strong><em>mailer</em>	Resolve to <em>mailer</em> <br />
<strong>$@</strong><em>host</em>	Specify <em>host</em> <br />
<strong>$:</strong><em>user</em>	Specify <em>user</em></p>

  <p>The <strong>$</strong> <em>n</em> syntax substitutes the corresponding value from a <strong>$+</strong>,
<strong>$-</strong>, <strong>$*</strong>, <strong>$=</strong>, or <strong>$~</strong> match on the LHS.  It may be used
anywhere.</p>

  <p>A host name enclosed between <strong>$[</strong> and <strong>$]</strong> is looked up in the host
database(s) and replaced by the canonical name.  For example, <code class="language-plaintext highlighter-rouge">$[ftp$]</code>
might become <code class="language-plaintext highlighter-rouge">ftp.CS.Berkeley.EDU</code> and <code class="language-plaintext highlighter-rouge">$[[128.32.130.2]$]</code> would become
<code class="language-plaintext highlighter-rouge">vangogh.CS.Berkeley.EDU</code>.  <em>Sendmail</em> recognizes its numeric IP address
without calling the name server and replaces it with its canonical name.</p>

  <p>The <strong>$( … $)</strong> syntax is a more general form of lookup; it uses
a named map instead of an implicit map.  If no lookup is found, the
indicated <em>default</em> is inserted; if no default is specified and no
lookup matches, the value is left unchanged.  The <em>arguments</em> are passed
to the map for possible use.</p>

  <p>The <strong>$&gt;</strong> <em>n</em> syntax causes the remainder of the line to be substituted
as usual and then passed as the argument to ruleset <em>n</em>.  The final value
of ruleset n then becomes the substitution for this rule.  The <strong>$&gt;</strong>
syntax expands everything after the ruleset name to the end of the
replacement string and then passes that as the initial input to the
ruleset.  Recursive calls are allowed. For example,</p>

  <p>$&gt;0 $&gt;3 $1</p>

  <p>expands $1, passes that to ruleset 3, and then passes the result of
ruleset 3 to ruleset 0.</p>

  <p>The <strong>$#</strong> syntax should <strong>only</strong> be used in ruleset zero, a subroutine
of ruleset zero, or rulesets that return decisions (e.g., <code class="language-plaintext highlighter-rouge">check_rcpt</code>).
It causes evaluation of the ruleset to terminate immediately, and signals
to <em>sendmail</em> that the address has completely resolved.  The complete
syntax for ruleset 0 is:</p>

  <p><strong>$#</strong><em>mailer</em> <strong>$@</strong><em>host</em> <strong>$:</strong><em>user</em></p>

  <p>This specifies the {mailer, host, user} 3-tuple necessary to direct
the mailer.  If the mailer is local the host part may be omitted.
The <em>mailer</em> must be a single word but the <em>host</em> and <em>user</em> may be
multi-part.  If the <em>mailer</em> is the built-in IPC mailer, the <em>host</em> may
be a colon-separated list of hosts that are searched in order for the
first working address (exactly like MX records).  The <em>user</em> is later
rewritten by the mailer-specific envelope rewriting set and assigned to
the <strong>$u</strong> macro.  As a special case, if the mailer specified has the
<strong>F=@</strong> flag specified and the first character of the <strong>$:</strong> value is <code class="language-plaintext highlighter-rouge">@</code>,
the <code class="language-plaintext highlighter-rouge">@</code> is stripped off, and a flag is set in the address descriptor that
causes sendmail to not do ruleset 5 processing.</p>

  <p>Normally, a rule that matches is retried, that is, the rule loops until
it fails.  A RHS may also be preceded by a <strong>$@</strong> or a <strong>$:</strong> to change
this behaviour.  A <strong>$@</strong> prefix causes the ruleset to return with the
remainder of the RHS as the value.  A <strong>$:</strong> prefix causes the rule to
terminate immediately, but the ruleset to continue; this can be used to
avoid continued application of a rule.  The prefix is stripped before continuing.</p>

  <p>The <strong>$@</strong> and <strong>$:</strong> prefixes may precede a <strong>$&gt;</strong> spec; for example:</p>

  <p>R$+ $: $&gt;7 $1</p>

  <p>matches anything, passes that to ruleset seven, and continues; the <strong>$:</strong>
is necessary to avoid an infinite loop.</p>

  <p>Substitution occurs in the order described, that is, parameters from the
LHS are substituted, hostnames are canonicalized, <code class="language-plaintext highlighter-rouge">subroutines</code> are called,
and finally <strong>$#</strong>, <strong>$@</strong>, and <strong>$:</strong> are processed.</p>
</blockquote>

<h3 id="mailer_definitions-m4-command---explanation">MAILER_DEFINITIONS m4 Command - Explanation</h3>

<p>The <strong>MAILER_DEFINITIONS</strong> section introduces your new delivery agent definitions.<br />
This m4 command forces new delivery agent definitions to be grouped with
the other delivery agent definitions.</p>

<p><strong>MAILER_DEFINITIONS</strong>  <br />
Define new (custom) delivery agents (aka “mailers”).</p>

<p>In this case, under <code class="language-plaintext highlighter-rouge">MAILER_DEFINITIONS</code> macro, three new deliver agents are defined:
<strong>MLR0relayST</strong>, <strong>MLR0relayLH</strong> and <strong>smartrelay</strong>.</p>

<p>A close inspection of the fields in these two mailer (delivery agent)
entries shows the following:</p>

<p><em>MLR0relayST</em>, <em>MLR0relayLH</em> and <em>Msmartrelay</em> <br />
Define and name a mailer, here arbitrarily named <em>MLR0relayST</em>, <em>MLR0relayLH</em> and <em>Msmartrelay</em>.</p>

<p><em>P=[IPC]</em> <br />
The path to the program used for this mailer is <code class="language-plaintext highlighter-rouge">[IPC]</code>, which means delivery
of this mail is handled internally by <em>sendmail</em>.</p>

<p><em>F=mDFMuXa8k</em><br />
The <em>sendmail</em> flags for this mailer say that this mailer can send to
multiple recipients at once (<code class="language-plaintext highlighter-rouge">m</code>); that Date (<code class="language-plaintext highlighter-rouge">D</code>), From (<code class="language-plaintext highlighter-rouge">F</code>), and
Message-Id (<code class="language-plaintext highlighter-rouge">M</code>) headers are required; that uppercase should be preserved
in hostnames and usernames (<code class="language-plaintext highlighter-rouge">u</code>); that lines beginning with a dot have an
extra dot prepended (<code class="language-plaintext highlighter-rouge">X</code>); to run extended SMTP protocol (ESMTP) (<code class="language-plaintext highlighter-rouge">a</code>);
to force sending 8-bit data over SMTP even if the receiving server doesn’t
support 8-bit MIME (<code class="language-plaintext highlighter-rouge">8</code>); and to don’t check for loops in EHLO/HELO command (<code class="language-plaintext highlighter-rouge">k</code>).</p>

<p><em>S=EnvFromSMTP/HdrFromSMTP</em>  <br />
The sender address in the mail <em>envelope</em> is processed through ruleset<code class="language-plaintext highlighter-rouge">EnvFromSMTP</code>,
and the sender address in the <em>message</em> is processed through ruleset <code class="language-plaintext highlighter-rouge">HdrFromSMTP</code>.</p>

<p><em>R=EnvToSMTP</em> <br />
All recipient addresses are processed through ruleset EnvToSMTP.</p>

<p><em>E=\r\n</em> <br />
Lines are terminated with a carriage return and a line feed.</p>

<p><em>L=2040</em> <br />
This mailer will handle lines up to 2040 bytes long.</p>

<p><em>T=DNS/RFC822/SMTP</em> <br />
The MIME-type information for this mailer says that DNS is used for hostnames,
RFC 822 email addresses are used, and SMTP error codes are used.</p>

<p><em>A=TCP $h</em> <br />
An internal <em>sendmail</em> process designed to deliver SMTP mail over a TCP connection.
The macro <code class="language-plaintext highlighter-rouge">$h</code> is expanded to provide the recipient host (<code class="language-plaintext highlighter-rouge">$h</code>) address.</p>

<p>All three custom delivery agents (<em>LR0relayST</em>, <em>LR0relayLH</em> and <em>smartrelay</em>)
have been copied from the <strong>relay</strong> delivery agent as defined and provided by
default in the <code class="language-plaintext highlighter-rouge">/etc/mail/submit.cf</code> file, and then modified. 
For my purposes, I’ve made only two modifications:</p>
<ul>
  <li>renaming delivery agent (to: <em>LR0relayST</em>, <em>LR0relayLH</em> and <em>smartrelay</em>), and</li>
  <li>for the <em>Msmartrelay</em> delivery agent: added a port number <strong>1465</strong> as
that’s the port configured to be used by <em>stunnel</em>.</li>
</ul>

<p>The <em>relay</em> delivery agent as defined by default in the <strong>sendmail.cf</strong>
configuration file uses TCP to connect to other hosts.  It speaks ESMTP
and has the <strong>F=mDFMuXa8</strong> delivery agent flags set by default:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ grep -A3 Mrelay /etc/mail/sendmail.cf
Mrelay,         P=[IPC], F=mDFMuXa8, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
                T=DNS/RFC822/SMTP,
                A=TCP $h
</code></pre></div></div>

<p>This delivery agent (the <em>relay</em> delivery agent) is chosen for forwarding
mail to the <strong>SMART_HOST</strong> (<code class="language-plaintext highlighter-rouge">SMART_HOST</code> mc macro). <strong>[<sup><a href="#footnotes"> 8 </a></sup>]</strong></p>

<p>However, note that in the <strong>submit.cf</strong> configuration file, which is the
configuration file that <em>sendmail</em> uses for its <strong>MSP</strong> (mail submission program)
[(a command-line <em>sendmail</em> that functions as a mail submission agent (<strong>MSA</strong>)],
the <strong>relay</strong> delivery agent is defind sligthly differently.  (The only difference
is in <strong>F=mDFMuXa8k</strong> delivery agent flags.  These are the same delivery
agent flags that <em>relay</em> in <em>sendmail.cf</em> uses  but with the <strong>F=k</strong> delivery
agent flag added, which means “Don’t check for loops in HELO/EHLO command”.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ grep -A3 Mrelay /etc/mail/submit.cf
Mrelay,         P=[IPC], F=mDFMuXa8k, S=EnvFromSMTP/HdrFromSMTP, R=MasqSMTP, E=\r\n, L=2040,
                T=DNS/RFC822/SMTP,
                A=TCP $h
</code></pre></div></div>

<p><strong>LOCAL_RULE_0</strong>  <br />
Add rules to parse rule set 0</p>

<p>Ruleset 0 is applied to recipient addresses by <em>sendmail</em> after Ruleset 3
<strong>[<sup><a href="#footnotes"> 9 </a></sup>]</strong>.
Ruleset 0 is expected to perform the delivery of the message to the recipient
so it must resolve to a triple that specifies each of the mailer, host,
and user.  The rules will be placed <strong>before</strong> any <strong>smart host</strong>
definition you may include so if you add rules that resolve addresses
appropriately, any address that matches a rule will <strong>not</strong> be handled by
the smart host.</p>

<p>The <code class="language-plaintext highlighter-rouge">LOCAL_RULE_0</code> macro marks the start of <em>sendmail.cf</em> code that is
added to <strong>ruleset 0</strong> (more commonly called the <strong>parse</strong> ruleset).
Specifically, the code that follows the <code class="language-plaintext highlighter-rouge">LOCAL_RULE_0</code> macro is added to
the <code class="language-plaintext highlighter-rouge">ParseLocal</code> ruleset, which is a hook into the <em>parse</em> ruleset where
<strong>locally defined rules</strong> are added.  The <em>parse</em> ruleset rewrites the delivery
address to a mail delivery triple.</p>

<p>The code that follows the <code class="language-plaintext highlighter-rouge">LOCAL_RULE_0</code> macro above is a rewrite rule.
The <code class="language-plaintext highlighter-rouge">R</code> command is used to define a rewriting rule: 
Mail addresses are compared to the rule on the left hand side (<code class="language-plaintext highlighter-rouge">$-</code> and <code class="language-plaintext highlighter-rouge">$+</code>)
(the <code class="language-plaintext highlighter-rouge">$j</code> macro holds the canonical domain name; which is in this case:
<code class="language-plaintext highlighter-rouge">fbsd1.home.arpa</code>).  If they match it, the rule rewrites those addresses
into a mail delivery triple where the mailer is <em>LR0relayLH</em>.</p>

<p>After rebuilding the configuration with the new master configuration file,
running a <code class="language-plaintext highlighter-rouge">sendmail -bv</code> test (with the <code class="language-plaintext highlighter-rouge">-Ac</code> parameters so that the
<strong>submit.cf</strong> is used instead of <strong>sendmail.cf</strong>) shows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo sendmail -Ac -bv dusko
dusko... deliverable: mailer LR0relayST, host fbsd1.home.arpa,
  user dusko@fbsd1.home.arpa

$ sudo sendmail -Ac -bv dusko@localhost
dusko@localhost... deliverable: mailer LR0relayLH, host fbsd1.home.arpa,
  user dusko@fbsd1.home.arpa

$ sudo sendmail -Ac -bv dusko@fbsd1.home.arpa
dusko@fbsd1.home.arpa... deliverable: mailer LR0relayLH, host fbsd1.home.arpa,
  user dusko@fbsd1.home.arpa

$ sudo sendmail -Ac -bv dusko@some.external.domain
dusko@some.external.domain... deliverable: mailer smartrelay, host [127.0.0.1],
  user dusko@some.external.domain
</code></pre></div></div>

<p><strong>NOTE:</strong>  Without defining the new, customized delivery agents
<em>LR0relayST</em> and <em>LR0relayLH</em>, delivery agent selected for local
delivery would have been the <code class="language-plaintext highlighter-rouge">relay</code> mailer supplied by default
by <em>sendmail</em>.  To check that you can run the following commands with
the default <code class="language-plaintext highlighter-rouge">submit.mc</code> (for FreeBSD: <code class="language-plaintext highlighter-rouge">freebsd.submit.mc</code>); that is,
without defining custom mailers (delivery agents):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo sendmail -Ac -bt 
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &lt;ruleset&gt; &lt;address&gt;

&gt; ?
Help for test mode:
?                :this help message.
[ . . . ]
=M               :display the known mailers.
[ . . . ]

&gt; =M 
[ . . .] 
mailer 8 (relay): P=[IPC] S=EnvFromSMTP/HdrFromSMTP R=MasqSMTP/MasqSMTP M=0 U=-1:-1 F=8DFMXakmu
  L=2040 E=\r\n T=DNS/RFC822/SMTP r=100 A=TCP $h
[ . . .] 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo sendmail -Ac -bv dusko
dusko... deliverable: mailer relay, host [127.0.0.1], user dusko@fbsd1.home.arpa

$ sudo sendmail -Ac -bv dusko@localhost
dusko@localhost... deliverable: mailer relay, host [127.0.0.1], user dusko@fbsd1.home.arpa

$ sudo sendmail -Ac -bv dusko@fbsd1.chem.ubc.ca
dusko@fbsd1.home.arpa... deliverable: mailer relay, host [127.0.0.1], user dusko@fbsd1.home.arpa

$ sudo sendmail -Ac -bv dusko@some.external.domain
dusko@some.external.domain... deliverable: mailer smartrelay, host [127.0.0.1],
  user dusko@some.external.domain
</code></pre></div></div>

<p>Continuing with the dissection of Ruleset 0 (a.k.a. <em>parse</em> ruleset):</p>

<p>Run <em>sendmail</em> in address test mode by using the <code class="language-plaintext highlighter-rouge">-bt</code> parameters (and also
with the <code class="language-plaintext highlighter-rouge">-Ac</code> parameters so that the <em>submit.cf</em> is used instead of <em>sendmail.cf</em>).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -bt -v -Ac
</code></pre></div></div>

<h3 id="parse-an-address-with-parse">Parse an Address with /parse</h3>

<p>(Adapted and modified based on 
“The Bat Book” - sendmail, 4th Edition by Bryan Costales, Claus Assmann,
George Jansen, Gregory Neil Shapiro - Published by O’Reilly Media, Inc.,
October 2007 - Chapter 8. Test Rule Sets with -bt;
Section <em>Parse an Address with /parse</em>.)</p>

<p>The <code class="language-plaintext highlighter-rouge">/parse</code> rule-testing command instructs <em>sendmail</em> to pass an address
through a predetermined sequence of rules to select a delivery agent and
to put the <code class="language-plaintext highlighter-rouge">$u</code> macro into its final form.  The <code class="language-plaintext highlighter-rouge">/parse</code> command is used
like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/parse address
</code></pre></div></div>

<p>Parse the indicated addresses (dusko, dusko@localhost, dusko@fbsd1.home.arpa,
dusko@some.external.domain) returning the parsed address and mailer
(a.k.a. delivery agent) that <em>sendmail</em> will use.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; /parse dusko
Cracked address = $g
Parsing envelope recipient address
canonify          input: dusko
Canonify2         input: dusko
Canonify2       returns: dusko
canonify        returns: dusko
parse             input: dusko
Parse0            input: dusko
Parse0          returns: dusko
ParseLocal        input: dusko
ParseLocal      returns: $# LR0relayST $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse           returns: $# LR0relayST $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
2                 input: dusko &lt; @ fbsd1 . home . arpa . &gt;
2               returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
MasqSMTP          input: dusko &lt; @ fbsd1 . home . arpa . &gt;
MasqSMTP        returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
final             input: dusko &lt; @ fbsd1 . home . arpa . &gt;
final           returns: dusko @ fbsd1 . home . arpa
mailer LR0relayST, host fbsd1.home.arpa, user dusko@fbsd1.home.arpa
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; /parse dusko@localhost (FirstN LastN)
Cracked address = $g (FirstN LastN)
Parsing envelope recipient address
canonify          input: dusko @ localhost
Canonify2         input: dusko &lt; @ localhost &gt;
Canonify2       returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
canonify        returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse             input: dusko &lt; @ fbsd1 . home . arpa . &gt;
Parse0            input: dusko &lt; @ fbsd1 . home . arpa . &gt;
Parse0          returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
ParseLocal        input: dusko &lt; @ fbsd1 . home . arpa . &gt;
ParseLocal      returns: $# LR0relayLH $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse           returns: $# LR0relayLH $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
2                 input: dusko &lt; @ fbsd1 . home . arpa . &gt;
2               returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
MasqSMTP          input: dusko &lt; @ fbsd1 . home . arpa . &gt;
MasqSMTP        returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
final             input: dusko &lt; @ fbsd1 . home . arpa . &gt;
final           returns: dusko @ fbsd1 . home . arpa 
mailer LR0relayLH, host fbsd1.home.arpa, user dusko@fbsd1.home.arpa
</code></pre></div></div>

<p>The address <em>you@localhost</em> is first fed into <em>crackaddr</em>
[line <em>Cracked address = $g (FirstN LastN)</em>] to separate it from any
surrounding RFC822 comments such as “(FirstN LastN)”.  If mail were
actually to be sent, the address would be stored in the <code class="language-plaintext highlighter-rouge">$g</code> macro before
being passed to rules.  That line uses <code class="language-plaintext highlighter-rouge">$g</code> as a placeholder to show where
the address was found.</p>

<p>The next line (<em>Parsing envelope recipient address</em>) shows that the address
will be treated as that of an <em>envelope recipient</em>.  The <code class="language-plaintext highlighter-rouge">/tryflags</code> command
sets whether it is treated as a <em>header</em> or <em>envelope</em> or as a <em>sender</em> or
<em>recipient</em> address.</p>

<p>The address is passed to the <code class="language-plaintext highlighter-rouge">canonify</code> rule set 3 because all addresses
are rewritten by the <code class="language-plaintext highlighter-rouge">canonify</code> rule set 3 first.  The job of the <code class="language-plaintext highlighter-rouge">canonify</code>
rule set 3 is to focus on (surround in angle brackets) the host part of the
address, which it does (line <em>Canonify2          input: dusko &lt; @ localhost &gt;</em>).
The <code class="language-plaintext highlighter-rouge">canonify</code> rule set 3, in this example, then passes the address to the
<code class="language-plaintext highlighter-rouge">Canonify2</code> rule set to see whether <em>localhost</em> is a synonym for the
local machine’s name.  Since it is, the <code class="language-plaintext highlighter-rouge">Canonify2</code> rule set makes that
translation (<em>Canonify2        returns: dusko &lt; @ fbsd1 . home . arpa . &gt;</em>).</p>

<p>The output of the <code class="language-plaintext highlighter-rouge">canonify</code> rule set 3 is passed to the <code class="language-plaintext highlighter-rouge">parse</code> rule set 0,
whose job is to select a <strong>delivery agent</strong>
(line <em>parse             input: dusko &lt; @ fbsd1 . home . arpa . &gt;</em>).
Since <em>fbsd1.home.arpa</em> is the local machine, the <code class="language-plaintext highlighter-rouge">parse</code> rule set 0
(by way of other rule sets) selects the <code class="language-plaintext highlighter-rouge">LR0relayLH</code> customized (local)
delivery agent <br />
(line
<em>parse    returns: $# LR0relayLH $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;</em>).</p>

<p>That line shows that the <code class="language-plaintext highlighter-rouge">$:</code> part of the delivery agent <strong>triple</strong> will
eventually be tucked into <code class="language-plaintext highlighter-rouge">$u</code> for use by the delivery agent’s <code class="language-plaintext highlighter-rouge">A=</code>
delivery agent equate.  Before that happens, that address needs to be
passed through its own set of specific rules.   It is given to rule set 2
because all recipient addresses are given to rule set 2 <br />
(line  <em>2            input: dusko &lt; @ fbsd1 . home . arpa . &gt;</em>). 
It is then given to rule set <code class="language-plaintext highlighter-rouge">MasqSMTP</code> because the <code class="language-plaintext highlighter-rouge">R=</code> delivery agent
equate for the <code class="language-plaintext highlighter-rouge">LR0relayLH</code> customized local delivery agent specifies rule
set <code class="language-plaintext highlighter-rouge">MasqSMTP</code> for the envelope recipient
(line <em>MasqSMTP          input: dusko &lt; @ fbsd1 . home . arpa . &gt;</em>).
Finally, it is given to the <code class="language-plaintext highlighter-rouge">final</code> rule set 4 because all addresses are
lastly rewritten by the final rule set 4 (line 
<em>final           returns: dusko @ fbsd1 . home . arpa</em>). 
The last line of output shows that the customized local delivery agent
<code class="language-plaintext highlighter-rouge">LR0relayLH</code> was selected and that the value that would be put into <code class="language-plaintext highlighter-rouge">$u</code>
(were mail really being sent) would be <code class="language-plaintext highlighter-rouge">dusko@fbsd1.home.arpa</code>.</p>

<p>Similarly, with the actual local host’s hostname (<em>fbsd1.home.arpa</em>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; /parse dusko@fbsd1.home.arpa
Cracked address = $g
Parsing envelope recipient address
canonify          input: dusko @ fbsd1 . home . arpa
Canonify2         input: dusko &lt; @ fbsd1 . home . arpa &gt;
Canonify2       returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
canonify        returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse             input: dusko &lt; @ fbsd1 . home . arpa . &gt;
Parse0            input: dusko &lt; @ fbsd1 . home . arpa . &gt;
Parse0          returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
ParseLocal        input: dusko &lt; @ fbsd1 . home . arpa . &gt;
ParseLocal      returns: $# LR0relayLH $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse           returns: $# LR0relayLH $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
2                 input: dusko &lt; @ fbsd1 . home . arpa . &gt;
2               returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
MasqSMTP          input: dusko &lt; @ fbsd1 . home . arpa . &gt;
MasqSMTP        returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
final             input: dusko &lt; @ fbsd1 . home . arpa . &gt;
final           returns: dusko @ fbsd1 . home . arpa
mailer LR0relayLH, host fbsd1.home.arpa, user dusko@fbsd1.home.arpa
</code></pre></div></div>

<p>In this configuration (with three customized delivery agents <em>LR0relayLH</em>,
<em>LR0relayST</em> and <em>smartrelay</em>), when you <code class="language-plaintext highlighter-rouge">/parse</code> an address that is not local:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; /parse dusko@some.external.domain
Cracked address = $g
Parsing envelope recipient address
canonify           input: dusko @ some . external . domain
Canonify2          input: dusko &lt; @ some . external . domain &gt;
Canonify2        returns: dusko &lt; @ some . external . domain . &gt;
canonify         returns: dusko &lt; @ some . external . domain . &gt;
parse              input: dusko &lt; @ some . external . domain . &gt;
Parse0             input: dusko &lt; @ some . external . domain . &gt;
Parse0           returns: dusko &lt; @ some . external . domain . &gt;
ParseLocal         input: dusko &lt; @ some . external . domain . &gt;
ParseLocal       returns: dusko &lt; @ some . external . domain . &gt;
Parse1             input: dusko &lt; @ some . external . domain . &gt;
MailerToTriple     input: &lt; smartrelay : [ 127 . 0 . 0 . 1 ] &gt; dusko &lt; @ some . external . domain . &gt;
MailerToTriple   returns: $# smartrelay $@ [ 127 . 0 . 0 . 1 ] $: dusko &lt; @ some . external . domain . &gt;
Parse1           returns: $# smartrelay $@ [ 127 . 0 . 0 . 1 ] $: dusko &lt; @ some . external . domain . &gt;
parse            returns: $# smartrelay $@ [ 127 . 0 . 0 . 1 ] $: dusko &lt; @ some . external . domain . &gt;
2                  input: dusko &lt; @ some . external . domain . &gt;
2                returns: dusko &lt; @ some . external . domain . &gt;
MasqSMTP           input: dusko &lt; @ some . external . domain . &gt;
MasqSMTP         returns: dusko &lt; @ some . external . domain . &gt;
final              input: dusko &lt; @ some . external . domain . &gt;
final            returns: dusko @ some . external . domain 
mailer smartrelay, host [127.0.0.1], user dusko@some.external.domain
</code></pre></div></div>

<p>In this configuration (with three customized delivery agents <em>LR0relayLH</em>,
<em>LR0relayST</em> and <em>smartrelay</em>), when you run the indicated addresses
(dusko, dusko@localhost, dusko@fbsd1.home.arpa, dusko@some.external.address)
through the rule 0:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; 0 dusko
parse             input: dusko
Parse0            input: dusko
Parse0          returns: dusko
ParseLocal        input: dusko
ParseLocal      returns: $# LR0relayST $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse           returns: $# LR0relayST $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; 0 dusko@localhost
parse              input: dusko @ localhost
Parse0             input: dusko @ localhost
Parse0           returns: dusko @ localhost
ParseLocal         input: dusko @ localhost
ParseLocal       returns: dusko @ localhost
Parse1             input: dusko @ localhost
Parse1           returns: $# local $: dusko @ localhost
parse            returns: $# local $: dusko @ localhost
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; 0 dusko@fbsd1.home.arpa
parse              input: dusko @ fbsd1 . home . arpa
Parse0             input: dusko @ fbsd1 . home . arpa
Parse0           returns: dusko @ fbsd1 . home . arpa
ParseLocal         input: dusko @ fbsd1 . home . arpa
ParseLocal       returns: dusko @ fbsd1 . home . arpa
Parse1             input: dusko @ fbsd1 . home . arpa
Parse1           returns: $# local $: dusko @ fbsd1 . home . arpa
parse            returns: $# local $: dusko @ fbsd1 . home . arpa
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; 0 dusko@some.external.address
parse              input: dusko @ some . external . domain
Parse0             input: dusko @ some . external . domain
Parse0           returns: dusko @ some . external . domain
ParseLocal         input: dusko @ some . external . domain
ParseLocal       returns: dusko @ some . external . domain
Parse1             input: dusko @ some . external . domain
Parse1           returns: $# local $: dusko @ some . external . domain
parse            returns: $# local $: dusko @ some . external . domain
</code></pre></div></div>

<p>Display the known mailers (by using the <code class="language-plaintext highlighter-rouge">=M</code> rule-testing command):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; =M
[ . . . ]
mailer 8 (relay): P=[IPC] S=EnvFromSMTP/HdrFromSMTP R=MasqSMTP/MasqSMTP M=0 U=-1:-1 F=8DFMXakmu L=2040 E=\r\n T=DNS/RFC822/SMTP r=100 A=TCP $h
mailer 9 (LR0relay): P=[IPC] S=EnvFromSMTP/HdrFromSMTP R=MasqSMTP/MasqSMTP M=0 U=-1:-1 F=8DFMXakmu L=2040 E=\r\n T=DNS/RFC822/SMTP r=100 A=TCP $h
mailer 10 (smartrelay): P=[IPC] S=EnvFromSMTP/HdrFromSMTP R=MasqSMTP/MasqSMTP M=0 U=-1:-1 F=8DFMXakmu L=2040 E=\r\n T=DNS/RFC822/SMTP r=100 A=TCP $h 1465
</code></pre></div></div>

<p>Dump the contents of the Ruleset 0.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; =S0
R$*             $: $&gt; Parse0 $1 
R&lt; @ &gt;          $# local $: &lt; @ &gt; 
R$*             $: $&gt; ParseLocal $1 
R$*             $: $&gt; Parse1 $1 
</code></pre></div></div>

<p>Dump the contents of the rule Parse0.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; =SParse0
R&lt; @ &gt;          $@ &lt; @ &gt;
[ . . . ]
R$* $=O $* &lt; @ *LOCAL* &gt;                $@ $&gt; Parse0 $&gt; canonify $1 $2 $3 
R$* &lt; @ *LOCAL* &gt;               $: $1 
</code></pre></div></div>

<p>Dump the contents of the rule ParseLocal.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; =SParseLocal
R$-       $# LR0relayST $@ fbsd1 . home . arpa $: $1 &lt; @ fbsd1 . home . arpa . &gt; 
R$+ &lt; @ fbsd1 . home . arpa . &gt;       $# LR0relayLH $@ fbsd1 . home . arpa $: $1 &lt; @ fbsd1 . home . arpa . &gt;
</code></pre></div></div>

<p>Dump the contents of the rule Parse1.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; =SParse1
R$* &lt; @ [ $+ ] &gt; $*             $: $&gt; ParseLocal $1 &lt; @ [ $2 ] &gt; $3 
R$* &lt; @ [ $+ ] &gt; $*             $: $1 &lt; @ [ $2 ] : smartrelay : [ 127 . 0 . 0 . 1 ] &gt; $3 
R$* &lt; @ [ $+ ] : &gt; $*           $# esmtp $@ [ $2 ] $: $1 &lt; @ [ $2 ] &gt; $3 
R$* &lt; @ [ $+ ] : $- : $* &gt; $*           $# $3 $@ $4 $: $1 &lt; @ [ $2 ] &gt; $5 
R$* &lt; @ [ $+ ] : $+ &gt; $*                $# esmtp $@ $3 $: $1 &lt; @ [ $2 ] &gt; $4 
R$=L &lt; @ $=w . &gt;                $# local $: @ $1 
R$+ &lt; @ $=w . &gt;                 $# local $: $1 
R$* &lt; @ $* &gt; $*                 $: $&gt; MailerToTriple &lt; smartrelay : [ 127 . 0 . 0 . 1 ] &gt; $1 &lt; @ $2 &gt; $3 
R$* &lt; @ $* &gt; $*                 $# esmtp $@ $2 $: $1 &lt; @ $2 &gt; $3 
R$=L            $# local $: @ $1 
R$+             $# local $: $1 
</code></pre></div></div>

<p>Tests:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n "Testing." | mail -v -s "Test 1" dusko
dusko... Connecting to fbsd1.chem.ubc.ca. via LR0relayST...
[ . . . ]
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n "Testing." | mail -v -s "Test 2" dusko@localhost
dusko@localhost... Connecting to fbsd1.chem.ubc.ca. via LR0relayLH...
[ . . . ]
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n "Testing." | mail -v -s "Test 3" dusko@fbsd1.home.arpa
dusko@fbsd1.home.arpa... Connecting to fbsd1.home.arpa. via LR0relayLH...
[ . . . ]
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n "Testing." | mail -v -s "Test 4" dusko@some.external.domain
dusko@some.external.domain... Connecting to [127.0.0.1] port 1465 via smartrelay...
[ . . . ]
</code></pre></div></div>

<p>Quit address test mode with the <code class="language-plaintext highlighter-rouge">/quit</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; /quit
</code></pre></div></div>

<hr />

<p>When you run <code class="language-plaintext highlighter-rouge">make</code>, if <code class="language-plaintext highlighter-rouge">your_machine_hostname.mc</code> file does not exist, 
it is created (using <code class="language-plaintext highlighter-rouge">freebsd.mc</code> file as a template).  Similarly, if 
<code class="language-plaintext highlighter-rouge">your_machine_hostname.submit.mc</code> file does not exist, it is created
using <code class="language-plaintext highlighter-rouge">freebsd.submit.mc</code> file as a template.</p>

<p>More specifically, when you run <code class="language-plaintext highlighter-rouge">make</code>:</p>
<ul>
  <li>the <code class="language-plaintext highlighter-rouge">freebsd.mc</code> file gets copied to <code class="language-plaintext highlighter-rouge">your_machine_hostname.mc</code></li>
  <li>the <code class="language-plaintext highlighter-rouge">m4</code> macro processor utility processes <code class="language-plaintext highlighter-rouge">your_machine_hostname.mc</code> 
into <code class="language-plaintext highlighter-rouge">your_machine_hostname.cf</code></li>
  <li>the <code class="language-plaintext highlighter-rouge">freebsd.submit.mc</code> file gets copied to <code class="language-plaintext highlighter-rouge">your_machine_hostname.submit.mc</code></li>
  <li>the <code class="language-plaintext highlighter-rouge">m4</code> macro processor utility processes <code class="language-plaintext highlighter-rouge">your_machine_hostname.submit.mc</code>
into <code class="language-plaintext highlighter-rouge">your_machine_hostname.submit.cf</code></li>
</ul>

<p>NOTE:<br />
<code class="language-plaintext highlighter-rouge">make install</code> will also install the <code class="language-plaintext highlighter-rouge">*.mc</code> files as <code class="language-plaintext highlighter-rouge">*.cf</code> files;
that is, it will install <code class="language-plaintext highlighter-rouge">your_machine_hostname.mc</code> as<br />
  <strong><code class="language-plaintext highlighter-rouge">sendmail.cf</code></strong><br />
and <br />
<code class="language-plaintext highlighter-rouge">your_machine_hostname.submit.mc</code> as<br />
  <strong><code class="language-plaintext highlighter-rouge">submit.cf</code></strong>. <br />
[A <code class="language-plaintext highlighter-rouge">make install</code> is only necessary after modifying the <em>.mc</em> file(s).]</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make 
</code></pre></div></div>

<p>Output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp -f freebsd.mc fbsd1.home.arpa.mc
/usr/bin/m4 -D_CF_DIR_=/usr/local/share/sendmail/cf/   /usr/local/share/sendmail/cf/m4/cf.m4 fbsd1.home.arpa.mc &gt; fbsd1.home.arpa.cf 

cp -f freebsd.submit.mc fbsd1.home.arpa.submit.mc
/usr/bin/m4 -D_CF_DIR_=/usr/local/share/sendmail/cf/   /usr/local/share/sendmail/cf/m4/cf.m4 fbsd1.home.arpa.submit.mc &gt; fbsd1.home.arpa.submit.cf
</code></pre></div></div>

<p>Modify the <code class="language-plaintext highlighter-rouge">mailer.conf</code> file.  (Note that <code class="language-plaintext highlighter-rouge">mailer.conf</code>
is in two locations.  The mailwrapper(8) program first looks in
<code class="language-plaintext highlighter-rouge">/usr/local/etc/mail/mailer.conf</code> falling back on <code class="language-plaintext highlighter-rouge">/etc/mail/mailer.conf</code>.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cp -i /usr/local/etc/mail/mailer.conf /usr/local/etc/mail/mailer.conf.ORIG
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /etc/mail/mailer.conf.ORIG 
# $FreeBSD$
#
# Execute the "real" sendmail program, named /usr/libexec/sendmail/sendmail
#
# If dma(8) is installed, an example mailer.conf that uses dma(8) instead can
# can be found in /usr/share/examples/dma.
#
sendmail        /usr/libexec/sendmail/sendmail
mailq           /usr/libexec/sendmail/sendmail
newaliases      /usr/libexec/sendmail/sendmail
hoststat        /usr/libexec/sendmail/sendmail
purgestat       /usr/libexec/sendmail/sendmail
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo vi /usr/local/etc/mail/mailer.conf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /usr/local/etc/mail/mailer.conf
#
# Execute the "real" sendmail program, named /usr/local/sbin/sendmail
#
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail
hoststat        /usr/local/sbin/sendmail
purgestat       /usr/local/sbin/sendmail
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cp -i /etc/mail/mailer.conf /etc/mail/mailer.conf.ORIG
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cp -i /usr/local/etc/mail/mailer.conf /etc/mail/
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /etc/mail/mailer.conf
#
# Execute the "real" sendmail program, named /usr/local/sbin/sendmail
#
sendmail        /usr/local/sbin/sendmail
send-mail       /usr/local/sbin/sendmail
mailq           /usr/local/sbin/sendmail
newaliases      /usr/local/sbin/sendmail
hoststat        /usr/local/sbin/sendmail
purgestat       /usr/local/sbin/sendmail
</code></pre></div></div>

<h2 id="authenticating-with-auth">Authenticating with AUTH</h2>

<p>From <strong>sendmail Cookbook</strong> by Craig Hunt (Published by O’Reilly
Media, Inc., Publication Date: December 2003):</p>

<blockquote>
  <p>Strong authentication uses cryptographic techniques to verify the
identity of the <strong>end points</strong> in a network exchange.  For <em>sendmail</em>,
strong authentication ensures that the connecting host and the receiving
host are <strong>who they claim to be</strong>.</p>

  <p>Authentication is not the same as encryption.  Encryption can be used to
hide the content of a piece of mail or to hide the entire SMTP protocol
exchange, including the mail.  (One technique for encrypting the SMTP
exchange, and the mail it carries, is covered in Chapter 8. Securing the
Mail Transport. <strong>[<sup><a href="#footnotes"> 11 </a></sup>])</strong>  Authentication does not
hide the contents of mail; rather, it ensures that the mail comes from
the correct source. <br />
[ . . . ]  <br />
<strong>The AUTH Protocol</strong><br />
<strong>AUTH</strong> is an SMTP protocol extension. It is defined in RFC 2554,
<em>SMTP Service Extension for Authentication</em>.  RFC 2554 outlines the
negotiations that are used to select an authentication mechanism.
<strong>[<sup><a href="#footnotes"> 12 </a></sup>]</strong>  <br />
[ . . . ] <br />
The AUTH protocol relies on the <strong>Simple Authentication and Security
Layer (SASL)</strong> for the actual authentication.  RFC 2222,
<em>Simple Authentication and Security Layer (SASL)</em>, describes the SASL
framework and defines how protocols negotiate an authentication method. <br />
[ . . . ] <br />
<em>sendmail</em> does not contain implementations of the various authentication
techniques.  Instead, <em>sendmail</em> uses the techniques that are implemented
and configured in SASL.  For this to work, Cyrus SASL must be installed
and properly configured on the <em>sendmail</em> system.</p>
</blockquote>

<p>Refer to
<strong><a href="#authmechanisms-option">AuthMechanisms Option</a></strong> section below for
more information about SASL (including a reference to an additional RFC:
RFC2554).</p>

<blockquote>
  <p><strong>Cyrus SASL</strong><br />
Cyrus SASL is implemented as a library.  The SASL library standardizes
the way in which applications interface with the authentication methods.
Many Unix systems come with the SASL libraries preinstalled.</p>

  <p>If SASL is not installed on your system, check to see if it was delivered
as part of your Unix software.  If it was, install the copy of SASL
provided by your Unix vendor.  If it is not available from your vendor,
go to <a href="http://www.cyrusimap.org/sasl/">http://www.cyrusimap.org/sasl/</a>
to download the latest version of SASL.</p>

  <p>After Cyrus SASL is installed, the specific authentication techniques
must be configured before they can be used.  To understand SASL
configuration, you must understand SASL terminology.
<strong>[<sup><a href="#footnotes"> 13 </a></sup>]</strong></p>

  <p><strong>The SASL Sendmail.conf file</strong> <br />
. . . Some authentication techniques (authentication mechanisms)
available through SASL that can be used with <em>sendmail</em> require
configuration through the <em>Sendmail.conf</em> SASL application file.
<strong>[<sup><a href="#footnotes"> 14 </a></sup>]</strong></p>
</blockquote>

<blockquote>
  <p><strong>Passing Flags to SASL</strong></p>

  <p><em>sendmail</em> can be configured to request optional processing from SASL
for the AUTH protocol.  The <code class="language-plaintext highlighter-rouge">confAUTH_OPTIONS</code> define can set several
flags that affect the way that <em>sendmail</em> and SASL interact.
<strong>[<sup><a href="#footnotes"> 15 </a></sup>]</strong></p>
</blockquote>

<blockquote>
  <p><strong>Authentication Macros and Rulesets</strong></p>

  <p><em>sendmail</em> uses the information provided by authentication and stores
authentication data in several macros.  The authentication macros are:</p>

  <p><em>${auth_author}</em><br />
This macro holds the <em>sendmail</em> <strong>authorization id</strong>, which is the address
assigned to the <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter on the <code class="language-plaintext highlighter-rouge">MAIL From:</code> line.</p>

  <p><em>${auth_authen}</em><br />
This macro holds the <em>sendmail</em> <strong>authentication id</strong>, which is either the
userid or the userid and the realm, written as <em>userid</em> @ <em>realm</em>.</p>

  <p><em>${auth_type}</em><br />
This macro holds the name of the authentication method used to
authenticate the client.  For example, LOGIN would be a possible
<code class="language-plaintext highlighter-rouge">${auth_type}</code> value.</p>

  <p><em>${auth_ssf}</em> <br />
This macro holds the number of bits used for optional SASL encryption.
If no SASL link encryption is used, this macro is unassigned.</p>
</blockquote>

<blockquote>
  <p>In addition to the authentication macros, the <strong>hostname</strong> <em>and</em>
the <strong>IP address</strong> of the system at the other end of the mail transport
connection are stored in macros, which can be useful information for
authentication checks.  The following values are stored in the macros:</p>

  <p><em>${server_addr}</em><br />
The <em>IP address</em> of the <strong>remote server</strong>, as determined from the
TCP connection.  This macro is used on the <strong>client</strong>.</p>

  <p><em>${server_name}</em> <br />
The <em>hostname</em> of the <strong>remote server</strong>, as determined from a hostname
lookup of the <code class="language-plaintext highlighter-rouge">${server_addr}</code> value.  This macro is used on the
<strong>client</strong>.</p>

  <p><em>${client_addr}</em><br />
The <em>IP address</em> of the <strong>client</strong>, as determined from the TCP connection.
This macro is used on the <strong>server</strong>.</p>

  <p><em>${client_name}</em><br />
The <em>hostname</em> of the <strong>client</strong>, as determined from a hostname lookup of
the <code class="language-plaintext highlighter-rouge">${client_addr}</code> value.  This macro is used on the <strong>server</strong>.</p>
</blockquote>

<blockquote>
  <p><em>sendmail</em> also provides <em>ruleset</em> <strong>hooks</strong> that simplify the process of
adding authentication checks.  The primary hooks used with AUTH are:</p>

  <p><em>Local_check_mail</em><br />
This ruleset adds checks to the <code class="language-plaintext highlighter-rouge">check_mail</code> ruleset, which is used to
process the <strong>envelope sender address</strong> from the <code class="language-plaintext highlighter-rouge">MAIL From:</code> line.
The <code class="language-plaintext highlighter-rouge">check_mail</code> ruleset is <strong>not</strong> specific to AUTH, but the overlap
between the <code class="language-plaintext highlighter-rouge">${auth_author}</code> value and the envelope sender address means
that <code class="language-plaintext highlighter-rouge">Local_check_mail</code> is occasionally used for custom AUTH processing.</p>

  <p><em>Local_check_rcpt</em><br />
This ruleset adds checks to the <code class="language-plaintext highlighter-rouge">check_rcpt</code> ruleset, which processes
the <strong>envelope recipient address</strong> from the <code class="language-plaintext highlighter-rouge">RCPT To:</code> line.
The <code class="language-plaintext highlighter-rouge">check_rcpt</code> ruleset is <strong>not</strong> specific to AUTH, but because it is
used to authorize delivery to a recipient, <code class="language-plaintext highlighter-rouge">Local_check_rcpt</code> is
occasionally used to modify it for AUTH processing.</p>

  <p><em>Local_trust_auth</em><br />
This ruleset adds checks to the <code class="language-plaintext highlighter-rouge">trust_auth</code> ruleset, which is used by
the server to determine whether the <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter on the <code class="language-plaintext highlighter-rouge">MAIL From:</code>
line should be trusted.  The <code class="language-plaintext highlighter-rouge">trust_auth</code> ruleset is specific to the AUTH
protocol because the <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter is only used when AUTH is running
on the client.  Use <code class="language-plaintext highlighter-rouge">Local_trust_auth</code> to customize the processing of
the <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter.</p>

  <p><em>Local_Relay_Auth</em><br />
This ruleset is called by the <code class="language-plaintext highlighter-rouge">Rcpt_ok</code> ruleset.  By default, <em>sendmail</em>
grants relaying privileges to an authenticated client only if the client
authenticated is using a mechanism listed in the <code class="language-plaintext highlighter-rouge">$={TrustAuthMech}</code> class.
Use <code class="language-plaintext highlighter-rouge">Local_Relay_Auth</code> to modify the process of granting relaying
privileges to <strong>authenticated clients</strong>.</p>
</blockquote>

<h2 id="storing-auth-credentials-in-the-authinfo-file">Storing AUTH Credentials in the authinfo File</h2>

<p>From the <em>sendmail</em> <strong>cf/README</strong> (<code class="language-plaintext highlighter-rouge">/usr/local/share/sendmail/cf/README</code>),
under the section for <strong>MSP</strong> (Message Submission Program), which is a
command-line <em>sendmail</em> that functions as a mail submission agent (<strong>MSA</strong>):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ . . . ]
+----------------------------+
| MESSAGE SUBMISSION PROGRAM |
+----------------------------+
[ . . . ]
If the MSP should actually use AUTH then the necessary data
should be placed in a map as explained in SMTP AUTHENTICATION:

FEATURE(`authinfo', `DATABASE_MAP_TYPE /etc/mail/msp-authinfo')

/etc/mail/msp-authinfo should contain an entry like:

        AuthInfo:127.0.0.1      "U:smmsp" "P:secret" "M:DIGEST-MD5"

The file and the map created by makemap should be owned by smmsp,
its group should be smmsp, and it should have mode 640.  

The database used by the MTA for AUTH must have a corresponding entry.

Additionally the MTA must trust this authentication data so the AUTH=
part will be relayed on to the next hop.  This can be achieved by
adding the following to your sendmail.mc file:

        LOCAL_RULESETS
        SLocal_trust_auth
        R$*     $: $&amp;{auth_authen}
        Rsmmsp  $# OK
[ . . . ]
</code></pre></div></div>

<p>Create the <em>/etc/mail/authinfo</em> file (for storing AUTH authentication
credentials in a file separate from the <em>access</em> database).</p>

<p><strong>NOTE:</strong>  In the two lines below <code class="language-plaintext highlighter-rouge">SLocal_trust_auth</code>
<strong>[<sup><a href="#footnotes"> 16 </a></sup>]</strong>, there is a <strong>tab</strong> character
before <code class="language-plaintext highlighter-rouge">$:</code> and before <code class="language-plaintext highlighter-rouge">$#</code>.</p>

<p>You need to store the client’s authentication credentials in that file
using the same <code class="language-plaintext highlighter-rouge">AuthInfo:</code> tag used in the <em>access</em> database, and you need
to make sure that the <em>authinfo</em> text file and database are not readable
by anyone except the <em>smmsp</em> user.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo vi /etc/mail/authinfo
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo chown smmsp:smmsp /etc/mail/authinfo
$ sudo chmod 0640 /etc/mail/authinfo
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -lh /etc/mail/authinfo
-rw-r-----  1 smmsp  smmsp   142B Nov 12 19:57 /etc/mail/authinfo
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ grep '127.0.0.1' /etc/hosts
127.0.0.1               localhost localhost.my.domain
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cat /etc/mail/authinfo
AuthInfo:[127.0.0.1] "U:smmsp" "I:dusko" "P:YourISPPassword" "M:LOGIN"
AuthInfo:127.0.0.1 "U:smmsp" "I:dusko" "P:YourISPPassword" "M:LOGIN"
</code></pre></div></div>

<p>In my tests, when the letter <code class="language-plaintext highlighter-rouge">M</code> (the list of mechanisms, separated by
spaces) had both PLAIN and LOGIN mechanisms; that is <code class="language-plaintext highlighter-rouge">"M:PLAIN LOGIN"</code>
(or: <code class="language-plaintext highlighter-rouge">"M:LOGIN PLAIN"</code>), <em>sendmail</em> used only the PLAIN mechanism.
<em>Sendmail</em> used the LOGIN mechanism when the <code class="language-plaintext highlighter-rouge">M</code> letter had only <code class="language-plaintext highlighter-rouge">LOGIN</code>
(that is, <code class="language-plaintext highlighter-rouge">"M:LOGIN"</code>).</p>

<p><strong>NOTE:</strong> This requires the use of the <em>authinfo</em> FEATURE to the
<em>sendmail</em> configuration, which you did above, when you modified
the <code class="language-plaintext highlighter-rouge">freebsd.submit.mc</code> file.</p>

<p><strong>NOTE:</strong> If the <code class="language-plaintext highlighter-rouge">make all</code> command generates an error <code class="language-plaintext highlighter-rouge">No such file or
directory</code> for <code class="language-plaintext highlighter-rouge">sendmail.cf</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd /etc/mail

$ sudo su
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make all
[ . . . ]
/usr/sbin/makemap hash authinfo.db &lt; authinfo
makemap: /etc/mail/sendmail.cf: No such file or directory
*** Error code 66

Stop.
make: stopped in /etc/mail
</code></pre></div></div>

<p>fix it by creating an empty <code class="language-plaintext highlighter-rouge">sendmail.cf</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># touch /etc/mail/sendmail.cf
</code></pre></div></div>

<p>and then run <code class="language-plaintext highlighter-rouge">make all</code> again:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make all
[ . . . ]
/usr/sbin/makemap hash authinfo.db &lt; authinfo
chmod 0640 authinfo.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh /etc/mail/authinfo*
-rw-r-----  1 smmsp  smmsp   142B Nov 12 19:57 /etc/mail/authinfo
-rw-r-----  1 root   wheel   128K Nov 12 17:57 /etc/mail/authinfo.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># chown smmsp:smmsp /etc/mail/authinfo.db 
# sudo chmod 0640 /etc/mail/authinfo.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh /etc/mail/authinfo*
-rw-r-----  1 smmsp  smmsp   142B Nov 12 19:57 /etc/mail/authinfo
-rw-r-----  1 smmsp  smmsp   128K Nov 12 19:57 /etc/mail/authinfo.db
</code></pre></div></div>

<p><strong>NOTE:</strong>  When you need to re-create <em>sendmail</em> configuration files with 
these permissions for <code class="language-plaintext highlighter-rouge">authinfo.db</code>, you might encounter a <code class="language-plaintext highlighter-rouge">Permission
denied</code> error:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make all   (# or 'make install')
[ . . . ]
/usr/sbin/makemap hash authinfo.db &lt; authinfo
makemap: error opening type hash map authinfo.db: Permission denied
*** Error code 73

Stop.
make: stopped in /etc/mail
</code></pre></div></div>

<p>To fix it, temporary change permissions for <code class="language-plaintext highlighter-rouge">authinfo.db</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># chgrp wheel /etc/mail/authinfo.db
# chmod 0660 /etc/mail/authinfo.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh /etc/mail/authinfo.db
-rw-rw----  1 smmsp  wheel   128K Nov 12 19:14 /etc/mail/authinfo.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make all
/usr/sbin/makemap hash authinfo.db &lt; authinfo
chmod 0640 authinfo.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh /etc/mail/authinfo.db
-rw-r-----  1 smmsp  wheel   128K Nov 12 19:14 /etc/mail/authinfo.db
</code></pre></div></div>

<p>After successfull <code class="language-plaintext highlighter-rouge">make run</code>, change the permissions back:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># chgrp smmsp /etc/mail/authinfo.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh /etc/mail/authinfo.db
-rw-r-----  1 smmsp  smmsp   128K Nov 12 19:14 /etc/mail/authinfo.db
</code></pre></div></div>

<p>and continue:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make install
# make start
Starting: sendmail sendmail-clientmqueue.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># exit
exit
% 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -d0 &lt; /dev/null
Version 8.17.1
 Compiled with: DANE DNSMAP IPV6_FULL LOG MAP_REGEX MATCHGECOS MILTER
                MIME7TO8 MIME8TO7 NAMED_BIND NETINET NETINET6 NETUNIX NEWDB NIS
                PICKY_HELO_CHECK PIPELINING SASLv2 SCANF STARTTLS TCPWRAPPERS
                TLS_EC TLS_VRFY_PER_CTX USERDB XDEBUG

============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = fbsd1
  (canonical domain name) $j = fbsd1.home.arpa
         (subdomain name) $m = home.arpa
              (node name) $k = fbsd1.home.arpa
========================================================
 
Recipient names must be specified
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -d0.1 -bv root 
Version 8.17.1
 Compiled with: DANE DNSMAP IPV6_FULL LOG MAP_REGEX MATCHGECOS MILTER
                MIME7TO8 MIME8TO7 NAMED_BIND NETINET NETINET6 NETUNIX NEWDB NIS
                PICKY_HELO_CHECK PIPELINING SASLv2 SCANF STARTTLS TCPWRAPPERS
                TLS_EC TLS_VRFY_PER_CTX USERDB XDEBUG

============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = fbsd1
  (canonical domain name) $j = fbsd1.home.arpa
         (subdomain name) $m = home.arpa
              (node name) $k = fbsd1.home.arpa
========================================================

Notice: -bv may give misleading output for non-privileged user
root... deliverable: mailer local, user root
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo /usr/libexec/sendmail/sendmail -d0.1 -bv root
Version 8.16.1
 Compiled with: DNSMAP IPV6_FULL LOG MAP_REGEX MATCHGECOS MILTER
                MIME7TO8 MIME8TO7 NAMED_BIND NETINET NETINET6 NETUNIX NEWDB NIS
                PIPELINING SCANF STARTTLS TCPWRAPPERS TLS_EC TLS_VRFY_PER_CTX
                USERDB XDEBUG

============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = fbsd1
  (canonical domain name) $j = fbsd1.home.arpa
         (subdomain name) $m = home.arpa
              (node name) $k = fbsd1.home.arpa
========================================================

root... deliverable: mailer local, user root
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo /usr/sbin/sendmail -d0.1 -bv root
Version 8.17.1
 Compiled with: DANE DNSMAP IPV6_FULL LOG MAP_REGEX MATCHGECOS MILTER
                MIME7TO8 MIME8TO7 NAMED_BIND NETINET NETINET6 NETUNIX NEWDB NIS
                PICKY_HELO_CHECK PIPELINING SASLv2 SCANF STARTTLS TCPWRAPPERS
                TLS_EC TLS_VRFY_PER_CTX USERDB XDEBUG

============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = fbsd1
  (canonical domain name) $j = fbsd1.home.arpa
         (subdomain name) $m = home.arpa
              (node name) $k = fbsd1.home.arpa
========================================================

root... deliverable: mailer local, user root
</code></pre></div></div>

<h3 id="install-and-configure-stunnel-1">Install and Configure stunnel</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo pkg install stunnel
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cp -i /usr/local/etc/stunnel/stunnel.conf-sample /usr/local/etc/stunnel/stunnel.conf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo vi /usr/local/etc/stunnel/stunnel.conf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat /usr/local/etc/stunnel/stunnel.conf
include = /usr/local/etc/stunnel/conf.d

[smarthost]
client = yes
accept = 127.0.0.1:1465 
connect = your.isp.net:465
</code></pre></div></div>

<p>where <code class="language-plaintext highlighter-rouge">your.isp.net</code> is the FQDN of the SMTP server (your ISP).</p>

<p>Set <code class="language-plaintext highlighter-rouge">stunnel_enable</code> to <code class="language-plaintext highlighter-rouge">YES</code> in <code class="language-plaintext highlighter-rouge">/etc/rc.conf</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n 'stunnel_enable="YES"' | sudo tee -a /etc/rc.conf
</code></pre></div></div>

<p>Start <em>stunnel</em> service.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo service stunnel start
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo service stunnel status
stunnel is running as pid 51293.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd /etc/mail

$ sudo su
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># rm -i /etc/mail/fbsd1.home.arpa.*
remove /etc/mail/fbsd1.home.arpa.cf? y
remove /etc/mail/fbsd1.home.arpa.mc? y
remove /etc/mail/fbsd1.home.arpa.submit.cf? y
remove /etc/mail/fbsd1.home.arpa.submit.mc? y
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># rm -i /etc/mail/*.cf
remove /etc/mail/sendmail.cf? y
remove /etc/mail/submit.cf? y
</code></pre></div></div>

<p>Run <code class="language-plaintext highlighter-rouge">make all</code>, <code class="language-plaintext highlighter-rouge">make install</code> and <code class="language-plaintext highlighter-rouge">make restart</code> (or <code class="language-plaintext highlighter-rouge">make stop</code> and 
then <code class="language-plaintext highlighter-rouge">make restart</code>, depending on whether <em>sendmail</em> is currently running 
or not).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make all
# make install
# make restart
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># service sendmail status
sendmail is running as pid 69385.
sendmail_msp_queue is running as pid 69388.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ps aux | grep -v grep | grep sendmail
root    6938   0.0  0.0    18972    7228  -  Ss   19:14       0:00.01 sendmail: accepting connections (sendmail)
smmsp   6941   0.0  0.0    18312    6304  -  Is   19:14       0:00.00 sendmail: Queue runner@00:30:00 for /var/spool/clientmqueue (sendmail)
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># tail /var/log/maillog
Nov 12 19:14:21 fbsd1 sm-mta[6938]: starting daemon (8.17.1): SMTP+queueing@00:30:00
[ . . . ]
Nov 12 19:14:21 fbsd1 sm-mta[6938]: STARTTLS=server, Diffie-Hellman init, key=2048 bit (I)
Nov 12 19:14:21 fbsd1 sm-mta[6938]: STARTTLS=server, init=1
Nov 12 19:14:21 fbsd1 sm-mta[6938]: started as: /usr/sbin/sendmail -L sm-mta -bd -q30m
Nov 12 19:14:21 fbsd1 sm-msp-queue[6941]: starting daemon (8.17.1): queueing@00:30:00
Nov 12 19:14:21 fbsd1 sm-msp-queue[6941]: started as: /usr/sbin/sendmail -L sm-msp-queue -Ac -q30m
</code></pre></div></div>

<p>If you now receive a <code class="language-plaintext highlighter-rouge">No local mailer defined</code> error when you run <code class="language-plaintext highlighter-rouge">make all</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make all
/usr/sbin/makemap hash authinfo.db &lt; authinfo
chmod 0640 authinfo.db
/usr/sbin/sendmail -bi -OAliasFile=/etc/mail/aliases
Warning: .cf file is out of date: sendmail 8.17.1 supports 
  version 10, .cf file is version 0
No local mailer defined
QueueDirectory (Q) option must be set
*** Error code 78

Stop.
make: stopped in /etc/mail
</code></pre></div></div>

<p>it’s because <em>sendmail.cf</em> is still empty.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh sendmail.cf 
-rw-r--r--  1 root  wheel     0B Nov 12 19:10 sendmail.cf
</code></pre></div></div>

<p>To fix that, run <code class="language-plaintext highlighter-rouge">make install</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make install
install -m 444 fbsd1.home.arpa.cf /etc/mail/sendmail.cf
install -m 444 fbsd1.home.arpa.submit.cf /etc/mail/submit.cf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -lh sendmail.cf
-r--r--r--  1 root  wheel    59K Nov 12 19:11 sendmail.cf
</code></pre></div></div>

<p>Now, the <code class="language-plaintext highlighter-rouge">make all</code> command runs fine:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make all
/usr/sbin/sendmail -bi -OAliasFile=/etc/mail/aliases
/etc/mail/aliases: 29 aliases, longest 10 bytes, 297 bytes total
chmod 0640 /etc/mail/aliases.db
</code></pre></div></div>

<p>Continue.  In this case, <em>sendmail</em> was not running so I used
<code class="language-plaintext highlighter-rouge">make start</code> (you might need to run <code class="language-plaintext highlighter-rouge">make restart</code> to first stop
<em>sendmail</em> if it’s running on your system).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make install
# make start
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># service sendmail status
sendmail is running as pid 47902.
sendmail_msp_queue is running as pid 47905.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># exit
$ cd

$ pwd
/usr/home/dusko
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo chown smmsp:smmsp /etc/mail/authinfo.db 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ls -lh /etc/mail/authinfo*
-rw-r-----  1 smmsp  smmsp    81B Nov 12 19:11 /etc/mail/authinfo
-rw-r-----  1 smmsp  smmsp   128K Nov 12 19:11 /etc/mail/authinfo.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># service sendmail status
sendmail is running as pid 49494.
sendmail_msp_queue is running as pid 49497.
</code></pre></div></div>

<h3 id="testing-smtp-with-telnet1-or-nc1-aka-netcat1">Testing SMTP with telnet(1) (or nc(1) aka (netcat(1))</h3>

<p>The Simple Mail Transfer Protocol (SMTP) governs mail flow.
SMTP conversation can be carried out by connecting to port 25 on
a mail server via <code class="language-plaintext highlighter-rouge">telnet(1)</code>.</p>

<p><strong>NOTE:</strong> <br />
Telnet is not secure as all communication in it happens in plain text
and all network traffic is unencrypted.  I decided it’s fine to use it
for testing my <em>localhost</em> because it’s in my trusted environment with
trusted network and applications.</p>

<p>Below is a sample test SMTP session with <code class="language-plaintext highlighter-rouge">telnet(1)</code> to Port 25 from
my <em>localhost</em>.</p>

<p><strong>NOTE:</strong> <br />
In the examples, “<strong>C:</strong>” indicates what is said by the SMTP
client, “<strong>T:</strong>” is what you type (that is, in the following example,
you type the following three lines: <code class="language-plaintext highlighter-rouge">telnet localhost 25</code>, <code class="language-plaintext highlighter-rouge">ehlo localhost</code>, 
and <code class="language-plaintext highlighter-rouge">quit</code>), and “<strong>S:</strong>” indicates what is said by the SMTP server.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>S: &lt;waits for connection on TCP port 25&gt;
C: &lt;opens connection&gt;   # with telnet
</code></pre></div></div>

<p>The second line shows the <em>telnet</em> command format using host <em>localhost</em>
and TCP port 25.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>S: &lt;waits for connection on TCP port 25&gt;

CT: telnet localhost 25
C: Trying 127.0.0.1...
C: Connected to localhost.
C: Escape character is '^]'.
S: 220 fbsd1.home.arpa ESMTP Sendmail 8.17.1/8.17.1; Sat, 12 Nov 2022 12:00:35 -0700 (PDT)
CT: ehlo localhost
S: 250-fbsd1.home.arpa Hello localhost [127.0.0.1], pleased to meet you
S: 250-ENHANCEDSTATUSCODES
S: 250-PIPELINING
S: 250-8BITMIME
S: 250-SIZE
S: 250-DSN
S: 250-ETRN
S: 250-AUTH DIGEST-MD5 CRAM-MD5
S: 250-STARTTLS
S: 250-DELIVERBY
S: 250 HELP
CT: quit
S: 221 2.0.0 fbsd1.home.arpa closing connection
C: Connection closed by foreign host.
</code></pre></div></div>

<p>From <strong>Postfix</strong> by Richard Blum
(Published By: Sams, Publication Date: May 2001):</p>

<blockquote>
  <p>If the server is running an SMTP-based daemon, you should see a response
similar to the one shown.  The first number is a 3-digit response code.
You can use this code for troubleshooting purposes.</p>

  <p>Next, the hostname of the SMTP server and a description of the SMTP
software package that the server is using are displayed
(in this case, <em>Sendmail 8.17.1/8.17.1</em>).</p>

  <p>To close the <em>telnet</em> connection, type the word <code class="language-plaintext highlighter-rouge">quit</code> and press the
Enter key.  The SMTP server sends you a closing message and ends the
TCP connection.</p>

  <p>SMTP accepts simple ASCII text commands and returns 3-digit reply codes
with optional ASCII text messages.  SMTP is defined in the Request For
Comment (RFC) document number 821 maintained by the Internet Engineering
Task Force (IETF) published on August 21, 1982.  Several modifications
and enhancements have been made to SMTP over the years, but the basic
protocol commands still remain in use.</p>
</blockquote>

<blockquote>
  <h4 id="basic-smtp-client-commands">Basic SMTP Client Commands</h4>

  <p>When a TCP session has been established and the SMTP server acknowledges
the client by sending a welcome banner, it is the client’s responsibility
to control the connection and transmit data to the server.  The client
accomplishes this by sending special commands to the server.  The server
responds according to each command it receives.</p>

  <p>RFC 821 defines the basic client commands that an SMTP server should
recognize and respond to.  Since then, there have been several extensions
to SMTP that not all servers have implemented.</p>

  <p>The basic format of an SMTP command is</p>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>command [parameters]
</code></pre></div>  </div>

  <p>where <code class="language-plaintext highlighter-rouge">command</code> is a 4-character SMTP command, and <code class="language-plaintext highlighter-rouge">parameters</code> are
optional qualifying data for the command.  For SMTP connections,
the command names are <strong>not</strong> case sensitive.  Table at the end 
of this page
<strong>[<sup><a href="#footnotes"> 18 </a></sup>]</strong> lists basic SMTP commands.</p>
</blockquote>

<p><strong>NOTE:</strong> You can use the <code class="language-plaintext highlighter-rouge">nc(1)</code> (<em>netcat</em>) utility instead of
the <code class="language-plaintext highlighter-rouge">telnet(1)</code> command (<code class="language-plaintext highlighter-rouge">nc localhost 25</code>).  For <em>localhost</em> testing,
I decided that <em>telnet</em> is fine.</p>

<p><a href="https://datatracker.ietf.org/doc/html/rfc3207">RFC 3207</a> defines how SMTP
connections can make use of encryption.  Once a connection is established,
the client issues a STARTTLS command.  If the server accepts this, the client
and the server negotiate an encryption mechanism.  If the negotiation
succeeds, the data that subsequently passes between them is encrypted.</p>

<p><strong>NOTE:</strong> In this example, the AUTH line (<code class="language-plaintext highlighter-rouge">250-AUTH DIGEST-MD5 LOGIN PLAIN</code>)
now has <code class="language-plaintext highlighter-rouge">LOGIN PLAIN</code> when inquiring MSA (Mail Submission Agent) port 587
(while it didn’t have LOGIN and PLAIN when testing via port 25). <br />
“<strong>C:</strong>” indicates what is said by the SMTP client, “<strong>T:</strong>” is what you
type (that is, in the following example, you type the following three lines:
<code class="language-plaintext highlighter-rouge">telnet localhost 587</code>, <code class="language-plaintext highlighter-rouge">ehlo localhost</code>, and <code class="language-plaintext highlighter-rouge">quit</code>), and “<strong>S:</strong>” indicates
what is said by the SMTP server.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>S: &lt;waits for connection on TCP port 587&gt;

CT: telnet localhost 587
C: Trying 127.0.0.1...
C: Connected to localhost.
C: Escape character is '^]'.
S: 220 fbsd1.home.arpa ESMTP Sendmail 8.17.1/8.17.1; Sat, 12 Nov 2022 12:00:46 -0700 (PDT)
CT: ehlo localhost
S: 250-fbsd1.home.arpa Hello localhost [127.0.0.1], pleased to meet you
S: 250-ENHANCEDSTATUSCODES
S: 250-PIPELINING
S: 250-8BITMIME
S: 250-SIZE
S: 250-DSN
S: 250-AUTH DIGEST-MD5 LOGIN PLAIN
S: 250-STARTTLS
S: 250-DELIVERBY
S: 250 HELP
CT: quit
S: 221 2.0.0 fbsd1.home.arpa closing connection
C: Connection closed by foreign host.
</code></pre></div></div>

<h2 id="testing-and-troubleshooting-with-sendmail-command-line">Testing and Troubleshooting with sendmail Command-Line</h2>

<p>Some of <em>sendmail</em> parameters (from the man page for <code class="language-plaintext highlighter-rouge">sendmail(8)</code>):</p>

<p><strong>-v</strong>:  Verbose mode.  Alias expansions will be announced, etc. <br />
<strong>-d</strong><em>category.level…</em>: Set the debugging flag for category to <em>level</em>.
The <em>category</em> is either an integer or a name specifying the topic,
and <em>level</em> is an integer specifying the level of debugging output desired.
Higher levels generally mean more output.  More than one flag can be
specified by separating them with commas.  A list of numeric debugging
categories found in the <em>TRACEFLAGS</em> file in the <em>sendmail</em> source
distribution.  The option <strong>-d0.1</strong> prints the version of <em>sendmail</em> and
the options used during the compile.  Most other categories are only
useful with, and documented in, <em>sendmail</em>’s source code.</p>

<p>Location of the <em>TRACEFLAGS</em> file in FreeBSD 13:
<code class="language-plaintext highlighter-rouge">/usr/local/share/doc/sendmail/TRACEFLAGS</code> and 
<code class="language-plaintext highlighter-rouge">/usr/src/contrib/sendmail/src/TRACEFLAGS</code>.</p>

<p>Send a test email message with <em>sendmail</em> command-line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ date | sendmail -v -d38.20 dusko@some.external.domain
</code></pre></div></div>

<p>Some of <em>sendmail</em> parameters (from the man page for <code class="language-plaintext highlighter-rouge">sendmail(8)</code>):</p>

<p><strong>-Ac</strong>:  Use <strong>submit.cf</strong> even if the operation mode does not indicate
          an initial mail submission; via the <strong>MSP</strong> (mail submission program)
          [which is a command-line <em>sendmail</em> that functions as a mail submission agent (<strong>MSA</strong>)].</p>

<p><strong>-d38.20</strong>:  Debug command-line switch for tracing many different map
              lookups and also for tracing general lookups in various
              kinds of databases.</p>

<p><strong>-odi</strong>:  Deliver in foreground.</p>

<p>Explanation for <strong>-odi</strong>:</p>

<p><strong>-o</strong>x <em>value</em> (from the man page for <code class="language-plaintext highlighter-rouge">sendmail(8)</code>):  Set option <em>x</em> to
the specified <em>value</em>.  This form uses single character names only.
The short names are not described in this manual page; see the Sendmail
Installation and Operation Guide (on FreeBSD 13:
<em>/usr/local/share/doc/sendmail/op.txt</em>, or
<em>/usr/local/share/doc/sendmail/op.ps</em>) for details.</p>

<p><strong>Options</strong> <br />
There are also many processing options that can be set.  Normally these
are only used by a system administrator.  Options may be set either on the
command line using the <strong>-o</strong> flag (for short names), the <strong>-O</strong> flag (for 
long names), or in the <strong>configuration file</strong>.  Some of the options are:</p>

<p><strong>DeliveryMode=</strong><em>x</em>  <br />
Set the delivery mode to <em>x</em>.  Delivery modes are
“<strong>i</strong>” for interactive (synchronous) delivery (a.k.a. delivery in
foreground), “<strong>b</strong>” for background (asynchronous) delivery, “<strong>q</strong>” for
queue only; i.e., actual delivery is done the next time the queue is run,
and “<strong>d</strong>” for deferred - the same as “<strong>q</strong>”, except that database
lookups for maps which have set the <strong>-D</strong> option (default for the
host map) are avoided.</p>

<p>As an example, the <strong>-odi</strong> in <em>sendmail</em> source:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sed -n 284p /usr/src/contrib/sendmail/rmail/rmail.c
        args[i++] = "-odi";             /* Deliver in foreground. */
</code></pre></div></div>

<p>Similarly, the <strong>-d38.20</strong> debug command-line switch in <em>sendmail</em> source:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sed -n 5590p /usr/src/contrib/sendmail/src/map.c
                if (tTd(38,20))
</code></pre></div></div>

<p>Send a test email message with <em>sendmail</em> command-line:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ date | sendmail -Ac -v -d38.20 -odi dusko@some.external.domain
</code></pre></div></div>

<p>Some of sendmail parameters (from the man page for sendmail(8)):</p>

<p><strong>-Am</strong>:  Use <strong>sendmail.cf</strong> even if the operation mode indicates an
          initial mail submission.</p>

<p><strong>-t:</strong>  Read message for recipients. <strong>To:</strong>, <strong>Cc:</strong>, and <strong>Bcc:</strong> lines
         will be scanned for recipient addresses.  The <strong>Bcc:</strong> line is 
         deleted before transmission.</p>

<p>Send a test email message with <em>sendmail</em> command-line.
In the following example, type in the first seven lines (starting with
<code class="language-plaintext highlighter-rouge">sendmail -Ac -v -t</code> and ending with a single dot).</p>

<p>(The lines that begin with numbers and the lines that begin with <code class="language-plaintext highlighter-rouge">&gt;&gt;&gt;</code>
 characters constitute a record of the SMTP conversation.  The other lines
 are <em>sendmail</em> on your local machine telling you what it is trying to do
 and what it has successfully done.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -Ac -v -t
To: Dusko P &lt;dusko@some.external.domain&gt;
From: DP &lt;dusko@fbsd1.home.arpa&gt;
Subject: Test with -Ac

Testing.
.
Dusko P &lt;dusko@some.external.domain&gt;... Connecting to [127.0.0.1] port 1465 via smartrelay...
220 mailx.some.external.domain ESMTP mailer ready at Sat, 12 Nov 2022 16:51:07 -0700
&gt;&gt;&gt; EHLO fbsd1.home.arpa
250-test.domain Hello fqdn.yourisp.domain [123.45.6.7], pleased to meet you
250-ENHANCEDSTATUSCODES
250-8BITMIME
250-SIZE 52428800
250-AUTH LOGIN PLAIN
250-DELIVERBY
250 HELP
&gt;&gt;&gt; AUTH LOGIN
334 VXNlcm5hbWU6
&gt;&gt;&gt; ABCab12=
334 UGFzc3dvcmQ6
&gt;&gt;&gt; ABCdEF12gHIJkLMnoPQRSt==
235 2.0.0 OK Authenticated
&gt;&gt;&gt; MAIL From:&lt;dusko@fbsd1.home.arpa&gt; SIZE=110 AUTH=dusko@fbsd1.home.arpa
250 2.1.0 &lt;dusko@fbsd1.home.arpa&gt;... Sender ok
&gt;&gt;&gt; RCPT To:&lt;dusko@some.external.domain&gt;
250 2.1.5 &lt;dusko@some.external.domain&gt;... Recipient ok
&gt;&gt;&gt; DATA
354 Enter mail, end with "." on a line by itself
&gt;&gt;&gt; .
250 2.0.0 2A2Np7PB018356 Message accepted for delivery
Dusko P &lt;dusko@some.external.domain&gt;... Sent (2A2Np7PB018356 Message accepted for delivery)
Closing connection to [127.0.0.1]
&gt;&gt;&gt; QUIT
221 2.0.0 mailx.some.external.domain closing connection
</code></pre></div></div>

<p><strong>Note:</strong><br />
<code class="language-plaintext highlighter-rouge">VXNlcm5hbWU6</code> is ‘Username:’ encoded in base64, and <code class="language-plaintext highlighter-rouge">UGFzc3dvcmQ6</code> is
‘Password:’ encoded in base64.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ perl -MMIME::Base64 -le 'print decode_base64("VXNlcm5hbWU6");'
Username:
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ perl -MMIME::Base64 -le 'print decode_base64("UGFzc3dvcmQ6");'
Password:
</code></pre></div></div>

<hr />

<h2 id="testing-and-troubleshooting-with-the-mail1-utility">Testing and Troubleshooting with the mail(1) Utility</h2>

<p>Send a test email message with the <em>mail</em> (aka <em>mail</em>, <em>Mail</em>, <em>mailx</em>)
utility:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf %s\\n "Testing." | mail -v -s "Test" dusko@some.external.domain
</code></pre></div></div>

<hr />

<h2 id="testing-smtp-with-openssl1-command-line-tool">Testing SMTP with openssl(1) Command Line Tool</h2>

<p>From <a href="https://www.exim.org/exim-html-current/doc/html/spec_html/ch-encrypted_smtp_connections_using_tlsssl.html">Chapter 43 - Encrypted SMTP connections using TLS/SSL - Exim Internet Mailer</a> (Retrieved on Nov 12, 2022):</p>

<blockquote>
  <p>As of <a href="https://www.rfc-editor.org/rfc/rfc8314">RFC 8314</a>, the common
practice of using the historically allocated port 465 for “email submission
but with TLS <strong>immediately</strong> upon connect <strong>instead</strong> of using STARTTLS” is
officially recommended by the IETF, and recommended by them in preference
to STARTTLS.</p>

  <p>The name originally assigned to the port was “ssmtp” or “smtps”, but as
clarity emerged over the dual roles of SMTP, for MX delivery and Email
Submission, nomenclature has shifted. The modern name is now “submissions”.</p>
</blockquote>

<p>To test/connect TLS/SSL with <code class="language-plaintext highlighter-rouge">openssl(1)</code> to a mail server on port 465
(Implicit TLS submission), use its <code class="language-plaintext highlighter-rouge">s_client(1)</code> command (SSL/TLS client
program).  (Change <em>your.outgoing.mailserver</em> to the host name of your
mailserver.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ openssl s_client -connect your.outgoing.mailserver:465
</code></pre></div></div>

<p>You’ll get a lot of output concerning the TLS (SSL) session and
certificates used, and the last line of that output will show
a confirmation (a 220 or 250 status code with a message).  For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>220 your.outgoing.mailserver ESMTP mailer ready at Sat, 12 Nov 2022 19:31:55 -0800
</code></pre></div></div>

<p><strong>Initiate the conversation</strong></p>

<p>Now you need to identify yourself and initiate the SMTP conversation with
the <code class="language-plaintext highlighter-rouge">EHLO</code> command (Extended EHLO).  This command takes the fully-qualified
domain name of the SMTP client (or an IP address, if the SMTP client system
does not have a meaningful domain name; e.g., when its address is
dynamically allocated and no reverse mapping record is available).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>EHLO fbsd1.home.arpa
</code></pre></div></div>

<p>The server returns a list of commands (keywords) available in Extended mode; that is,
in ESMTP (Extended SMTP):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>250-your.outgoing.mailserver Hello fbsd1.home.arpa [123.45.67.89], pleased to meet you
250-ENHANCEDSTATUSCODES
250-8BITMIME
250-SIZE 52428800
250-AUTH LOGIN PLAIN
250-DELIVERBY
250 HELP
</code></pre></div></div>

<p><strong>Authenticate yourself</strong></p>

<p>The output to the <code class="language-plaintext highlighter-rouge">EHLO</code> ESMTP command above displayed a space separated
list of the names of supported SASL mechanisms.  In this case, the list of
advertised authentication mechanisms was <code class="language-plaintext highlighter-rouge">PLAIN</code> and <code class="language-plaintext highlighter-rouge">LOGIN</code>.</p>

<p><strong>Authenticate yourself using PLAIN</strong></p>

<p>The PLAIN mechanism expects a base64 encoded string containing both
username and password, each prefixed with a <code class="language-plaintext highlighter-rouge">NULL</code> byte.  You can generate
this string using Perl and its 
<a href="https://perldoc.perl.org/MIME::Base64">MIME::Base64</a> module.
(Change your <em>username</em> and <em>password</em> with your username and password.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ perl -MMIME::Base64 -e 'print encode_base64("\0username\0password");'
AHVzZXJuYW1lAHBhc3N3b3Jk
</code></pre></div></div>

<p>Submit this base64 encoded string to the <code class="language-plaintext highlighter-rouge">AUTH</code> command in your
<em>openssl</em> session:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AUTH PLAIN AHVzZXJuYW1lAHBhc3N3b3Jk
</code></pre></div></div>

<p>If the authorization is successful, the mail server will reply
with <code class="language-plaintext highlighter-rouge">235 2.0.0 OK</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>235 2.0.0 OK Authenticated
</code></pre></div></div>

<p><strong>Authenticate yourself using LOGIN</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">LOGIN</code> mechanism also expects base64 encoded username and password
but separately.  You can generate this string using Perl and its
<a href="https://perldoc.perl.org/MIME::Base64">MIME::Base64</a> module.  (Change your
<em>yourusername</em> and <em>yourpasswordhere</em> with your username and password.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ perl -MMIME::Base64 -e 'print encode_base64("yourusername");'
eW91cnVzZXJuYW1l
 
$ perl -MMIME::Base64 -e 'print encode_base64("yourpasswordhere");'
eW91cnBhc3N3b3JkaGVyZQ==
</code></pre></div></div>

<p>Authenticate yourself with the SMTP server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AUTH LOGIN
</code></pre></div></div>

<p>The server replies with <code class="language-plaintext highlighter-rouge">334</code> (authentication challenge) code, followed by
a challenge string.  (<code class="language-plaintext highlighter-rouge">VXNlcm5hbWU6</code> is ‘Username:’ encoded in base64.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>334 VXNlcm5hbWU6
</code></pre></div></div>

<p>Enter your username:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eW91cnVzZXJuYW1l
</code></pre></div></div>

<p>Next, the mail server asks for the password.  (<code class="language-plaintext highlighter-rouge">UGFzc3dvcmQ6</code> is ‘Password:’
encoded in base64.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>334 UGFzc3dvcmQ6
</code></pre></div></div>

<p>Enter your password:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eW91cnBhc3N3b3JkaGVyZQ==
</code></pre></div></div>

<p>If the authorization is successful, the mail server will reply with
<code class="language-plaintext highlighter-rouge">235 2.0.0 OK Authenticated</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>235 2.0.0 OK Authenticated
</code></pre></div></div>

<p><strong>Send an email</strong></p>

<p>There are three steps to SMTP mail transactions <strong>[<sup><a href="#footnotes"> 20 </a></sup>]</strong>:</p>
<ul>
  <li>the sender (<code class="language-plaintext highlighter-rouge">MAIL FROM:</code>)</li>
  <li>the recipient (<code class="language-plaintext highlighter-rouge">RCPT TO:</code>)</li>
  <li>the message body (<code class="language-plaintext highlighter-rouge">DATA</code>)</li>
</ul>

<p>The first step in the procedure is the <code class="language-plaintext highlighter-rouge">MAIL</code> command.
You use the <code class="language-plaintext highlighter-rouge">MAIL FROM:</code> SMTP command to set the message sender
(the <strong>envelope sender</strong> address).</p>

<p><strong>NOTE:</strong>  According to
<a href="https://datatracker.ietf.org/doc/html/rfc821">RFC 821 - Simple Mail Transfer Protocol (SMTP)</a>
  and
<a href="https://datatracker.ietf.org/doc/html/rfc2821">RFC 2821 - Simple Mail Transfer Protocol (SMTP)</a>, you need to surround the email address with <code class="language-plaintext highlighter-rouge">&lt;&gt;</code>; that is, 
with <strong>angle brackets</strong>.  Also, note that there is <strong>no space (blank)
character</strong> around the colon character (<code class="language-plaintext highlighter-rouge">:</code>). <strong>[<sup><a href="#footnotes"> 20 </a></sup>]</strong></p>

<p>If the mail server accepts the email address, it will reply with <code class="language-plaintext highlighter-rouge">250 OK</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MAIL FROM:&lt;dusko@fbsd1.home.arpa&gt;
250 2.1.0 &lt;dusko@fbsd1.home.arpa&gt;... Sender ok
</code></pre></div></div>

<p>Now you send the <code class="language-plaintext highlighter-rouge">RCPT TO:</code> (or <code class="language-plaintext highlighter-rouge">rcpt to:</code>, see the NOTE below) SMTP command
so the server knows who the email message is for.  In this case, I’m sending
the email to <em>dusko@yourdomain.example.net</em>.
(Change <em>dusko@yourdomain.example.net</em> with your test email address.)</p>

<p><strong>NOTE</strong>:  When you connect with <em>openssl</em> (as opposed to, for example, 
with <em>nc</em> or <em>telnet</em>), make sure to type the <code class="language-plaintext highlighter-rouge">rcpt to</code> command in
<strong>lowercase</strong>.  Pressing <code class="language-plaintext highlighter-rouge">R</code> in the client session instructs <em>openssl</em> to
renegotiate the TLS connection. <strong>[<sup><a href="#footnotes"> 21 </a></sup>]</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rcpt to:&lt;dusko@yourdomain.example.net&gt;
250 2.1.5 &lt;dusko@yourdomain.example.net&gt;... Recipient ok
</code></pre></div></div>

<p>If you were communicating with a destination mail server here, and the
account you specified in the <code class="language-plaintext highlighter-rouge">RCPT TO:</code> command was invalid, the mail
server would return an error code.  At this point, the mail server has
accepted the message and will attempt to deliver it.</p>

<p>After the <code class="language-plaintext highlighter-rouge">MAIL</code> and <code class="language-plaintext highlighter-rouge">RCPT</code> commands, the <code class="language-plaintext highlighter-rouge">DATA</code> command initiates the
actual message transfer.  To enter it, type <code class="language-plaintext highlighter-rouge">DATA</code> and press Enter.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DATA
</code></pre></div></div>

<p>The mail server responds with instructions to end your email message body
with an empty line containing a single dot (<code class="language-plaintext highlighter-rouge">.</code>) character.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>354 Enter mail, end with "." on a line by itself
</code></pre></div></div>

<p>You can add any additional headers to your email message in the body.</p>

<p>As per <a href="https://datatracker.ietf.org/doc/html/rfc2822">RFC 2822 - Internet Message Format</a>, the only required header fields are the origination date field (<code class="language-plaintext highlighter-rouge">Date:</code>)
and the originator address field(s) (<code class="language-plaintext highlighter-rouge">From:</code>).  To end the message,
type a period on a line by itself.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>From: Dusko P &lt;dusko@fbsd1.home.arpa&gt;
To: DP &lt;dusko@yourdomain.example.net&gt;
Date: Sat, 12 Nov 2022 20:12:43 -0800
Subject: Test message 1

Testing.
.
</code></pre></div></div>

<p>The server will respond with <code class="language-plaintext highlighter-rouge">250 2.0.0</code> followed by the queue ID.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>250 2.0.0 2BH22lp2011970 Message accepted for delivery
</code></pre></div></div>

<p>Type <code class="language-plaintext highlighter-rouge">QUIT</code> to close the session.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>QUIT
</code></pre></div></div>

<p>The server responds with <code class="language-plaintext highlighter-rouge">DONE</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DONE
</code></pre></div></div>

<hr />

<h2 id="testing-with-class-w-w---the-local-host">Testing with Class w ($=w) - The Local Host</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ printf '$=w' | sendmail -bt
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &lt;ruleset&gt; &lt;address&gt;
&gt; [IPv6:fe80:0:0:0:0:0:0:1]
[IPv6:0:0:0:0:0:0:0:1]
localhost
fbsd1.home.arpa
[123.45.6.7]
localhost.my.domain
[localhost.my.domain]
&gt; $ 
</code></pre></div></div>

<p>From <strong>sendmail</strong>, 4th Edition (a.k.a. <strong>“Bat Book”</strong>) <br />
By Bryan Costales, Claus Assmann, George Jansen, Gregory Neil Shapiro<br />
(Published by: O’Reilly Media, Inc., Publication Date: October 2007):</p>

<p><strong>Delivering to Local Recipient</strong></p>

<blockquote>
  <p>Typically, some early rules in the <code class="language-plaintext highlighter-rouge">parse</code> <em>rule set 0</em> are intended to
detect addresses that should be delivered locally.  A rule that
accomplishes that end might look like this:</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>R $+ &lt;@ $w&gt;          $#local $:$1                 local address
</code></pre></div></div>

<blockquote>
  <p>Here, the <code class="language-plaintext highlighter-rouge">$w</code> <em>sendmail</em> macro is the name of the <em>local host</em>.
Note that the RHS (righthand side) strips the focused host part from
the username.</p>
</blockquote>

<blockquote>
  <p>At some sites, the local host can be known by any of several names.
A rule to handle such hosts would begin with a class declaration that
adds those names to the class <code class="language-plaintext highlighter-rouge">w</code> (such as in the first line here):</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Cw font-server fax printer3
R $+ &lt;@ $=w&gt;        $#local $:$1                 local address
</code></pre></div></div>

<blockquote>
  <p>The class <code class="language-plaintext highlighter-rouge">w</code> is special because it is the one to which <em>sendmail</em>
automatically appends the alternative name of the local host.
This class declaration line adds names that <em>sendmail</em> might not
automatically detect.  Usually, such a declaration would be near the top
of the configuration file rather than in the <code class="language-plaintext highlighter-rouge">parse</code> rule <em>set 0</em>, but
technically it can appear anywhere in the file.  This rule looks to see
whether an address contains any of the names in class <code class="language-plaintext highlighter-rouge">w</code>.  If it does,
the <code class="language-plaintext highlighter-rouge">$=w</code> in the lefthand side (LHS) matches, and the RHS selects the
local delivery agent.</p>
</blockquote>

<blockquote>
  <p>On central mail-server machines, the <code class="language-plaintext highlighter-rouge">parse</code> <em>rule set 0</em> might also
have to match from a list of hosts for which the central server is an
MX recipient machine (<code class="language-plaintext highlighter-rouge">FEATURE(use_cw_file)</code>).</p>
</blockquote>

<hr />

<h3 id="check-whether-your-sendmail-supports-sasl-with--d010-debugging-switch">Check whether Your sendmail Supports SASL (with -d0.10 Debugging Switch)</h3>

<p>If you are running a precompiled <em>sendmail</em> binary, you can use
the <code class="language-plaintext highlighter-rouge">-d0.10</code> debugging command-line switch to determine whether
<em>SASL</em> support is defined (if it appears in the list, it is defined).</p>

<p>Also, it shows configuration files; that is, default conf files for
<strong>MTA</strong> (Mail Transport Agent), <strong>MSP</strong> (Mail Submission Program)
[which is a command-line <em>sendmail</em> that functions as a mail submission
agent (<strong>MSA</strong>)], and the <em>selected configuration file</em> (if, for example,
you’ve started <em>sendmail</em> with the <code class="language-plaintext highlighter-rouge">-C&lt;file_name&gt;</code> parameter to use an
alternate configuration file).</p>

<p>By default: <br />
configuration file for MSP is:  <code class="language-plaintext highlighter-rouge">/etc/mail/submit.cf</code>   <br />
configuration file for MTA is:  <code class="language-plaintext highlighter-rouge">/etc/mail/sendmail.cf</code></p>

<p>The <code class="language-plaintext highlighter-rouge">-d0.10</code> debug switch causes <em>sendmail</em> to print all the operating
system-specific <strong>definitions</strong> that were used to <strong>compile</strong> your specific
version of <em>sendmail</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -bt -d0.10 &lt; /dev/null 
Version 8.17.1
 Compiled with: DANE DNSMAP IPV6_FULL LOG MAP_REGEX MATCHGECOS MILTER
                MIME7TO8 MIME8TO7 NAMED_BIND NETINET NETINET6 NETUNIX NEWDB NIS
                PICKY_HELO_CHECK PIPELINING SASLv2 SCANF STARTTLS TCPWRAPPERS
                TLS_EC TLS_VRFY_PER_CTX USERDB XDEBUG
    OS Defines: BSD4_4_SOCKADDR HASFCHOWN HASFCHMOD HASFLOCK
                HASGETDTABLESIZE HASGETUSERSHELL HASINITGROUPS HASLSTAT HASNICE
                HASRANDOM HASRRESVPORT HASSETLOGIN HASSETREUID HASSETRLIMIT
                HASSETSID HASSETUSERCONTEXT HASSETVBUF HAS_ST_GEN HASSRANDOMDEV
                HASURANDOMDEV HASSTRERROR HASUNAME HASUNSETENV HASWAITPID
                HAVE_NANOSLEEP IDENTPROTO IP_SRCROUTE LOCK_ON_OPEN
                SAFENFSPATHCONF SFS_MOUNT USE_DOUBLE_FORK USESETEUID USESYSCTL
Kernel symbols: don't use _PATH_UNIX
     Conf file: /etc/mail/submit.cf (default for MSP)
     Conf file: /etc/mail/sendmail.cf (default for MTA)
      Pid file: /var/run/sendmail.pid (default)
Canonical name: fbsd1.home.arpa
 UUCP nodename: fbsd1.home.arpa
        a.k.a.: localhost.my.domain
        a.k.a.: fbsd1.home.arpa
        a.k.a.: [127.0.0.1]
        a.k.a.: [IPv6:0:0:0:0:0:0:0:1]
        a.k.a.: [IPv6:fe80:0:0:0:0:0:0:1]
        a.k.a.: [192.168.1.3]
        a.k.a.: [192.168.8.1]
        a.k.a.: [10.1.2.3]
     Conf file: /etc/mail/sendmail.cf (selected)
      Pid file: /var/run/sendmail.pid (selected)

============ SYSTEM IDENTITY (after readcf) ============
      (short domain name) $w = fbsd1
  (canonical domain name) $j = fbsd1.home.arpa
         (subdomain name) $m = home.arpa
              (node name) $k = fbsd1.home.arpa
========================================================

ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &lt;ruleset&gt; &lt;address&gt;
&gt; $ 
</code></pre></div></div>

<h2 id="from-sendmail-4th-edition-aka-bat-book">From <strong>sendmail</strong>, 4th Edition (a.k.a. <strong>“Bat Book”</strong>)</h2>
<p>By Bryan Costales, Claus Assmann, George Jansen, Gregory Neil Shapiro<br />
(Published by: O’Reilly Media, Inc., Publication Date: October 2007):</p>

<h2 id="authinfo-and-the-access-database">Authinfo and the access Database</h2>

<p>Under V8.12, default client authentication information was moved out of
the <em>default-auth-info</em> text file and into the <em>access</em> database.  If you 
prefer a more secure database than the <em>access</em> database, you can declare
an alternative with the <code class="language-plaintext highlighter-rouge">authinfo</code> feature (<code class="language-plaintext highlighter-rouge">FEATURE(authinfo)</code>). For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FEATURE(`authinfo')
</code></pre></div></div>

<p>Here, instead of looking up client authentication information in the 
<em>access</em> database, <em>sendmail</em> will look in the <em>/etc/mail/authinfo</em>
database.</p>

<p>Whether you store default client authentication information in the
<em>access</em> database or in the <em>authinfo</em> database, the syntax of entries
is the same.</p>

<p>The database entries are created from a text file that has keys down the
left column and matching values down the right.  The two columns are
separated by one or more tab or space characters.  One line in such
a source text file might look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AuthInfo:address      "U:user"  "P=password" 
</code></pre></div></div>

<p>The left column of the database is composed of two parts. The first part
is mandatory, the literal expression <code class="language-plaintext highlighter-rouge">AuthInfo:</code>.  The second, configurable
part is an IPv4 address, an IPv6 address, or a canonical host or domain
name.  For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AuthInfo:123.45.67.89
Authinfo:IPv6:2002:c0a8:51d2::23f4
AuthInfo:host.domain.com
AuthInfo:domain.com
</code></pre></div></div>

<p>When <em>sendmail</em> connects to another host, and that other host offers to
authenticate, that connected-to host’s IP address, hostname, and domain
are looked up in the database.</p>

<p>If the IP address, host, or domain is not found, the connection is allowed,
but <em>sendmail</em> will not attempt to authenticate it.  Otherwise, the
information in the matching right column is returned for <em>sendmail</em> to use.</p>

<p>The right column is composed of letter and value pairs, each pair quoted
and separated from the others by space characters:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AuthInfo:address      "U:user"  "P=password"
</code></pre></div></div>

<p>Letters are separated from their value with a colon or an equal-sign.
A colon means that the value is literal text.  An equal-sign means that
the value is Base64-encoded.</p>

<p>These letters and their meanings are shown in the table below.</p>

<p>Right-column key letters for the default <em>authinfo</em> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-------------+----------------------------------------------+ 
| Letter      | Description                                  |
+-------------+----------------------------------------------+ 
| U           | The user (authorization) identifier          |
+-------------+----------------------------------------------+ 
| I           | The authentication identifier                |
+-------------+----------------------------------------------+
| P           | The password                                 |
+-------------+----------------------------------------------+ 
| R           | The realm                                    |
+-------------+----------------------------------------------+ 
| M           | The list of mechanisms (separated by spaces) |
+-------------+----------------------------------------------+ 
</code></pre></div></div>

<p>Either the <code class="language-plaintext highlighter-rouge">U</code> or the <code class="language-plaintext highlighter-rouge">I</code>, or both, must exist or authentication will fail.
The <code class="language-plaintext highlighter-rouge">P</code> must always be present.  The <code class="language-plaintext highlighter-rouge">R</code> and <code class="language-plaintext highlighter-rouge">M</code> are optional.  All the
letters are case-insensitive-that is, <code class="language-plaintext highlighter-rouge">U</code> and <code class="language-plaintext highlighter-rouge">u</code> are the same.</p>

<p>The <code class="language-plaintext highlighter-rouge">U</code> lists the name of the user that <em>sendmail</em> will use to check
allowable permissions.  Generally, this could be <code class="language-plaintext highlighter-rouge">U:authuser</code> (but it
should never be <code class="language-plaintext highlighter-rouge">root</code>).</p>

<p>The <code class="language-plaintext highlighter-rouge">I</code> lists the name of the user allowed to set up the connection.
Generally, this could be <code class="language-plaintext highlighter-rouge">I:authuser</code> (but it should never be <em>root</em>).</p>

<p>The <code class="language-plaintext highlighter-rouge">P</code> value is the password.  If the <code class="language-plaintext highlighter-rouge">P</code> is followed by a colon (as <code class="language-plaintext highlighter-rouge">P:</code>),
the password is in plain text.  If the <code class="language-plaintext highlighter-rouge">P</code> is followed by an equal-sign
(<code class="language-plaintext highlighter-rouge">P=</code>), the password is Base64-encoded.  Generally, this should never be
<em>root</em>’s plain-text password.</p>

<p>The <code class="language-plaintext highlighter-rouge">R</code> lists the administrative realm for authentication.  In general,
this should be your DNS domain.  If no realm is specified (this item is
missing), <em>sendmail</em> will substitute the value of
the (<a href="#canonical-name-macro"><code class="language-plaintext highlighter-rouge">$j</code> macro</a>) unless the <code class="language-plaintext highlighter-rouge">AuthRealm</code> option
is used to define a realm to use in place of the value of the <code class="language-plaintext highlighter-rouge">$j</code> macro.</p>

<p>The <code class="language-plaintext highlighter-rouge">M</code> lists the preferred mechanism for connection authentication. 
Multiple mechanisms can be listed, one separated from another with a space:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"M:DIGEST-MD5 CRAM-MD5"
</code></pre></div></div>

<p>If the <code class="language-plaintext highlighter-rouge">M</code> item is missing, <em>sendmail</em> uses the mechanisms listed in the
<code class="language-plaintext highlighter-rouge">AuthMechanisms</code> option (<a href="#authmechanisms-option">AuthMechanisms</a>).</p>

<p>Missing required letters, unsupported letters, and letters that are missing
values have warnings logged at a LogLevel of 9, or above, like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AUTH=client, relay=server_name [server_addr], authinfo failed
</code></pre></div></div>

<p>Here, the <code class="language-plaintext highlighter-rouge">server_name</code> is the value of the <code class="language-plaintext highlighter-rouge">${server_name}</code> <em>sendmail</em>
macro.  The <code class="language-plaintext highlighter-rouge">server_addr</code> is the value of the <code class="language-plaintext highlighter-rouge">${server_addr}</code> <em>sendmail</em>
macro.  Both identify the connected-to host for which the connection failed.</p>

<p>All of this is implemented when you use the <code class="language-plaintext highlighter-rouge">authinfo</code> rule set.
As of V8.14, there is no way to add your own rules to this rule set.</p>

<h3 id="defaultauthinfo">DefaultAuthInfo</h3>

<p>When <em>sendmail</em> is compiled with SASL defined, authenticated connections 
can be supported.  When negotiating an authenticated connection, certain 
information is required, specifically and in this order:</p>

<ul>
  <li>The <em>user id</em> is the identifier <em>sendmail</em> uses to check allowable
permissions.  In general, this should never be <em>root</em>.</li>
  <li>The <em>authorization id</em> is the identifier of the user allowed to set up
the connection.  In general, this should never be <em>root</em>.</li>
  <li>The <em>password</em> is the clear text password used to authorize the mail
connection.  This should be a password dedicated to this use, <em>not</em> the
plain text copy of the user’s password.</li>
  <li>The <em>realm</em> is the administrative zone for authentication.  In general,
this should be your DNS domain.  If no realm is specified (this item is
blank), <em>sendmail</em> will substitute the value of
the <a href="#canonical-name-macro"><code class="language-plaintext highlighter-rouge">$j</code> macro</a> (a.k.a. canonical name macro).</li>
  <li>The <em>mechanism</em> is the preferred mechanism for connection authentication.
This should match one of the mechanisms listed in
the <a href="#authmechanisms-option"><code class="language-plaintext highlighter-rouge">AuthMechanisms</code> option</a>.</li>
</ul>

<h2 id="canonical-name-macro">Canonical Name Macro</h2>

<p><strong>$j</strong></p>

<p>Your official canonical name</p>

<p>The <code class="language-plaintext highlighter-rouge">$j</code> macro is used to hold the fully qualified domain name of the 
local machine.  V8 <em>sendmail</em> automatically defines <code class="language-plaintext highlighter-rouge">$j</code> to be the fully
qualified canonical name of the local host.  However, you can still
redefine <code class="language-plaintext highlighter-rouge">$j</code> if necessary; for example, if <em>sendmail</em> cannot figure out
your fully qualified canonical name, or if your machine has multiple
network interfaces and <em>sendmail</em> chooses the name associated with the
wrong interface.</p>

<p>A fully qualified domain name is one that begins with the local hostname,
which is followed by a dot and all the components of the local domain.</p>

<p>The hostname part is the name of the local machine.  That name is defined
at boot time in ways that vary with the version of Unix you are using.</p>

<p>At many sites, the local hostname is already fully qualified.
To tell whether your site uses just the local hostname, run <em>sendmail</em>
with a <code class="language-plaintext highlighter-rouge">-d0.4</code> switch:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -d0 -bt &lt; /dev/null 
[ . . . ]
  (canonical domain name) $j = fbsd1.home.arpa
</code></pre></div></div>

<p>One way to tell whether <code class="language-plaintext highlighter-rouge">$j</code> contains the correct value is to send mail
to yourself.  Examine the <code class="language-plaintext highlighter-rouge">Received:</code> headers.  The name of the local host
must be fully qualified where it appears in them:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Received: by some.domain   ...other text here
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">$j</code> is also used in the <code class="language-plaintext highlighter-rouge">Message-ID:</code> header definition.</p>

<p>The <code class="language-plaintext highlighter-rouge">$j</code> macro must <em>never</em> be defined in the command line.</p>

<p>In the rare event that you need to give <code class="language-plaintext highlighter-rouge">$j</code> a value, you can do so in
your <em>mc</em> configuration file like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dnl Here at your.domain we hardwire the domain.
define(`confDOMAIN_NAME', `your.domain')
</code></pre></div></div>

<h2 id="authmechanisms-option">AuthMechanisms Option</h2>

<p>The <code class="language-plaintext highlighter-rouge">AuthMechanisms</code> option is used to declare the types of authentication
you want to allow to be passed in the AUTH ESMTP extension (see 
<a href="https://datatracker.ietf.org/doc/html/rfc2554">RFC2554</a>
and 
<a href="https://datatracker.ietf.org/doc/html/rfc4954">RFC4954</a>).</p>

<p>You use this option by listing the mechanisms you wish to set as its value.</p>

<p>When there is more than one preferred mechanism, each is separated from
the others by space characters. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define(`confAUTH_MECHANISMS', `CRAM-MD5 KERBEROS_V4')
</code></pre></div></div>

<p>Before the actual AUTH is generated, <em>sendmail</em> produces an intersection
of the mechanisms you want and those supported by the SASL software you
have installed.  Only those that are specified by this option and those
supported by your software are listed by the issued AUTH command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>250-AUTH CRAM-MD5
</code></pre></div></div>

<p>Here, you wanted both CRAM-MD5 and KERBEROS_V4 offered as mechanisms.
But if the SASL software installed on your machine, for example, supports
only CRAM-MD5 and DIGEST-MD5, the common or intersecting mechanism will be
CRAM-MD5, so that is all that will be advertised.</p>

<p>When more than one mechanism is listed, the other side will negotiate them
one at a time, until one succeeds.</p>

<p>The following mechanisms are the maximum set of those recognized by the
cyrus-sasl-1.5.16 distribution.  Not all will be compiled in, so not all
will be supported.</p>

<p><em>ANONYMOUS</em> <br />
The ANONYMOUS mechanism allows anyone to use the service. Authentication
parallels that of the anonymous <em>ftp</em> login.</p>

<p><em>CRAM-MD5</em> <br />
The CRAM-MD5 mechanism is the style of authentication used by POP servers
known as APOP.</p>

<p><em>DIGEST-MD5</em> <br />
The DIGEST-MD5 mechanism is a stronger version of the CRAM-MD5 mechanism
that also supports encryption.</p>

<p><em>GSSAPI</em> <br />
The GSSAPI mechanism implements an API for general security services that
also support encryption.  One example is support for Kerberos V5, which is
achieved using GSSAPI.</p>

<p><em>KERBEROS_V4</em><br />
The KERBEROS_V4 mechanism implements authentication based on MIT’s Kerberos 4.</p>

<p><em>PLAIN</em><br />
The PLAIN mechanism can perform plain text password authentication (in a
single step) with either PAM, KERBEROS_V4, or <em>/etc/passwd</em>
(or <em>/etc/shadow</em>) authentication.</p>

<p><em>LOGIN</em><br />
The LOGIN mechanism is a two-step version of PLAIN.</p>

<p>The <code class="language-plaintext highlighter-rouge">AuthMechanisms</code> option is available only if <em>sendmail</em> is compiled
with SASL.</p>

<p><strong>NOTE:</strong> <br />
The complete list of SASL mechanisms, and the RFC that describes each,
can be found at</p>

<p><strong>Simple Authentication and Security Layer (SASL) Mechanisms - IANA
(Internet Assigned Numbers Authority)</strong> <br />
<a href="https://www.iana.org/assignments/sasl-mechanisms/sasl-mechanisms.xhtml">https://www.iana.org/assignments/sasl-mechanisms/sasl-mechanisms.xhtml</a></p>

<p>Similarly, the list of SASL mechanisms, SASL profiles and SASL APIs:  <br />
<strong>SASL mechanisms, SASL profiles, SASL APIs - Claus Aßmann at sendmail.org</strong><br />
(List composed by Alexey Melnikov.  Last updated: April 29, 2002.)   <br />
<a href="https://www.sendmail.org/~ca/email/mel/SASL_info.html">https://www.sendmail.org/~ca/email/mel/SASL_info.html</a></p>

<h2 id="test-submitcf-hostnamesubmitmc-with-sendmail-from-cli">Test <code class="language-plaintext highlighter-rouge">submit.cf</code> (<code class="language-plaintext highlighter-rouge">&lt;hostname&gt;.submit.mc</code>) with <em>sendmail</em> from CLI</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ hostname
fbsd1.home.arpa
</code></pre></div></div>

<p>In the following example, after you start <em>sendmail</em> with 
<code class="language-plaintext highlighter-rouge">sendmail -Ac -bt</code>, lines and commands that you type are:
<code class="language-plaintext highlighter-rouge">3,0 dusko@localhost</code>, <code class="language-plaintext highlighter-rouge">3,0 dusko@fbsd1.home.arpa</code>, <code class="language-plaintext highlighter-rouge">3,0 dusko@example.com</code>,
<code class="language-plaintext highlighter-rouge">3,0 dusko</code>, <code class="language-plaintext highlighter-rouge">3,0 root</code>, <code class="language-plaintext highlighter-rouge">/quit</code>.</p>

<p><strong>NOTE:</strong>  <br />
The <code class="language-plaintext highlighter-rouge">-Ac</code> parameter tells <em>sendmail</em> to use <em>submit.cf</em> configuration file;
that is, to oparate in <strong>MSP</strong> (Mail Submission Program) mode.
MSP is a command-line <em>sendmail</em> that functions as a Mail Submission Agent
(<strong>MSA</strong>).</p>

<p>The <code class="language-plaintext highlighter-rouge">-bt</code> parameter invokes <em>sendmail</em> in address test mode.
This mode reads addresses and shows the steps in parsing.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sendmail -Ac -bt
ADDRESS TEST MODE (ruleset 3 NOT automatically invoked)
Enter &lt;ruleset&gt; &lt;address&gt;
&gt; 3,0 dusko@localhost       
canonify           input: dusko @ localhost
Canonify2          input: dusko &lt; @ localhost &gt;
Canonify2        returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
canonify         returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse              input: dusko &lt; @ fbsd1 . home . arpa . &gt;
Parse0             input: dusko &lt; @ fbsd1 . home . arpa . &gt;
Parse0           returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
ParseLocal         input: dusko &lt; @ fbsd1 . home . arpa . &gt;
ParseLocal       returns: $# LR0relay $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse            returns: $# LR0relay $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
 
&gt; 3,0 dusko@fbsd1.home.arpa
canonify           input: dusko @ fbsd1 . home . arpa
Canonify2          input: dusko &lt; @ fbsd1 . home . arpa &gt;
Canonify2        returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
canonify         returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse              input: dusko &lt; @ fbsd1 . home . arpa . &gt;
Parse0             input: dusko &lt; @ fbsd1 . home . arpa . &gt;
Parse0           returns: dusko &lt; @ fbsd1 . home . arpa . &gt;
ParseLocal         input: dusko &lt; @ fbsd1 . home . arpa . &gt;
ParseLocal       returns: $# LR0relay $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;
parse            returns: $# LR0relay $@ fbsd1 . home . arpa $: dusko &lt; @ fbsd1 . home . arpa . &gt;

&gt; 3,0 dusko@example.com
canonify           input: dusko @ example . com
Canonify2          input: dusko &lt; @ example . com &gt;
Canonify2        returns: dusko &lt; @ example . com . &gt;
canonify         returns: dusko &lt; @ example . com . &gt;
parse              input: dusko &lt; @ example . com . &gt;
Parse0             input: dusko &lt; @ example . com . &gt;
Parse0           returns: dusko &lt; @ example . com . &gt;
ParseLocal         input: dusko &lt; @ example . com . &gt;
ParseLocal       returns: dusko &lt; @ example . com . &gt;
Parse1             input: dusko &lt; @ example . com . &gt;
MailerToTriple     input: &lt; smartrelay : [ 127 . 0 . 0 . 1 ] &gt; dusko &lt; @ example . com . &gt;
MailerToTriple   returns: $# smartrelay $@ [ 127 . 0 . 0 . 1 ] $: dusko &lt; @ example . com . &gt;
Parse1           returns: $# smartrelay $@ [ 127 . 0 . 0 . 1 ] $: dusko &lt; @ example . com . &gt;
parse            returns: $# smartrelay $@ [ 127 . 0 . 0 . 1 ] $: dusko &lt; @ example . com . &gt;
 
&gt; 3,0 dusko
canonify           input: dusko
Canonify2          input: dusko
Canonify2        returns: dusko
canonify         returns: dusko
parse              input: dusko
Parse0             input: dusko
Parse0           returns: dusko
ParseLocal         input: dusko
ParseLocal       returns: dusko
Parse1             input: dusko
Parse1           returns: $# local $: dusko
parse            returns: $# local $: dusko

&gt; 3,0 root
canonify           input: root
Canonify2          input: root
Canonify2        returns: root
canonify         returns: root
parse              input: root
Parse0             input: root
Parse0           returns: root
ParseLocal         input: root
ParseLocal       returns: root
Parse1             input: root
Parse1           returns: $# local $: root
parse            returns: $# local $: root
 
&gt; /quit
</code></pre></div></div>

<h2 id="steps-when-recompiling-sendmail-configuration-after-modifying-its-configuration-files">Steps When Recompiling Sendmail Configuration after Modifying Its Configuration Files</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd /etc/mail
$ sudo su
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make stop
Stopping: sendmail sendmail-clientmqueue.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># rm -i fbsd1.home.arpa.*
remove fbsd1.home.arpa.cf? y
remove fbsd1.home.arpa.mc? y
remove fbsd1.home.arpa.submit.cf? y
remove fbsd1.home.arpa.submit.mc? y
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># rm -i *.cf
remove sendmail.cf? y
remove submit.cf? y
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># make all
# make install 
# make start
</code></pre></div></div>

<h2 id="debugging-sendmail---sending-outgoing-test-message-in-verbosedebug-mode">Debugging Sendmail - Sending Outgoing Test Message in Verbose/Debug Mode</h2>

<p><code class="language-plaintext highlighter-rouge">-d8.20</code>: Debugging Switch: Tracking DNS Queuries <br />
<code class="language-plaintext highlighter-rouge">-d60.5</code>: Debugging Switch: Tracking Maps (Databases) queries <br />
<code class="language-plaintext highlighter-rouge">-Ac:</code> Use <code class="language-plaintext highlighter-rouge">submit.cf</code> even if the operation mode does not indicate an
initial mail submission; that is, oparate in MSP (Mail Submission Program)
mode.  MSP is a command-line <em>sendmail</em> that functions as a Mail Submission
Agent (MSA).</p>

<p>From: <br />
<a href="https://serverfault.com/questions/521032/debugging-sendmail-dsn-5-0-0/521614#521614">Debugging sendmail - dsn=5.0.0 - - Sendmail: Sending outgoing test message in verbose/debug mode</a></p>

<p>You may add additional debug/tracking command line options:  <br />
<code class="language-plaintext highlighter-rouge">-d8.20</code> - tracking DNS queuries  <br />
<code class="language-plaintext highlighter-rouge">-d60.5</code> - tracking maps (databases) queries</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sendmail -v -Ac -d60.5 dusko@your.isp.domain
# sendmail -v -Ac -d60.5 dusko
</code></pre></div></div>

<p>Equivalent to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sendmail -v -d60.5 -Csubmit.cf dusko@your.isp.domain
# sendmail -v -d60.5 -Csubmit.cf dusko
</code></pre></div></div>

<p>In the following example, after you start <em>sendmail</em> with 
<code class="language-plaintext highlighter-rouge">sendmail -v -Ac -d60.5 &lt;username&gt;</code>, the three lines you type are:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Subject: Test 1

.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sendmail -v -Ac -d60.5 dusko
map_lookup(dequote, dusko, %0=dusko) =&gt; NOT FOUND (0), ad=0
map_lookup(dequote, dusko, %0=dusko) =&gt; NOT FOUND (0), ad=0
map_lookup(dequote, dusko, %0=dusko) =&gt; NOT FOUND (0), ad=0
Subject: Test 1

.
dusko... Connecting to [127.0.0.1] via relay...
220 fbsd1.home.arpa ESMTP mailer ready at Sat, 12 Nov 2022 16:53:07 -0800 (PST)
&gt;&gt;&gt; EHLO fbsd1.home.arpa
250-fbsd1.home.arpa Hello localhost [127.0.0.1], pleased to meet you 
250-ENHANCEDSTATUSCODES
250-8BITMIME
250-SIZE 52428800
250-AUTH LOGIN PLAIN
250-DELIVERBY
250 HELP
&gt;&gt;&gt; STARTTLS
220 2.0.0 Ready to start TLS
&gt;&gt;&gt; EHLO fbsd1.home.arpa
250-fbsd1.home.arpa Hello localhost [127.0.0.1], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-DELIVERBY
250 HELP
&gt;&gt;&gt; MAIL From:&lt;dusko@fbsd1.home.arpa&gt; SIZE=17
250 2.1.0 &lt;dusko@fbsd1.home.arpa&gt;... Sender ok
&gt;&gt;&gt; RCPT To:&lt;dusko@fbsd1.home.arpa&gt;
&gt;&gt;&gt; DATA
250 2.1.5 &lt;dusko@fbsd1.home.arpa&gt;... Recipient ok
354 Enter mail, end with "." on a line by itself
&gt;&gt;&gt; .
250 2.0.0 2B71HsDo027909 Message accepted for delivery
dusko... Sent (2B71HsDo027909 Message accepted for delivery)
Closing connection to [127.0.0.1]
&gt;&gt;&gt; QUIT
221 2.0.0 fbsd1.home.arpa closing connection
</code></pre></div></div>

<p>The lines that begin with numbers and the lines that begin with <code class="language-plaintext highlighter-rouge">&gt;&gt;&gt;</code>
characters constitute a record of the SMTP conversation.</p>

<p>Similarly, with the <code class="language-plaintext highlighter-rouge">-Am</code> parameter, which tells <em>sendmail</em> to use
<code class="language-plaintext highlighter-rouge">sendmail.cf</code> configuration file even if the operation mode indicates an
initial mail submission:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sendmail -v -Am -d60.5 dusko@your.isp.domain
# sendmail -v -Am -d60.5 dusko
</code></pre></div></div>

<p>Equivalent to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sendmail -v -Csendmail.cf -d60.5 dusko@your.isp.domain
# sendmail -v -Csendmail.cf -d60.5 dusko
</code></pre></div></div>

<hr />

<h2 id="references">References</h2>

<p>(All references retrieved on Nov 12, 2022.)</p>

<p><a href="https://cgit.freebsd.org/src/commit/?id=4d184bd438">RELNOTES: document the switch from sendmail to dma</a>  (Author: Baptiste Daroussin <bapt at="" FreeBSD.org="">  2022-11-07)</bapt></p>

<p><a href="https://cgit.freebsd.org/src/commit/?id=a67b925ff3e58b072a60b633e442ee1d33e47f7f">FreeBSD source tree - mail: make The DragonFly Mail Agent (dma) the default mta.</a></p>

<p><a href="https://web.archive.org/web/20150810193500/http://brandonhutchinson.com/Creating_a_new_sendmail_mailer.html">Creating a new <em>sendmail</em> mailer</a></p>

<p><a href="https://william.shallum.net/notes/2010-07-24-sendmailredirectallmailfordevelopment/">Sendmail: redirect all mail for development</a></p>

<p><a href="https://forums.freebsd.org/threads/sendmail.56661/">Sendmail - The FreeBSD Forums</a></p>

<p><a href="https://forums.freebsd.org/threads/lazy-question-about-sendmail.49321/">Solved - “Lazy” question about sendmail - The FreeBSD Forums</a></p>

<p><a href="https://www.hydrus.org.uk/journal/base-sendmail.html">Modifying the FreeBSD base system sendmail - Posted on Mar 12, 2005</a></p>

<p><a href="https://www-ecs-shimane--u-ac-jp.translate.goog/~stamura/personal/network/op25b-sendmail.html?_x_tr_sch=http&amp;_x_tr_sl=ja&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=sc">Setting method of submit.mc for non-resident sendmail under OP25B environment - Configuration of submit.mc Under Outbound Port 25 Blocking</a></p>

<p><a href="https://www-ecs-shimane--u-ac-jp.translate.goog/~stamura/personal/network/op25b-sendmail.html?_x_tr_sl=ja&amp;_x_tr_tl=en&amp;_x_tr_hl=en&amp;_x_tr_pto=sc&amp;_x_tr_sch=http#smtp-auth-proxy">Configuring SMTP-AUTH proxy with resident sendmail</a></p>

<p><a href="https://www.exim.org/exim-html-current/doc/html/spec_html/ch-encrypted_smtp_connections_using_tlsssl.html">Chapter 43 - Encrypted SMTP connections using TLS/SSL - Exim Internet Mailer</a></p>

<p><a href="https://forums.freebsd.org/threads/dma-makes-sense.52219/">[Solved] DMA makes sense - The FreeBSD Forums</a></p>

<p><a href="https://groups.google.com/g/comp.mail.sendmail/c/Gy6QBfMd3l4">sendmail as relay client over port 465 with SSL - comp.mail.sendmail - <em>sendmail</em> news group</a></p>

<p><a href="https://groups.google.com/g/comp.mail.sendmail/c/hIqbWpw1ugc/m/uBg2v3kwAwAJ">Sendmail smtps support - comp.mail.sendmail - <em>sendmail</em> news group</a></p>

<p><a href="https://fedoraproject.org/wiki/Configure_sendmail_as_a_client_for_SMTPs">Configure sendmail as a client for SMTPs - Fedora Project Wiki</a></p>

<p><a href="https://web.archive.org/web/20140228040212/http://www.dawoodfall.net/index.php/en/relaying-sendmail-a-ssl">Configuring Sendmail to Relay via an SSL tunnel - Relaying Sendmail and SSL (posted on Feb 28, 2014)</a></p>

<p><a href="https://jpmens.net/2020/03/05/simple-solution-for-outgoing-mail-from-a-freebsd-system/">Simple solution for outgoing mail from a FreeBSD system - with dma(8) - DragonFly Mail Agent</a></p>

<p><a href="https://docs.freebsd.org/en/books/handbook/mail/#sendmail">30.3. Sendmail Configuration Files - Chapter 30. Electronic Mail - FreeBSD Documentation Portal</a></p>

<p><a href="https://www.sendmail.org/~ca/email/auth.html">SMTP AUTH in sendmail 8.10 (Last Update 2006-04-15) (Claus Aßmann at sendmail.org)</a></p>

<p><a href="https://docs.freebsd.org/en/books/handbook/mail/#SMTP-Auth">30.9. SMTP Authentication - FreeBSD Handbook - FreeBSD Documentation Portal</a></p>

<p><a href="https://www.brennan.id.au/12-Sendmail_Server.html">Chapter 12 - Sendmail Server – Linux Home Server HOWTO</a></p>

<p><a href="https://blog.grem.de/sysadmin/Sendmail-SmartHost-Without-DNS-2012-05-06-22-00.html">Configure sendmail to forward root’s email without DNS (posted on May 6, 2012)</a></p>

<p><a href="https://perldoc.perl.org/MIME::Base64">Perl - MIME::Base64 Module (Encoding and decoding of base64 strings)</a></p>

<p><a href="https://serverfault.com/questions/343720/sendmail-rewrite-rules-in-separate-file">sendmail rewrite rules in separate file - Server Fault</a></p>
<blockquote>
  <p>Rules using LOCAL_NET_CONFIG will always be inserted at the same place: <br />
halfway through ruleset 0.  And they can’t be wildly different from what
was there before such that delivery no longer approximately matches the
assumptions made by the existing “parse” functionality.  New rulesets
(subroutines) from LOCAL_RULESETS will either be called only by your
inserted rules, or be called directly by the <em>sendmail</em> program itself
depending on specific (and possibly obscure) subroutine names and
sendmail.mc FEATURE specifications.  And extensions to existing rulesets
(subroutines) from LOCAL_RULESET can add new functionality, but probably
cannot change existing functionality, as a match and “return” by an
existing earlier rule will terminate execution of that ruleset before
your additional rules are even reached.  Nevertheless, this may be
adequate for what you want.</p>

  <p>If you do this, use the <code class="language-plaintext highlighter-rouge">sendmail -bt -Ctrial_sendmail.cf_file -d21.15</code><br />
(<code class="language-plaintext highlighter-rouge">-d21.15</code> debug switch is for tracing <em>sendmail</em> rules and rule sets)
test mechanism to make sure it’s behaving the way you intend.
Remember, your “style” should be to compose your new rules in such
a way that they fit seamlessly into the existing ruleset framework
(rather than making arbitrary changes with little consideration for the
existing framework); it’s rather like adding a new feature to existing
code that was structured by somebody else.  The distributed rewrite
rules are very good at handling not only mainline behavior but also edge
cases (MX for individual hosts? Masquerade exceptions?  UUCP connectivity?
aliases? etc.?); hopefully your added rules will be similarly comprehensive.</p>
</blockquote>

<hr />

<h2 id="footnotes">Footnotes</h2>

<p><strong>[ 1 ]</strong> Other possible AKAs:</p>

<p>Sendmail as a relay client over port 465 with SSL-or-TLS<br />
Sendmail with SASL2, SMTP AUTH and TLS <br />
Sendmail with SASL2, SMTP AUTH and SSL<br />
Sendmail with SASL2, SMTP AUTH and SSL-or-TLS<br />
Using Stunnel to secure SMTP transport <br />
Implicit TLS on port 465 for SMTP Submission <br />
Sendmail with SSL (port 465) <br />
Sendmail with SSL-or-TLS (port 465) <br />
Sendmail’s SMTP Authentication (SMTP AUTH) <br />
Setting up Sendmail with SSL-or-TLS and AUTH support in FreeBSD <br />
Setting up Sendmail with TLS and AUTH support in FreeBSD <br />
Getting Sendmail (as a client) to use AUTH LOGIN <br />
Sendmail TLS SASL SMTP-AUTH <br />
Sendmail SSL-or-TLS SASL SMTP-AUTH <br />
Secure SMTP AUTH over SSL with Sendmail and Cyrus SASL <br />
Secure SMTP AUTH over SSL-or-TLS with Sendmail and Cyrus SASL <br />
Authenticated SMTP with sendmail <br />
SMTP AUTH: Client Authentication <br />
Sendmail, SASL, and SSL-or-TLS <br />
Sendmail, SASL, and TLS <br />
Testing SMTP AUTH connections <br />
Sendmail TLS SASL SMTP-AUTH <br />
Sendmail SSL-or-TLS SASL SMTP-AUTH</p>

<p><strong>[ 2 ]</strong>  Technically, SMTPS doesn’t exist.  According to
<a href="https://datatracker.ietf.org/doc/html/rfc5321#page-61">RFC 5321</a>,
the Protocol is either SMTP or ESMTP:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Protocol       = "ESMTP" / "SMTP" / Attdl-Protocol

   Attdl-Protocol = Atom
                  ; Additional standard names for protocols are
                  ; registered with the Internet Assigned Numbers
                  ; Authority (IANA) in the "mail parameters"
                  ; registry [9].  SMTP servers SHOULD NOT
                  ; use unregistered names.

----

   [9]   Newman, C., "ESMTP and LMTP Transmission Types Registration",
         RFC 3848 [https://datatracker.ietf.org/doc/html/rfc3848], July 2004.
</code></pre></div></div>

<p><a href="https://datatracker.ietf.org/doc/html/rfc3848">RFC 3848</a> specified
additional values: <br />
ESMTPA when ESMTP is used with successful user authentication, ESMTPS
when ESMTP is used with STARTTLS, and ESMTPSA when the session has been
secured with both STARTTLS and SMTP AUTH are successfully negotiated
(the combination of ESMTPS and ESMTPA):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Abstract

   This registers seven new mail transmission types (ESMTPA, ESMTPS,
   ESMTPSA, LMTP, LMTPA, LMTPS, LMTPSA) for use in the "with" clause of
   a Received header in an Internet message.

[ . . . ]

1.  IANA Considerations

   As directed by SMTP [2], IANA maintains a registry [7] of "WITH
   protocol types" for use in the "with" clause of the Received header
   in an Internet message.  This registry presently includes SMTP [6],
   and ESMTP [2].  This specification updates the registry as follows:

   o  The new keyword "ESMTPA" indicates the use of ESMTP when the SMTP
      AUTH [3] extension is also used and authentication is successfully
      achieved.

   o  The new keyword "ESMTPS" indicates the use of ESMTP when STARTTLS
      [1] is also successfully negotiated to provide a strong transport
      encryption layer.

   o  The new keyword "ESMTPSA" indicates the use of ESMTP when both
      STARTTLS and SMTP AUTH are successfully negotiated (the
      combination of ESMTPS and ESMTPA).

----

   [1]  Hoffman, P., "SMTP Service Extension for Secure SMTP over
        Transport Layer Security", 
        RFC 3207 [https://datatracker.ietf.org/doc/html/rfc3207], February 2002.

   [2]  Klensin, J., Ed., "Simple Mail Transfer Protocol", 
        RFC 2821 [https://datatracker.ietf.org/doc/html/rfc2821], April 2001.

   [3]  Myers, J., "SMTP Service Extension for Authentication", 
        RFC 2554 [https://datatracker.ietf.org/doc/html/rfc2554], March 1999.

[ . . . ]  

   [6]  Postel, J., "Simple Mail Transfer Protocol", STD 10, 
        RFC 821 [https://datatracker.ietf.org/doc/html/rfc821], August 1982.

   [7]  &lt;http://www.iana.org/assignments/mail-parameters&gt;
</code></pre></div></div>

<p><strong>[ 3 ]</strong> <a href="https://www.rfc-editor.org/rfc/rfc8314#section-3.3">3.3. Implicit TLS for SMTP Submission -  The RFC 8314</a>:</p>

<blockquote>
  <p>3.3.  Implicit TLS for SMTP Submission</p>

  <p>When a TCP connection is established for the “submissions” service
(default port 465), a TLS handshake begins immediately.  Clients MUST
implement the certificate validation mechanism described in
[RFC7817].  Once the TLS session is established, Message Submission
protocol data [RFC6409] is exchanged as TLS application data for the
remainder of the TCP connection.  (Note: The “submissions” service
name is defined in Section 7.3 of this document and follows the usual
convention that the name of a service layered on top of Implicit TLS
consists of the name of the service as used without TLS, with an “s”
appended.)</p>

  <p>[ . . . ]</p>

  <p>Note that the “submissions” port provides access to a Message
Submission Agent (MSA) as defined in [RFC6409], so requirements and
recommendations for MSAs in that document, including the requirement
to implement SMTP AUTH [RFC4954] and the requirements of Email
Submission Operations [RFC5068], also apply to the submissions port.</p>
</blockquote>

<p><a href="https://tools.ietf.org/html/rfc8314#section-7.3">7.3. Submissions Port Registration (Port 465) for message submission over TLS protocol – The RFC 8314 - January 2018</a></p>

<blockquote>
  <p>7.3.  Submissions Port Registration</p>

  <p>IANA has assigned an alternate usage of TCP port 465 in addition to
the current assignment using the following template [RFC6335]:</p>

  <p>Service Name: submissions<br />
Transport Protocol: TCP<br />
Assignee: IESG &lt;iesg@ietf.org&gt;<br />
Contact: IETF Chair &lt;chair@ietf.org&gt;<br />
Description: Message Submission over TLS protocol<br />
Reference: RFC 8314<br />
Port Number: 465</p>

  <p>[ . . . ]</p>

  <p>Historically, port 465 was briefly registered as the “smtps” port.
This registration made no sense, as the SMTP transport MX
infrastructure has no way to specify a port, so port 25 is always
used.  As a result, the registration was revoked and was subsequently
reassigned to a different service.  In hindsight, the “smtps”
registration should have been renamed or reserved rather than
revoked.  Unfortunately, some widely deployed mail software
interpreted “smtps” as “submissions” [RFC6409] and used that port for
email submission by default when an end user requested security
during account setup.</p>
</blockquote>

<p><strong>[ 4 ]</strong> The RFC 8314 was amended in 2018 to recommend the use of
          Implicit TLS over port 465:</p>

<p><a href="https://www.rfc-editor.org/rfc/rfc8314#section-3">The IETF issued a one-time amendment to reinstate port 465 for message submission over TLS protocol - RFC 8314 - Use of TLS for Email Submission/Access - January 2018</a>:</p>

<blockquote>
  <p>To encourage more widespread use of TLS and to also encourage greater
consistency regarding how TLS is used, this specification now recommends
the use of Implicit TLS for POP, IMAP, SMTP Submission, and all other
protocols used between an MUA (Mail User Agent) and an MSP (Mail Service
Provider).</p>
</blockquote>

<p>Port 465 and 587 are both <strong>valid</strong> ports for a mail submission agent (MSA).
Port 465 requires negotiation of TLS/SSL at connection setup and port 587
uses STARTTLS if an MUA chooses to negotiate TLS.</p>

<p><strong>[ 5 ]</strong> On FreeBSD 13, the <code class="language-plaintext highlighter-rouge">user.localbase</code> is set to <code class="language-plaintext highlighter-rouge">/usr/local</code> by default.</p>

<p>From the man page for <code class="language-plaintext highlighter-rouge">sysctl(8)</code> utility:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The string and integer information is summarized below.  For a detailed
description of these variable see sysctl(3).

The changeable column indicates whether a process with appropriate
privilege can change the value.  String and integer values can be set
using sysctl.
  
Name                           Type          Changeable
.
[ . . . ]
.
user.localbase                 string        no
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ man 3 sysctl
[ . . . ]
       USER_LOCALBASE
               Return the value of localbase that has been compiled into system
               utilities that need to have access to resources provided by a
               port or package.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sysctl -d user.localbase
user.localbase: Prefix used to install and locate add-on packages
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sysctl user.localbase
user.localbase: /usr/local
</code></pre></div></div>

<p><strong>[ 6 ]</strong>  FreeBSD src tree - FreeBSD src commits - RELNOTES: document the
switch from sendmail to dma (Posted on Nov 7, 2022)</p>

<ul>
  <li>
    <p><a href="https://cgit.freebsd.org/src/commit/?id=4d184bd438">FreeBSD src tree - FreeBSD src commits - RELNOTES: document the switch from sendmail to dma</a>  <br />
(Posted on Nov 7, 2022)</p>

    <ul>
      <li><a href="https://twitter.com/FreeBSD_src_git/status/1589587194003472384">FreeBSD src commits (@FreeBSD_src_git) on Twitter - bapt@ on . (4d184bd438): RELNOTES: document the switch from sendmail to dma</a>  (Posted on Nov 7, 2022)</li>
    </ul>
  </li>
  <li>
    <p><a href="https://twitter.com/_bapt_/status/938688218215714817">Time to remove sendmail from #FreeBSD base? - Baptiste Daroussin - Twitter</a>  (Posted on Dec 7, 2017)</p>

    <ul>
      <li><a href="https://lists.freebsd.org/pipermail/freebsd-arch/2017-December/018712.html">Sendmail deprecation ? - Baptiste Daroussin bapt at FreeBSD.org - Dec 6, 2017 - The freebsd-arch Mailing List Archives</a></li>
    </ul>
  </li>
  <li>
    <p><a href="https://twitter.com/ed_maste/status/1487170942249930756">Did you know? FreeBSD includes the DragonFly Mail Agent (dma), a minimal MTA, in the base system. - Ed Maste (@ed_maste)</a>  (Posted on Jan 28, 2022)</p>
    <blockquote>
      <p>Did you know? FreeBSD includes the DragonFly Mail Agent (dma), a minimal MTA,
in the base system.  See the dma(1) and mailer.conf(5) man pages for
configuration details.</p>

      <p><a href="https://www.freebsd.org/cgi/man.cgi?query=dma">dma(8) - FreeBSD Manual Pages</a></p>
    </blockquote>
  </li>
</ul>

<p><strong>[ 7 ]</strong> From <a href="https://www.sendmail.org/~ca/email/auth.html">SMTP AUTH in sendmail 8.10 - Claus Aßmann at sendmail.org</a> (Last Update 2006-04-15) (Retrieved on Nov 12, 2022):</p>

<blockquote>
  <p><strong>Terminology</strong></p>

  <p>SASL defines two terms which are important in this context:
<em>authorization identifier</em> and <em>authentication identifer</em>.</p>

  <p><em>authorization identifier</em> (<strong>userid</strong>) <br />
The userid is the identifier an application uses to check whether
operations are allowed (authorized).  <br />
<em>authentication identifer</em> (<strong>authid</strong>) <br />
The authentication identifier is the identifier that is being used to
authenticate the client.  That is, the authentication credentials of
the client contain the authentication identifier.  This can be used
for a proxy server to act as (proxy for) another user.</p>

  <p>[ . . . ]</p>

  <p><strong>Operation</strong></p>

  <p>SMTP AUTH allows relaying for senders who have successfully
<strong>authenticated themselves</strong>.  Per default, <strong>relaying</strong> is <strong>allowed</strong>
for any user who <strong>authenticated</strong> via a trusted mechanism, i.e., one that
is defined via <br />
TRUST_AUTH_MECH(`list of mechanisms’) <br />
This is useful for roaming users and can replace POP-before-SMTP hacks if
the MUA supports SMTP AUTH.</p>

  <p>[ . . . ]</p>

  <p>New macros for SMTP AUTH are <code class="language-plaintext highlighter-rouge">{auth_authen}</code>, <code class="language-plaintext highlighter-rouge">{auth_author}</code>, and
<code class="language-plaintext highlighter-rouge">{auth_type}</code>, which hold the client’s authentication credentials
(<a href="https://www.sendmail.org/~ca/email/auth.html#authid">authid</a>),
the authorization identity
(<a href="https://www.sendmail.org/~ca/email/auth.html#userid">userid</a>)
(i.e., the <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter of the <code class="language-plaintext highlighter-rouge">MAIL</code> command, if supplied),
and the mechanism used for authentication.</p>
</blockquote>

<p><strong>[ 8 ]</strong> In addition, the <strong>relay</strong> delivery agent is also chosen for
forwarding mail to LUSER_RELAY (<code class="language-plaintext highlighter-rouge">LUSER_RELAY</code> mc macro),
BITNET_RELAY (<code class="language-plaintext highlighter-rouge">$B</code> macro, deprecated), UUCP_RELAY (<code class="language-plaintext highlighter-rouge">UUCP_RELAY</code> mc macro),
DECNET_RELAY (<code class="language-plaintext highlighter-rouge">DECNET_RELAY</code> mc macro), FAX_RELAY (<code class="language-plaintext highlighter-rouge">FAX_RELAY</code> mc macro)
and MAIL_HUB (<code class="language-plaintext highlighter-rouge">MAIL_HUB</code> mc macro).</p>

<p><strong>[ 9 ]</strong>
From <em>Linux Network Administrator’s Guide</em>, Second Edition<br />
By Olaf Kirch, Terry Dawson;
Published By: O’Reilly Media, Inc., Publication Date: June 2000<br />
(Chapter 18. Sendmail &gt; Interpreting and Writing Rewrite Rules &gt; Ruleset Semantics):</p>

<blockquote>
  <p>Each of the <em>sendmail</em> rulesets is called upon to perform
a different task in mail processing.</p>

  <p>LOCAL_RULE_3</p>

  <p>Ruleset 3 is responsible for converting an address in an arbitrary format
into a common format that <em>sendmail</em> will then process.
The expected output format is<br />
<code class="language-plaintext highlighter-rouge">local-part</code> <code class="language-plaintext highlighter-rouge">@</code> <code class="language-plaintext highlighter-rouge">host-domain-spec</code>.</p>

  <p>Ruleset 3 should place the hostname part of the converted address inside
the <code class="language-plaintext highlighter-rouge">&lt;</code> and <code class="language-plaintext highlighter-rouge">&gt;</code> characters to make parsing by later rulesets easier.
Ruleset 3 is applied before <em>sendmail</em> does any other processing of an
email address so if you want <em>sendmail</em> to gateway mail from some system that
uses some unusual address format, you should add a rule using the <code class="language-plaintext highlighter-rouge">LOCAL_RULE_3</code>
macro to convert addresses into the common format.</p>
</blockquote>

<p><strong>[ 10 ]</strong> Delivery Agent Equates</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+--------+----------------+-------------------------------+
| Equate | Field Name     | Meaning                       |
+--------+----------------+-------------------------------+
| /=     | /path          | Set a chroot directory        |
|        |                | (V8.10 and later)             |
+--------+----------------+-------------------------------+
| A=     | Argv           | Delivery agent's              |
|        |                | command-line arguments        |
+--------+----------------+-------------------------------+
| C=     | CharSet        | Default MIME character        |
|        |                | set (V8.7 and later)          |
+--------+----------------+-------------------------------+
| D=     | Directory      | Delivery agent working        |
|        |                | directory (V8.6 and later)    |
+--------+----------------+-------------------------------+
| E=     | EOL            | End-Of-Line string            |
+--------+----------------+-------------------------------+
| F=     | Flags          | Delivery agent flags          |
+--------+----------------+-------------------------------+
| L=     | LineLimit      | Maximum line length           |
|        |                | (V8.1 and later)              |
+--------+----------------+-------------------------------+
| M=     | MaxMsgSize     | Maximum message size          |
+--------+----------------+-------------------------------+
| m=     | maxMsgsPerConn | Max messages per connection   |
|        |                | (V8.10 and later)             |
+--------+----------------+-------------------------------+
| N=     | Niceness       | How to nice(2) the agent      |
|        |                | (V8.7 and later)              | 
+--------+----------------+-------------------------------+
| P=     | Path           | Path to the delivery agent    |
+--------+----------------+-------------------------------+
| Q=     | QueueGroup     | The name of the queue group   | 
|        |                | to use (V8.12 and later)      | 
+--------+----------------+-------------------------------+
| R=     | Recipient      | Recipient rewriting rule      | 
+--------+----------------+-------------------------------+
| r=     | recipients     | Maximum recipients per        | 
|        |                | envelope (V8.12 and later)    |
+--------+----------------+-------------------------------+
| S=     | Sender         | Sender rewriting rule set     | 
+--------+----------------+-------------------------------+
| T=     | Type           | Types for DSN diagnostics     | 
|        |                | (V8.7 and later)              |
+--------+----------------+-------------------------------+
| U=     | UID            | Run agent as user-id:group-id |
|        |                | (V8.7 and later)              | 
+--------+----------------+-------------------------------+
| W=     | Wait           | Timeout for a process wait    |
|        |                | (V8.10 and later)             |
+--------+----------------+-------------------------------+
</code></pre></div></div>

<p><strong>[ 11 ]</strong> Sections of Chapter 8. Securing the Mail Transport
(from <em>sendmail Cookbook</em> by Craig Hunt - Published by O’Reilly
Media, Inc., Publication Date: December 2003):</p>

<p>8.1. Building a Private Certificate Authority<br />
8.2. Creating a Certificate Request<br />
8.3. Signing a Certificate Request<br />
8.4. Configuring sendmail for STARTTLS<br />
8.5. Relaying Based on the CA<br />
8.6. Relaying Based on the Certificate Subject<br />
8.7. Requiring Outbound Encryption<br />
8.8. Requiring Inbound Encryption <br />
8.9. Requiring a Verified Certificate<br />
8.10. Requiring TLS for a Recipient<br />
8.11. Refusing STARTTLS Service<br />
8.12. Selectively Advertising STARTTLS<br />
8.13. Requesting Client Certificates</p>

<p><strong>[ 12 ]</strong> The RFC describes three functions for the AUTH keyword:</p>

<blockquote>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">250-AUTH</code> is the response of the SMTP <code class="language-plaintext highlighter-rouge">EHLO</code> command.  The response
advertises the supported authentication mechanisms.  The configuration
that causes <em>sendmail</em> to list AUTH in the <code class="language-plaintext highlighter-rouge">EHLO</code> response and to accept
incoming AUTH connections is covered in Recipe 7.1.  That configuration
applies when <em>sendmail</em> runs as an <strong>MTA</strong>, and it is <strong>only</strong> applicable
when <em>sendmail</em> is run with the <strong><code class="language-plaintext highlighter-rouge">-bd</code></strong> command-line option.</li>
    <li><code class="language-plaintext highlighter-rouge">AUTH</code> is the SMTP command used to request authentication and to select
the authentication mechanism for the session.  The connecting host must
select one of the mechanisms advertised by the receiving host, or the
authentication attempt is rejected. <em>sendmail</em> will request AUTH
authentication when it is configured as described in Recipe 7.2.
A laptop or desktop that sends SMTP mail but does not accept inbound SMTP
connections could be configured using only Recipe 7.2.  A system that
accepts incoming AUTH connections and creates outgoing AUTH connections
would combine the configurations from both Recipe 7.1 and Recipe 7.2.</li>
    <li><code class="language-plaintext highlighter-rouge">AUTH=</code> is a parameter used on the <code class="language-plaintext highlighter-rouge">MAIL From:</code> line to identify the
authenticated source address.  The <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter comes from the
connecting host as part of the initial envelope sender address.
If the receiving host trusts the <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter, it propagates it on
to the next mail relay.  Recipe 7.6 provides additional information about
the <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter.</li>
  </ul>
</blockquote>

<p><strong>[ 13 ]</strong> The Cyrus SASL documentation defines four special terms:</p>

<p><strong>userid</strong>  <br />
The username that determines the permissions granted to the client.
The client is given the permissions normally granted to the specified user.
<em>userid</em> is also called the <strong><em>authorization id</em></strong>.</p>

<p><strong>authid</strong>  <br />
The account name used to authenticate the connection.
<em>authid</em> is also called the <strong><em>authentication id</em></strong>.</p>

<p><strong>realm</strong><br />
A group of users, systems, and services that share a common authentication
environment.  All members of a given group use the same <em>realm</em> value.
It is <strong>common</strong> to use a <strong>domain name</strong> or <strong>hostname</strong> for the <em>realm</em> value.</p>

<p><strong>mechanism</strong> <br />
Identifies the type of authentication used.  For example, DIGEST-MD5 is a
valid <em>mechanism</em> value.</p>

<p>The <em>userid</em> and <em>authid</em> values cause the most confusion.  To understand
how SASL uses these two values, think of an <em>/etc/passwd</em> file with one
entry for <em>craig</em> and another for <em>kathy</em>.  In a normal login, when Kathy
logs in to the <em>kathy</em> account, she is granted the permissions given to
that account.  With SASL, it is possible to set <em>authid</em> to <em>kathy</em> and
<em>userid</em> to <em>craig</em>, which means that the <em>kathy</em> account password is
required for authentication, but the permissions granted to the user are
the permissions granted to the <em>craig</em> account.</p>

<p><strong>[ 14 ]</strong> Three configuration commands can be used in the <em>Sendmail.conf</em> file.
They are:</p>

<p><em>srvtab</em> <br />
The <code class="language-plaintext highlighter-rouge">srvtab</code> command points to the file that contains the Kerberos 4
service key.  The argument provided with this command is the full pathname
of the service key file.</p>

<p><em>auto_transition</em><br />
The <code class="language-plaintext highlighter-rouge">auto_transition</code> command causes SASL to automatically create
a <em>sasldb</em> entry for every user that authenticates using the <strong>PLAIN</strong>
authentication method.</p>

<p><em>pwcheck_method</em><br />
The <code class="language-plaintext highlighter-rouge">pwcheck_method</code> command defines the technique that SASL should use to
validate the clear text password received during <strong>PLAIN</strong> method
authentication.  The possible values for the <code class="language-plaintext highlighter-rouge">pwcheck_method</code> are:</p>
<ul>
  <li><em>passwd</em> <br />
Tells SASL to look up passwords in the <em>/etc/passwd</em> file.</li>
  <li><em>shadow</em> <br />
Tells SASL to look up passwords on the <em>/etc/shadow</em> file.  Because of the
file permissions associated with the <em>/etc/shadow</em> file, the application
must be running as <em>root</em>.</li>
  <li><em>pam</em> <br />
Tells SASL to use Pluggable Authentication Modules (PAM). PAM must,
of course, be properly configured to authenticate the password.</li>
  <li><em>sasldb</em> <br />
Tells SASL that the passwords for the PLAIN authentication method are
stored in the <em>sasldb</em> file.  Normally, <em>sasldb</em> is only used for
DIGEST-MD5 and CRAM-MD5 authentication.</li>
  <li><em>kerberos_v4</em> <br />
Tells SASL to authenticate clear text passwords through the Kerberos 4
server.  Kerberos 4 must be installed, configured, and running, and the
Kerberos 4 server must be configured to accept clear text passwords.</li>
  <li><em>sia</em> <br />
Tells SASL to use Digital’s Security Integration Architecture (SIA) to
validate passwords.</li>
  <li><em>pwcheck</em> <br />
Tells SASL to pass the data to an external program for password checking.</li>
</ul>

<p><strong>[ 15 ]</strong> SASL Flags</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------+---------------------------------------------------------------+
| Flag | Purpose                                                       |
+------+---------------------------------------------------------------+
| A    | Use the AUTH= parameter only when successfully authenticated. |
+------+---------------------------------------------------------------+
| a    | Request optional protection against active attacks during the |
|      | authentication exchange.                                      |
+------+---------------------------------------------------------------+
| c    | Require client credentials if the authentication mechanism    |
|      | supports them.                                                |
+------+---------------------------------------------------------------+
| d    | Reject authentication techniques that are susceptible to      |
|      | dictionary attacks.                                           |
+------+---------------------------------------------------------------+
| f    | Don't use the same static shared-secret for each session.     |
+------+---------------------------------------------------------------+
| p    | Reject authentication techniques that are susceptible to      |
|      | simple passive attacks.                                       |
+------+---------------------------------------------------------------+
| y    | Don't allow the ANONYMOUS authentication mechanism.           |
+------+---------------------------------------------------------------+
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">A</code> option controls when the <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter is added to the envelope
sender information on the SMTP <code class="language-plaintext highlighter-rouge">Mail From:</code> command line.</p>

<p><strong>[ 16 ]</strong> <code class="language-plaintext highlighter-rouge">Local_trust_auth</code> rule set and <code class="language-plaintext highlighter-rouge">SLocal_trust_auth</code> hook</p>

<p>About the <code class="language-plaintext highlighter-rouge">SLocal_trust_auth</code> hook - based on directions from
<em>/usr/local/share/sendmail/cf/README</em>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>If the MSP should actually use AUTH then the necessary data
should be placed in a map as explained in SMTP AUTHENTICATION:

FEATURE(`authinfo', `DATABASE_MAP_TYPE /etc/mail/msp-authinfo')

/etc/mail/msp-authinfo should contain an entry like:

        AuthInfo:127.0.0.1      "U:smmsp" "P:secret" "M:DIGEST-MD5"

The file and the map created by makemap should be owned by smmsp,
its group should be smmsp, and it should have mode 640.

The database used by the MTA for AUTH must have a corresponding entry.

Additionally the MTA must trust this authentication data so the AUTH=
part will be relayed on to the next hop.  This can be achieved by
adding the following to your sendmail.mc file:

        LOCAL_RULESETS
        SLocal_trust_auth
        R$*	$: $&amp;{auth_authen}
        Rsmmsp	$# OK
</code></pre></div></div>

<p>From <strong>sendmail</strong>, 4th Edition (a.k.a. <strong>“Bat Book”</strong>) <br />
By Bryan Costales, Claus Assmann, George Jansen, Gregory Neil Shapiro<br />
(Published by: O’Reilly Media, Inc., Publication Date: October 2007)</p>

<p><strong>SASL and Rule Sets</strong></p>

<p>The SMTP <code class="language-plaintext highlighter-rouge">AUTH</code> extension, enabled by SASL, allows client machines to relay
mail through the authentication-checking server.  This mechanism is especially
useful for roaming users whose laptops seldom have a constant IP number or
hostname assigned.  A special rule set called <code class="language-plaintext highlighter-rouge">trust_auth</code>, found inside
the <em>sendmail</em> configuration file, does the actual checking.  This rule set
decides whether the client’s authentication identifier (<code class="language-plaintext highlighter-rouge">authid</code>) is trusted
to act as (proxy for) the requested authorization identity (<code class="language-plaintext highlighter-rouge">userid</code>).
It allows <code class="language-plaintext highlighter-rouge">authid</code> to act for <code class="language-plaintext highlighter-rouge">userid</code> if both are recognized, and disallows
that action if the authentication fails.</p>

<p>Another rule set, called <code class="language-plaintext highlighter-rouge">Local_trust_auth</code>, is available if you wish to
supplement the basic test provided by <code class="language-plaintext highlighter-rouge">trust_auth</code>.  The <code class="language-plaintext highlighter-rouge">Local_trust_auth</code>
rule set can return the <code class="language-plaintext highlighter-rouge">#error</code> delivery agent to disallow proxying, or it
can return OK to allow proxying.</p>

<p>Within the <code class="language-plaintext highlighter-rouge">Local_trust_auth</code> rule set you can use three new <em>sendmail</em>
macros (in addition to the other normal <em>sendmail</em> macros). They are:</p>

<p><code class="language-plaintext highlighter-rouge">{auth_authen}</code>  <br />
The client’s <strong>authentication credentials</strong> as determined by the
authentication process.</p>

<p><code class="language-plaintext highlighter-rouge">{auth_author}</code> <br />
The <strong>authorization identity</strong> as set by issuance of the <code class="language-plaintext highlighter-rouge">SMTP AUTH=</code> parameter.
This could be either a <em>username</em> or a <em>user@host.domain</em> address.</p>

<p><code class="language-plaintext highlighter-rouge">{auth_type}</code> <br />
The <strong>mechanism</strong> used for authentication, such as CRAM-MD5 and PLAIN.</p>

<p>These three macros can also be used in any of the relay-testing rule sets
to determine whether a particular user may relay.  To illustrate, consider
a rule set designed to allow senders with local accounts on the local
machine to relay only if authenticated:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LOCAL_RULESETS
SLocal_check_rcpt
R$*			$: $&amp;{auth_type} $| $&amp;{auth_authen}
RDIGEST-MD5 $| $+@$=w	$# OK
RCRAM-MD5 $| $+@$=w	$# OK
</code></pre></div></div>

<p>Here, the <code class="language-plaintext highlighter-rouge">Local_check_rcpt</code> rule set is called to validate the envelope
recipient.  The first rule (<code class="language-plaintext highlighter-rouge">R</code> line) replaces the workspace (the <code class="language-plaintext highlighter-rouge">$*</code> on
the left) with three values: the current value of the <code class="language-plaintext highlighter-rouge">${auth_type}</code> macro;
a <code class="language-plaintext highlighter-rouge">$|</code> literal; and the current value of the <code class="language-plaintext highlighter-rouge">${auth_authen}</code> macro.</p>

<p>If the authentication type is either <code class="language-plaintext highlighter-rouge">DIGEST-MD5</code> or <code class="language-plaintext highlighter-rouge">CRAM-MD5</code> and if the
domain is in the class <code class="language-plaintext highlighter-rouge">$=w</code> (is a local hostname or address), the envelope
sender is allowed to relay.  But if the <code class="language-plaintext highlighter-rouge">${auth_type}</code> macro’s value is
empty (nothing was authenticated), or if the authentication was by an
untrusted mechanism, such as PLAIN, the envelope sender is not allowed to relay.</p>

<p><strong>Policy Rule Set Reference</strong></p>

<blockquote>
  <p>Beginning with V8.8, <em>sendmail</em> calls special rule sets internally to
determine its behavior.  Called the <em>policy rule sets</em>, they are used for
such varied tasks as setting spam handling, setting policy, or validating
the conditions when ETRN should be allowed, to list just a few.
Table below shows the complete list of these policy rule sets.</p>
</blockquote>

<p><em>The policy rule sets table</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+--------------+-------------------+------------------------------------------------------+
| Rule set     | Hook              | Description                                          |
+--------------+-------------------+------------------------------------------------------+
| authinfo     | None              | Handle AuthInfo: lookups in the access database.     |
+--------------+-------------------+------------------------------------------------------+
| check_compat | See below         | Validate just before delivery.                       |
+--------------+-------------------+------------------------------------------------------+
| check_data   | None needed       | Check just after DATA.                               | 
+--------------+-------------------+------------------------------------------------------+
| check_eoh    | None needed       | Validate after headers are read.                     |
+--------------+-------------------+------------------------------------------------------+
| check_eom    | None needed       | Review message's size (V8.13 and later).             |
+--------------+-------------------+------------------------------------------------------+
| check_etrn   | None needed       | Allow or disallow ETRN.                              |
+--------------+-------------------+------------------------------------------------------+
| check_expn   | None needed       | Validate EXPN.                                       |
+--------------+-------------------+------------------------------------------------------+
| check_mail   | Local_check_mail  | Validate the envelope-sender address.                | 
+--------------+-------------------+------------------------------------------------------+
| check_rcpt   | Local_check_rcpt  | Validate the envelope-recipient address.             | 
+--------------+-------------------+------------------------------------------------------+
| check_relay  | Local_check_relay | Validate incoming network connections.               |
+--------------+-------------------+------------------------------------------------------+
| check_vrfy   | None needed       | Validate VRFY.                                       |
+--------------+-------------------+------------------------------------------------------+
| queuegroup   | See below         | Select a queue group.                                |
+--------------+-------------------+------------------------------------------------------+
| srv_features | None needed       | Tune server setting based on connection information. | 
+--------------+-------------------+------------------------------------------------------+
| tls_client   | LOCAL_TLS_CLIENT  | With the access database, validate inbound STARTTLS  |
|              |                   | or MAIL From: SMTP command.                          |
+--------------+-------------------+------------------------------------------------------+
| tls_rcpt     | LOCAL_TLS_RCPT    | Validate a server's credentials based on the         |
|              |                   | recipient address.                                   |
+--------------+-------------------+------------------------------------------------------+
| tls_server   | LOCAL_TLS_SERVER  | Possibly with the access database, validate the      |
|              |                   | inbound and outbound connections.                    |
+--------------+-------------------+------------------------------------------------------+
| trust_auth   | Local_trust_auth  | Validate that a client's authentication              |
|              |                   | identifier (authid) is trusted to act as (proxy for) |
|              |                   | the requested authorization identity (userid).       |
+--------------+-------------------+------------------------------------------------------+
| try_tls      | LOCAL_TRY_TLS     | Disable STARTTLS for selected outbound connected-to  |
|              |                   | hosts.                                               |
+--------------+-------------------+------------------------------------------------------+
| Hname:$      | n/a               | Reject, discard, or accept a message based on a      |
|              |                   | header's value.                                      |
+--------------+-------------------+------------------------------------------------------+
</code></pre></div></div>

<p>Note that some of these rule sets are omitted from your configuration file
by default.  For those, no hook is needed. You merely declare the rule set
in your <em>mc</em> file and give it appropriate rules:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LOCAL_RULESETS
Scheck_vrfy
... &lt;your rules here&gt;
</code></pre></div></div>

<p>Those with a <code class="language-plaintext highlighter-rouge">Local_</code> hook, as shown in the table, are declared
<strong>by default</strong> in your configuration file.  To use them yourself, you need
only declare them with the <code class="language-plaintext highlighter-rouge">Local_</code> hook indicated:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LOCAL_RULESETS
SLocal_check_rcpt
... &lt;your rules here&gt;
</code></pre></div></div>

<p>Those with a <code class="language-plaintext highlighter-rouge">LOCAL_</code> hook, as shown in the table, are <strong>declared directly
with that hook</strong>.  There in no need to precede the hook with <code class="language-plaintext highlighter-rouge">LOCAL_RULESETS</code>.
For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LOCAL_TRY_TLS
... &lt;your rules here&gt;
</code></pre></div></div>

<p>The two <strong>exceptions</strong> are the <code class="language-plaintext highlighter-rouge">check_compat</code> and <code class="language-plaintext highlighter-rouge">queuegroup</code> rule sets.
Each is automatically declared when you use the corresponding
<code class="language-plaintext highlighter-rouge">FEATURE(check_compat)</code> or <code class="language-plaintext highlighter-rouge">FEATURE(queuegroup)</code>, but not declared if you
don’t use that feature.</p>

<p>All of these rule sets are handled in the same manner.  If the rule set
does not exist, the action is permitted.  If the rule set returns anything
other than a <code class="language-plaintext highlighter-rouge">#error</code> or a <code class="language-plaintext highlighter-rouge">#discard</code> delivery agent, the message, identity,
or action is accepted for that rule set (although it can still be rejected
or discarded by another rule set).  Otherwise, the <code class="language-plaintext highlighter-rouge">#error</code> delivery agent
causes the message, identity, or action to be rejected and the <code class="language-plaintext highlighter-rouge">#discard</code>
delivery agent causes the message to be accepted, then discarded.</p>

<p><strong>${auth_authen} Macro</strong></p>

<p>RFC2554 AUTH credentials, <em>sendmail</em> V8.10 and later.</p>

<p>A server offers authentication by presenting the AUTH keyword to the
connecting site, following that with the types of mechanisms supported:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>250-host.domain Hello some.domain, pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH DIGEST-MD5 CRAM-MD5
250-DELIVERBY
250 HELP
</code></pre></div></div>

<p>Note the line <code class="language-plaintext highlighter-rouge">250-AUTH DIGEST-MD5 CRAM-MD5</code></p>

<p>If the connecting site wishes to authenticate itself, it replies with an
AUTH command indicating the type of mechanism preferred:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AUTH X5                                                           ← client sends
504 Unrecognized authentication type.                             ← server replies
AUTH CRAM-MD5                                                     ← client sends
334  PENCeUxFREJoU0NnbmhNWitOMjNGNndAZWx3b29kLmlubm9zb2Z0LmNvbT4= ← server replies
ZnJlZCA5ZTk1YWVlMDljNDBhZjJiODRhMGMyYjNiYmFlNzg2ZQ=  =            ← client sends
235 Authentication successful.          
</code></pre></div></div>

<p>Here, the client first asks for X5 authentication, which the server rejects.
The client next asks for CRAM-MD5.  The server says it can support that by
replying with a 334 followed by a challenge string.  The client replies to
the challenge with an appropriate reply string, and the authentication is
successful (as shown in the last line).</p>

<p>If authentication is successful, this <code class="language-plaintext highlighter-rouge">${auth_authen}</code> macro is assigned
the authentication credentials that were approved as its value.  The form
of the credentials depends on the encryption used.  It could be a simple
username (such as <em>bob</em>) or a username at a realm (such as <code class="language-plaintext highlighter-rouge">bob@some.domain</code>).</p>

<p>The client can then offer a different user, rather than the envelope sender,
to authenticate on behalf of the envelope sender.  This is done by adding
an AUTH= parameter to the <code class="language-plaintext highlighter-rouge">MAIL From:</code> keyword:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MAIL From: &lt;user@host.domain&gt; AUTH=address
</code></pre></div></div>

<p>The <em>address</em> is assigned to the <code class="language-plaintext highlighter-rouge">{auth_author}</code> macro, and the <code class="language-plaintext highlighter-rouge">trust_auth</code>
rule set is called to make further policy decisions, with the AUTH= parameter
in its workspace.</p>

<p>The <code class="language-plaintext highlighter-rouge">${auth_authen}</code> macro is useful for adding your own rules to the
<code class="language-plaintext highlighter-rouge">Local_trust_auth</code> rule set.</p>

<p><code class="language-plaintext highlighter-rouge">${auth_authen}</code> is transient.  If defined in the configuration file or in
the command line, that definition can be ignored by <em>sendmail</em>.  Note that
a <code class="language-plaintext highlighter-rouge">$&amp;</code> prefix is necessary when you reference this macro in rules (that is,
use <code class="language-plaintext highlighter-rouge">$&amp;{auth_authen}</code>, not <code class="language-plaintext highlighter-rouge">${auth_authen}</code>).</p>

<p>Note that, beginning with V8.13, the value to be stored into this macro is
first xtext encoded, then stored (Macro Xtext Translations
<strong>[<sup><a href="#footnotes"> 17 </a></sup>]</strong>).</p>

<p><strong>${auth_author} Macro</strong></p>

<p>RFC2554 <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter, <em>sendmail</em> V8.10 and later.</p>

<p>As part of the RFC2554 authentication scheme, a client can ask whether
a user other than the envelope sender is allowed to authenticate on behalf
of the envelope sender.  This is done by adding an <code class="language-plaintext highlighter-rouge">AUTH=</code> parameter to the
<code class="language-plaintext highlighter-rouge">MAIL From:</code> keyword:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MAIL From: &lt;user@host.domain&gt; AUTH=address
</code></pre></div></div>

<p>This <code class="language-plaintext highlighter-rouge">${auth_author}</code> macro is assigned the <em>address</em> that followed the
<code class="language-plaintext highlighter-rouge">MAIL From:</code> AUTH= extension.</p>

<p>The <code class="language-plaintext highlighter-rouge">${auth_author}</code> macro is useful for adding your own rules to the
<code class="language-plaintext highlighter-rouge">Local_trust_auth</code> rule set.<br />
Note that a <code class="language-plaintext highlighter-rouge">$&amp;</code> prefix is necessary when you reference this macro in rules
(that is, use <code class="language-plaintext highlighter-rouge">$&amp;{auth_author}</code>, not <code class="language-plaintext highlighter-rouge">${auth_author}</code>).</p>

<p>Note that beginning with V8.13, the value to be stored into this
macro is first xtext-encoded, then stored (Macro Xtext Translations
<strong>[<sup><a href="#footnotes"> 17 </a></sup>]</strong>).</p>

<p><code class="language-plaintext highlighter-rouge">${auth_author}</code> is transient.  If defined in the configuration file or in
the command line, that definition can be ignored by <em>sendmail</em>.</p>

<p><strong>${auth_type} Macro</strong></p>

<p>Authentication mechanism used, <em>sendmail</em> V8.10 and later.</p>

<p>A server offers authentication by presenting the AUTH keyword to
the connecting site, following that with the types of authentication
mechanisms supported:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>250-host.domain Hello some.domain, pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH DIGEST-MD5 CRAM-MD5
250-DELIVERBY
250 HELP
</code></pre></div></div>

<p>Note the line <code class="language-plaintext highlighter-rouge">250-AUTH DIGEST-MD5 CRAM-MD5</code></p>

<p>If the connecting site wishes to authenticate itself, it replies with
an AUTH command indicating the mechanism preferred:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AUTH CRAM-MD5                                 ← client sends
</code></pre></div></div>

<p>Once it is selected, that mechanism is placed into this <code class="language-plaintext highlighter-rouge">${auth_type}</code> macro.
If no mechanism is selected (none is offered, or none is accepted) or if the
act of authentication fails, <code class="language-plaintext highlighter-rouge">${auth_type}</code> becomes undefined (NULL).</p>

<p>If the authentication is accepted, the <code class="language-plaintext highlighter-rouge">Received:</code> header is updated to reflect that:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HReceived: $?sfrom $s $.$?_($?s$|from $.$_)
        $.$?{auth_type}(authenticated$?{auth_ssf} bits=${auth_ssf}$.)
        $.by $j ($v/$Z)$?r with $r$. id $i$?{tls_version}
        (version=${tls_version} cipher=${cipher} bits=${cipher_bits}
verify=${verify})$.$?u
        for $u; $|;
        $.$b
</code></pre></div></div>

<p>Here, if the connection were authenticated, the second line of the
<code class="language-plaintext highlighter-rouge">Received:</code> header would look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(authenticated bits=bits)
(authenticated)                       ← if no encryption negotiated
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">${auth_type}</code> macro is useful for adding your own rules to
policy rule sets, such as to the <code class="language-plaintext highlighter-rouge">Local_trust_auth</code> rule set.
Note that a <code class="language-plaintext highlighter-rouge">$&amp;</code> prefix is necessary when you reference this macro
in rules (that is, use <code class="language-plaintext highlighter-rouge">$&amp;{auth_type}</code>, not <code class="language-plaintext highlighter-rouge">${auth_type}</code>).</p>

<p><code class="language-plaintext highlighter-rouge">${auth_type}</code> is transient.  If defined in the configuration file or in
the command line, that definition can be ignored by <em>sendmail</em>.</p>

<p><strong>[ 17 ]</strong> Macro Xtext Translations</p>

<p>Some macros are assigned values from text that is supplied by outside
connecting hosts.  Such text cannot necessarily be trusted in rule sets,
or as keys in database-map lookups.</p>

<p>To protect itself, <em>sendmail</em> modifies such text by translating whitespace
characters (spaces and tabs), nonprinting characters (such as newlines and
control characters), and the following list of special characters:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt; &gt; ( ) " +
</code></pre></div></div>

<p><em>Translation</em> is the replacement of each special character with its
corresponding hexadecimal value (based on U.S. ASCII), where each new
hexadecimal value is prefixed with a <strong>plus character</strong>. (This is also
called <em>xtext</em> translation and is documented in RFC1891.)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(some text)        becomes  →   +28some+20text+29
</code></pre></div></div>

<p>Only six macros are subject to this encoding at this time.  They are listed
in the table below.</p>

<p><em>Macros subject to xtext encoding</em></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-----------------+---------------------------------------------------------------+
| Macro           | Description                                                   |
+-----------------+---------------------------------------------------------------+
| ${auth_authen}  | RFC2554 AUTH credentials (xtext encoded with V8.13 and later) |
+-----------------+---------------------------------------------------------------+
| ${auth_author}  | RFC2554 AUTH= parameter (xtext encoded with V8.13 and later)  |
+-----------------+---------------------------------------------------------------+
| ${cert_issuer}  | Distinguished name of certificate signer                      |
+-----------------+---------------------------------------------------------------+
| ${cert_subject} | Distinguished name of certificate (owner)                     |
+-----------------+---------------------------------------------------------------+
| ${cn_issuer}    | Common name of certificate signer                             |
+-----------------+---------------------------------------------------------------+
| ${cn_subject}   | Common name of certificate                                    |
+-----------------+---------------------------------------------------------------+
</code></pre></div></div>

<hr />

<p><strong>[ 18 ]</strong> SMTP Basic Commands
(From <em>Postfix</em> by Richard Blum, 
Published By: Sams, Publication Date: May 2001):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+---------+----------------------------------------------------------------------+
| Command | Description                                                          |
+---------+----------------------------------------------------------------------+
| HELO    | Opening greeting from client                                         |
+---------+----------------------------------------------------------------------+
| MAIL    | Identifies sender of message                                         |
+---------+----------------------------------------------------------------------+
| RCPT    | Identifies recipient(s)                                              |
+---------+----------------------------------------------------------------------+
| DATA    | Identifies start of message                                          |
+---------+----------------------------------------------------------------------+
| SEND    | Sends message to terminal(s)                                         |
+---------+----------------------------------------------------------------------+
| SOML    | Send-or-Mail; sends message to mailbox or terminal of recipient(s)   |
+---------+----------------------------------------------------------------------+
| SAML    | Send-and-Mail; sends message to mailbox and terminal of recipient(s) |
+---------+----------------------------------------------------------------------+
| RSET    | Reset; aborts SMTP connection and discards information               |
+---------+----------------------------------------------------------------------+
| VRFY    | Verifies that username exists on server                              |
+---------+----------------------------------------------------------------------+
| EXPN    | Verifies that mailing list exists on server                          |
+---------+----------------------------------------------------------------------+
| HELP    | Requests list of commands                                            |
+---------+----------------------------------------------------------------------+
| NOOP    | No operation; only elicits an "OK" from server                       |
+---------+----------------------------------------------------------------------+
| QUIT    | Ends the SMTP session                                                |
+---------+----------------------------------------------------------------------+
| TURN    | Requests that the systems reverse their current SMTP roles           |
+---------+----------------------------------------------------------------------+
</code></pre></div></div>

<p><strong>HELO Command</strong></p>

<p>This is not a typo.  By definition, SMTP commands are four characters long,
thus the opening greeting by the client to the server is the <code class="language-plaintext highlighter-rouge">HELO</code> command.
The format for this command is</p>

<p><code class="language-plaintext highlighter-rouge">HELO hostname</code></p>

<p>The purpose of the HELO command is for the client to identify itself to
the SMTP server.  The client can identify itself as whatever it wants to
use in the text string.  Most SMTP servers use this command just as
a formality.  If they really need to know the identity of the client,
they try to use a reverse DNS lookup of the client’s IP address to
determine the client’s DNS name.  For security reasons, many SMTP servers
refuse to talk to hosts whose IP address does not resolve to a proper
DNS hostname.</p>

<p>By sending the <code class="language-plaintext highlighter-rouge">HELO</code> command, the client indicates that it wants to
initialize a new SMTP session with the server.  By responding to this
command, the server acknowledges the new connection and should be ready
to receive further commands from the client.</p>

<p><strong>NOTE:</strong>  <em>About people clients versus host clients</em>  <br />
In SMTP you must remember to differentiate between people and hosts.
When creating a new mail message, the email user is the client of his
local host.  Once the user sends his message, s/he is no longer the client
in the SMTP process.  His/her local host computer takes over the process of
mailing the message and now becomes the client as far as SMTP is concerned.
When the local host contacts the remote host to transfer the message
using SMTP, it is now acting as the client in the SMTP process.
The <code class="language-plaintext highlighter-rouge">HELO</code> command identifies the local hostname as the client, not the
actual sender of the message.  This terminology often gets confusing.</p>

<p><strong>MAIL Command</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">MAIL</code> command initiates a mail session with the server after the
initial <code class="language-plaintext highlighter-rouge">HELO</code> command is sent.  It identifies from whom the message is
being sent. The format of the <code class="language-plaintext highlighter-rouge">MAIL</code> command is</p>

<p><code class="language-plaintext highlighter-rouge">MAIL reverse-path</code></p>

<p>The <code class="language-plaintext highlighter-rouge">reverse-path</code> argument not only identifies the sender, but it also
identifies how to reach the sender with a return message.  If the sender
were a user on the client computer that initiated the SMTP session,
the format for the <code class="language-plaintext highlighter-rouge">MAIL</code> command would look something like this:</p>

<p><code class="language-plaintext highlighter-rouge">MAIL FROM:username@example.domain.net</code></p>

<p>Notice how the <code class="language-plaintext highlighter-rouge">FROM</code> section denotes the proper email address for the
sender of the message, including the fully qualified hostname of the client
computer.  This information should appear in the text of the email message
in the <code class="language-plaintext highlighter-rouge">FROM</code> section.  If the email message has been routed through several
different systems between the original sender and the desired recipient,
each system adds its routing information to the <code class="language-plaintext highlighter-rouge">reverse-path</code> section.
This documents the path that the email message traversed to get to the server.</p>

<p>Often, mail from clients on private networks has to traverse several mail
relay points before getting to the Internet.  The <code class="language-plaintext highlighter-rouge">reverse-path</code> information
is often useful in troubleshooting email problems or in tracking down
senders who are purposely trying to hide their identity by bouncing their
email messages off of several unknowing SMTP servers.</p>

<p><strong>RCPT Command</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">RCPT</code> command identifies the intended recipient of the message.
In order to deliver the same message to multiple recipients, each recipient
must be listed in a separate <code class="language-plaintext highlighter-rouge">RCPT</code> command line. The format of the <code class="language-plaintext highlighter-rouge">RCPT</code>
command is</p>

<p><code class="language-plaintext highlighter-rouge">RCPT forward-path</code></p>

<p>The <code class="language-plaintext highlighter-rouge">forward-path</code> argument defines where the email is ultimately destined.
This is usually a fully qualified email address but could be just a username
that is local to the SMTP server.  For example, the following RCPT command</p>

<p><code class="language-plaintext highlighter-rouge">RCPT TO:haley</code></p>

<p>would send the message to user <code class="language-plaintext highlighter-rouge">haley</code> on the local SMTP server that is
processing the message.</p>

<p>The protocol also allows messages to be relayed; that is, sent to users on
computer systems other than the server currently handling the SMTP connection.</p>

<p>For example, sending the following <code class="language-plaintext highlighter-rouge">RCPT</code> command</p>

<p><code class="language-plaintext highlighter-rouge">RCPT TO:riley@example.domain.net</code></p>

<p>to the SMTP server on <code class="language-plaintext highlighter-rouge">shadrach.domain.net</code> would cause <code class="language-plaintext highlighter-rouge">shadrach.domain.net</code>
to make a decision.  Since the recipient is not local to <code class="language-plaintext highlighter-rouge">shadrach</code>, it must
decide what to do with the message.  <code class="language-plaintext highlighter-rouge">shadrach</code> could take three possible
actions with the message:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">shadrach</code> could accept the message for later forwarding to the specified
destination and return an OK response to the client.  In this scenario,
<code class="language-plaintext highlighter-rouge">shadrach</code> would prepend its hostname to the message’s <code class="language-plaintext highlighter-rouge">&lt;reverse-path&gt;</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">shadrach</code> could refuse to forward the message but could reply to the
client that it would not deliver the message.  The response could also verify
that the address of <code class="language-plaintext highlighter-rouge">example.domain.net</code> was a correct address for another
server.  Then the client could try to resend the message directly to
<code class="language-plaintext highlighter-rouge">example.domain.net</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">shadrach</code> could refuse to forward the message and could reply to the
client that this operation (relaying) is not permitted from this server.
It would be up to the system administrator at the client to figure out
what happened and why.</li>
</ul>

<p>In the early days of the Internet, it was common to run across computers
that used the first scenario and blindly forwarded email messages across
the world.  Unfortunately, that courteous behavior was exploited by email
<em>spammers</em>, people who do mass mailings across the Internet for either fun
or profit.  Spammers often use unsuspecting, unsecured SMTP servers that
blindly forward email messages in an attempt to disguise the origin of their
mail messages.  To combat this situation, most mail system administrators
have either completely turned off mail relaying or have at least limited
it to hosts within their domain.  Many ISPs allow their customers to relay
email from their mail server but restrict outside computers from that privilege.</p>

<p>In the case of multiple recipients, it is up to the client how to handle
situations in which some of the recipients are not allowed by the server.
Some clients abort the entire message and return an error to the sending
user.  Some continue sending the message to the recipients that are
acknowledged and list the recipients that aren’t acknowledged in a return
message.</p>

<p><strong>DATA Command</strong></p>

<p>After the <code class="language-plaintext highlighter-rouge">MAIL</code> and <code class="language-plaintext highlighter-rouge">RCPT</code> commands are worked out, the <code class="language-plaintext highlighter-rouge">DATA</code> command
initiates the actual message transfer.  The format of the <code class="language-plaintext highlighter-rouge">DATA</code> command is</p>

<p><code class="language-plaintext highlighter-rouge">DATA</code></p>

<p>Anything that appears after the command is treated as part of the message
being transferred.  Usually the SMTP server adds a timestamp and
<code class="language-plaintext highlighter-rouge">return-path</code> information to the head of the message.  The client indicates
the end of the message by sending a line with just <strong>a single period</strong>.
The format for that line is</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
</code></pre></div></div>

<p>When the SMTP server receives this sequence, it knows that the message
transmission is done and should return a response code to the client
indicating whether the message has been accepted.</p>

<p>Technically there is no wrong way to send a message, although work has been
done to standardize a method (see the “Message Format”
<strong>[<sup><a href="#footnotes"> 19 </a></sup>]</strong> in Footnotes).  Any combination of
valid ASCII characters is transferred to the specified recipients.</p>

<p><strong>RSET Command</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">RSET</code> command is short for reset.  If the client somehow gets confused
by the responses from the server or thinks that the SMTP connection has
gotten out of sync, it can issue the <code class="language-plaintext highlighter-rouge">RSET</code> command to return the connection to the HELO command state. Of course, all MAIL, RCPT, and DATA information already entered is lost. Often this is used as a last-ditch effort when the client either has lost track of where it was in the command series or did not expect a particular response from the server.</p>

<p><strong>HELP Command</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">HELP</code> command asks the server to return useful information to
the client.  <code class="language-plaintext highlighter-rouge">HELP</code> with no arguments returns a list of SMTP commands
that the SMTP server understands.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ telnet localhost 25
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 fbsd1.home.arpa ESMTP Sendmail 8.17.1/8.17.1; Sat, 12 Nov 2022 19:12:14 -0800 (PST)
HELP
214-2.0.0 This is sendmail version 8.17.1
214-2.0.0 Topics:
214-2.0.0       HELO    EHLO    MAIL    RCPT    DATA
214-2.0.0       RSET    NOOP    QUIT    HELP    VRFY
214-2.0.0       EXPN    VERB    ETRN    DSN     AUTH
214-2.0.0       STARTTLS
214-2.0.0 For more info use "HELP &lt;topic&gt;".
214-2.0.0 To report bugs in the implementation see
214-2.0.0       http://www.sendmail.org/email-addresses.html
214-2.0.0 For local information send email to Postmaster at your site.
214 2.0.0 End of HELP info
QUIT
221 2.0.0 fbsd1.home.arpa closing connection
Connection closed by foreign host.
</code></pre></div></div>

<p><strong>NOOP Command</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">NOOP</code> command is short for <em>no operation</em>.  This command has no effect
on the SMTP server other than making it return a positive response code.
This is often a useful command to send to test connectivity without actually
starting the message transfer process.</p>

<p><strong>QUIT Command</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">QUIT</code> command indicates that the client computer is finished with the
current SMTP session and wants to close the connection.  It is the
responsibility of the SMTP server to respond to this command and to initiate
the closing of the TCP connection.  If the server receives a <code class="language-plaintext highlighter-rouge">QUIT</code> command
in the middle of an email transaction, any data previously transferred will
be deleted and not sent to any recipients.</p>

<p><strong>Extended SMTP</strong></p>

<p>Since SMTP invention in 1982, system administrators began to recognize
its limitations.  Work was done to try and improve the basic SMTP protocol
by keeping the original specifications and adding new features.</p>

<p><a href="https://datatracker.ietf.org/doc/html/rfc1869">RFC 1869, SMTP Service Extensions</a>
was published in 1995 and defined a method of extending the capabilities of SMTP.</p>

<p>Extended SMTP (ESMTP) replaces the original SMTP greeting (<code class="language-plaintext highlighter-rouge">HELO</code>) with
a new greeting command: <code class="language-plaintext highlighter-rouge">EHLO</code>.  When an ESMTP server receives this command,
it should realize that the client is capable of sending extended SMTP commands.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ telnet localhost 25
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
220 fbsd1.home.arpa ESMTP Sendmail 8.17.1/8.17.1; Sat, 12 Nov 2022 19:28:44 -0800 (PST)
EHLO localhost
250-fbsd1.home.arpa Hello localhost [127.0.0.1], pleased to meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH DIGEST-MD5 CRAM-MD5 LOGIN PLAIN
250-STARTTLS
250-DELIVERBY
250 HELP
HELP DSN
214-2.0.0 MAIL From:&lt;sender&gt; [ RET={ FULL | HDRS} ] [ ENVID=&lt;envid&gt; ]
214-2.0.0 RCPT To:&lt;recipient&gt; [ NOTIFY={NEVER,SUCCESS,FAILURE,DELAY} ]
214-2.0.0                    [ ORCPT=&lt;recipient&gt; ]
214-2.0.0       SMTP Delivery Status Notifications.
214-2.0.0 Descriptions:
214-2.0.0       RET     Return either the full message or only headers.
214-2.0.0       ENVID   Sender's "envelope identifier" for tracking.
214-2.0.0       NOTIFY  When to send a DSN. Multiple options are OK, comma-
214-2.0.0               delimited. NEVER must appear by itself.
214-2.0.0       ORCPT   Original recipient.
214 2.0.0 End of HELP info
HELP ETRN
214-2.0.0 ETRN [ &lt;hostname&gt; | @&lt;domain&gt; | #&lt;queuename&gt; ]
214-2.0.0       Run the queue for the specified &lt;hostname&gt;, or
214-2.0.0       all hosts within a given &lt;domain&gt;, or a specially-named
214-2.0.0       &lt;queuename&gt; (implementation-specific).
214 2.0.0 End of HELP info
QUIT
221 2.0.0 fbsd1.home.arpa closing connection
Connection closed by foreign host.
</code></pre></div></div>

<p>Notice that the server indicates that some additional commands are
available now that it is in “extended” mode. One of the new groups
of commands is the Delivery Status Notification (DSN) options.
These options can be used on the <code class="language-plaintext highlighter-rouge">MAIL</code> and <code class="language-plaintext highlighter-rouge">RCPT</code> commands to indicate
the delivery status of a particular email message for the client.</p>

<p><strong>The ETRN Command</strong></p>

<p>The <code class="language-plaintext highlighter-rouge">ETRN</code> command allows an SMTP client to issue a request for the SMTP
server to initiate another SMTP connection with the client to transfer
messages back to it.  The <code class="language-plaintext highlighter-rouge">ETRN</code> command is a request to start another
SMTP session.  This way, the SMTP server can contact the client using the
normal DNS hostname resolution methods.  This does not rely on who the
client says it is.  If a malicious actor establishes an unauthorized SMTP
connection and issues an <code class="language-plaintext highlighter-rouge">ETRN</code> command, the SMTP server just starts a new
SMTP connection with the real client and sends any mail - no harm done.</p>

<p>The format for the ETRN command is</p>

<p><code class="language-plaintext highlighter-rouge">ETRN name</code></p>

<p>where <code class="language-plaintext highlighter-rouge">name</code> can be either an individual hostname or a domain name if you
are requesting mail for an entire domain.  The <code class="language-plaintext highlighter-rouge">ETRN</code> command is a valuable
tool for the mail administrator.  If you elect to have an ISP spool mail
for your email server, you might use this method to notify the ISP when
you are ready to receive your spooled mail.</p>

<p><strong>The AUTH Command</strong></p>

<p>Another extended SMTP command gaining popularity is the <code class="language-plaintext highlighter-rouge">AUTH</code> command,
which allows an SMTP client to identify itself to the SMTP server with
a username and password pair or other agreed-upon authentication technique.
Once the client is positively identified by the server, it may be allowed
to perform special functions, such as using the server as a mail relay,
which non-authenticated clients would not be allowed to do.</p>

<p>The Cyrus-SASL package is a popular software package that can be used to
provide SMTP <code class="language-plaintext highlighter-rouge">AUTH</code> command support for many MTA packages.
The mail administrator must maintain a separate username and password
database that allows authentication of remote SMTP clients.</p>

<p><strong>[ 19 ]</strong> Message Format - Standard RFC 822 Header Fields</p>

<p>RFC 822 specifies splitting the message into two separate parts.
The first part is called the <em>header</em>.  Its job is to store information
about the message.  The second part is the <em>body</em> of the message.
The header consists of data fields that can be used whenever additional
information is needed in the message.  The header fields should appear
before the text body of the message and should be separated by
<strong>one blank line</strong>.  Header fields do not need to appear in any particular
order, and the message can have multiple occurrences of any header field
(though this is deprecated).  Below is how a basic RFC 822-compliant
message would look.</p>

<p>RFC 822-compliant email message</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RFC 822-compliant email message 
+-----------------------------+
| RFC 822 Header              |
| +-------------------------+ |
| | Received:               | |
| | Return-Path:            | |
| | Reply-To:               | |
| | From:                   | |
| | Date:                   | |
| | To:                     | |
| +-------------------------+ |
|                             |  
| Message Body                |
| +-------------------------+ |
| |                         | |
| |                         | |
| |                         | |
| |                         | |
| |                         | |
| |                         | |
| +-------------------------+ |
+-----------------------------+
</code></pre></div></div>

<p>From <a href="https://datatracker.ietf.org/doc/html/rfc822#section-4">RFC 822 - Standard for the Format of ARPA Internet Text Messages</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     4.  MESSAGE SPECIFICATION
     
     4.1.  SYNTAX
     
     Note:  Due to an artifact of the notational conventions, the syn-
            tax  indicates that, when present, some fields, must be in
            a particular order.  Header fields  are  NOT  required  to
            occur  in  any  particular  order, except that the message
            body must occur AFTER  the  headers.   It  is  recommended
            that,  if  present,  headers be sent in the order "Return-
            Path", "Received", "Date",  "From",  "Subject",  "Sender",
            "To", "cc", etc.
     
            This specification permits multiple  occurrences  of  most
            fields.   Except  as  noted,  their  interpretation is not
            specified here, and their use is discouraged.

[ . . . ]

     4.4.  ORIGINATOR FIELDS
     
          The standard allows only a subset of the combinations possi-
     ble  with the From, Sender, Reply-To, Resent-From, Resent-Sender,
     and Resent-Reply-To fields.  The limitation is intentional.
     
     4.4.1.  FROM / RESENT-FROM
     
        This field contains the identity of the person(s)  who  wished
        this  message to be sent.  The message-creation process should
        default this field  to  be  a  single,  authenticated  machine
        address,  indicating  the  AGENT  (person,  system or process)
        entering the message.  If this is not done, the "Sender" field
        MUST  be  present.  If the "From" field IS defaulted this way,
        the "Sender" field is  optional  and  is  redundant  with  the
        "From"  field.   In  all  cases, addresses in the "From" field
        must be machine-usable (addr-specs) and may not contain  named
        lists (groups).

     4.4.2.  SENDER / RESENT-SENDER
     
        This field contains the authenticated identity  of  the  AGENT
        (person,  system  or  process)  that sends the message.  It is
        intended for use when the sender is not the author of the mes-
        sage,  or  to  indicate  who among a group of authors actually
        sent the message.  If the contents of the "Sender" field would
        be  completely  redundant  with  the  "From"  field,  then the
        "Sender" field need not be present and its use is  discouraged
        (though  still legal).  In particular, the "Sender" field MUST
        be present if it is NOT the same as the "From" Field.

[ . . . ]

     4.5.  RECEIVER FIELDS
     
     4.5.1.  TO / RESENT-TO
     
        This field contains the identity of the primary recipients  of
        the message.

[ . . . ]

     4.6.  REFERENCE FIELDS
     
     4.6.1.  MESSAGE-ID / RESENT-MESSAGE-ID
     
             This field contains a unique identifier  (the  local-part
        address  unit)  which  refers to THIS version of THIS message.
        The uniqueness of the message identifier is guaranteed by  the
        host  which  generates  it.  This identifier is intended to be
        machine readable and not necessarily meaningful to humans.   A
        message  identifier pertains to exactly one instantiation of a
        particular message; subsequent revisions to the message should
        each receive new message identifiers. 

[ . . . ]

     4.6.3.  REFERENCES
     
             The contents of this field identify other  correspondence
        which  this message references.  Note that if message identif-
        iers are used, they must use the msg-id specification format.

[ . . . ]

     4.7.  OTHER FIELDS
     
     4.7.1.  SUBJECT
     
             This is intended to provide a summary,  or  indicate  the
        nature, of the message.
</code></pre></div></div>

<p>From <a href="https://datatracker.ietf.org/doc/html/rfc2822">RFC 2822 - Internet Message Format</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2.1.1. Line Length Limits

   There are two limits that this standard places on the number of
   characters in a line.  Each line of characters MUST be no more than
   998 characters, and SHOULD be no more than 78 characters, excluding
   the CRLF.

[ . . . ]

2.3. Body

   The body of a message is simply lines of US-ASCII characters.  The
   only two limitations on the body are as follows:

   - CR and LF MUST only occur together as CRLF; they MUST NOT appear
     independently in the body.

   - Lines of characters in the body MUST be limited to 998 characters,
     and SHOULD be limited to 78 characters, excluding the CRLF.
</code></pre></div></div>

<p>Required header fields:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3.6. Field definitions

[ . . . ]

   The only required header fields are the origination date field and
   the originator address field(s).  All other header fields are
   syntactically optional.
</code></pre></div></div>

<p><strong>[ 20 ]</strong> About the proper format of the <code class="language-plaintext highlighter-rouge">MAIL FROM:</code> SMTP command.</p>

<p>From <a href="https://datatracker.ietf.org/doc/html/rfc821#page-3">RFC 821 - Simple Mail Transfer Protocol (SMTP)</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Commands and replies are composed of characters from the ASCII
character set [1].  When the transport service provides an 8-bit byte
(octet) transmission channel, each 7-bit character is transmitted
right justified in an octet with the high order bit cleared to zero.

When specifying the general form of a command or reply, an argument
(or special symbol) will be denoted by a meta-linguistic variable (or
constant), for example, "&lt;string&gt;" or "&lt;reverse-path&gt;".  Here the
angle brackets indicate these are meta-linguistic variables.

----

REFERENCES

   [1]  ASCII

      ASCII, "USA Code for Information Interchange", United States of
      America Standards Institute, X3.4, 1968.  Also in:  Feinler, E.
      and J. Postel, eds., "ARPANET Protocol Handbook", NIC 7104, for
      the Defense Communications Agency by SRI International, Menlo
      Park, California, Revised January 1978.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>However, some arguments use the angle brackets literally.  For
example, an actual reverse-path is enclosed in angle brackets, i.e.,
"&lt;John.Smith@USC-ISI.ARPA&gt;" is an instance of &lt;reverse-path&gt; (the
angle brackets are actually transmitted in the command or reply).
</code></pre></div></div>

<p>From <a href="https://datatracker.ietf.org/doc/html/rfc821#section-3">RFC 821 - Simple Mail Transfer Protocol (SMTP)</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 3.1.  MAIL

      There are three steps to SMTP mail transactions.  The transaction
      is started with a MAIL command which gives the sender
      identification.  A series of one or more RCPT commands follows
      giving the receiver information.  Then a DATA command gives the
      mail data.  And finally, the end of mail data indicator confirms
      the transaction.

         The first step in the procedure is the MAIL command.  The
         &lt;reverse-path&gt; contains the source mailbox.

            MAIL &lt;SP&gt; FROM:&lt;reverse-path&gt; &lt;CRLF&gt;

         This command tells the SMTP-receiver that a new mail
         transaction is starting and to reset all its state tables and
         buffers, including any recipients or mail data.  It gives the
         reverse-path which can be used to report errors.  If accepted,
         the receiver-SMTP returns a 250 OK reply.

[ . . . ]

The second step in the procedure is the RCPT command.

            RCPT &lt;SP&gt; TO:&lt;forward-path&gt; &lt;CRLF&gt;

         This command gives a forward-path identifying one recipient.
         If accepted, the receiver-SMTP returns a 250 OK reply, and
         stores the forward-path.  If the recipient is unknown the
         receiver-SMTP returns a 550 Failure reply.  This second step of
         the procedure can be repeated any number of times.

[ . . . ]

The third step in the procedure is the DATA command.

            DATA &lt;CRLF&gt;

         If accepted, the receiver-SMTP returns a 354 Intermediate reply
         and considers all succeeding lines to be the message text.
         When the end of text is received and stored the SMTP-receiver
         sends a 250 OK reply.
</code></pre></div></div>

<p>From <a href="https://datatracker.ietf.org/doc/html/rfc2821#section-3.3">RFC 2821 - Simple Mail Transfer Protocol (SMTP)</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3.3 Mail Transactions
[ . . . ]

   The first step in the procedure is the MAIL command.

      MAIL FROM:&lt;reverse-path&gt; [SP &lt;mail-parameters&gt; ] &lt;CRLF&gt;

[ . . . ]

   . . .                     The &lt;reverse-path&gt; portion of the first or
   only argument contains the source mailbox (between "&lt;" and "&gt;"
   brackets) . . . 
</code></pre></div></div>

<p>From <a href="https://datatracker.ietf.org/doc/html/rfc821">RFC 821 - Simple Mail Transfer Protocol (SMTP)</a>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4.  THE SMTP SPECIFICATIONS

   4.1.  SMTP COMMANDS

      4.1.1.  COMMAND SEMANTICS

         The SMTP commands define the mail transfer or the mail system
         function requested by the user.  SMTP commands are character
         strings terminated by &lt;CRLF&gt;.  The command codes themselves are
         alphabetic characters terminated by &lt;SP&gt; if parameters follow
         and &lt;CRLF&gt; otherwise.  The syntax of mailboxes must conform to
         receiver site conventions.  The SMTP commands are discussed
         below.  The SMTP replies are discussed in the Section 4.2.

[ . . . ]

         The last command in a session must be the QUIT command.  The
         QUIT command can not be used at any other time in a session.


  4.1.2.  COMMAND SYNTAX

         The commands consist of a command code followed by an argument
         field.  Command codes are four alphabetic characters.  Upper
         and lower case alphabetic characters are to be treated
         identically.  Thus, any of the following may represent the mail
         command:

            MAIL    Mail    mail    MaIl    mAIl

         This also applies to any symbols representing parameter values,
         such as "TO" or "to" for the forward-path.  Command codes and
         the argument fields are separated by one or more spaces.
         However, within the reverse-path and forward-path arguments
         case is important.  In particular, in some hosts the user
         "smith" is different from the user "Smith".

         The argument field consists of a variable length character
         string ending with the character sequence &lt;CRLF&gt;.  The receiver
         is to take no action until this sequence is received.

[ . . . ]

         The syntax of the above argument fields (using BNF notation
         where applicable) is given below.  The "..." notation indicates
         that a field may be repeated one or more times.

[ . . . ]

            &lt;CR&gt; ::= the carriage return character (ASCII code 13)

            &lt;LF&gt; ::= the line feed character (ASCII code 10)

            &lt;SP&gt; ::= the space character (ASCII code 32)
</code></pre></div></div>

<p><strong>[ 21 ]</strong> From the man page for <code class="language-plaintext highlighter-rouge">s_client(1)</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  CONNECTED COMMANDS
         If a connection is established with an SSL server then any data
         received from the server is displayed and any key presses will be sent
         to the server. If end of file is reached then the connection will be
         closed down. When used interactively (which means neither -quiet nor
         -ign_eof have been given), then certain commands are also recognized
         which perform special operations. These commands are a letter which
         must appear at the start of a line. They are listed below.

[ . . . ]

         R   Renegotiate the SSL session (TLSv1.2 and below only).
</code></pre></div></div>

<hr />

</div>
  <div class="share-page">
  <span style="float: left;">Share this on &rarr;&nbsp;&nbsp;</span>

  <!-- Twitter -->
  <a href="https://twitter.com/share" class="twitter-share-button" data-via="github.io">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  <!-- Facebook -->
  <div class="fb-share-button" data-href="http://localhost:4000/sendmail/smtp/mta/mailserver/cli/terminal/shell/freebsd/sysadmin/reference/2022/11/12/sendmail-auth-client.html" data-layout="button_count" style="position: relative; top: -8px; left: 3px;"></div>
</div>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=1749788565247320";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

</div>


  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
            
            <div class="panel-body">
              <h4>Related Posts</h4>
              <ul>
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/howto/webbrowser/networking/sysadmin/unix/webdevelopment/http/html/ruby/tutorial/2024/09/24/testing-different-jekyll-themes.html">Testing Different Jekyll Themes</a>
                  
                    (Categories: <a href="/category/howto">howto</a>, <a href="/category/webbrowser">webbrowser</a>, <a href="/category/networking">networking</a>, <a href="/category/sysadmin">sysadmin</a>, <a href="/category/unix">unix</a>, <a href="/category/webdevelopment">webdevelopment</a>, <a href="/category/http">http</a>, <a href="/category/html">html</a>, <a href="/category/ruby">ruby</a>, <a href="/category/tutorial">tutorial</a>)
                  
                </li>
          
          
        
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/unicode/utf8/x11/xorg/xterm/cli/terminal/shell/howto/sysadmin/unix/perl/python/vi/vim/ascii/plaintext/text/tex/latex/pdf/typography/font/html/design/webbrowser/webdevelopment/awk/regex/programming/coding/development/tool/reference/dotfiles/tip/2024/09/17/encodings-utf8-and-unicode-notes.html">Encodings, UTF-8 and Unicode Notes</a>
                  
                    (Categories: <a href="/category/unicode">unicode</a>, <a href="/category/utf8">utf8</a>, <a href="/category/x11">x11</a>, <a href="/category/xorg">xorg</a>, <a href="/category/xterm">xterm</a>, <a href="/category/cli">cli</a>, <a href="/category/terminal">terminal</a>, <a href="/category/shell">shell</a>, <a href="/category/howto">howto</a>, <a href="/category/sysadmin">sysadmin</a>, <a href="/category/unix">unix</a>, <a href="/category/perl">perl</a>, <a href="/category/python">python</a>, <a href="/category/vi">vi</a>, <a href="/category/vim">vim</a>, <a href="/category/ascii">ascii</a>, <a href="/category/plaintext">plaintext</a>, <a href="/category/text">text</a>, <a href="/category/tex">tex</a>, <a href="/category/latex">latex</a>, <a href="/category/pdf">pdf</a>, <a href="/category/typography">typography</a>, <a href="/category/font">font</a>, <a href="/category/html">html</a>, <a href="/category/design">design</a>, <a href="/category/webbrowser">webbrowser</a>, <a href="/category/webdevelopment">webdevelopment</a>, <a href="/category/awk">awk</a>, <a href="/category/regex">regex</a>, <a href="/category/programming">programming</a>, <a href="/category/coding">coding</a>, <a href="/category/development">development</a>, <a href="/category/tool">tool</a>, <a href="/category/reference">reference</a>, <a href="/category/dotfiles">dotfiles</a>, <a href="/category/tip">tip</a>)
                  
                </li>
          
          
        
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/hpc/server/hardware/sysadmin/automation/configmanagement/howto/vm/virtualization/qemu/kvm/cli/terminal/shell/linux/unix/networking/2024/09/12/hpc-torque-pbs-xcat-psh.html">HPC with TORQUE/PBS, xCAT, Gaussian and WebMO</a>
                  
                    (Categories: <a href="/category/hpc">hpc</a>, <a href="/category/server">server</a>, <a href="/category/hardware">hardware</a>, <a href="/category/sysadmin">sysadmin</a>, <a href="/category/automation">automation</a>, <a href="/category/configmanagement">configmanagement</a>, <a href="/category/howto">howto</a>, <a href="/category/vm">vm</a>, <a href="/category/virtualization">virtualization</a>, <a href="/category/qemu">qemu</a>, <a href="/category/kvm">kvm</a>, <a href="/category/cli">cli</a>, <a href="/category/terminal">terminal</a>, <a href="/category/shell">shell</a>, <a href="/category/linux">linux</a>, <a href="/category/unix">unix</a>, <a href="/category/networking">networking</a>)
                  
                </li>
          
          
        
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/unicode/utf8/x11/xorg/xterm/cli/terminal/shell/howto/sysadmin/unix/typography/font/webbrowser/html/2024/08/11/why-some-chars-displayed-as-squares.html">Why Does My Program Display Some Characters as Square (Tofu)?</a>
                  
                    (Categories: <a href="/category/unicode">unicode</a>, <a href="/category/utf8">utf8</a>, <a href="/category/x11">x11</a>, <a href="/category/xorg">xorg</a>, <a href="/category/xterm">xterm</a>, <a href="/category/cli">cli</a>, <a href="/category/terminal">terminal</a>, <a href="/category/shell">shell</a>, <a href="/category/howto">howto</a>, <a href="/category/sysadmin">sysadmin</a>, <a href="/category/unix">unix</a>, <a href="/category/typography">typography</a>, <a href="/category/font">font</a>, <a href="/category/webbrowser">webbrowser</a>, <a href="/category/html">html</a>)
                  
                </li>
          
          
        
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/x11/xorg/xterm/cli/terminal/shell/howto/sysadmin/unix/2024/08/09/xorg-x11-window-id-by-process-id.html">How to Find an X11 Window ID (WID) by a Process ID (PID)</a>
                  
                    (Categories: <a href="/category/x11">x11</a>, <a href="/category/xorg">xorg</a>, <a href="/category/xterm">xterm</a>, <a href="/category/cli">cli</a>, <a href="/category/terminal">terminal</a>, <a href="/category/shell">shell</a>, <a href="/category/howto">howto</a>, <a href="/category/sysadmin">sysadmin</a>, <a href="/category/unix">unix</a>)
                  
                </li>
          
          
        
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
            
                <li class="relatedPost">
                  <a href="http://localhost:4000/perl/programming/tutorial/cli/terminal/shell/script/it/computing/unix/sysadmin/learning/2024/07/24/introduction-to-perl.html">Beginner's Introduction to Perl [WIP]</a>
                  
                    (Categories: <a href="/category/perl">perl</a>, <a href="/category/programming">programming</a>, <a href="/category/tutorial">tutorial</a>, <a href="/category/cli">cli</a>, <a href="/category/terminal">terminal</a>, <a href="/category/shell">shell</a>, <a href="/category/script">script</a>, <a href="/category/it">it</a>, <a href="/category/computing">computing</a>, <a href="/category/unix">unix</a>, <a href="/category/sysadmin">sysadmin</a>, <a href="/category/learning">learning</a>)
                  
                </li>
          
          
        
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
    
      
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
        
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
          
      
    
  
  
  </ul>
</div>


<div class="PageNavigation">
  
    <a class="prev" href="/sendmail/smtp/mta/mailserver/cli/terminal/shell/freebsd/sysadmin/reference/2022/10/22/sendmail-notes.html">&laquo; Sendmail Notes [WIP]</a>
  
  
    <a class="next" href="/sendmail/smtp/mta/mailserver/cli/terminal/shell/freebsd/sysadmin/reference/2022/11/15/dma-freebsd-auth-smtps-starttls-email.html">Outgoing SMTP AUTH Mail with dma(8) from a FreeBSD System &raquo;</a>
  
</div>

<div class="disqus-comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* <![CDATA[ */
    var disqus_shortname = "";
    var disqus_identifier = "http://localhost:4000_Sendmail SMTP AUTH Running As a Client [HOWTO]";
    var disqus_title = "Sendmail SMTP AUTH Running As a Client [HOWTO]";

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    /* ]]> */
  </script>
</div>

        <footer>
          <!-- &copy; Dusko Pijetlovic -->
          
            <!-- - <a href="https://github.com/duskopijetlovic">https://github.com/duskopijetlovic</a> - Powered by Jekyll. -->
          
          <div class="btn-github" style="float:right;">
            <!-- <iframe src="https://ghbtns.com/github-btn.html?user=agusmakmun&repo=agusmakmun.github.io&type=star&count=true" frameborder="0" scrolling="0" width="100" height="20px"></iframe> -->
            <!-- <iframe src="https://ghbtns.com/github-btn.html?user=agusmakmun&repo=agusmakmun.github.io&type=fork&count=true" frameborder="0" scrolling="0" width="100" height="20px"></iframe> -->
          </div>
        </footer>
      </div>
      <!-- end /.col-sm-8 -->
    </div>
    <!-- end /.container -->

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/super-search.js"></script>
    <script src="/static/js/thickbox-compressed.js"></script>
    <script src="/static/js/projects.js"></script>
  </body>
</html>

