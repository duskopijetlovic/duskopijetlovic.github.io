<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Dusko Pijetlovic</title>
    <description>Dusko Pijetlovic - My Personal Web Space</description>
    <link>http://localhost:4000/</link>
    <atom:link href="http://localhost:4000/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Sun, 11 Sep 2022 17:57:32 -0700</pubDate>
    <lastBuildDate>Sun, 11 Sep 2022 17:57:32 -0700</lastBuildDate>
    <generator>Jekyll v3.9.0</generator>
    
      <item>
        <title>How To Run diagrams.net (aka draw.io or drawio) Locally with Docker on FreeBSD 13 with vm-bhyve and Debian GNU/Linux</title>
        <description>&lt;p&gt;Host OS: FreeBSD 13, Shell: csh  &lt;br /&gt;
Guest OS: Debian GNU/Linux, Shell: bash&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Prerequsites:&lt;/p&gt;

&lt;p&gt;In Debian GNU/Linux VM guest (running inside bhyve):&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Docker installed&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker.service&lt;/code&gt; running&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;containerd.service&lt;/code&gt; running&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can follow instructions outlined here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/freebsd/docker/vm/virtualization/howto/diagram/2022/02/24/freebsd-docker-linux-kroki-diagrams.html&quot;&gt;How to Run Kroki on FreeBSD 13 with vm-bhyve and Debian GNU/Linux VM&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sudo vm list
NAME       DATASTORE  LOADER  CPU  MEMORY  VNC  AUTOSTART  STATE
debianvm1  default    grub    1    2048M   -    No         Stopped 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sudo vm start debianvm1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sudo vm console debianvm1
---- snip ----

debianvm1 login: dusko
Password:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo \
docker run -d -p 9000:9000 -v \
/var/run/docker.sock:/var/run/docker.sock -v \
portainer_data:/data portainer/portainer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ss -an | grep 9000
tcp   LISTEN 0      4096    0.0.0.0:9000             0.0.0.0:*
tcp   LISTEN 0      4096    [::]:9000                [::]:*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo \
docker \
run -it --rm --name=&quot;draw&quot; \
-p 8080:8080 -p 8443:8443 \
jgraph/drawio
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;IP address of the guest VM (GNU/Linux Debian) is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.8.18&lt;/code&gt;.
The network interface name assigned by the OS is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;enp0s5&lt;/code&gt;, and 
when you run the following inside the guest, you get its IP address:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip address show dev enp0s5 | grep -w inet 
    inet 192.168.8.18/24 brd 192.168.8.255 scope global dynamic enp0s5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Use a Web browser on the FreeBSD host and open &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://192.168.8.18:8080/&lt;/code&gt; 
or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;https://192.168.8.18:8443/&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;References:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jgraph.github.io/drawio/&quot;&gt;drawio&lt;/a&gt;
(Source to app.diagrams.net, &lt;a href=&quot;https://www.diagrams.net/&quot;&gt;www.diagrams.net&lt;/a&gt;) 
(Retrieved on Aug 28, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;draw.io, this project, is a configurable diagramming/whiteboarding 
visualization application. draw.io is owned and developed by JGraph Ltd, 
a UK based software company.&lt;/p&gt;

  &lt;p&gt;As well as running this project, we run a production-grade deployment 
of the diagramming interface at https://app.diagrams.net.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;Scope of the Project&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;draw.io is a diagramming or whiteboarding application, depending on 
which theme is selected.  It is not an SVG editing app, the SVG export 
is designed only for embedding in web pages, not for further editing 
in other tools.&lt;/p&gt;

  &lt;p&gt;The application is designed to be used largely as-is.  It’s possible to 
alter the major parts of the interface, but if you’re looking for an 
editor with very specific editing features, the project is likely not 
a good base to use.&lt;/p&gt;

  &lt;p&gt;That is to say, if you wanted to create/deploy a whiteboard or 
diagramming application where the functionality in the main canvas is 
as this project provides, it more likely to be a good base to use. 
The default libraries, the menus, the toolbar, the default colours, 
the storage location, these can all be changed.&lt;/p&gt;

  &lt;p&gt;&lt;strong&gt;Running&lt;/strong&gt;&lt;/p&gt;

  &lt;p&gt;One way to run diagrams.net is to fork this project, &lt;a href=&quot;https://help.github.com/categories/github-pages-basics/&quot;&gt;publish the master 
branch to GitHub pages&lt;/a&gt; and the &lt;a href=&quot;https://jgraph.github.io/drawio/src/main/webapp/index.html&quot;&gt;pages sites&lt;/a&gt; will have the full editor 
functionality (sans the integrations).&lt;/p&gt;

  &lt;p&gt;Another way is to use &lt;a href=&quot;https://github.com/jgraph/docker-drawio&quot;&gt;the recommended Docker project&lt;/a&gt; or to download &lt;a href=&quot;https://get.diagrams.net/&quot;&gt;draw.io Desktop&lt;/a&gt;.&lt;/p&gt;

  &lt;p&gt;The full packaged .war of the client and servlets is built when the 
project is tagged and available on the &lt;a href=&quot;https://github.com/jgraph/draw.io/releases&quot;&gt;releases page&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        <pubDate>Sun, 28 Aug 2022 11:27:04 -0700</pubDate>
        <link>http://localhost:4000/howto/diagram/java/graph/graphviz/plaintext/text/tex/latex/visualization/sysadmin/documentation/2022/08/28/run-diagrams-dot-net-aka-drawio-locally.html</link>
        <guid isPermaLink="true">http://localhost:4000/howto/diagram/java/graph/graphviz/plaintext/text/tex/latex/visualization/sysadmin/documentation/2022/08/28/run-diagrams-dot-net-aka-drawio-locally.html</guid>
        
        
        <category>howto</category>
        
        <category>diagram</category>
        
        <category>java</category>
        
        <category>graph</category>
        
        <category>graphviz</category>
        
        <category>plaintext</category>
        
        <category>text</category>
        
        <category>tex</category>
        
        <category>latex</category>
        
        <category>visualization</category>
        
        <category>sysadmin</category>
        
        <category>documentation</category>
        
      </item>
    
      <item>
        <title>How To Run diagrams.net (aka draw.io or drawio) Locally with a Java war File on FreeBSD 13</title>
        <description>&lt;p&gt;OS: FreeBSD 13 &lt;br /&gt;
Shell: csh&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;From the draw.io project’s 
&lt;a href=&quot;https://github.com/jgraph/drawio#readme&quot;&gt;Readme&lt;/a&gt; file:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The full packaged .war of the client and servlets is built when the 
project is tagged and available on the &lt;a href=&quot;https://github.com/jgraph/draw.io/releases&quot;&gt;releases page&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As of Aug 27, 2022, the latest draw.io version is 20.2.6.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% mkdir drawio
% cd drawio
% fetch https://github.com/jgraph/drawio/releases/download/v20.2.6/draw.war
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% file draw.war
draw.war: Zip archive data, at least v1.0 to extract, compression method=store
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% unzip draw.war 
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% pwd
/usr/home/dusko/drawio
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ifconfig
---- snip ----
ue0: flags=8843&amp;lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&amp;gt; metric 0 mtu 1500 
  options=68009b&amp;lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,
  LINKSTATE,RXCSUM_IPV6,TXCSUM_IPV6&amp;gt;
---- snip ----
        inet 192.168.1.9 netmask 0xffffff00 broadcast 192.168.1.255
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For example, to run it with python3 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http.server&lt;/code&gt; module on port &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;8081&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% python3.9 -m http.server 8081
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Use a Web browser and open &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://localhost:8081&lt;/code&gt; or
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://127.0.0.1:8081/&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://192.168.1.9:8081/&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Alternatively, on this system I could also run it with 
python 3.8. &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% python3.8 -m http.server 8081
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;   If you use python2, to use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SimpleHTTPServer&lt;/code&gt; module, 
you need to run this command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% python2 -m SimpleHTTPServer 8081
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;p&gt;[1] About Python versions on this system:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% pkg info --regex python 
python38-3.8.13_2
python39-3.9.13
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% command -v python; type python; whereis python; which python
python: not found
python:
python: Command not found.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% command -v python3.8; type python3.8; whereis python3.8; which python3.8
/usr/local/bin/python3.8
python3.8 is /usr/local/bin/python3.8
python3.8: /usr/local/bin/python3.8 /usr/local/man/man1/python3.8.1.gz
/usr/local/bin/python3.8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% command -v python3.9; type python3.9; whereis python3.9; which python3.9
/usr/local/bin/python3.9
python3.9 is /usr/local/bin/python3.9
python3.9: /usr/local/bin/python3.9 /usr/local/man/man1/python3.9.1.gz
/usr/local/bin/python3.9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -lh /usr/local/bin/python*
-r-xr-xr-x  1 root  wheel   5.1K Jul  3 05:11 /usr/local/bin/python3.8
-r-xr-xr-x  1 root  wheel   3.1K Jul  3 05:11 /usr/local/bin/python3.8-config
-r-xr-xr-x  1 root  wheel   5.1K Jul  2 18:17 /usr/local/bin/python3.9
-r-xr-xr-x  1 root  wheel   3.1K Jul  2 18:18 /usr/local/bin/python3.9-config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 27 Aug 2022 10:34:06 -0700</pubDate>
        <link>http://localhost:4000/howto/diagram/java/graph/graphviz/plaintext/text/tex/latex/visualization/sysadmin/documentation/2022/08/27/run-diagrams-dot-net-aka-drawio-with-java-war-image.html</link>
        <guid isPermaLink="true">http://localhost:4000/howto/diagram/java/graph/graphviz/plaintext/text/tex/latex/visualization/sysadmin/documentation/2022/08/27/run-diagrams-dot-net-aka-drawio-with-java-war-image.html</guid>
        
        
        <category>howto</category>
        
        <category>diagram</category>
        
        <category>java</category>
        
        <category>graph</category>
        
        <category>graphviz</category>
        
        <category>plaintext</category>
        
        <category>text</category>
        
        <category>tex</category>
        
        <category>latex</category>
        
        <category>visualization</category>
        
        <category>sysadmin</category>
        
        <category>documentation</category>
        
      </item>
    
      <item>
        <title>Fonts in X11 - aka Fonts in X (Xorg)</title>
        <description>&lt;p&gt;OS: FreeBSD 13   &lt;br /&gt;
Shell: csh&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;iconv&lt;/li&gt;
  &lt;li&gt;python; e.g.:  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;print(b.decode(&quot;utf8&quot;))&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Perl&lt;/li&gt;
  &lt;li&gt;Also, basically all or most from here:
&lt;a href=&quot;https://charbase.com/02b7-unicode-modifier-letter-small-w&quot;&gt;https://charbase.com/02b7-unicode-modifier-letter-small-w&lt;/a&gt;:  &lt;strong&gt;Decomposition&lt;/strong&gt;, Index, Class, Block, Java escape, Javascript escape, Python escape, HTML escapes, URL encoded, UTF8, UTF16&lt;/li&gt;
  &lt;li&gt;xterm tests - from e.g. Thomas E. Dickey &lt;a href=&quot;http://invisible-island.net/ncurses/&quot;&gt;http://invisible-island.net/ncurses/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;fonts-in-x11-x-window-system-aka-x&quot;&gt;Fonts in X11 (X Window System, aka X)&lt;/h2&gt;

&lt;p&gt;From “Linux in a Windows World” by Roderick W Smith
(O’Reilly Media, Inc. February 2005):&lt;/p&gt;

&lt;p&gt;Two font systems:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The X core fonts (a.k.a. X fonts)
    &lt;ul&gt;
      &lt;li&gt;Designed with bitmap fonts in mind, meaning that individual characters
were designed for display at a specific size in pixels.
        &lt;ul&gt;
          &lt;li&gt;To support scaleable fonts, which can be resized, multiple bitmap
font files are required, one for each size. X servers ship with
several bitmap fonts in a variety of sizes, designed for both
72 dots per inch (dpi) and 100-dpi displays.&lt;/li&gt;
          &lt;li&gt;Most modern fonts, though, use scaleable font (a.k.a. outline font)
technologies, in which the font is described in terms of mathematical
descriptions of lines and curves.  These descriptions provide an
outline of a character, which the font renderer can scale to any
desired resolution and fill in.
            &lt;ul&gt;
              &lt;li&gt;The two most common scaleable font formats today are
&lt;strong&gt;PostScript Type 1&lt;/strong&gt; (a.k.a. Adobe Type Manager or ATM) fonts and
&lt;strong&gt;TrueType&lt;/strong&gt; fonts (TTF).&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Xft fonts (aka outline fonts or scalable fonts)
    &lt;ul&gt;
      &lt;li&gt;Designed around the FreeType library, which was originally a tool for
rendering TrueType fonts.  Today, though, Xft supports both TrueType
and Type 1 fonts.&lt;/li&gt;
      &lt;li&gt;Improved limitations in the X core fonts:
        &lt;ul&gt;
          &lt;li&gt;X core fonts can’t readily handle more than two colors per font
(Required a font technology known as font smoothing or anti-aliasing.
 Font smoothing uses shades of gray to deliberately blur fonts,
 which has the subjective effect of improving the appearance of
 fonts because it tends to hide the jagged edges along diagonal
 lines and curves.)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Installing the X core fonts can be tricky.&lt;/li&gt;
      &lt;li&gt;X core fonts were not designed with printing in mind, and coordinating
the display and print fonts can be a challenge when using these fonts.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;
Individual X-based programs sometimes employ their own font-handling systems.&lt;/p&gt;

&lt;h2 id=&quot;installing-x-core-fonts-aka-traditional-x-fonts&quot;&gt;Installing X Core Fonts (aka “Traditional” X Fonts)&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  ORDER&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Install font; that is, copy its files&lt;/li&gt;
  &lt;li&gt;Run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkfontdir&lt;/code&gt; to recreate the font database&lt;/li&gt;
  &lt;li&gt;Run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkfontscale&lt;/code&gt; to recreate an index of scalable font files for X&lt;/li&gt;
  &lt;li&gt;Run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xset fp+ /path/to/the/new/font&lt;/code&gt;  to append it to the font path&lt;/li&gt;
  &lt;li&gt;Run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xset fp rehash&lt;/code&gt; to  reread the font databases in the font path&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;file-fontsdir----todo&quot;&gt;File fonts.dir    &lt;strong&gt;[TODO]&lt;/strong&gt;&lt;/h3&gt;

&lt;h3 id=&quot;file-fontsscale--todo&quot;&gt;File fonts.scale  &lt;strong&gt;[TODO]&lt;/strong&gt;&lt;/h3&gt;

&lt;h3 id=&quot;refresh-rehash-the-font-databases&quot;&gt;Refresh (Rehash) the Font Databases&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% xset fp rehash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xset(1)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;fp rehash
        The rehash argument resets the font path to its current value,
        causing the server to reread the font databases in the current
        font path.  This is generally only used when adding new fonts
        to a font directory (after running mkfontdir to recreate the
        font database).
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;
To reset the font path to the server’s (that is, X server’s) default:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% xset fp default
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;xlsfonts1---server-font-list-displayer-for-x&quot;&gt;xlsfonts(1) - Server Font List Displayer for X&lt;/h3&gt;

&lt;p&gt;List all X core fonts on the system:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% xlsfonts | wc -l
   25462
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sudo xlsfonts | wc -l
Password:
   25462
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;converting-a-file-from-an-8-bit-character-set-for-example-iso_8859-1-to-utf-8-without-posting-the-file-to-a-remote-server&quot;&gt;Converting a File from an 8-bit Character Set (For Example ISO_8859-1) to UTF-8 without POSTing the File to a Remote server&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;http://www.acc.umu.se/~saasha/charconv/&quot;&gt;Converting a file from an 8-bit character set (for example ISO_8859-1) to UTF-8 without POSTing the file to a remote server&lt;/a&gt; (Retrieved on Apr 17, 2022):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt; In many cases, the most obvious way to solve such a problem is to save 
the file, open a terminal, move to the directory where the file resides 
(with cd …) and use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iconv&lt;/code&gt; similarly to:&lt;/p&gt;

  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;iconv -f iso88591 -t utf8 fileToConvert.txt &amp;gt; convertedFile.txt&lt;/code&gt;&lt;/p&gt;

  &lt;p&gt;Unfortunately, finding out how to start a terminal is not always easy 
in today’s GUI’s!&lt;/p&gt;

  &lt;p&gt;Here, you are given the opportunity to achieve such a conversion locally. 
Choose a character set (charset, encoding) in the list below and choose 
the file you wish to convert.  The JavaScript program linked to by this 
page will try to make your browser convert the file to UTF-8. 
If the conversion succeeds, you will be given the opportunity to save 
the converted file.&lt;/p&gt;

  &lt;p&gt;You do not need any Internet connection to achieve this conversion. 
You can save this page locally together with (in the same directory than) 
the JavaScript program it is linked to and open it in a browser to 
achieve the conversions even without any Internet connection.&lt;/p&gt;

  &lt;p&gt;Comments and suggestions may be sent to saasha@acc.umu.se.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;installing-xft-fonts-aka-fontconfig&quot;&gt;Installing Xft Fonts (aka Fontconfig)&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -alh /usr/local/share/fonts/ | wc -l
      42

% ls -lh /usr/local/share/fonts/ | wc -l
      40
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -ld /usr/local/etc/fonts/
drwxr-xr-x  4 root  wheel  7 Feb  3  2022 /usr/local/etc/fonts/

% ls -alh /usr/local/etc/fonts/ | wc -l
       8

% ls -lh /usr/local/etc/fonts/ | wc -l
       6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -lh /usr/local/etc/fonts/
total 79
drwxr-xr-x  2 root  wheel    51B Feb  3  2022 conf.avail
drwxr-xr-x  2 root  wheel    33B Feb  3  2022 conf.d
-rw-r--r--  1 root  wheel   2.6K Jan 21  2022 fonts.conf
-rw-r--r--  1 root  wheel   2.6K Jan 21  2022 fonts.conf.sample
-rw-r--r--  1 root  wheel   8.1K Dec  3  2020 fonts.dtd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -alh /usr/local/etc/fonts/conf.avail/ | wc -l
      52

% ls -lh /usr/local/etc/fonts/conf.avail/ | wc -l
      50
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -alh /usr/local/etc/fonts/conf.d/ | wc -l
      34

% ls -lh /usr/local/etc/fonts/conf.d/ | wc -l
      32
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% cat /usr/local/etc/fonts/conf.d/README
conf.d/README

Each file in this directory is a fontconfig configuration file.  Fontconfig
scans this directory, loading all files of the form [0-9][0-9]*.conf.
These files are normally installed in /usr/local/etc/fonts/conf.avail
and then symlinked here, allowing them to be easily installed and then
enabled/disabled by adjusting the symlinks.

The files are loaded in numeric order, the structure of the configuration
has led to the following conventions in usage:

 Files beginning with:  Contain:

 00 through 09          Font directories
 10 through 19          system rendering defaults (AA, etc)
 20 through 29          font rendering options
 30 through 39          family substitution
 40 through 49          generic identification, map family-&amp;gt;generic
 50 through 59          alternate config file loading
 60 through 69          generic aliases, map generic-&amp;gt;family
 70 through 79          select font (adjust which fonts are available)
 80 through 89          match target=&quot;scan&quot; (modify scanned patterns)
 90 through 99          font synthesis
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -lh /usr/local/etc/fonts/fonts.conf*
-rw-r--r--  1 root  wheel   2.6K Jan 21  2022 /usr/local/etc/fonts/fonts.conf
-rw-r--r--  1 root  wheel   2.6K Jan 21  2022 /usr/local/etc/fonts/fonts.conf.sample
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% diff /usr/local/etc/fonts/fonts.conf.sample /usr/local/etc/fonts/fonts.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% file /usr/local/etc/fonts/fonts.conf
/usr/local/etc/fonts/fonts.conf: XML 1.0 document, ASCII text
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% wc -l /usr/local/etc/fonts/fonts.conf
     103 /usr/local/etc/fonts/fonts.conf

% sed &apos;/^[[:space:]]*$/d&apos; /usr/local/etc/fonts/fonts.conf | grep -v \# | wc -l
      87
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sed &apos;/^[[:space:]]*$/d&apos; /usr/local/etc/fonts/fonts.conf | grep -v \#
&amp;lt;?xml version=&quot;1.0&quot;?&amp;gt;
&amp;lt;!DOCTYPE fontconfig SYSTEM &quot;urn:fontconfig:fonts.dtd&quot;&amp;gt;
&amp;lt;!-- /etc/fonts/fonts.conf file to configure system font access --&amp;gt;
&amp;lt;fontconfig&amp;gt;
        &amp;lt;description&amp;gt;Default configuration file&amp;lt;/description&amp;gt;
&amp;lt;!--
        DO NOT EDIT THIS FILE.
        IT WILL BE REPLACED WHEN FONTCONFIG IS UPDATED.
        LOCAL CHANGES BELONG IN &apos;local.conf&apos;.
        The intent of this standard configuration file is to be adequate for
        most environments.  If you have a reasonably normal environment and
        have found problems with this configuration, they are probably
        things that others will also want fixed.  Please submit any
        problems to the fontconfig bugzilla system located at fontconfig.org
        Note that the normal &apos;make install&apos; procedure for fontconfig is to
        replace any existing fonts.conf file with the new version.  Place
        any local customizations in local.conf which this file references.
        Keith Packard
--&amp;gt;
&amp;lt;!-- Font directory list --&amp;gt;
        &amp;lt;dir&amp;gt;/usr/local/share/fonts&amp;lt;/dir&amp;gt;
        &amp;lt;dir&amp;gt;/usr/local/lib/X11/fonts&amp;lt;/dir&amp;gt;
        &amp;lt;dir prefix=&quot;xdg&quot;&amp;gt;fonts&amp;lt;/dir&amp;gt;
        &amp;lt;!-- the following element will be removed in the future --&amp;gt;
        &amp;lt;dir&amp;gt;~/.fonts&amp;lt;/dir&amp;gt;
&amp;lt;!--
  Accept deprecated &apos;mono&apos; alias, replacing it with &apos;monospace&apos;
--&amp;gt;
        &amp;lt;match target=&quot;pattern&quot;&amp;gt;
                &amp;lt;test qual=&quot;any&quot; name=&quot;family&quot;&amp;gt;
                        &amp;lt;string&amp;gt;mono&amp;lt;/string&amp;gt;
                &amp;lt;/test&amp;gt;
                &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&amp;gt;
                        &amp;lt;string&amp;gt;monospace&amp;lt;/string&amp;gt;
                &amp;lt;/edit&amp;gt;
        &amp;lt;/match&amp;gt;
&amp;lt;!--
  Accept alternate &apos;sans serif&apos; spelling, replacing it with &apos;sans-serif&apos;
--&amp;gt;
        &amp;lt;match target=&quot;pattern&quot;&amp;gt;
                &amp;lt;test qual=&quot;any&quot; name=&quot;family&quot;&amp;gt;
                        &amp;lt;string&amp;gt;sans serif&amp;lt;/string&amp;gt;
                &amp;lt;/test&amp;gt;
                &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&amp;gt;
                        &amp;lt;string&amp;gt;sans-serif&amp;lt;/string&amp;gt;
                &amp;lt;/edit&amp;gt;
        &amp;lt;/match&amp;gt;
&amp;lt;!--
  Accept deprecated &apos;sans&apos; alias, replacing it with &apos;sans-serif&apos;
--&amp;gt;
        &amp;lt;match target=&quot;pattern&quot;&amp;gt;
                &amp;lt;test qual=&quot;any&quot; name=&quot;family&quot;&amp;gt;
                        &amp;lt;string&amp;gt;sans&amp;lt;/string&amp;gt;
                &amp;lt;/test&amp;gt;
                &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&amp;gt;
                        &amp;lt;string&amp;gt;sans-serif&amp;lt;/string&amp;gt;
                &amp;lt;/edit&amp;gt;
        &amp;lt;/match&amp;gt;
&amp;lt;!--
  Accept alternate &apos;system ui&apos; spelling, replacing it with &apos;system-ui&apos;
--&amp;gt;
        &amp;lt;match target=&quot;pattern&quot;&amp;gt;
                &amp;lt;test qual=&quot;any&quot; name=&quot;family&quot;&amp;gt;
                        &amp;lt;string&amp;gt;system ui&amp;lt;/string&amp;gt;
                &amp;lt;/test&amp;gt;
                &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot; binding=&quot;same&quot;&amp;gt;
                        &amp;lt;string&amp;gt;system-ui&amp;lt;/string&amp;gt;
                &amp;lt;/edit&amp;gt;
        &amp;lt;/match&amp;gt;
&amp;lt;!--
  Load local system customization file
--&amp;gt;
        &amp;lt;include ignore_missing=&quot;yes&quot;&amp;gt;conf.d&amp;lt;/include&amp;gt;
&amp;lt;!-- Font cache directory list --&amp;gt;
        &amp;lt;cachedir&amp;gt;/var/db/fontconfig&amp;lt;/cachedir&amp;gt;
        &amp;lt;cachedir prefix=&quot;xdg&quot;&amp;gt;fontconfig&amp;lt;/cachedir&amp;gt;
        &amp;lt;!-- the following element will be removed in the future --&amp;gt;
        &amp;lt;cachedir&amp;gt;~/.fontconfig&amp;lt;/cachedir&amp;gt;
        &amp;lt;config&amp;gt;
&amp;lt;!--
  Rescan configuration every 30 seconds when FcFontSetList is called
 --&amp;gt;
                &amp;lt;rescan&amp;gt;
                        &amp;lt;int&amp;gt;30&amp;lt;/int&amp;gt;
                &amp;lt;/rescan&amp;gt;
        &amp;lt;/config&amp;gt;
&amp;lt;/fontconfig&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -ld /etc/fonts/fonts.conf
ls: /etc/fonts/fonts.conf: No such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;font-directory-list&quot;&gt;Font Directory List&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% grep -n &apos;Font directory list&apos; /usr/local/etc/fonts/fonts.conf
25:&amp;lt;!-- Font directory list --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sed -n 25,35p /usr/local/etc/fonts/fonts.conf
&amp;lt;!-- Font directory list --&amp;gt;

        &amp;lt;dir&amp;gt;/usr/local/share/fonts&amp;lt;/dir&amp;gt;
        &amp;lt;dir&amp;gt;/usr/local/lib/X11/fonts&amp;lt;/dir&amp;gt;


        &amp;lt;dir prefix=&quot;xdg&quot;&amp;gt;fonts&amp;lt;/dir&amp;gt;
        &amp;lt;!-- the following element will be removed in the future --&amp;gt;
        &amp;lt;dir&amp;gt;~/.fonts&amp;lt;/dir&amp;gt;

&amp;lt;!--
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.fonts&lt;/code&gt; directory will be removed in the future:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% grep -n removed /usr/local/etc/fonts/fonts.conf
32:     &amp;lt;!-- the following element will be removed in the future --&amp;gt;
91:     &amp;lt;!-- the following element will be removed in the future --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sed -n 32,34p /usr/local/etc/fonts/fonts.conf
        &amp;lt;!-- the following element will be removed in the future --&amp;gt;
        &amp;lt;dir&amp;gt;~/.fonts&amp;lt;/dir&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -alh /usr/local/share/fonts/ | wc -l
      42

% ls -lh /usr/local/share/fonts/ | wc -l
      40
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls /usr/local/share/fonts/
100dpi                  gnu-unifont             SourceHanSansK
75dpi                   ipamjm                  SourceHanSansSC
adobe-cmaps             jmk-x11-fonts           SourceHanSansTC
bitstream-vera          Liberation              SourceSansPro
Caladea                 LinLibertineG           symbola
cantarell               misc                    terminus-font
Carlito                 Monoid                  TerminusTTF
ChromeOS                nanum-coding-ttf        TTF
comic-neue              nanum-ttf               twemoji-color-font-ttf
cyrillic                noto                    Type1
dejavu                  OTF                     uw-ttyp0
encodings               SourceCodePro           vlgothic
GentiumBasic            SourceHanSans           wqy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -ld /usr/local/lib/X11/fonts
ls: /usr/local/lib/X11/fonts: No such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -ld ~/.fonts/
drwxr-xr-x  3 dusko  dusko  214 Nov 22  2021 /home/dusko/.fonts/

% ls -alh ~/.fonts/ | wc -l
     215

% ls -lh ~/.fonts/ | wc -l
     213
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;font-cache-directory-list&quot;&gt;Font Cache Directory List&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% grep -n -i list /usr/local/etc/fonts/fonts.conf
25:&amp;lt;!-- Font directory list --&amp;gt;
87:&amp;lt;!-- Font cache directory list --&amp;gt;
96:  Rescan configuration every 30 seconds when FcFontSetList is called
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sed -n 87,94p /usr/local/etc/fonts/fonts.conf
&amp;lt;!-- Font cache directory list --&amp;gt;

        &amp;lt;cachedir&amp;gt;/var/db/fontconfig&amp;lt;/cachedir&amp;gt;
        &amp;lt;cachedir prefix=&quot;xdg&quot;&amp;gt;fontconfig&amp;lt;/cachedir&amp;gt;
        &amp;lt;!-- the following element will be removed in the future --&amp;gt;
        &amp;lt;cachedir&amp;gt;~/.fontconfig&amp;lt;/cachedir&amp;gt;

        &amp;lt;config&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.fontconfig&lt;/code&gt; directory will be removed in the future:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% grep -n removed /usr/local/etc/fonts/fonts.conf
32:     &amp;lt;!-- the following element will be removed in the future --&amp;gt;
91:     &amp;lt;!-- the following element will be removed in the future --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sed -n 91,92p /usr/local/etc/fonts/fonts.conf
        &amp;lt;!-- the following element will be removed in the future --&amp;gt;
        &amp;lt;cachedir&amp;gt;~/.fontconfig&amp;lt;/cachedir&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -ld /var/db/fontconfig/
drwxr-xr-x  2 root  wheel  57 Mar 31 13:49 /var/db/fontconfig/

% ls -alh /var/db/fontconfig/ | wc -l
      58

% ls -lh /var/db/fontconfig/ | wc -l
      56
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% cat /var/db/fontconfig/CACHEDIR.TAG
Signature: 8a477f597d28d172789f06886806bc55
# This file is a cache directory tag created by fontconfig.
# For information about cache directory tags, see:
#       http://www.brynosaurus.com/cachedir/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -ld ~/.fontconfig
ls: /home/dusko/.fontconfig: No such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;file--fontsalias&quot;&gt;File:  fonts.alias&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo locate fonts.alias
/usr/local/share/fonts/100dpi/fonts.alias
/usr/local/share/fonts/75dpi/fonts.alias
/usr/local/share/fonts/cyrillic/fonts.alias
/usr/local/share/fonts/misc/fonts.alias
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;list-information-about-current-fonts-configuration-font-path&quot;&gt;List Information about Current Fonts Configuration, Font Path&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xset -q | grep -n Font
22:Font Path:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xset -q | sed -n 22,23p
Font Path:
  /usr/local/share/fonts/misc/,/usr/local/share/fonts/TTF/,/usr/local/share/fonts/OTF/,/usr/local/share/fonts/Type1/,/usr/local/share/fonts/100dpi/,/usr/local/share/fonts/75dpi/,catalogue:/usr/local/etc/X11/fontpath.d,built-ins,/usr/local/share/fonts/100dpi,/usr/local/share/fonts/75dpi,/usr/local/share/fonts/adobe-cmaps,/usr/local/share/fonts/bitstream-vera,/usr/local/share/fonts/Caladea,/usr/local/share/fonts/cantarell,/usr/local/share/fonts/Carlito,/usr/local/share/fonts/ChromeOS,/usr/local/share/fonts/comic-neue,/usr/local/share/fonts/cyrillic,/usr/local/share/fonts/dejavu,/usr/local/share/fonts/GentiumBasic,/usr/local/share/fonts/gnu-unifont,/usr/local/share/fonts/ipamjm,/usr/local/share/fonts/jmk-x11-fonts,/usr/local/share/fonts/Liberation,/usr/local/share/fonts/LinLibertineG,/usr/local/share/fonts/misc,/usr/local/share/fonts/Monoid,/usr/local/share/fonts/nanum-coding-ttf,/usr/local/share/fonts/nanum-ttf,/usr/local/share/fonts/noto,/usr/local/share/fonts/OTF,/usr/local/share/fonts/SourceCodePro,/usr/local/share/fonts/SourceHanSans,/usr/local/share/fonts/SourceHanSansK,/usr/local/share/fonts/SourceHanSansSC,/usr/local/share/fonts/SourceHanSansTC,/usr/local/share/fonts/SourceSansPro,/usr/local/share/fonts/symbola,/usr/local/share/fonts/terminus-font,/usr/local/share/fonts/TerminusTTF,/usr/local/share/fonts/TTF,/usr/local/share/fonts/twemoji-color-font-ttf,/usr/local/share/fonts/Type1,/usr/local/share/fonts/uw-ttyp0,/usr/local/share/fonts/vlgothic,/usr/local/share/fonts/wqy,/usr/home/dusko/.fonts/knxt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;fc-cache1---build-font-information-cache-files&quot;&gt;fc-cache(1) - Build Font Information Cache Files&lt;/h3&gt;

&lt;p&gt;To refresh only system fonts:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% fc-cache -sv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-cache(1)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;DESCRIPTION
       fc-cache scans the font directories on the system and builds font
       information cache files for applications using fontconfig for their
       font handling.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-s     Only scan system-wide directories, omitting the places located
       in the user&apos;s home directory.

-v     Display status information while busy.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To force refresh fonts cache:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% fc-cache -fv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-f     Force re-generation of apparently up-to-date cache files,
       overriding the timestamp checking.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Erase all existing cache files and rescan:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% fc-cache -rv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;fc-list1---list-available-fonts&quot;&gt;fc-list(1) - List Available Fonts&lt;/h3&gt;

&lt;p&gt;From the man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-list(1)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;DESCRIPTION
       fc-list lists fonts and styles available on the system for applications
       using fontconfig.  If any elements are specified, only those are
       printed.  Otherwise family and style are printed, unless verbose output
       is requested.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Number of &lt;strong&gt;fontconfig&lt;/strong&gt; fonts available to the user (lists all font faces):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% fc-list | wc -l
    3182
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Number of &lt;strong&gt;fontconfig&lt;/strong&gt; fonts available to root user (lists all font faces):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sudo fc-list | wc -l
Password:
    2966
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;fc-conflist1---show-the-ruleset-files-information-on-the-system&quot;&gt;fc-conflist(1) - Show the ruleset files information on the system&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% fc-conflist | wc -l
      51

% sudo fc-conflist | wc -l
      50
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% fc-conflist | grep dusko
+ /home/dusko/.config/fontconfig/fonts.conf: No description
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sudo fc-conflist | grep dusko
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -lh /home/dusko/.config/fontconfig/fonts.conf
-rw-r--r--  1 dusko  dusko   1.8K Oct 21  2021 /home/dusko/.config/fontconfig/fonts.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;: Courtesy of &lt;strong&gt;vermaden&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% wc -l /home/dusko/.config/fontconfig/fonts.conf
      52 /home/dusko/.config/fontconfig/fonts.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% cat /home/dusko/.config/fontconfig/fonts.conf
&amp;lt;?xml version=&quot;1.0&quot;?&amp;gt;
&amp;lt;!DOCTYPE fontconfig SYSTEM &quot;fonts.dtd&quot;&amp;gt;

&amp;lt;fontconfig&amp;gt;

  &amp;lt;!-- ANTIALIAS ALL FONTS --&amp;gt;
  &amp;lt;match target=&quot;font&quot;&amp;gt;
    &amp;lt;edit name=&quot;antialias&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;bool&amp;gt;true&amp;lt;/bool&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;edit name=&quot;hinting&quot;   mode=&quot;assign&quot;&amp;gt;&amp;lt;bool&amp;gt;false&amp;lt;/bool&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;edit name=&quot;hintstyle&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;int&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;edit name=&quot;dpi&quot;       mode=&quot;assign&quot;&amp;gt;&amp;lt;double&amp;gt;75&amp;lt;/double&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;edit name=&quot;rgba&quot;      mode=&quot;assign&quot;&amp;gt;&amp;lt;const&amp;gt;none&amp;lt;/const&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;/match&amp;gt;

  &amp;lt;!-- REPLACE THESE WITH A BETTER LOOKING FONT (MONO) --&amp;gt;
  &amp;lt;match target=&quot;pattern&quot;&amp;gt;
    &amp;lt;test name=&quot;family&quot;    qual=&quot;any&quot;&amp;gt;&amp;lt;string&amp;gt;Courier [Adobe]&amp;lt;/string&amp;gt;&amp;lt;/test&amp;gt;
    &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;string&amp;gt;Courier 10 Pitch&amp;lt;/string&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;/match&amp;gt;

  &amp;lt;match target=&quot;pattern&quot;&amp;gt;
    &amp;lt;test name=&quot;family&quot;    qual=&quot;any&quot;&amp;gt;&amp;lt;string&amp;gt;Fixed&amp;lt;/string&amp;gt;&amp;lt;/test&amp;gt;
    &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;string&amp;gt;Courier 10 Pitch&amp;lt;/string&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;/match&amp;gt;

  &amp;lt;match target=&quot;pattern&quot;&amp;gt;
    &amp;lt;test name=&quot;family&quot;    qual=&quot;any&quot;&amp;gt;&amp;lt;string&amp;gt;courier&amp;lt;/string&amp;gt;&amp;lt;/test&amp;gt;
    &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;string&amp;gt;Courier 10 Pitch&amp;lt;/string&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;/match&amp;gt;

  &amp;lt;!-- REPLACE THESE WITH A BETTER LOOKING FONT (SANS) --&amp;gt;
  &amp;lt;match target=&quot;pattern&quot;&amp;gt;
    &amp;lt;test name=&quot;family&quot;    qual=&quot;any&quot;&amp;gt;&amp;lt;string&amp;gt;helvetica&amp;lt;/string&amp;gt;&amp;lt;/test&amp;gt;
    &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;string&amp;gt;arial&amp;lt;/string&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;/match&amp;gt;

  &amp;lt;match target=&quot;pattern&quot;&amp;gt;
    &amp;lt;test name=&quot;family&quot;    qual=&quot;any&quot;&amp;gt;&amp;lt;string&amp;gt;times&amp;lt;/string&amp;gt;&amp;lt;/test&amp;gt;
    &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;string&amp;gt;garamond&amp;lt;/string&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;/match&amp;gt;

  &amp;lt;match target=&quot;pattern&quot;&amp;gt;
    &amp;lt;test name=&quot;family&quot;    qual=&quot;any&quot;&amp;gt;&amp;lt;string&amp;gt;lucida&amp;lt;/string&amp;gt;&amp;lt;/test&amp;gt;
    &amp;lt;edit name=&quot;family&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;string&amp;gt;trebuchet ms&amp;lt;/string&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;/match&amp;gt;

  &amp;lt;!-- DISABLE EMBEDDED BITMAPS --&amp;gt;
  &amp;lt;match target=&quot;font&quot; &amp;gt;
    &amp;lt;edit name=&quot;embeddedbitmap&quot; mode=&quot;assign&quot;&amp;gt;&amp;lt;bool&amp;gt;false&amp;lt;/bool&amp;gt;&amp;lt;/edit&amp;gt;
    &amp;lt;/match&amp;gt;

&amp;lt;/fontconfig&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;useful-tools-commands-and-code-snippets-for-exploring-fonts-in-x11&quot;&gt;Useful Tools, Commands and Code Snippets for Exploring Fonts in X11&lt;/h2&gt;

&lt;p&gt;Start &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xterm&lt;/code&gt; with red cursor, font Source Code Pro and font size 18:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% xterm -cr red -fa &apos;Source Code Pro&apos; -fs 18
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-fa&lt;/code&gt; option enables &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xterm&lt;/code&gt; to render &lt;strong&gt;Xft&lt;/strong&gt; fonts 
(a.k.a. fontconfig).&lt;/p&gt;

&lt;p&gt;The venerable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file(1)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% file /usr/local/share/fonts/SourceCodePro/SourceCodePro-Regular.ttf
/usr/local/share/fonts/SourceCodePro/SourceCodePro-Regular.ttf: TrueType Font data, digitally signed, 15 tables, 1st &quot;BASE&quot;, 72 names, Microsoft, language 0x408, type 256 string, \261\300\273\314 a\261\300\273\314 gi &amp;amp; l \274\265 \261\272\301\265\274\314\275\265\302\243\254\
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Report information about OpenType fonts with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;otfinfo(1)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% otfinfo --info /usr/local/share/fonts/SourceCodePro/SourceCodePro-Regular.ttf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% otfinfo --features /usr/local/share/fonts/SourceCodePro/SourceCodePro-Regular.ttf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Print supported scripts and languages:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% otfinfo --scripts /usr/local/share/fonts/SourceCodePro/SourceCodePro-Regular.ttf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;DFLT            Default
cyrl            Cyrillic
cyrl.SRB        Cyrillic/Serbian
grek            Greek
latn            Latin
latn.ATH        Latin/Athapaskan
latn.NSM        Latin/Northern Sami
latn.SKS        Latin/Skolt Sami
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Other interesting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;otfinfo&lt;/code&gt;’s options:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-g, --glyphs
     Print the name of every glyph in each font, one per line.

-u, --unicode
     Print each Unicode code point supported by the font, followed by
     the glyph number representing that code point (and, if present,
     the name of the corresponding glyph).

-t, --tables
     Print the size and name of every OpenType table in the font.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-z, --optical-size
     Print optical size information.

-p, --postscript-name
      Print each font&apos;s PostScript name.

-a, --family
     Print each font&apos;s family name.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xset -q
Keyboard Control:
  auto repeat:  on    key click percent:  0    LED mask:  00000000
  XKB indicators:
    00: Caps Lock:   off    01: Num Lock:    off    02: Scroll Lock: off
    03: Compose:     off    04: Kana:        off    05: Sleep:       off
    06: Suspend:     off    07: Mute:        off    08: Misc:        off
    09: Mail:        off    10: Charging:    off    11: Shift Lock:  off
    12: Group 2:     off    13: Mouse Keys:  off
  auto repeat delay:  660    repeat rate:  25
  auto repeating keys:  00ffffffdffffbbf
                        fadfffefffedffff
                        9fffffffffffffff
                        fff7ffffffffffff
  bell percent:  0    bell pitch:  400    bell duration:  100
Pointer Control:
  acceleration:  2/1    threshold:  4
Screen Saver:
  prefer blanking:  yes    allow exposures:  yes
  timeout:  600    cycle:  600
Colors:
  default colormap:  0x22    BlackPixel:  0x0    WhitePixel:  0xffffff
Font Path:
  /usr/local/share/fonts/misc/,/usr/local/share/fonts/TTF/,/usr/local/share/fonts/OTF/,/usr/local/share/fonts/Type1/,/usr/local/share/fonts/100dpi/,/usr/local/share/fonts/75dpi/,catalogue:/usr/local/etc/X11/fontpath.d,built-ins,/usr/local/share/fonts/100dpi,/usr/local/share/fonts/75dpi,/usr/local/share/fonts/adobe-cmaps,/usr/local/share/fonts/bitstream-vera,/usr/local/share/fonts/Caladea,/usr/local/share/fonts/cantarell,/usr/local/share/fonts/Carlito,/usr/local/share/fonts/ChromeOS,/usr/local/share/fonts/comic-neue,/usr/local/share/fonts/cyrillic,/usr/local/share/fonts/dejavu,/usr/local/share/fonts/GentiumBasic,/usr/local/share/fonts/gnu-unifont,/usr/local/share/fonts/ipamjm,/usr/local/share/fonts/jmk-x11-fonts,/usr/local/share/fonts/Liberation,/usr/local/share/fonts/LinLibertineG,/usr/local/share/fonts/misc,/usr/local/share/fonts/Monoid,/usr/local/share/fonts/nanum-coding-ttf,/usr/local/share/fonts/nanum-ttf,/usr/local/share/fonts/noto,/usr/local/share/fonts/OTF,/usr/local/share/fonts/politika-otf,/usr/local/share/fonts/politika-ttf,/usr/local/share/fonts/SourceCodePro,/usr/local/share/fonts/SourceHanSans,/usr/local/share/fonts/SourceHanSansK,/usr/local/share/fonts/SourceHanSansSC,/usr/local/share/fonts/SourceHanSansTC,/usr/local/share/fonts/SourceSansPro,/usr/local/share/fonts/symbola,/usr/local/share/fonts/terminus-font,/usr/local/share/fonts/TerminusTTF,/usr/local/share/fonts/TTF,/usr/local/share/fonts/twemoji-color-font-ttf,/usr/local/share/fonts/Type1,/usr/local/share/fonts/uw-ttyp0,/usr/local/share/fonts/vlgothic,/usr/local/share/fonts/wqy,/usr/home/dusko/.fonts/knxt
DPMS (Energy Star):
  Standby: 600    Suspend: 600    Off: 600
  DPMS is Enabled
  Monitor is On
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt; the content of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Font Path:&lt;/code&gt; line.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xrdb -query
! screen-independent resources
XTerm*saveLines:        1048576
XTerm*loginShell:       true
XTerm*charClass:        33:48,35:48,37:48,43:48,45-47:48,64:48,95:48,126:48
XTerm*eightBitInput:    false
XTerm*borderWidth:      4
Xcursor.theme:  Vanilla-DMZ
XTerm*cursorBlink:      true
XTerm*scrollKey:        true
XTerm*colorUL:  Yellow
XTerm*colorULMode:      true
XTerm*cursorColor:      Cyan
XTerm*background:       Black
XTerm*foreground:       White
XTerm*locale:   UTF-8
XTerm*faceNameDoublesize:       Noto Serif CJK JP
XTerm*scrollTtyOutput:  false
XTerm*selectToClipboard:        true
Xft.autohint:   0
Xft.antialias:  1
Xft.hinting:    1
Xft.rgba:       rgb
Xft.hintstyle:  hintlight
Xft.lcdfilter:  lcddefault
*VT100.Translations:    #override Button1 &amp;lt;Btn3Down&amp;gt;: select-end(PRIMARY,CUT_BUFFER0,CLIPBOARD) \n !Shift &amp;lt;Btn2Up&amp;gt;: insert-selection(CLIPBOARD) \n ~Shift ~Ctrl ~Meta &amp;lt;Btn2Up&amp;gt;: insert-selection(PRIMARY,CUT_BUFFER0) \n &amp;lt;Key&amp;gt;F3: string(&quot;cd ~/scratch/tmpscratch2&quot;) string(0x0d) \n Alt &amp;lt;Key&amp;gt;t: string(&quot;date | dzen2 -xs 2 -p 5 -bg blue&quot;) string(0x0d)
Xmessage*Scrollbar.thumb:       vlines2
Xmessage*Scrollbar.width:       2

! screen 0 resources
#if SCREEN_NUM == 0
#endif

! screen 1 resources
#if SCREEN_NUM == 1
#endif
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; This environment has two monitors so there are references to 
both of them: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#if SCREEN_NUM == 0&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#if SCREEN_NUM == 1&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;*VT100.Translations:&lt;/code&gt; is my own customization.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;List all monospaced fonts:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$ fc-list | cut -f2 -d: | sort -u | grep -i Mono&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Print out the fixed width fonts that are available:&lt;/strong&gt; 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$ fc-list :scalable=true:spacing=mono:&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Print out the fixed width fonts that are available with their family name:&lt;/strong&gt; 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$ fc-list :scalable=true:spacing=mono: family&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Sort and page through the available fonts - not only fixed width fonts:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$ fc-list | cut -f2 -d: | sort -u | less&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;To test the status of your colour support in XTerm:&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ tput colors
80
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;References: &lt;br /&gt;
(Retrieved on Apr 17, 2022)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.futurile.net/2016/06/14/xterm-setup-and-truetype-font-configuration/&quot;&gt;XTerm introduction and TrueType fonts configuration&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.futurile.net/2016/06/15/xterm-256color-themes-molokai-terminal-theme/&quot;&gt;XTerm colour set-up and Molokai theme&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;installing-an-xft-font-aka-fontconfig---a-full-example&quot;&gt;Installing an Xft Font (aka Fontconfig) - A Full Example&lt;/h3&gt;

&lt;p&gt;OS:  FreeBSD 13.0 &lt;br /&gt;
Shell:  csh&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list | wc -l
    3186
 
$ sudo fc-list | wc -l
    2968
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list | grep -i hermit
$ sudo fc-list | grep -i hermit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xlsfonts | wc -l
   25462
 
$ sudo xlsfonts | wc -l
   25462
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xlsfonts | grep -i hermit
$ sudo xlsfonts | grep -i hermit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ pkg search hermit
hermit-font-2.0_1      Monospaced font for programmers by a programmer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo pkg install hermit-font
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list | wc -l
    3192
 
$ sudo fc-list | wc -l
    2974
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list | grep -i hermit | wc -l
       6

$ sudo fc-list | grep -i hermit | wc -l
       6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list | grep -i hermit
/usr/local/share/fonts/hermit/Hermit-LightItalic.otf: Hermit,Hermit LightItalic:style=LightItalic,Regular
/usr/local/share/fonts/hermit/Hermit-Bold.otf: Hermit:style=Bold
/usr/local/share/fonts/hermit/Hermit-Regular.otf: Hermit:style=Regular
/usr/local/share/fonts/hermit/Hermit-RegularItalic.otf: Hermit:style=RegularItalic,Italic
/usr/local/share/fonts/hermit/Hermit-Light.otf: Hermit,Hermit Light:style=Light,Regular
/usr/local/share/fonts/hermit/Hermit-BoldItalic.otf: Hermit:style=BoldItalic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xlsfonts | wc -l
   25462

$ sudo xlsfonts | wc -l
   25462
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xlsfonts | grep -i hermit
$ sudo xlsfonts | grep -i hermit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list : fullname | grep -i hermit | wc -l
       6

$ fc-list : fullname | grep -i hermit
:fullname=Hermit Bold
:fullname=Hermit Light
:fullname=Hermit RegularItalic
:fullname=Hermit BoldItalic
:fullname=Hermit LightItalic
:fullname=Hermit Regular
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list : postscriptname | grep -i hermit | wc -l
       6

$ fc-list : postscriptname | grep -i hermit
:postscriptname=Hermit-Regular
:postscriptname=Hermit-RegularItalic
:postscriptname=Hermit-LightItalic
:postscriptname=Hermit-Bold
:postscriptname=Hermit-Light
:postscriptname=Hermit-BoldItalic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-match hermit 
Hermit-Regular.otf: &quot;Hermit&quot; &quot;Regular&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-match Hermit
Hermit-Regular.otf: &quot;Hermit&quot; &quot;Regular&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-query /usr/local/share/fonts/hermit/Hermit-Regular.otf | wc -l
      41
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-query /usr/local/share/fonts/hermit/Hermit-Regular.otf 
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ file /usr/local/share/fonts/hermit/Hermit-Regular.otf
/usr/local/share/fonts/hermit/Hermit-Regular.otf: OpenType font data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --info /usr/local/share/fonts/hermit/Hermit-Regular.otf
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --features /usr/local/share/fonts/hermit/Hermit-Regular.otf
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --scripts /usr/local/share/fonts/hermit/Hermit-Regular.otf
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --glyphs /usr/local/share/fonts/hermit/Hermit-Regular.otf | wc -l
     393
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --glyphs /usr/local/share/fonts/hermit/Hermit-Regular.otf | wc -l
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --unicode /usr/local/share/fonts/hermit/Hermit-Regular.otf | wc -l
     391
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --unicode /usr/local/share/fonts/hermit/Hermit-Regular.otf 
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --font-version /usr/local/share/fonts/hermit/Hermit-Regular.otf
Version 2.000;PS 002.000;hotconv 1.0.88;makeotf.lib2.5.64775
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --optical-size /usr/local/share/fonts/hermit/Hermit-Regular.otf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ otfinfo --postscript-name /usr/local/share/fonts/hermit/Hermit-Regular.otf
Hermit-Regular
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list -v Hermit-Regular charset 
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fc-list -v Hermit-Regular
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xfd -fa Hermit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xterm -fa Hermit -fs 14
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xterm -fa &apos;Hermit:light&apos; -fs 14
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Font face size (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-fs&lt;/code&gt; option for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xterm&lt;/code&gt;) and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pixelsize&lt;/code&gt; are 
not the same so the following two are different:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xterm -fa &apos;Hermit:light:pixelsize=14:antialias=true:autohint=true&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xterm -fa &apos;Hermit:light:antialias=true:autohint=true&apos; -fs 14
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This table gives an approximate conversion between points and pixels:&lt;br /&gt;
&lt;a href=&quot;https://reeddesign.co.uk/test/points-pixels.html&quot;&gt;Approximate conversion from points to pixels - ReedDesign&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Here’s a chart that converts points to pixels (and ems and %). 
It’s an approximation, which will depend on font, browser and OS, but 
it’s a good starting point.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As per that table, 14pt is approximately 19px:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ xterm -fa &apos;Hermit:light:pixelsize=19:antialias=true:autohint=true&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and that’s the same (similar) to the font face size of 14: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$ xterm -fa &apos;Hermit:light:antialias=true:autohint=true&apos; -fs 14&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Hermit font setup reference: &lt;br /&gt;
&lt;a href=&quot;http://eradman.com/posts/openbsd-workstation.html&quot;&gt;Eric Radman - Workstation Notes&lt;/a&gt; (Retrieved on Apr 17, 2022)&lt;/p&gt;

&lt;h2 id=&quot;converting-unicode-to-utf-8&quot;&gt;Converting Unicode to UTF-8&lt;/h2&gt;

&lt;h3 id=&quot;a-short-introduction&quot;&gt;A Short Introduction&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Not going into details about different operating systems, 
different shells, different fonts, locales, different editors, 
different ordering and byte format (7-bit, 8-bit, single byte, 
double byte, multi-byte), double-wide characters, collation, 
endianness, composing &amp;amp; decomposing, UTF-8 vs. UTF-16 vs. UTF-32
&lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;, etc.&lt;/p&gt;

&lt;p&gt;Here’s just a few references to illustrate how complex this area is:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://scripts.sil.org/cms/scripts/page.php?site_id=nrsi&amp;amp;id=UnicodeSupport&quot;&gt;Software requirements for different levels of Unicode Support&lt;/a&gt; (Retrieved on Apr 17, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Vim supports editing Unicode in the GUI version and in terminals that 
support UTF-8.  Double-wide characters can be used, and up to two 
composing characters are supported.  When reading a file, Vim can often 
detect how it is encoded and convert the text when necessary. 
UTF-8 files are edited without conversion.  Other Unicode formats 
(16 bit and 32 bit) are converted internally.  Conversion is also used 
to edit files in just about any encoding, using an external converter.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://invisible-island.net/ncurses/ncurses.faq.html&quot;&gt;About Vim’s Unicode support - from What is ncurses? - by Thomas E. Dickey, developer and maintainer of xterm&lt;/a&gt; &lt;br /&gt;
(Updated on Mar 16, 2022) (Retrieved on Apr 17, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Vim &lt;br /&gt;
Vim’s developers provide their own termcap definitions, just in case 
there is nothing good enough on the system, and provide features for 
overriding the system’s termcap capabilities even when using the system 
definition as a starting point.  Because of this, vim has had little 
impact on ncurses development; the change-log does not mention vim. 
On the other hand, unlike screen, the source-code for vim still contains 
a comment about a bug in ncurses which was addressed in late 1997, 
before ncurses 4.2 was released.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://vi.stackexchange.com/questions/341/what-is-the-relation-between-vi-nvi-and-vim&quot;&gt;History of - What is the relation between vi, nvi and vim? - Vi and Vim Stack Exchange&lt;/a&gt; (Retrieved on Apr 17, 2022)&lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;http://ex-vi.sourceforge.net/&quot;&gt;The Traditional Vi&lt;/a&gt; (Retrieved on Apr 17, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;This port of vi has generally preserved the original style, terminal 
control, and feature set.  It adds &lt;strong&gt;support for international character 
sets, including multibyte encodings such as UTF-8&lt;/strong&gt; (&lt;em&gt;emphasis mine&lt;/em&gt;), 
and some minor enhancements that were not present in BSD vi 3.7, but had 
been included in later vi versions for System V or in POSIX.2.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;http://ex-vi.sourceforge.net/README&quot;&gt;The Traditional Vi README&lt;/a&gt; (Retrieved on Apr 17, 2022):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Welcome to the ex/vi port!
==========================

This implementation is derived from ex/vi 3.7 of 6/7/85 and the BSD
termcap library, originally from the 2.11BSD distribution. All of them
were changed to compile and run on newer POSIX compatible Unix systems.
Support for international character sets was added, including support
for multibyte locales (based on UTF-8 or East Asian encodings), and some
changes were made to get closer to the POSIX.2 guidelines for ex and
vi. Some issues that were clearly bugs and not features have also been
resolved; see the Changes file for details.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On FreeBSD 13.1 - RELEASE:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% command -v vi; type vi; whereis vi; which vi
/usr/bin/vi
vi is /usr/bin/vi
vi: /usr/bin/vi /usr/share/man/man1/vi.1.gz
/usr/bin/vi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ls -lh /usr/bin/vi
-r-xr-xr-x  6 root  wheel   463K Jul 27 11:06 /usr/bin/vi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% command -v nvi; type nvi; whereis nvi; which nvi
/usr/bin/nvi
nvi is /usr/bin/nvi
nvi: /usr/bin/nvi /usr/share/man/man1/nvi.1.gz
/usr/bin/nvi
 
% ls -lh /usr/bin/nvi
-r-xr-xr-x  6 root  wheel   463K Jul 27 11:06 /usr/bin/nvi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% diff /usr/bin/vi /usr/bin/nvi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reference:  &lt;br /&gt;
From a FreeBSD Forum post started on Dec 24, 2014 &lt;br /&gt;
&lt;a href=&quot;https://forums.freebsd.org/threads/how-do-i-type-in-special-characters-such-as-in-the-terminal-in-vi.49659/&quot;&gt;How do I type in special characters, such as ∞ in the terminal in vi?&lt;/a&gt;, 
post #3 &lt;a href=&quot;https://forums.FreeBSD.org/threads/how-do-i-type-in-special-characters-such-as-in-the-terminal-in-vi.49659/post-277491&quot;&gt;https://forums.FreeBSD.org/threads/how-do-i-type-in-special-characters-such-as-in-the-terminal-in-vi.49659/post-277491&lt;/a&gt; (Retrieved on Apr 17, 2022): &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;For a complete and detailed list of differences and improvements, 
here’s the official &lt;a href=&quot;https://vimhelp.org/vi_diff.txt.html#vi-differences&quot;&gt;Differences between Vim and Vi&lt;/a&gt; document at the &lt;a href=&quot;https://vimhelp.org/&quot;&gt;Vim help files&lt;/a&gt; site (an HTML version of the Vim help pages).&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;converting-unicode-to-utf-8-when-you-know-unicode-code-point&quot;&gt;Converting Unicode to UTF-8 When You Know Unicode Code Point&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  Code point is also known as codepoint or code position.&lt;/p&gt;

&lt;h4 id=&quot;converting-with-od1&quot;&gt;Converting with od(1)&lt;/h4&gt;

&lt;p&gt;OS: FreeBSD 13.1 &lt;br /&gt;
Shell: csh&lt;/p&gt;

&lt;p&gt;For example, use the character U+02B7: MODIFIER LETTER SMALL W for testing: &lt;br /&gt;
&lt;a href=&quot;https://charbase.com/02b7-unicode-modifier-letter-small-w&quot;&gt;U+02B7: MODIFIER LETTER SMALL W&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://charbase.com/&quot;&gt;Charbase - A visual Unicode database&lt;/a&gt;
(Retrieved on Apr 17, 2022)&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Charbase is a visual database of characters from the Unicode 6.1 
standard, made available without clutter.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;With &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;uni.pl&lt;/code&gt; Perl script, obtained from Leah Neukirchen’s dotfiles and bin section:  &lt;br /&gt;
&lt;a href=&quot;https://leahneukirchen.org/dotfiles/bin/uni&quot;&gt;uni PATTERN - list unicode symbols matching PATTERN&lt;/a&gt;) (Retrieved on Apr 17, 2022):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ./uni.pl ʷ
ʷ       02B7    MODIFIER LETTER SMALL W
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf ʷ &amp;gt; chartest
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% cat chartest
ʷ% 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% od -ac chartest
0000000   ca  b7
           ʷ  **
0000002
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf %s\\n ʷ &amp;gt; chartest
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% cat chartest
ʷ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% od -ac chartest
0000000   ca  b7  nl
           ʷ  **  \n
0000003
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% od -N 1 -ac chartest
0000000   ca
         312
0000001
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a 2-byte character:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% od -N 2 -ac chartest
0000000   ca  b7
           ʷ  **
0000002
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In &lt;strong&gt;UTF-8&lt;/strong&gt;, this character is  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CA B7&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% od -N 2 -t x1 chartest
0000000    ca  b7
0000002
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% od -N 2 -c -t x1 chartest
0000000    ʷ  **
           ca  b7
0000002
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% od -N 2 -ab chartest
0000000   ca  b7
          312 267
0000002
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;TIP:&lt;/strong&gt;&lt;br /&gt;
For POSIX compliance, use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt; instead of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;echo&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://unix.stackexchange.com/questions/65803/why-is-printf-better-than-echo&quot;&gt;Why is printf better than echo?&lt;/a&gt; (Retrieved on Apr 17, 2022)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.in-ulm.de/%7Emascheck/various/echo+printf/&quot;&gt;echo(1) and printf(1)&lt;/a&gt; (Retrieved on Apr 17, 2022)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.etalabs.net/sh_tricks.html&quot;&gt;Rich’s sh (POSIX shell) tricks&lt;/a&gt; (Retrieved on Apr 17, 2022)&lt;/p&gt;

&lt;p&gt;For POSIX compliance, for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt; you need &lt;strong&gt;octal&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Not going into details about different operating systems, 
different shells, different fonts, locales, etc.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf &apos;\312\267&apos;
ʷ%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf &apos;\312\267\n&apos;
ʷ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  On FreeBSD 13.1-RELEASE in csh:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% command -v printf; type printf; whereis printf; which printf
printf
printf is a shell builtin
printf: /usr/bin/printf /usr/share/man/man1/printf.1.gz
/usr/bin/printf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% freebsd-version
13.1-RELEASE

% ps $$
  PID TT  STAT    TIME COMMAND
22492  9  Ss   0:00.17 -csh (csh)

% printf %s\\n &quot;$SHELL&quot;
/bin/csh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;TIP:&lt;/strong&gt;  You can use the Posix-standard &lt;a href=&quot;https://pubs.opengroup.org/onlinepubs/9699919799/utilities/command.html&quot;&gt;command&lt;/a&gt; command to avoid the use of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt; builtin: &lt;br /&gt;
  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;command printf&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;You can also do it directly by specifying the complete path to the 
non-builtin &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;printf&lt;/code&gt;:  &lt;br /&gt;
  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/printf&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Discussion about this (retrieved on Apr 17, 2022): &lt;br /&gt;
&lt;a href=&quot;https://stackoverflow.com/questions/27652458/whats-the-best-way-to-embed-a-unicode-character-in-a-posix-shell-script&quot;&gt;What’s the best way to embed a Unicode character in a POSIX shell script?&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Per this reference (retrieved on Apr 17, 2022):  &lt;br /&gt;
&lt;a href=&quot;https://askubuntu.com/questions/601137/how-to-print-an-octal-values-corresponding-utf-8-character-in-bash&quot;&gt;https://askubuntu.com/questions/601137/how-to-print-an-octal-values-corresponding-utf-8-character-in-bash&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf &quot;%b\n&quot; &apos;\312\267&apos;
ʷ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% awk &apos;BEGIN {print &quot;\312\267&quot;}&apos;
ʷ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;converting-unicode-to-utf-8-when-you-dont-know-unicode-code-point&quot;&gt;Converting Unicode to UTF-8 When You Don’t Know Unicode Code Point&lt;/h3&gt;

&lt;p&gt;From 
&lt;a href=&quot;https://unix.stackexchange.com/questions/55770/does-hexdump-respect-the-endianness-of-its-system&quot;&gt;Does hexdump respect the endianness of its system?&lt;/a&gt; 
(Retrieved on Apr 17, 2022):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The traditional BSD hexdump utility uses the platform’s endianness so 
the output you see means your machine is little-endian.&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;TIP:&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hexdump -C&lt;/code&gt; (or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;od -t x1&lt;/code&gt;) to get &lt;strong&gt;consistent byte-by-byte output 
irrespective of the platform’s endianness&lt;/strong&gt; (&lt;em&gt;emphasis mine&lt;/em&gt;).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Therefore:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf ʷ | hexdump -C
00000000  ca b7                                             |..|
00000002
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf ʷ | od -t x1
0000000    ca  b7
0000002
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From here, follow the instructions above for:  &lt;br /&gt;
&lt;a href=&quot;#converting-unicode-to-utf-8-when-you-know-unicode-code-point&quot;&gt;Converting Unicode to UTF-8 When You Know Unicode Code Point&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also, from the same question - different answer:  &lt;br /&gt;
&lt;a href=&quot;https://unix.stackexchange.com/questions/55770/does-hexdump-respect-the-endianness-of-its-system/55771#55771&quot;&gt;https://unix.stackexchange.com/questions/55770/does-hexdump-respect-the-endianness-of-its-system/55771#55771&lt;/a&gt;
(Retrieved on Apr 17, 2022):&lt;/p&gt;

&lt;p&gt;Your output is little-endian (least significant byte first), which is also the endianness of the x86 and x86_64 architectures, which you are probably using.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  If no format strings are specified, the default display 
in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hexdump(1)&lt;/code&gt; is equivalent to specifying the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-x&lt;/code&gt; option – From the 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hexdump(1)&lt;/code&gt; manpage:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-x      Two-byte hexadecimal display.  Display the input offset in hexa‐
        decimal, followed by eight, space separated, four column, zero-
        filled, two-byte quantities of input data, in hexadecimal, per
        line.

... 

If no format strings are specified, the default display is equivalent 
to specifying the -x option.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf ʷ | hexdump
0000000 b7ca
0000002
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;troubleshooting-fonts&quot;&gt;Troubleshooting Fonts&lt;/h2&gt;

&lt;h3 id=&quot;try-a-different-application&quot;&gt;Try a Different Application&lt;/h3&gt;

&lt;p&gt;Even though you can list a font with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-list(1)&lt;/code&gt; and then grep for it,
sometimes it will not be available in some applications, or if it’s
available it will not work.&lt;/p&gt;

&lt;p&gt;Possible fix: try a different app.
For example, I had a problem with a font in TEA &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;
and LibreOffice &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;4&lt;/a&gt;&lt;/sup&gt; – The fix was to use
AbiWord &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;, which worked fine with that font.&lt;/p&gt;

&lt;h3 id=&quot;useful-tools-commands-and-code-snippets-for-troubleshooting-fonts-in-x11&quot;&gt;Useful Tools, Commands and Code Snippets for Troubleshooting Fonts in X11&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Search for a font by its name:&lt;/strong&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-list : fullname | grep -i FontNameHere&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Search for a font by its PostScript name:&lt;/strong&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-list : postscriptname | grep -i FontNameHere&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Show the list of supported characters in a font:&lt;/strong&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-list -v &apos;FontName: style=Regular&apos; charset&lt;/code&gt;   &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-list -v &apos;FontName&apos; charset&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Query the font:&lt;/strong&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-query /usr/local/share/fonts/FontNameHere/FontFile.ttf&lt;/code&gt;
Number of elts (size) that pattern has, family, style (e.g. Regular),
fullname, slant, weight, width, foundry, is it outline, is it scalable,
charset, lang (supported languages), fontversion, postscriptname,
is it color.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Display the font (display all the characters) in an X core font:&lt;/strong&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xfd -fn FontName&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Display the font (display all the characters) in an Xft font:&lt;/strong&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xfd -fa FontName&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Check if the current terminal and font support a Unicode character
(with Perl) (e.g. “ʷ” U+02B7: Modifier Letter Small W):&lt;/strong&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;perl -C -e &apos;print chr 0x02B7&apos;&lt;/code&gt;
    or
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;perl -C -e &apos;print pack(&quot;U&quot;,0x02b7).&quot;\n&quot;&apos;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Reference:  Create unicode character with pack &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;A simple Perl one-liner:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% perl -e &apos;print chr(0x02b7); print &quot;\n&quot;&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Wide character in print at -e line 1.
ʷ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Alternatively:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% perl -e &apos;print &quot;\x{02b7}\n&quot;&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Wide character in print at -e line 1.
ʷ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  “Wide character in print at …”
Perl warns you if you print a string that has a character with an ordinal
value greater than 255 (hence it is a “wide” character that requires more
than one byte of storage).
Explicitly &lt;a href=&quot;https://en.wikibooks.org/wiki/Perl_Programming/Unicode_UTF-8#3._Encoding_and_output&quot;&gt;encode your output&lt;/a&gt; to avoid this warning:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% perl -e &apos;binmode STDOUT, &quot;:encoding(utf8)&quot;; print &quot;\x{02b7}\n&quot;&apos;
ʷ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% perl -e &apos;binmode STDOUT, &quot;:encoding(utf8)&quot;; print chr(0x02b7); print &quot;\n&quot;&apos;
ʷ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;From &lt;a href=&quot;https://stackoverflow.com/questions/31198425/perl-pack-a-utf-8-chinese-character-how-to-unpack-to-get-this-character&quot;&gt;perl pack a utf-8 Chinese Character how to unpack to get this Character?&lt;/a&gt; (Retrieved on Apr 17, 2022):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% cat unpack.pl
#!/usr/local/bin/perl

use utf8;
binmode STDOUT,&quot;:utf8&quot;;

my $packed = pack(&quot;U*&quot;, 0x02b7);
print &quot;$packed\n&quot;;  # ʷ

my $unpacked = unpack(&quot;U*&quot;, &quot;ʷ&quot;);
printf &quot;0x%X\n&quot;, $unpacked;  # 0x02b7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% chmod 0744 unpack.pl
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% ./unpack.pl
ʷ
0x2B7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another useful Perl Unicode code snippet:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% perl -MDevel::Peek -e &apos;Dump(pack(&quot;U&quot;, 0x02b7));&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SV = PV(0x800e28060) at 0x800e5f7b0
  REFCNT = 1
  FLAGS = (PADTMP,POK,READONLY,PROTECT,pPOK,UTF8)
  PV = 0x800f16480 &quot;\312\267&quot;\0 [UTF8 &quot;\x{2b7}&quot;]
  CUR = 2
  LEN = 32
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Check if the current terminal and font support a Unicode character
(with Python):&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% command -v python; which python
python: Command not found.

% command -v python2; which python2
python2: Command not found.

% command -v python3; which python3
python3: Command not found.

% command -v python3.7; which python3.7
python3.7: Command not found.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% command -v python3.8; which python3.8
/usr/local/bin/python3.8
/usr/local/bin/python3.8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% python3.8 -c &apos;print(u&quot;\u02B7&quot;)&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% python3.8 -c &apos;print(u&quot;\u02B7\n&quot;)&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;From “Beyond Linux® From Scratch (System V Edition) - Version r11.1-906 - Chapter 24. Graphical Environments”, &lt;a href=&quot;https://www.linuxfromscratch.org/blfs/view/svn/x/tuning-fontconfig.html&quot;&gt;Tuning Fontconfig&lt;/a&gt;
(retrieved on Apr 17, 2022):&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-list | less&lt;/code&gt;: show a list of all available fonts (/path/to/filename:
Font Name:style).  If you installed a font more than 30 seconds ago but
it does not show, then it or one of its directories is not readable by
your user.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-match &apos;Font Name&apos;&lt;/code&gt;: will tell you which font will be used if the named
font is requested.  Typically you would use this to see what happens if a
font you have not installed is requested, but you can also use it if the
system is giving you a different font from what you expected (perhaps
because fontconfig does not agree that the font supports your language).&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-match -a &apos;Type&apos; | less&lt;/code&gt;: will provide a list of all fonts which can be
used for that type (Monospace, Sans, Serif).  Note that in-extremis
fontconfig will take a glyph from any available font, even if it is not of
the specified type, and unless it knows about the font’s type it will
assume it is Sans.&lt;/p&gt;

&lt;p&gt;If you wish to know which font will be used for a string of text (i.e. one
or more glyphs, preceded by a space), paste the following command and
replace the xyz by the text you care about:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FC_DEBUG=4 pango-view --font=monospace -t xyz | grep family&lt;/code&gt;: this requires
&lt;a href=&quot;https://www.linuxfromscratch.org/blfs/view/svn/x/pango.html&quot;&gt;Pango-1.50.8&lt;/a&gt;
and &lt;a href=&quot;https://www.linuxfromscratch.org/blfs/view/svn/general/imagemagick.html&quot;&gt;ImageMagick-7.1.0-25&lt;/a&gt; - it will invoke display to show the
text in a tiny window, and after closing that the last line of the output
will show which font was chosen.  This is particularly useful for CJK
languages, and you can also pass a language,
e.g. PANGO_LANGUAGE=en;ja (English, then assume Japanese) or
just zh-cn (or other variants - ‘zh’ on its own is not valid). – My Note:
This works in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bash&lt;/code&gt; and compatible shells.
For &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;csh/tcsh&lt;/code&gt;, use:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;env DISPLAY=:0 FC_DEBUG=4 pango-view --font=monospace -t xyz | grep family&lt;/code&gt;
    or
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;env FC_DEBUG=4 pango-view --font=monospace -t xyz | grep family&lt;/code&gt;
    or (for no output, reduce debugging level to zero):
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;env FC_DEBUG=0 pango-view --font=monospace -t xyz | grep family&lt;/code&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;tools-and-test-pages-available-online-unicode-utf-8-encodings&quot;&gt;Tools and Test Pages Available Online: Unicode, UTF-8, Encodings&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://jkorpela.fi/chars/test8.htm&quot;&gt;Test page for 8-bit encodings&lt;/a&gt; &lt;br /&gt;
(Created on May 11, 2005 - Retrieved on Apr 17, 2022)
    &lt;blockquote&gt;
      &lt;p&gt;The table contains alternating rows with octets in the range 
128–255 (decimal) and ISO 8859-1 characters with the same code numbers. 
The first two rows for ISO 8859-1 have been greyed out, since those 
code positions do not contain printable characters but are reserved 
for control character purposes.&lt;/p&gt;

      &lt;p&gt;This document has no character encoding information.  This allows you 
to view it using various 8-bit encodings.  On Internet Explorer, 
&amp;lt; for example, select View, then Encoding, and then for example 
Baltic (Windows) in order to compare Windows Baltic with ISO 8859-1.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://jkorpela.fi/fui.html8&quot;&gt;Full Unicode Input utility (for Unicode version 14)&lt;/a&gt; &lt;br /&gt;
(Created on Oct 2, 2012 - Retrieved on Apr 17, 2022)
    &lt;blockquote&gt;
      &lt;p&gt;This utility can be characterized as an online extended character map 
oriented towards writing characters.  It displays a table that looks 
like a set of keyboard buttons, and clicking on a button you enter the 
character in question.  The characters will be appended to the text 
input area on the right.&lt;/p&gt;

      &lt;p&gt;You can also type the Unicode number of a character in the box prefixed 
by “U+” and press Enter or click on the Add button.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;And, of course, have in mind:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://eev.ee/blog/2015/05/20/i-stared-into-the-fontconfig-and-the-fontconfig-stared-back-at-me/&quot;&gt;I stared into the fontconfig, and the fontconfig stared back at me&lt;/a&gt; - Posted: May 20, 2015 – Retrieved: Apr 17, 2022&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.reddit.com/r/linux/comments/97z73q/i_stared_into_the_fontconfig_and_the_fontconfig/&quot;&gt;I stared into the fontconfig, and the fontconfig stared back at me / fuzzy notepad - r/linux&lt;/a&gt; – Retrieved: Apr 17, 2022&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.reddit.com/r/programming/comments/36wcu7/i_stared_into_the_fontconfig_and_the_fontconfig/&quot;&gt;I stared into the fontconfig, and the fontconfig stared back at me - r/programming&lt;/a&gt; – Retrieved: Apr 17, 2022&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;From blog post:
&lt;a href=&quot;https://eev.ee/blog/2015/05/20/i-stared-into-the-fontconfig-and-the-fontconfig-stared-back-at-me/&quot;&gt;I stared into the fontconfig, and the fontconfig stared back at me&lt;/a&gt; - Posted: May 20, 2015 – Retrieved: Apr 17, 2022:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Some hot parting tips&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-cache&lt;/code&gt; will force fontconfig to pick up any changes.  There’s a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-f&lt;/code&gt;,
but in all my fighting with fontconfig it never once made a difference.&lt;/p&gt;

&lt;p&gt;As far as I can tell, there is no reason to ever run sudo &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-cache -vf&lt;/code&gt;.
This has been floating around the Internet for years, but it seems to be
apocryphal copy/paste.  You don’t need to flush root’s fontconfig cache
unless you’re running GUI stuff as root.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-match &amp;lt;font&amp;gt;&lt;/code&gt; will tell you what font will be used in practice.
You might think that’s what &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-query&lt;/code&gt; does, and you’d be wrong.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-query&lt;/code&gt;’s primary use is to produce bizarre error messages when you
accidentally use it instead of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-match&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;It is really fxxxing difficult to figure out what font will be used for
a specific glyph.  There are two approaches:&lt;/p&gt;

&lt;p&gt;1. Do it in a [web] browser.  Make a URL like this (that is, enter it in the
browser’s address bar):
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;data:text/html,&amp;lt;meta charset=&quot;utf8&quot;&amp;gt;&amp;lt;p style=&quot;font-family: monospace;&quot;&amp;gt;☺&amp;lt;/p&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Then pop open your dev tools, and look for where it tells you the fonts
that are actually being used.  Firefox’s Inspector has a dedicated “fonts”
tab in the panel on the right; Chromium’s Elements lists fonts at the
bottom of the “computed” tab.&lt;/p&gt;

&lt;p&gt;Fair warning: this is one level removed from fontconfig, because CSS font
rules may interfere.  This bit me above when I tried to confirm my new
cursive font in Firefox!&lt;/p&gt;

&lt;p&gt;Another warning: while Firefox picks up fontconfig changes more or less
instantly (after an &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fc-cache&lt;/code&gt;), Chromium does not.  Worse, Chromium seems
to outright ignore fontconfig when it feels like it, such as when it used
a sans serif Japanese font for text styled as serif.&lt;/p&gt;

&lt;p&gt;2. You can also do this nonsense in a terminal:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DISPLAY=:0 FC_DEBUG=4 pango-view --font=monospace -t ☺ | grep family:&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;My note:&lt;/strong&gt; -&amp;gt; for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;csh/tcsh&lt;/code&gt;:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;env DISPLAY=:0 FC_DEBUG=4 pango-view --font=monospace -t ☺ | grep family:&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pango-view&lt;/code&gt; is a tiny program that just pops open a window containing
some text in a particular font.  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FC_DEBUG&lt;/code&gt; is an environment variable to
make fontconfig spit out mountains of fxxxing text on stdout.  The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;grep&lt;/code&gt;
cuts it down to something a little more manageable.  Most likely the last
family you see listed is the font actually being used to render your
favourite glyph.&lt;/p&gt;

&lt;p&gt;If you’re really curious how the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;match&amp;gt;&lt;/code&gt; blocks work, good news:
they are the one thing the &lt;a href=&quot;http://www.freedesktop.org/software/fontconfig/fontconfig-user.html&quot;&gt;fontconfig docs&lt;/a&gt; actually kind of explain.
And of course your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/fonts/conf.d&lt;/code&gt;
(&lt;strong&gt;my note:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/local/etc/fonts/conf.d&lt;/code&gt; on FreeBSD) is probably full
of real-world practical examples.&lt;/p&gt;

&lt;p&gt;…&lt;/p&gt;

&lt;p&gt;From the same blog:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;I haven’t put my fontconfig font config (…) in my
&lt;a href=&quot;https://github.com/eevee/rc/&quot;&gt;rc.git&lt;/a&gt;; it seems pretty specific to my
desktop’s particular setup.
But here’s &lt;a href=&quot;https://gist.github.com/eevee/ba231c1b9b64e6ced70d&quot;&gt;the whole thing in a gist&lt;/a&gt;, if you’re interested.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;p&gt;[1] A nice overview and discussion about UTF-8, UTF-16 and UTF-32 on StackOverflow:  &lt;a href=&quot;https://stackoverflow.com/questions/496321/utf-8-utf-16-and-utf-32&quot;&gt;UTF-8, UTF-16, and UTF-32&lt;/a&gt; (Posted on Jan 30, 2009; Retrieved on Apr 17, 2022)&lt;/p&gt;

&lt;p&gt;[2] From a FreeBSD Forum post started on Dec 24, 2014 &lt;a href=&quot;https://forums.freebsd.org/threads/how-do-i-type-in-special-characters-such-as-in-the-terminal-in-vi.49659/&quot;&gt;How do I type in special characters, such as ∞ in the terminal in vi?&lt;/a&gt;, 
post #3 &lt;a href=&quot;https://forums.FreeBSD.org/threads/how-do-i-type-in-special-characters-such-as-in-the-terminal-in-vi.49659/post-277491&quot;&gt;https://forums.FreeBSD.org/threads/how-do-i-type-in-special-characters-such-as-in-the-terminal-in-vi.49659/post-277491&lt;/a&gt; (Retrieved on Apr 17, 2022):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Which vi?  vi on Linux is just a soft link to Vim.  On BSDs vi is 
symbolic link to nvi (new vi) which is a re-implementation of the 
“classic Berkeley vi”.  “Classical Berkeley vi” has multiple versions 
IIRC one of which is personal copy of Bill Joy.  Solaris’ version of vi 
could also be considered classical as well as traditional vi 
&lt;a href=&quot;http://ex-vi.sourceforge.net/&quot;&gt;http://ex-vi.sourceforge.net/&lt;/a&gt;. 
Reading documentation of traditional vi project is a good start.&lt;/p&gt;

  &lt;p&gt;To make matters more confusing BSD projects continue to use nvi 
version 1.79 due to licensing issues between Berkeley Database 1.85 and 
the later versions by Sleepycat Software.  nvi has a support for Unicode 
but I am not sure if the version 1.79 includes or not as I have never 
used Unicode with nvi.
Now &lt;a href=&quot;https://forums.freebsd.org/members/scottro.1587/&quot;&gt;scottro&lt;/a&gt; made 
a major mistake mentioning Unicode as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$\infty$&lt;/code&gt; as written in TeX is 
extended ASCII character and one doesn’t need Unicode to type it. 
I do not know how would you type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$\infty$&lt;/code&gt; in nvi as a professional 
mathematician I have never seen any mathematical symbols or mathematical 
text typing without serious text typing system such as TeX or Troff. 
TeX is de-facto standard for typing mathematics adopted since 
1979 by AMS.  Troff uses mathematical pre-processor and is definitely 
able to produce all special mathematical characters.  On the web we use 
MathJax, a cross-browser JavaScript library that displays in web, 
using MathML, LaTeX and ASCIIMathML markup to write mathematics.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;[3] Retrieved on Apr 17, 2022: &lt;br /&gt;
    &lt;a href=&quot;https://tea.ourproject.org/&quot;&gt;TEA - text editor&lt;/a&gt;    &lt;br /&gt;
    &lt;a href=&quot;https://en.wikipedia.org/wiki/TEA_%28text_editor%29&quot;&gt;TEA (text editor) - Wikipedia&lt;/a&gt;   &lt;br /&gt;
    &lt;a href=&quot;https://www.linuxinsider.com/story/tea-a-smooth-text-editor-that-hits-the-sweet-spot-74677.html&quot;&gt;TEA: A Smooth Text Editor That Hits the Sweet Spot&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[4] Retrieved on Apr 17, 2022:  &lt;br /&gt;
    &lt;a href=&quot;https://www.libreoffice.org/&quot;&gt;LibreOffice&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[5] Retrieved on Apr 17, 2022:  &lt;br /&gt;
    &lt;a href=&quot;http://www.abisource.com/&quot;&gt;AbiWord&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;[6] Retrieved on Apr 17, 2022:  &lt;br /&gt;
    &lt;a href=&quot;https://stackoverflow.com/questions/30851728/create-unicode-character-with-pack&quot;&gt;Create unicode character with pack&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sun, 17 Apr 2022 09:14:33 -0700</pubDate>
        <link>http://localhost:4000/font/freebsd/unix/x11/xorg/dotfiles/2022/04/17/x-fonts.html</link>
        <guid isPermaLink="true">http://localhost:4000/font/freebsd/unix/x11/xorg/dotfiles/2022/04/17/x-fonts.html</guid>
        
        
        <category>font</category>
        
        <category>freebsd</category>
        
        <category>unix</category>
        
        <category>x11</category>
        
        <category>xorg</category>
        
        <category>dotfiles</category>
        
      </item>
    
      <item>
        <title>FVWM - F Virtual Window Manager</title>
        <description>&lt;hr /&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo pkg install fvwm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;About FVWM - from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pkg info --regex --full fvwm&lt;/code&gt; 3 &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;/&lt;sub&gt;4&lt;/sub&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt; &lt;br /&gt;
Replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mydotfiles...&lt;/code&gt; with
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fetch https://zensites.net/fvwm/guide/fvwm-guide-icons.tar.bz2&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cp -rf \
 /mnt/usbflashdrive/mydotfiles/FVWM.freebsd.lenovo.x280.2022_07_10_2200/THEME-2-ARCTIC/.fvwm/* \
 ~/.fvwm/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ grep -n icons ~/.fvwm/config
36:#   2. Place all icons in this directory:
37:#        /usr/local/share/icons/gnant
38:#   3. It might take a couple of minutes for some icons in the dock
40:#      clock icons.
49:SetEnv  fvwm_icon               /usr/local/share/icons/$[fvm_gnome_icon_theme]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ grep -n fvm_gnome_icon_theme ~/.fvwm/config
48:SetEnv  fvm_gnome_icon_theme    gnant
49:SetEnv  fvwm_icon               /usr/local/share/icons/$[fvm_gnome_icon_theme]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fetch https://strog.org/files/gnant-0.2.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ tar xf gnant-0.2.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mv gnant /usr/local/share/icons/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ rm -i gnant-0.2.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ fetch https://zensites.net/fvwm/guide/fvwm-guide-icons.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ tar xf fvwm-guide-icons.tar.bz2 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh
total 198
drwxr-xr-x   3 dusko  wheel     4B Apr 16 08:25 .
drwxrwxrwt  37 root   wheel   570B Apr 16 08:23 ..
drwxr-xr-x   7 dusko  wheel     8B Aug  5  2004 .fvwm
-rw-r--r--   1 dusko  wheel    73K Jan 14  2008 fvwm-guide-icons.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh .fvwm/
total 20
drwxr-xr-x  7 dusko  wheel     8B Aug  5  2004 .
drwxr-xr-x  3 dusko  wheel     4B Jul 11 19:25 ..
-rw-r--r--  1 dusko  wheel    17K Aug  5  2004 fvwm2rc-guide
drwxr-xr-x  5 dusko  wheel     5B Aug  5  2004 icons
drwxr-xr-x  5 dusko  wheel     5B Aug  5  2004 images
drwxr-xr-x  2 dusko  wheel     2B Aug  4  2004 screenshot
drwxr-xr-x  2 dusko  wheel     2B Aug  4  2004 scripts
drwxr-xr-x  2 dusko  wheel     2B Aug  4  2004 tmp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh .fvwm/icons/
total 35
drwxr-xr-x  5 dusko  wheel     5B Aug  5  2004 .
drwxr-xr-x  7 dusko  wheel     8B Aug  5  2004 ..
drwxr-xr-x  2 dusko  wheel    10B Aug  5  2004 48x48
drwxr-xr-x  2 dusko  wheel    28B Aug  5  2004 menu
drwxr-xr-x  2 dusko  wheel     7B Aug  5  2004 mini
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo cp -rf .fvwm/icons/menu /usr/local/share/icons/gnant/
$ sudo cp -rf .fvwm/icons/mini /usr/local/share/icons/gnant/
$ sudo cp -rf .fvwm/icons/48x48/* /usr/local/share/icons/gnant/48x48/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ rm -rf .fvwm/
$ rm -i fvwm-guide-icons.tar.bz2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% sudo pkg install rox-filer
% sudo pkg install 3ddesktop
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;pre&gt;&lt;code class=&quot;language-`&quot;&gt;% pkill Xorg
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Start X:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% exec xinit 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Alternatively:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ exec startx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;p&gt;[1] From &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pkg info --regex --full fvwm&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;WWW            : http://www.fvwm.org/
Comment        : Popular virtual window manager for X

Description    :
Fvwm is a very famous window manager for X, which provides a
virtual/multiple disjoint desktop, a 3-D look for windows decorations,
shaped/color icons. It gives a very good emulation of mwm. A nice
button-bar can be used to provide convenient access to frequently used
functions or programs.

WWW: http://www.fvwm.org/

Jason C. Wells
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From &lt;a href=&quot;https://www.fvwm.org/&quot;&gt;https://www.fvwm.org/&lt;/a&gt; (Retrieved on Apr 16, 2022):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Fvwm is a virtual window manager for the X windows system. It was 
originally a feeble fork of TWM by Robert Nation in 1993 (fvwm history), 
and has evolved into the fantastic, fabulous, famous, flexible, and so on, 
window manager we have today.

Fvwm is ICCCM-compliant and highly configurable. Starting from a minimal 
configuration, Fvwm can be configured with both internal tools and third 
party software to customize most aspects of a desktop.

This site is an archive of documentation for Fvwm version 2.6.x, which is 
the current frozen release. For information about the development of Fvwm 
version 3, check out fvwmorg/fvwm3 on GitHub.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 16 Apr 2022 08:12:34 -0700</pubDate>
        <link>http://localhost:4000/2022/04/16/fvwm.html</link>
        <guid isPermaLink="true">http://localhost:4000/2022/04/16/fvwm.html</guid>
        
        
      </item>
    
      <item>
        <title>Converting Traditional sysV Init Scripts to systemd Unit Files</title>
        <description>&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;References:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;(All references retrieved on Apr 9, 2022)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://0pointer.de/blog/projects/systemd-for-admins-3.html&quot;&gt;How Do I Convert A SysV Init Script Into A systemd Service File? (systemd for Administrators, Part III)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.redhat.com/en/blog/converting-traditional-sysv-init-scripts-red-hat-enterprise-linux-7-systemd-unit-files&quot;&gt;Converting traditional sysV init scripts to Red Hat Enterprise Linux 7 systemd unit files&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.golinuxcloud.com/create-systemd-service-example/&quot;&gt;Create systemd service in Linux [Explained with Example]&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 09 Apr 2022 09:03:31 -0700</pubDate>
        <link>http://localhost:4000/systemd/linux/howto/cli/terminal/shell/rhel/centos/sysadmin/2022/04/09/convert-sysvinit-to-systemd-service.html</link>
        <guid isPermaLink="true">http://localhost:4000/systemd/linux/howto/cli/terminal/shell/rhel/centos/sysadmin/2022/04/09/convert-sysvinit-to-systemd-service.html</guid>
        
        
        <category>systemd</category>
        
        <category>linux</category>
        
        <category>howto</category>
        
        <category>cli</category>
        
        <category>terminal</category>
        
        <category>shell</category>
        
        <category>rhel</category>
        
        <category>centos</category>
        
        <category>sysadmin</category>
        
      </item>
    
      <item>
        <title>TWM - Tab Window Manager for the X Window System</title>
        <description>&lt;p&gt;OS: FreeBSD 13.0  &lt;br /&gt;
Shell: csh/tcsh&lt;/p&gt;

&lt;hr /&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% cat ~/.twmrc
RestartPreviousState      # Reiconify iconified windows on startup
UsePPosition        &quot;on&quot;  # Use program-specified size hints accepted
NoTitle                   # No titlebars
BorderWidth         1     # Number of pixels for border around entire window
DontMoveOff               # Disallow moving windows off the visible screen
IconifyByUnmapping        # Iconifying a window sends it to the Icon Manager
AutoRelativeResize        # Don&apos;t wait until the window edge is crossed
NoGrabServer
RandomPlacement

IconManagerFont           &quot;a14&quot;
IconRegion                &quot;90x44-0+0&quot; North East 40 30 
IconManagerGeometry       &quot;90x44-0+0&quot; 1

IconManagerDontShow
{
  &quot;xclock&quot; &quot;xload&quot;
}

Color
{
    BorderColor &quot;red&quot;
    {
      &quot;XTerm&quot; &quot;red&quot;       # Active xterm window border: red
    }

    BorderColor           &quot;yellow&quot;
    BorderTileBackground  &quot;yellow&quot;
    BorderTileForeground  &quot;yellow&quot;

    DefaultBackground     &quot;rgb:2/a/9&quot;
    DefaultForeground     &quot;gray85&quot;
    TitleBackground       &quot;rgb:2/a/9&quot;
    TitleForeground       &quot;gray85&quot;
    MenuBackground        &quot;rgb:2/a/9&quot;
    MenuForeground        &quot;gray85&quot;
    MenuBorderColor       &quot;slategrey&quot;
    MenuTitleBackground   &quot;gray70&quot;
    MenuTitleForeground   &quot;rgb:2/a/9&quot;
    IconBackground        &quot;rgb:2/a/9&quot;
    IconForeground        &quot;gray85&quot;
    IconBorderColor       &quot;gray85&quot;

    IconManagerHighlight  &quot;white&quot;

    IconManagerBackground &quot;rgb:2/a/9&quot;
    {
      &quot;XTerm&quot;             &quot;#ff595e&quot;
      &quot;tea&quot;               &quot;#1982c4&quot;
      &quot;KeePassXC&quot;         &quot;#ffca3a&quot;
      &quot;Thunderbird&quot;       &quot;#6a4c93&quot;
      &quot;Firefox&quot;           &quot;#8ac926&quot; 
      &quot;LibreOffice&quot;       &quot;#deff0a&quot;
      &quot;soffice.bin&quot;       &quot;#deff0a&quot;
      &quot;Zathura&quot;           &quot;#be0aff&quot;
    }

    IconManagerForeground &quot;gray85&quot;
    {
      &quot;XTerm&quot;             &quot;#fae0e4&quot;
      &quot;tea&quot;               &quot;#84DE02&quot;
      &quot;KeePassXC&quot;         &quot;#219ebc&quot; 
      &quot;Thunderbird&quot;       &quot;#ff595e&quot;
      &quot;Firefox&quot;           &quot;#ffff3f&quot;
      &quot;LibreOffice&quot;       &quot;#ff595e&quot;
      &quot;soffice.bin&quot;       &quot;#ff595e&quot;
      &quot;Zathura&quot;           &quot;#0aff99&quot;
    }
}

Cursors
{
  Frame     &quot;left_ptr&quot;
  Title     &quot;left_ptr&quot;
  Icon      &quot;left_ptr&quot;
  IconMgr   &quot;left_ptr&quot;
  Move      &quot;fleur&quot;
  Resize    &quot;fleur&quot;
  Menu      &quot;hand1&quot;
  Button    &quot;hand2&quot;
  Wait      &quot;clock&quot;
  Select    &quot;dot&quot;
  Destroy   &quot;pirate&quot;
}

# ----  Mouse and keyboard bindings  ----
# Mouse:     Button1=left, Button2=middle, Button3=right
# Keyboard:  m=meta (alt), c=ctrl, s=shift, m4=mod4 (Win)

Button1 =   : root    : f.menu &quot;defops&quot;
Button1 =   : iconmgr : f.iconify
Button1 = m : window  : f.move      # Alt + left mouse button
Button3 = m : window  : f.resize    # Alt + right mouse button

&quot;s&quot; =     m : all : f.showiconmgr   # Show the Icon Manager  (Alt + s)
&quot;s&quot; = s | m : all : f.hideiconmgr   # Hide the Icon Manager  (Alt + Shift + s)
&quot;r&quot; =     m : all : f.raiselower    # Raise window if behind (Alt + r)
&quot;v&quot; =     m : all : f.iconify       # &quot;Minimize&quot; window      (Alt + v)

# Cycle through windows with vi(1)-style key bindings 
# NOTE: For best results, make sure that the Icon Manager is *not* hidden
#       when the Icon Manager is hidden, only &quot;l&quot; and &quot;j&quot; work 
&quot;h&quot; =     m : all : f.backiconmgr  # previous column
&quot;l&quot; =     m : all : f.forwiconmgr  # next column
&quot;k&quot; =     m : all : f.upiconmgr    # previous row
&quot;j&quot; =     m : all : f.downiconmgr  # next row

# Use keyboard arrow keys to change the input focus between windows
# NOTE: For best results, make sure that the Icon Manager is *not* hidden
&quot;Left&quot;  = m : all : f.backiconmgr  # previous column
&quot;Right&quot; = m : all : f.forwiconmgr  # next column
&quot;Up&quot;    = m : all : f.upiconmgr    # previous row
&quot;Down&quot;  = m : all : f.downiconmgr  # next row

# Show time and date (local and UTC):  Press Ctrl + Alt + t
&quot;t&quot; =  m | c: all : f.exec &quot;(date; echo &apos;&apos;; date -u) | \
/usr/local/bin/xmessage -bg \&quot;#DE3163\&quot; -fg \&quot;#F6EABE\&quot; -rv -fn \
\&quot;-b&amp;amp;h-lucidatypewriter-bold-r-normal-sans-26-190-100-100-m-159-iso10646-1\&quot; \
-geometry -0+0 -buttons OK:1 -default OK -file - &amp;amp;&quot;

# Display virtual desktop number:      Press Ctrl + Alt + d
&quot;d&quot; =  m | c: all : f.exec &quot;(vdesk) | \
/usr/local/bin/xmessage -bg \&quot;#DE3163\&quot; -fg \&quot;#F6EABE\&quot; -rv -fn \
\&quot;-b&amp;amp;h-lucidatypewriter-bold-r-normal-sans-26-190-100-100-m-159-iso10646-1\&quot; \
-geometry -0+0 -buttons &apos; &apos; -default OK -file - &amp;amp;&quot;

# Launch dmenu with Alt + p
&quot;p&quot; = m      : all : f.exec &quot;/usr/local/bin/dmenu_run&quot;

&quot;i&quot; = m      : all : f.identify   # Alt + i
&quot;d&quot; = m      : all : f.delete     # For closing e.g. &quot;About&quot; windows
&quot;h&quot; = s | m4 : all : f.leftzoom   # [Shift + mod4 (Win)] + h
&quot;l&quot; = s | m4 : all : f.rightzoom  # [Shift + mod4 (Win)] + l
&quot;k&quot; = s | m4 : all : f.topzoom    # [Shift + mod4 (Win)] + k
&quot;j&quot; = s | m4 : all : f.bottomzoom # [Shift + mod4 (Win)] + j
&quot;f&quot; = s | m4 : all : f.fullzoom   # [Shift + mod4 (Win)] + o
&quot;m&quot; = s | m4 : all : f.zoom       # [Shift + mod4 (Win)] + m &amp;lt;- Zoom vertically
&quot;c&quot; = s | m4 : all : f.circledown # [Shift + mod4 (Win)] + c
&quot;u&quot; = s | m4 : all : f.circleup   # [Shift + mod4 (Win)] + u

# QUIT menu
# Defined here, used in the &quot;Main Menu&quot; (below),
#      i.e.  it&apos;s a sub-menu of the Main Menu
menu &quot;quitmenu&quot;
{
 &quot;Really Quit?&quot;   f.title
 &quot;No&quot;             f.nop
 &quot;Yes&quot;            f.quit
}

# Add a menu with the usual things
menu &quot;defops&quot;
{
  &quot;Twm&quot;           f.title
  &quot;Iconify&quot;       f.iconify
  &quot;Resize&quot;        f.resize
  &quot;Move&quot;          f.move
  &quot;Raise&quot;         f.raise
  &quot;Lower&quot;         f.lower
  &quot;&quot;              f.nop
  &quot;Focus&quot;         f.focus
  &quot;Unfocus&quot;       f.unfocus
  &quot;Show Iconmgr&quot;  f.showiconmgr
  &quot;Hide Iconmgr&quot;  f.hideiconmgr
  &quot;&quot;              f.nop
  &quot;Xterm&quot;         f.exec &quot;exec xterm &amp;amp;&quot;
  &quot;&quot;              f.nop
  &quot;Kill&quot;          f.destroy
  &quot;Delete&quot;        f.delete
  &quot;&quot;              f.nop
  &quot;Restart&quot;       f.restart
  &quot;Exit&quot;          f.menu &quot;quitmenu&quot;
}

# Virtual desktops with vdesk  ---- http://offog.org/code/vdesk.html -----

function &quot;set-desktop-1&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 1&quot;
}
    
function &quot;set-desktop-2&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 2&quot;
}
  
function &quot;set-desktop-3&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 3&quot;
}

function &quot;set-desktop-4&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 4&quot;
}

function &quot;set-desktop-5&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 5&quot;
}

function &quot;set-desktop-6&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 6&quot;
}

function &quot;set-desktop-7&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 7&quot;
}

function &quot;set-desktop-8&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 8&quot;
}

function &quot;set-desktop-9&quot;
{
   f.exec &quot;/usr/local/bin/vdesk 0 `xwininfo -tree -root | grep xclock | awk &apos;{print $1}&apos;`&quot;
   f.exec &quot;vdesk 9&quot;
}

function &quot;desktop-back&quot;
{
   f.exec &quot;A=$((`vdesk`-1)); if [ $A = 0 ] ; then A=9 ; fi ; vdesk $A&quot;
}

# To switch to one of nine virtual desktop: Alt + [1-9]:
&quot;1&quot;     =     m : all : f.function &quot;set-desktop-1&quot;
&quot;2&quot;     =     m : all : f.function &quot;set-desktop-2&quot;
&quot;3&quot;     =     m : all : f.function &quot;set-desktop-3&quot;
&quot;4&quot;     =     m : all : f.function &quot;set-desktop-4&quot;
&quot;5&quot;     =     m : all : f.function &quot;set-desktop-5&quot;
&quot;6&quot;     =     m : all : f.function &quot;set-desktop-6&quot;
&quot;7&quot;     =     m : all : f.function &quot;set-desktop-7&quot;
&quot;8&quot;     =     m : all : f.function &quot;set-desktop-8&quot;
&quot;9&quot;     =     m : all : f.function &quot;set-desktop-9&quot;

# To cycle forward through virtual desktops:
#     Ctrl + Meta (Win key) + right arrow key
&quot;Right&quot; = c | m : all : f.function &quot;desktop-forward&quot;
# To cycle backwards through virtual desktops:
#     Ctrl + Meta (Win key) + left arrow key
&quot;Left&quot;  = c | m : all : f.function &quot;desktop-back&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% cat ~/.xinitrc
xrdb -load $HOME/.Xresources 

xsetroot -solid slategrey
xset b off

# Add fonts
for m in `ls /usr/local/share/fonts/`; do
    if [ -d &quot;/usr/local/share/fonts/$m&quot; ]; then
        xset fp+ &quot;/usr/local/share/fonts/$m&quot;
    fi
done

exec twm &amp;gt; /tmp/twmrclog 2&amp;gt;&amp;amp;1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you want to have a clock or clocks, add one or more of the following
four lines to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.xinitrc&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;exec /usr/local/bin/xclock -digital -strftime &quot;Vancouver: %a %d %b %H:%M:%S&quot; \
  -update 1 -face mono:size=10 -bg &quot;#002020&quot; -fg &quot;red&quot; -geometry -0-2 &amp;amp;
exec env TZ=Europe/Belgrade xclock -digital -strftime \
  &quot;Belgrade: %a %d %b %H:%M&quot; -face mono:size=10 -bg &quot;#002020&quot; -fg &quot;gold&quot; \
  -geometry -256-2 &amp;amp;
exec env TZ=UTC /usr/local/bin/xclock -digital -strftime \
  &apos;UTC: %a %d %b %H:%M&apos; -face mono:size=10 -bg &apos;#002020&apos; -fg &apos;#f6eabe&apos; \
  -geometry -480-2 &amp;amp; 
exec env TZ=GMT /usr/local/bin/xclock -digital -strftime \
  &apos;GMT: %a %d %b %H:%M&apos; -face mono:size=10 -bg &apos;#002020&apos; -fg &apos;#aaaaaa&apos; \
  -geometry -664-2 &amp;amp; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you want to have xload, you first need to install it (with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo pkg install xload&lt;/code&gt;), and after that add this line to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;~/.xinitrc&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;exec xload -bg steelblue -fg &apos;#001013&apos; -nolabel -geometry 224x33-840-2 &amp;amp;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;X&lt;/code&gt; with:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% exec startx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% exec xinit 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;References:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Man pages:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;twm(1) - Tab Window Manager for the X Window System&lt;/li&gt;
  &lt;li&gt;xterm(1) - terminal emulator for X&lt;/li&gt;
  &lt;li&gt;xwininfo(1) - window information utility for X&lt;/li&gt;
  &lt;li&gt;Xsecurity(7) - X display access control, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.Xauthority&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Xserver(1) - X Window System display server&lt;/li&gt;
  &lt;li&gt;X(7) - Keyboards, modifiers and keysym - section KEYBOARDS&lt;/li&gt;
  &lt;li&gt;Xorg(1) - X11R7 X server&lt;/li&gt;
  &lt;li&gt;XOrgFoundation(7) -  X.Org Foundation information&lt;/li&gt;
  &lt;li&gt;xinit(1) - X Window System initializer&lt;/li&gt;
  &lt;li&gt;x11perf(1) - X11 server performance test program&lt;/li&gt;
  &lt;li&gt;xauth(1) - X authority file utility&lt;/li&gt;
  &lt;li&gt;showrgb(1) - display an rgb color-name database&lt;/li&gt;
  &lt;li&gt;xkbwatch(1) - XKB extension user utility&lt;/li&gt;
  &lt;li&gt;xkbevd(1) - XKB event daemon&lt;/li&gt;
  &lt;li&gt;xkbvleds(1) - display the state of LEDs on an XKB keyboard&lt;/li&gt;
  &lt;li&gt;xkill(1) - kill a client by its X resource&lt;/li&gt;
  &lt;li&gt;xlsatoms(1) - list interned atoms defined on server&lt;/li&gt;
  &lt;li&gt;xprop(1) - property displayer for X&lt;/li&gt;
  &lt;li&gt;xmodmap(1) - utility for modifying keymaps and pointer button mappings in X&lt;/li&gt;
  &lt;li&gt;xrdb(1) - X server resource database utility&lt;/li&gt;
  &lt;li&gt;xset(1) - user preference utility for X&lt;/li&gt;
  &lt;li&gt;xrefresh(1) - refresh all or part of an X screen&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Retrieved on Apr 3, 2022:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.custompc.plus.com/twm/twmrc.htm&quot;&gt;Graham’s TWM Page!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.custompc.plus.com/twm2/Grahams_TWM_page2.html&quot;&gt;Graham’s TWM Page! - Updated for 2021&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://offog.org/code/vdesk/&quot;&gt;vdesk -  a virtual desktop manager&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;word-cloud&quot;&gt;Word Cloud&lt;/h3&gt;

&lt;p&gt;X(7), libX11, modifier, keysum, the vmodmap array, locale, 
XkbLatchModifiers(3)&lt;/p&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sun, 03 Apr 2022 09:27:31 -0700</pubDate>
        <link>http://localhost:4000/wm/x11/xorg/freebsd/unix/dotfiles/2022/04/03/twm.html</link>
        <guid isPermaLink="true">http://localhost:4000/wm/x11/xorg/freebsd/unix/dotfiles/2022/04/03/twm.html</guid>
        
        
        <category>wm</category>
        
        <category>x11</category>
        
        <category>xorg</category>
        
        <category>freebsd</category>
        
        <category>unix</category>
        
        <category>dotfiles</category>
        
      </item>
    
      <item>
        <title>How To Setup Two Separate Bridges for a QEMU Guest with Two NICs Connected to Two Different Networks</title>
        <description>&lt;hr /&gt;
&lt;p&gt;Host OS: RHEL 8.5 - Shell: csh  &lt;br /&gt;
Guest OS: CentOS Linux 7.9 - Shell: bash&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;em&gt;Assumptions:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The host server was already configured for virtualization.  It had the 
following packages installed on it:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ipxe-roms-qemu, libvirt-daemon-driver-qemu, qemu-guest-agent, qemu-img, 
qemu-kvm, qemu-kvm-block-curl, qemu-kvm-block-gluster, qemu-kvm-block-iscsi, 
qemu-kvm-block-rbd, qemu-kvm-block-ssh, qemu-kvm-common, qemu-kvm-core,
libvirt, virt-install, virt-manager, libguestfs-tools, libguestfs-gfs2, 
libguestfs-rescue, ibguestfs-rsync libguestfs-xfs,
virt-dib, virt-v2v, virt-p2v-maker, virt-viewer, virt-who, virt-top, virtio-win

minicom 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;about-bridge-switch-bridge-mode-of-qemu-bridged-networking-tun-connection-tap-mode-tap-device-nat-mode&quot;&gt;About Bridge Switch, Bridge Mode of QEMU, Bridged Networking, TUN Connection, TAP Mode (TAP Device), NAT Mode&lt;/h3&gt;

&lt;p&gt;A &lt;strong&gt;bridge&lt;/strong&gt; is a &lt;strong&gt;network switch&lt;/strong&gt; but implemented in software.&lt;/p&gt;

&lt;p&gt;From the &lt;a href=&quot;https://wiki.archlinux.org/index.php/Network_bridge&quot;&gt;Arch Wiki&lt;/a&gt; (Retrieved on Apr 2, 2022):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;A &lt;strong&gt;bridge&lt;/strong&gt; is a piece of software used to &lt;strong&gt;unite&lt;/strong&gt; two or 
more &lt;strong&gt;network segments&lt;/strong&gt;.&lt;/p&gt;

  &lt;p&gt;A bridge behaves like a virtual network &lt;strong&gt;switch&lt;/strong&gt;, working 
transparently (other machines do not need to know about its 
existence).  Any real devices (e.g. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eth0&lt;/code&gt;) and virtual devices
(e.g. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tap0&lt;/code&gt;) can be connected to it.&lt;/p&gt;

  &lt;p&gt;[…]   &lt;br /&gt;
When the bridge is fully set up, it can be &lt;strong&gt;assigned an IP address&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Or as per &lt;a href=&quot;https://wiki.linuxfoundation.org/networking/bridge&quot;&gt;Bridge - The Linux Foundation Wiki&lt;/a&gt; (Retrieved on Apr 2, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;[…] a bridge connects two or more physical Ethernets together to 
form one &lt;strong&gt;bigger (logical) Ethernet&lt;/strong&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;When you install &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;libvirt&lt;/code&gt;, a &lt;strong&gt;virtual bridge&lt;/strong&gt; (aka &lt;strong&gt;virtual network 
switch&lt;/strong&gt;), the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt;, is automatically created.  When you later 
create virtual machines, they connect to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; bridge.&lt;/p&gt;

&lt;p&gt;By default, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; uses &lt;strong&gt;NAT&lt;/strong&gt; mode and gets assigned an 
IP address 192.168.122.1.  Also, it can provide DHCP service for 
other virtual interfaces that connect to it.&lt;/p&gt;

&lt;p&gt;From the &lt;a href=&quot;https://wiki.archlinux.org/title/Network_bridge&quot;&gt;Arch Wiki&lt;/a&gt;: 
a bridge is a network switch but implemented in software.  Any real 
devices (e.g. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eth0&lt;/code&gt;) and virtual devices (e.g. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tap0&lt;/code&gt;) can be connected 
to it.&lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;https://wiki.qemu.org/Documentation/Networking/NAT&quot;&gt;NAT Networking - QEMU Documentation&lt;/a&gt; (Retrieved on Apr 2, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;NAT &lt;br /&gt;
Configuring Network Address Translation (NAT) is a useful way to network 
virtual machines in a desktop environment (particularly, when using 
wireless networking).  A NAT network will allow your guests to fully 
access the network, allow networking between your host and guests, but 
&lt;strong&gt;prevent the guests&lt;/strong&gt; from being directly &lt;strong&gt;visible&lt;/strong&gt; on the physical network.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;em&gt;References:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://unix.stackexchange.com/questions/523245/whats-the-function-of-virbr0-and-virbr0-nic&quot;&gt;What’s the function of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0-nic&lt;/code&gt;?&lt;/a&gt; &lt;br /&gt;
(Retrieved on Apr 2, 2022)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://listman.redhat.com/archives/libvirt-users/2012-September/msg00038.html&quot;&gt;[libvirt-users] virtual networking - virbr0-nic interface&lt;/a&gt; &lt;br /&gt;
(Retrieved on Apr 2, 2022)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://unix.stackexchange.com/questions/378264/what-is-virtual-bridge-with-nic-in-the-end-of-name/444863#444863&quot;&gt;What is virtual bridge with -nic in the end of name&lt;/a&gt; &lt;br /&gt;
(Retrieved on Apr 2, 2022)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli
eno1: connected to eno1
[...]
eno2: connected to eno2
[...]
virbr0: connected (externally) to virbr0
        &quot;virbr0&quot;
        bridge, 52:54:00:11:22:33, sw, mtu 1500
        inet4 192.168.122.1/24
        route4 192.168.122.0/24
eno3: disconnected
[...]
eno4: disconnected
[...]
lo: unmanaged
        &quot;lo&quot;
        loopback (unknown), 00:00:00:00:00:00, sw, mtu 65536

virbr0-nic: unmanaged
        &quot;virbr0-nic&quot;
        tun, 52:54:00:11:22:33, sw, mtu 1500

DNS configuration:
        servers: 208.67.222.222, 208.67.220.220  &amp;lt;-- Will list your DNS servers
        interface: eno1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show virbr0
GENERAL.DEVICE:               virbr0
GENERAL.TYPE:                 bridge
[...]
GENERAL.STATE:                100 (connected (externally))
GENERAL.CONNECTION:           virbr0
[...]
IP4.ADDRESS[1]:               192.168.122.1/24
IP4.GATEWAY:                  --
IP4.ROUTE[1]:                 dst = 192.168.122.0/24, nh = 0.0.0.0, mt = 0
IP6.GATEWAY:                  --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The network &lt;strong&gt;interface&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0-nic&lt;/code&gt; (virtual network interface) is not 
a bridge.  It is a regular Ethernet interface (although a virtual one, 
created with ip add type &lt;a href=&quot;https://man7.org/linux/man-pages/man4/veth.4.html&quot;&gt;veth&lt;/a&gt;).  It’s there so that the bridge has at least one interface beneath it to 
use its MAC address from.  It doesn’t pass real traffic since it’s not 
really connected to any physical device.
The bridge would work without it but then it could change its MAC address 
as interfaces enter and exit the bridge, and when the MAC of the bridge 
changes, external switches may be confused, making the host lose network 
for some time.&lt;/p&gt;

&lt;p&gt;According to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmcli device show&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip -details link show&lt;/code&gt; commands, 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0-nic&lt;/code&gt; virtual network interface is a &lt;strong&gt;TUN&lt;/strong&gt; device:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;GENERAL.DEVICE:               virbr0-nic
GENERAL.TYPE:                 tun
GENERAL.HWADDR:               52:54:00:11:22:33
GENERAL.MTU:                  1500
GENERAL.STATE:                10 (unmanaged)
GENERAL.CONNECTION:           --
GENERAL.CON-PATH:             --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip -details link show virbr0-nic | \
egrep -woi &quot;tun|tap|bridge|bridge_slave|vlan_tunnel&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;tun
tap
bridge_slave
vlan_tunnel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;IP forwarding &lt;a href=&quot;#footnotes&quot;&gt;¹&lt;/a&gt; was already enabled on this server:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo /sbin/sysctl --all | grep &apos;net.ipv4.ip_forward&apos;
net.ipv4.ip_forward = 1
net.ipv4.ip_forward_update_priority = 1
net.ipv4.ip_forward_use_pmtu = 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additional package that you need to install is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bridge-utils&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo dnf install bridge-utils
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It provides &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brctl&lt;/code&gt; tool.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo dnf whatprovides /usr/sbin/brctl
[...]
bridge-utils-1.5-9.el7.x86_64 : Utilities for configuring the linux 
                              : ethernet bridge
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ command -V brctl; type brctl; which brctl; whereis brctl
brctl is /usr/sbin/brctl
brctl is /usr/sbin/brctl
/usr/sbin/brctl
brctl: /usr/sbin/brctl /usr/share/man/man8/brctl.8.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brctl(8)&lt;/code&gt; tool is used for the Ethernet bridge administration. 
From its man page:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]
DESCRIPTION
    brctl is used to set up, maintain, and inspect the ethernet bridge 
    configuration in the linux kernel.

    An ethernet bridge is a device commonly used to connect different  
    networks of ethernets together, so that these ethernets will appear 
    as one ethernet to the participants.

    Each of the ethernets being connected corresponds to one physical
    interface in the bridge.  These individual ethernets are bundled into
    one bigger (&apos;logical&apos;) ethernet, this bigger ethernet corresponds to
    the bridge network interface.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently, this server has one bridge device (named virbr0) installed by 
the libvirt library so the output of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brctl show&lt;/code&gt; and  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brctl show virbr0&lt;/code&gt; 
is the same.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show 
bridge name     bridge id               STP enabled     interfaces
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show virbr0
bridge name     bridge id               STP enabled     interfaces
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;qemu-networking&quot;&gt;QEMU Networking&lt;/h2&gt;

&lt;p&gt;Two parts:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The front-end.  The virtual network device; e.g. a PCI network card
(aka NIC - network interface controller) that the guest sees.&lt;/li&gt;
  &lt;li&gt;The network back-end on the host side; that is, the interface that QEMU uses 
to exchange network packets with the outside (like other QEMU instances
or other real hosts in your intranet or the internet).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;QEMU supports networking by emulating some popular network cards
(aka NICs - network interface controllers) and establishing virtual
LANs (VLAN). There are four ways that QEMU guests can be connected:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;User mode (SLiRP)&lt;/li&gt;
  &lt;li&gt;Tap&lt;/li&gt;
  &lt;li&gt;Socket redirection&lt;/li&gt;
  &lt;li&gt;VDE networking&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;References:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.qemu.org/2018/05/31/nic-parameter/&quot;&gt;QEMU’s new -nic command line option&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://wiki.qemu.org/Documentation/Networking&quot;&gt;Networking - QEMU Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://en.wikibooks.org/wiki/QEMU/Networking&quot;&gt;Networking - QEMU on wikibooks.org&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The difference between &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-nic&lt;/code&gt; options of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu&lt;/code&gt; command:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net&lt;/code&gt; option can create either a front-end or a back-end (and also does other things)&lt;/li&gt;
  &lt;li&gt;the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev&lt;/code&gt; can only create a back-end&lt;/li&gt;
  &lt;li&gt;a single occurrence of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-nic&lt;/code&gt; creates both a front-end and a back-end&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;slirp-user-networking&quot;&gt;SLiRP (user networking)&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Provides access to the host’s network via NAT&lt;/li&gt;
  &lt;li&gt;It doesn’t support protocols other than TCP and UDP so e.g. ping and other ICMP utilities won’t work from the guest&lt;/li&gt;
  &lt;li&gt;A virtual DHCP server on 10.0.2.2&lt;/li&gt;
  &lt;li&gt;A virtual DNS server on 10.0.2.3&lt;/li&gt;
  &lt;li&gt;Gateway: 10.0.2.3&lt;/li&gt;
  &lt;li&gt;An IP address starting from 10.0.2.15&lt;/li&gt;
  &lt;li&gt;NO tap0 on the host&lt;/li&gt;
  &lt;li&gt;ssh from the guest to the host&lt;/li&gt;
  &lt;li&gt;By default it acts as a firewall and does not permit any incoming traffic&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;starting-a-qemu-vm-with-slirp-user-networking&quot;&gt;Starting a QEMU VM with SLiRP (User Networking)&lt;/h4&gt;

&lt;p&gt;With the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev&lt;/code&gt; option:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev user,id=network0 \
-device e1000,netdev=network0 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you don’t specify any network configuration options, then QEMU creates 
a SLiRP user network back-end and an appropriate virtual network device 
for the guest (e.g. an E1000 PCI card for most x86 PC guests):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Alternatively, you can use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net&lt;/code&gt; (&lt;a href=&quot;https://www.qemu.org/2018/05/31/nic-parameter/&quot;&gt;QEMU’s new -nic command line option&lt;/a&gt;) instead of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev&lt;/code&gt; option:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-net nic \
-net user \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;tap&quot;&gt;Tap&lt;/h3&gt;

&lt;h4 id=&quot;how-to-create-a-bridged-networking-tun-device-in-tap-mode-for-qemu-with-an-ip-address-provided-by-libvirts-bridge-virbr0&quot;&gt;How To Create a Bridged Networking (Tun Device in Tap Mode) for QEMU with an IP Address Provided by libvirt’s Bridge virbr0&lt;/h4&gt;

&lt;p&gt;References: &lt;br /&gt;
&lt;a href=&quot;https://wiki.qemu.org/Features/HelperNetworking&quot;&gt;Helper Networking&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Allows the guest to directly access the host’s network&lt;/li&gt;
  &lt;li&gt;ICMP utilities (e.g. ping) working&lt;/li&gt;
  &lt;li&gt;192.168.122.x (gw: 192.168.122.254)&lt;/li&gt;
  &lt;li&gt;tap0 on the host&lt;/li&gt;
  &lt;li&gt;IP address visible on the host’s network -&amp;gt; ssh from the guest to the host&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When you install the libvirt &lt;a href=&quot;#footnotes&quot;&gt;²&lt;/a&gt; package, a virtual network 
switch named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; is created.&lt;/p&gt;

&lt;p&gt;To allow unprivileged user access to the bridge from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt;
tool, create or modify &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/qemu-kvm/bridge.conf&lt;/code&gt; (in other Linux 
distributions, the location of this configuration file might be different, 
for example, /etc/qemu/bridge.conf).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% printf %s\\n &quot;allow virbr0&quot; | sudo tee -a /etc/qemu-kvm/bridge.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NOTE: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bridge.conf&lt;/code&gt; are in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-kvm-common&lt;/code&gt; package:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dnf repoquery --file /etc/qemu-kvm/bridge.conf 
[...]
qemu-kvm-common-15:2.12.0-63.module+el8+2833+c7d6d092.x86_64

$ dnf repoquery --file /usr/libexec/qemu-bridge-helper
[...]
qemu-kvm-common-15:2.12.0-63.module+el8+2833+c7d6d092.x86_64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Both examples below use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev&lt;/code&gt; option for the back-end, together 
with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-device&lt;/code&gt; for the front-end.  That combination configures a network 
connection where the emulated NIC is directly connected to a host network
back-end, without a hub in between (as opposed to a network connection 
created with the legacy &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net&lt;/code&gt; option).&lt;/p&gt;

&lt;h4 id=&quot;tap-with-virbr0-default-virtual-network-switch-created-by-the-libvirt-library---method-1&quot;&gt;Tap with virbr0 (Default Virtual Network Switch Created by the libvirt Library) - Method 1&lt;/h4&gt;

&lt;p&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br=&amp;lt;bridge name&amp;gt;&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev&lt;/code&gt; option.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev bridge,br=virbr0,id=hn0 \
-device virtio-net-pci,netdev=hn0,id=nic1 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;tap-with-virbr0-default-virtual-network-switch-created-by-the-libvirt-library---method-2&quot;&gt;Tap with virbr0 (Default Virtual Network Switch Created by the libvirt Library) - Method 2&lt;/h4&gt;

&lt;p&gt;In the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev&lt;/code&gt; option, for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tap&lt;/code&gt; specify &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;helper&lt;/code&gt; and point &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--br&lt;/code&gt; to 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; because by default the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt; expects that the 
bridge name is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=virbr0&quot;,id=hn0 \
-device virtio-net-pci,netdev=hn0,id=nic1 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;how-to-create-a-bridged-networking-tun-device-in-tap-mode-for-qemu-with-an-ip-address-visible-on-the-hosts-network-and-via-a-bridge-interface-you-created&quot;&gt;How To Create a Bridged Networking (Tun Device in Tap Mode) for QEMU with an IP Address Visible on the Host’s Network and via a Bridge Interface You Created&lt;/h3&gt;

&lt;p&gt;When you don’t want to use the [default] bridge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; provided by the 
libvirt library, you need to configure the new bridge &lt;em&gt;before&lt;/em&gt; running qemu.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Steps:&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Create a network bridge device and bind your default-route NIC to it.&lt;/li&gt;
  &lt;li&gt;Create a tap device attached to the bridge for QEMU to use.
    &lt;ul&gt;
      &lt;li&gt;Instead of setting it up manually, you can let QEMU to set up
the necessary &lt;strong&gt;tap&lt;/strong&gt; device using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt; tool
(location on this host with the operating system RHEL 8.5:
 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/libexec/qemu-bridge-helper&lt;/code&gt;).  This example shows this, that is,
it leaves the tap device creation and deletion to QEMU.&lt;/li&gt;
      &lt;li&gt;To set up a bridge as a regular user, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt; tool 
must be run as root so you have to add the setuid bit; that is, 
permission (access) needs to be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(4755/-rwsr-xr-x)&lt;/code&gt;.  On this system
I didn’t have to do it as the helper was already configured with the setuid.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Configure the host’s firewall to allow packets to move across the bridge.
I didn’t have to make changes for this item because IP forwarding
&lt;a href=&quot;#footnotes&quot;&gt;¹&lt;/a&gt; was already enabled on this host.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ lsmod | grep ^bridge
bridge                192512  0

$ lsmod | grep ^tun
tun                    53248  1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip tuntap list
virbr0-nic: tap persist
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show
bridge name     bridge id               STP enabled     interfaces
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NOTE:  &lt;br /&gt;
I haven’t tried network bridging with wireless interface.&lt;/p&gt;

&lt;p&gt;As per &lt;a href=&quot;https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_network_bridging&quot;&gt;Configure Network Bridging - Red Hat Product Documentation (RHEL 7)&lt;/a&gt; (Retrieved on Apr 2, 2022), network bridging doesn’t work with Wi-Fi in Ad-Hoc or Infrastructure modes:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Note that a bridge cannot be established over Wi-Fi networks operating 
in Ad-Hoc or Infrastructure modes.  This is due to the IEEE 802.11 
standard that specifies the use of 3-address frames in Wi-Fi for the 
efficient use of airtime.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;To configure bridged networking with a wireless adapter on the host, use NAT:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wiki.qemu.org/Documentation/Networking#How_to_use_tap_with_a_wireless_adapter_on_the_host&quot;&gt;How to use tap with a wireless adapter on the host&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wiki.qemu.org/Documentation/Networking/NAT&quot;&gt;QEMU Documentation - Networking - NAT&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bbs.archlinux.org/viewtopic.php?id=207907&quot;&gt;[SOLVED] qemu vm tap networking with internet via host wifi&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;create-a-new-bridge-connection&quot;&gt;Create a New Bridge Connection&lt;/h4&gt;

&lt;p&gt;This new bridge connection will be linked to the eno1 network interface.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip address show
[...]
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 08:94:ef:f4:00:04 brd ff:ff:ff:ff:ff:ff
    inet 123.12.23.148/24 brd 123.12.23.254 scope global noprefixroute eno1
       valid_lft forever preferred_lft forever
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create a new bridge connection named br0.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection add type bridge con-name br0 ifname br0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig | grep -w br0
br0: flags=4099&amp;lt;UP,BROADCAST,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show
bridge name     bridge id               STP enabled     interfaces
br0             8000.000000000000       yes
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eno1&lt;/code&gt; network interface to the bridge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection add type bridge-slave ifname eno1 master br0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli -f bridge connection show br0
bridge.mac-address:                     --
bridge.stp:                             yes
bridge.priority:                        32768
bridge.forward-delay:                   15
bridge.hello-time:                      2
bridge.max-age:                         20
bridge.ageing-time:                     300
bridge.group-forward-mask:              0
bridge.multicast-snooping:              yes
bridge.vlan-filtering:                  no
bridge.vlan-default-pvid:               1
bridge.vlans:                           --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h5 id=&quot;convert-settings-from-nic-network-interface-controller-to-bridge-interface&quot;&gt;Convert Settings from NIC (Network Interface Controller) to Bridge Interface&lt;/h5&gt;

&lt;p&gt;Allocate a static IP address to the new br0 interface.  (If the DHCP server 
is available, it would provide IP addresses and other settings but since 
this is a server, I chose a set up with a static IP address.)&lt;/p&gt;

&lt;p&gt;In this example, network settings of the existing network interface 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eno1&lt;/code&gt; are converted to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt; bridge settings.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show eno1 | grep &apos;ipv4.addresses&apos;
ipv4.addresses:   123.12.23.148/24

$ nmcli connection show eno1 | grep gateway
ipv4.gateway:     123.12.23.254

$ nmcli connection show eno1 | grep &apos;ipv4.dns&apos;
ipv4.dns:         208.67.222.222,208.67.220.220  &amp;lt;-- Will show your DNS servers

$ nmcli connection show eno1 | grep &apos;ipv4.method&apos;
ipv4.method:                            manual
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection modify br0 ipv4.addresses &apos;123.12.23.148/24&apos;
$ sudo nmcli connection modify br0 ipv4.gateway &apos;123.12.23.254&apos;
$ sudo nmcli connection modify br0 ipv4.dns &apos;208.67.222.222,208.67.220.220&apos;
$ sudo nmcli connection modify br0 ipv4.method manual
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection up br0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Connection successfully activated (master waiting for slaves) 
(D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/28)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show
bridge name     bridge id               STP enabled     interfaces
br0             8000.0894eff40004       yes             eno1
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show
NAME               UUID                                  TYPE      DEVICE 
eno1               4d928341-...........................  ethernet  eno1   
eno2               e94a2707-...........................  ethernet  eno2   
br0                07d25404-...........................  bridge    br0    
virbr0             3216d7f0-...........................  bridge    virbr0 
bridge-slave-eno1  02132481-...........................  ethernet  --     
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip address show br0
40: br0: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,UP&amp;gt; mtu 1500 qdisc noqueue 
      state DOWN group default qlen 1000
      link/ether 5a:18:0d:a2:18:26 brd ff:ff:ff:ff:ff:ff
      inet 123.12.23.148/24 brd 123.12.23.255 scope global noprefixroute br0
      valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Remove the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eno1&lt;/code&gt; network interface because now the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt; bridge 
has a static IP address and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eno1&lt;/code&gt; will be in forwarding state.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection delete eno1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Allow a regular user access to the new bridge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt; from 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt;.  Add &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;allow br0&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bridge.conf&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ printf %s\\n &quot;allow br0&quot; | sudo tee -a /etc/qemu-kvm/bridge.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat /etc/qemu-kvm/bridge.conf
allow virbr0
allow br0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NOTE: &lt;br /&gt;
You don’t need to create a tap device (a.k.a. a tap interface) manually 
because the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt; tool (location on the host’s OS, RHEL 8.5: 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/libexec/qemu-bridge-helper&lt;/code&gt;) creates it automatically when you 
start a guest VM.  By default the helper assumes that the bridge name 
is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt;.  Also, the name of a tap device that the helper automatically 
creates when the guest VM is started is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tap0&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev bridge,br=br0,id=hn0 \
-device virtio-net-pci,netdev=hn0,id=nic1 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(NOTE:   You can skip &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br=br0&lt;/code&gt; because the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt; tool assumes that the name of the bridge is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt;.   Also, you can skip &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id=nic1&lt;/code&gt;.)&lt;/p&gt;

&lt;p&gt;Explanation for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;device&lt;/code&gt; options:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-netdev bridge,br=br0,id=hn0&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Create a bridge network back-end (with id hn0) via bridge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt;. 
This will connect to a tap interface tap0 device (aka tap0 interface), 
which will be automatically setup with the helper &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-device virtio-net-pci,netdev=hn0,id=nic1&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Create a NIC (of a model &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virtio-net-pci&lt;/code&gt; and with id nic1) and connect 
to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hn0&lt;/code&gt; back-end created by the previous parameter.&lt;/p&gt;

&lt;p&gt;NOTE:  To list all devices, including network devices, 
run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/libexec/qemu-kvm -device help&lt;/code&gt;, which shows help on possible 
drivers and properties (in this case, since you’d be interested in network devices, you’d look under the section titled “Network devices”).&lt;/p&gt;

&lt;p&gt;While the guest VM is running, start another shell on the host.
Run the following set of commands on the host system.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig | egrep &quot;^br|^virbr|^tap&quot;
br0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
tap0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
virbr0: flags=4099&amp;lt;UP,BROADCAST,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig -a | egrep &quot;^br|^virbr|^tap&quot;
br0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
tap0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
virbr0: flags=4099&amp;lt;UP,BROADCAST,MULTICAST&amp;gt;  mtu 1500
virbr0-nic: flags=4098&amp;lt;BROADCAST,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection | egrep -i &quot;bridge|tun|tap|type&quot;
NAME               UUID                                  TYPE      DEVICE 
br0                07d25404-5b85-4006-bdbc-272c63b9aaf0  bridge    br0    
virbr0             3216d7f0-124e-4c66-a6de-5b218d18377c  bridge    virbr0 
bridge-slave-eno1  02132481-584a-413d-97f5-46b161a4de9f  ethernet  eno1   
tap0               37ddcf4a-1105-4ab4-b076-0b62f87df4a8  tun       tap0   
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show br0 | egrep -wi &quot;type|mode|name|master|slave&quot;
connection.type:                    bridge
connection.interface-name:          br0
connection.master:                  --
connection.slave-type:              --
ipv6.addr-gen-mode:                 stable-privacy
GENERAL.NAME:                       br0
GENERAL.MASTER-PATH:                --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show tap0 | egrep -wi &quot;type|mode|name|master|slave&quot;
connection.type:                    tun
connection.interface-name:          tap0
connection.master:                  br0
connection.slave-type:              bridge
bridge-port.hairpin-mode:           no
tun.mode:                           2 (tap)
GENERAL.NAME:                       tap0
GENERAL.MASTER-PATH:                /org/freedesktop/NetworkManager/Devices/34
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device | egrep -i &quot;bridge|tun|type&quot;
DEVICE      TYPE      STATE                   CONNECTION        
br0         bridge    connected               br0               
virbr0      bridge    connected (externally)  virbr0            
eno1        ethernet  connected               bridge-slave-eno1 
tap0        tun       connected (externally)  tap0              
virbr0-nic  tun       unmanaged               --                
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show br0
GENERAL.DEVICE:         br0
GENERAL.TYPE:           bridge
GENERAL.HWADDR:         08:94:EF:F4:00:04
GENERAL.MTU:            1500
GENERAL.STATE:          100 (connected)
GENERAL.CONNECTION:     br0
GENERAL.CON-PATH:       /org/freedesktop/NetworkManager/ActiveConnection/28
IP4.ADDRESS[1]:         123.12.23.148/24 
IP4.GATEWAY:            123.12.23.254
IP4.ROUTE[1]:           dst = 123.12.23.0/24, nh = 0.0.0.0, mt = 426
IP4.ROUTE[2]:           dst = 0.0.0.0/0, nh = 123.12.23.254, mt = 426
IP4.DNS[1]:             208.67.222.222
IP4.DNS[2]:             208.67.220.220
IP6.ADDRESS[1]:         fe80::c929:3169:74dd:2429/64
IP6.GATEWAY:            fe80::a68c:dbff:fede:1301
IP6.ROUTE[1]:           dst = fe80::/64, nh = ::, mt = 426
IP6.ROUTE[2]:           dst = ::/0, nh = fe80::a68c:dbff:fede:1301, mt = 426
IP6.ROUTE[3]:           dst = ff00::/8, nh = ::, mt = 256, table=255
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show tap0
GENERAL.DEVICE:         tap0
GENERAL.TYPE:           tun
GENERAL.HWADDR:         FE:90:76:81:BE:CF
GENERAL.MTU:            1500
GENERAL.STATE:          100 (connected (externally))
GENERAL.CONNECTION:     tap0
GENERAL.CON-PATH:       /org/freedesktop/NetworkManager/ActiveConnection/30
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show
bridge name     bridge id               STP enabled     interfaces
br0             8000.0894eff40004       yes             eno1
                                                        tap0
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip link show master br0
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc mq master br0 
    state UP mode DEFAULT group default qlen 1000
    link/ether 08:94:ef:f4:00:04 brd ff:ff:ff:ff:ff:ff
44: tap0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc fq_codel 
    master br0 state UNKNOWN mode DEFAULT group default qlen 1000
    link/ether fe:90:76:81:be:cf brd ff:ff:ff:ff:ff:ff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ bridge link show
[...]
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 master br0 
     state forwarding priority 32 cost 100 
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 master br0 hwmode VEPA 
[...]
44: tap0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 master br0 
      state forwarding priority 32 cost 100 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show br0 | grep -i type
GENERAL.TYPE:                           bridge

$ nmcli device show tap0 | grep -i type
GENERAL.TYPE:                           tun

$ nmcli device show eno1 | grep -i type
GENERAL.TYPE:                           ethernet
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Return to the first shell, and in the guest VM, power off the system.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# poweroff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back on the host system, after the VM is powered off:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig | egrep &quot;^br|^virbr|^tap&quot;
br0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
virbr0: flags=4099&amp;lt;UP,BROADCAST,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig -a | egrep &quot;^br|^virbr|^tap&quot;
br0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
virbr0: flags=4099&amp;lt;UP,BROADCAST,MULTICAST&amp;gt;  mtu 1500
virbr0-nic: flags=4098&amp;lt;BROADCAST,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection | egrep -i &quot;bridge|tun|tap|type&quot;
NAME               UUID                                  TYPE      DEVICE 
br0                07d25404-5b85-4006-bdbc-272c63b9aaf0  bridge    br0    
virbr0             3216d7f0-124e-4c66-a6de-5b218d18377c  bridge    virbr0 
bridge-slave-eno1  02132481-584a-413d-97f5-46b161a4de9f  ethernet  eno1   
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device | egrep -i &quot;bridge|tun|tap|type&quot;
DEVICE      TYPE      STATE                   CONNECTION        
br0         bridge    connected               br0               
virbr0      bridge    connected (externally)  virbr0            
eno1        ethernet  connected               bridge-slave-eno1 
virbr0-nic  tun       unmanaged               --                
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show
bridge name     bridge id               STP enabled     interfaces
br0             8000.0894eff40004       yes             eno1
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip link show master br0
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc mq master br0 
    state UP mode DEFAULT group default qlen 1000
    link/ether 08:94:ef:f4:00:04 brd ff:ff:ff:ff:ff:ff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ bridge link show
[...]
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 master br0 
     state forwarding priority 32 cost 100 
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 master br0 hwmode VEPA 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;create-a-second-bridge-connection&quot;&gt;Create a Second Bridge Connection&lt;/h3&gt;

&lt;p&gt;This new bridge connection will be linked to the eno2 network interface, 
which is used for a non-routable private network (for a cluster of compute 
nodes).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip address show
[...]
5: eno2: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc mq state UP 
      group default qlen 1000
    link/ether 08:94:ef:00:11:22 brd ff:ff:ff:ff:ff:ff
    inet 192.168.80.210/24 brd 192.168.80.255 scope global noprefixroute eno2
       valid_lft forever preferred_lft forever
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create a new bridge connection named br1 on the host system.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection add type bridge con-name br1 ifname br1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;convert-settings-from-nic-network-interface-controller-to-bridge-interface-1&quot;&gt;Convert Settings from NIC (Network Interface Controller) to Bridge Interface&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show eno2 | grep &apos;ipv4.addresses&apos;
ipv4.addresses :                  192.168.80.210/24

$ nmcli connection show eno2 | grep &apos;ipv4.gateway&apos; 
ipv4.gateway:                     --

$ nmcli connection show eno2 | grep &apos;ipv4.dns&apos;
ipv4.dns:                         --

$ nmcli connection show eno2 | grep &apos;ipv4.method&apos;
ipv4.method:                      manual
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection add type bridge-slave ifname eno2 master br1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection modify br1 ipv4.addresses &apos;192.168.80.210/24&apos;
$ sudo nmcli connection modify br1 ipv4.method manual
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection delete eno2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip address show br1
53: br1: &amp;lt;NO-CARRIER,BROADCAST,MULTICAST,UP&amp;gt; mtu 1500 qdisc noqueue 
      state DOWN group default qlen 1000
    link/ether 52:c3:05:11:22:33 brd ff:ff:ff:ff:ff:ff
    inet 192.168.80.210/24 brd 192.168.80.255 scope global noprefixroute br1
       valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show
NAME               UUID                                  TYPE      DEVICE
br0                07d25404-...........................  bridge    br0
br1                1f0c11be-...........................  bridge    br1
virbr0             3216d7f0-...........................  bridge    virbr0
bridge-slave-eno1  02132481-...........................  ethernet  eno1
bridge-slave-eno2  6f94adf1-...........................  ethernet  eno2
eno3               70568f00-...........................  ethernet  --
eno4               39d9c6c1-...........................  ethernet  --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device
DEVICE      TYPE      STATE                   CONNECTION
br0         bridge    connected               br0
br1         bridge    connected               br1
virbr0      bridge    connected (externally)  virbr0
eno1        ethernet  connected               bridge-slave-eno1
eno2        ethernet  connected               bridge-slave-eno2
eno3        ethernet  disconnected            --
eno4        ethernet  disconnected            --
lo          loopback  unmanaged               --
virbr0-nic  tun       unmanaged               --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ printf %s\\n &quot;allow br1&quot; | sudo tee  -a /etc/qemu-kvm/bridge.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat /etc/qemu-kvm/bridge.conf
allow virbr0
allow br0
allow br1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl restart NetworkManager
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You might need to restart dhcpd service too.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl restart dhcpd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After you launch an instance of QEMU guest VM that uses the both bridge 
devices (br0 and br1) you’ve created (see section below), QEMU automatically
creates TUN devices named tun0 and tun1.  Run the following three commands
on the host while the guest virtual machine is running.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection
NAME               UUID                                  TYPE      DEVICE
br0                07d25404-...........................  bridge    br0
br1                1f0c11be-...........................  bridge    br1
virbr0             3216d7f0-...........................  bridge    virbr0
bridge-slave-eno1  02132481-...........................  ethernet  eno1
bridge-slave-eno2  6f94adf1-...........................  ethernet  eno2
tap0               4da9861f-...........................  tun       tap0
tap1               9837b7c2-...........................  tun       tap1
eno3               70568f00-...........................  ethernet  --
eno4               39d9c6c1-...........................  ethernet  --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device
DEVICE      TYPE      STATE                   CONNECTION
br0         bridge    connected               br0
br1         bridge    connected               br1
virbr0      bridge    connected (externally)  virbr0
eno1        ethernet  connected               bridge-slave-eno1
eno2        ethernet  connected               bridge-slave-eno2
tap0        tun       connected (externally)  tap0
tap1        tun       connected (externally)  tap1
eno3        ethernet  disconnected            --
eno4        ethernet  disconnected            --
lo          loopback  unmanaged               --
virbr0-nic  tun       unmanaged               --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show
bridge name     bridge id               STP enabled     interfaces
br0             8000.0894eff40004       yes             eno1
                                                        tap0
br1             8000.0894eff40005       yes             eno2
                                                        tap1
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;how-to-launch-a-qemu-instance-in-bridge-network-with-two-nics-in-two-separate-networks-via-tap-network-connections---aka-configure-host-tap-network-backendshost-tap-interfaces&quot;&gt;How To Launch a QEMU Instance in Bridge Network with Two NICs in Two Separate Networks via TAP Network Connections - aka Configure Host TAP Network Backends/Host TAP Interfaces&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  &lt;br /&gt;
You can use the same bridge on the host for connecting two guest NICs to it,
in which case the both guest network connections get IP address assigned from
the host’s bridge subnet.&lt;/p&gt;

&lt;p&gt;This example shows a different configuration, where the guest VM needs to 
be connected to two different networks so one of two guest NICs is 
connected to one bridge and the other guest NIC is connected to the other 
bridge on the host side.&lt;/p&gt;

&lt;h4 id=&quot;two-bridges---method-1&quot;&gt;Two Bridges - Method 1&lt;/h4&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;Launch a QEMU instance with two NICs, each connected to a TAP device.
Use the default network script but instead of using the script’s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; 
bridge, connect the both TAP devices to bridgess &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br1&lt;/code&gt;,
respectively:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br0&quot;,id=hn0 \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br1&quot;,id=hn1 \
-device virtio-net-pci,netdev=hn0 \
-device virtio-net-pci,netdev=hn1 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When it starts the guest VM, QEMU automatically creates two &lt;strong&gt;TUN&lt;/strong&gt;
connections (aka tun devices) of type &lt;strong&gt;TAP&lt;/strong&gt;.  In this case QEMU names
these two devices tap0 and tap1.  You can obtain the details by starting
a separate shell (while the guest VM is running) and by using the 
following commands: 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip --details address show&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip --details link show&lt;/code&gt;, 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip --details tuntap&lt;/code&gt;, 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmcli connection&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmcli device&lt;/code&gt;,
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmcli device show&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;brctl show&lt;/code&gt;.&lt;/p&gt;

&lt;h4 id=&quot;two-bridges---method-2&quot;&gt;Two Bridges - Method 2&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev bridge,br=br0,id=hn0 \
-netdev bridge,br=br1,id=hn1 \
-device virtio-net-pci,netdev=hn0 \
-device virtio-net-pci,netdev=hn1 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;vde-networking&quot;&gt;VDE Networking&lt;/h3&gt;

&lt;p&gt;From &lt;a href=&quot;https://wiki.qemu.org/Documentation/Networking&quot;&gt;Networking - QEMU Wiki - Documentation&lt;/a&gt; (Retrieved on Apr 2, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;VDE&lt;/p&gt;

  &lt;p&gt;The VDE networking backend uses the &lt;a href=&quot;https://github.com/virtualsquare/vde-2&quot;&gt;Virtual Distributed Ethernet&lt;/a&gt; infrastructure to network guests. 
Unless you specifically know that you want to use VDE, it is probably 
not the right backend to use.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;redirecting-ports&quot;&gt;Redirecting Ports&lt;/h3&gt;

&lt;h4 id=&quot;how-to-get-ssh-access-to-a-guest-with-port-forwarding&quot;&gt;How to Get SSH Access to a Guest with Port Forwarding&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;No tap0 on the guest.&lt;/li&gt;
  &lt;li&gt;IP address in the guest:  10.0.2.x  (gw: 10.0.2.254)&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-device e1000,netdev=net0 \
-netdev user,id=net0,hostfwd=tcp::5555-:22 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first line creates a virtual e1000 network device, while the second 
line created one user typed backend, forwarding local port 5555 to guest 
port 22.  Then from the host:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh -p 5555 username@localhost
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to have SSH access to guest after its network setup (if there are any 
firewalls in the guest or host, disable them or allow the needed ports).&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;how-to-start-a-qemu-vm-with-bridged-networking-with-the-legacy--net-option-aka-via-hub&quot;&gt;How To Start a QEMU VM with Bridged Networking (with the Legacy -net Option, aka via Hub)&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;Task:&lt;/em&gt;  Start a guest VM with the virtual network bridge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; 
(installed by the libvirt).&lt;/p&gt;

&lt;p&gt;When QEMU starts (e.g. when you invoke it by starting a VM via QEMU), 
it runs the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qemu-bridge-helper&lt;/code&gt; tool, which automatically creates 
a new tap device, which is effectively a virtual NIC (network interface
controller) with its own MAC address, and connects that device to the bridge.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;NOTE:&lt;/em&gt; &lt;br /&gt;
This example shows the use of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net&lt;/code&gt; &lt;a href=&quot;#footnotes&quot;&gt;³&lt;/a&gt; legacy option.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Possible to ping from the guest VM&lt;/li&gt;
  &lt;li&gt;The NIC is an e1000 by default on the PC target so if you want to emulate 
an e1000 NIC in the guest you can skip &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-model=e1000&lt;/code&gt; in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net nic&lt;/code&gt; option.
As such, in the example below, you can use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net nic&lt;/code&gt; instead of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net nic,model=e1000&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;The emulated NIC and the host back-end are not &lt;em&gt;directly&lt;/em&gt; connected.
They are rather both connected to an emulated &lt;strong&gt;hub&lt;/strong&gt; (called “vlan” in older versions of QEMU).&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-global ide-hd.physical_block_size=4096 \
-m 4G \
-net nic,model=e1000 \
-net bridge,br=virbr0 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  CentOS Linux (3.10.0-1160.el7.x86_64) 7 (Core)
  CentOS Linux (0-rescue-d01c41227ec248b983c9ea19758c73b0) 7 (Core)


  Use the ↑ and ↓ keys to change the selection.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log in to the guest VM.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

xcatmn login: root
Password:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Networking information in the guest VM:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ifconfig | grep -w inet
    inet 192.168.122.76  netmask 255.255.255.0  broadcast 192.168.122.255
    inet 127.0.0.1  netmask 255.0.0.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli connection 
NAME  UUID                                  TYPE      DEVICE 
ens3  e5ec08b7-...........................  ethernet  ens3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ip address show ens3 | grep -w inet
    inet 192.168.122.76/24 brd 192.168.122.255 scope global noprefixroute dynam3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /etc/sysconfig/network-scripts/ifcfg-ens3
TYPE=&quot;Ethernet&quot;
PROXY_METHOD=&quot;none&quot;
BROWSER_ONLY=&quot;no&quot;
BOOTPROTO=&quot;dhcp&quot;
DEFROUTE=&quot;yes&quot;
IPV4_FAILURE_FATAL=&quot;no&quot;
IPV6INIT=&quot;no&quot;
IPV6_AUTOCONF=&quot;yes&quot;
IPV6_DEFROUTE=&quot;yes&quot;
IPV6_FAILURE_FATAL=&quot;no&quot;
IPV6_ADDR_GEN_MODE=&quot;stable-privacy&quot;
NAME=&quot;ens3&quot;
UUID=&quot;e5ec08b7-...........................&quot;
DEVICE=&quot;ens3&quot;
ONBOOT=&quot;yes&quot;
DNS1=&quot;208.67.222.222&quot;  &amp;lt;-- Will list your DNS1 server
DNS2=&quot;208.67.220.220&quot;  &amp;lt;-- Will list your DNS2 server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli device show ens3 | grep DNS
IP4.DNS[1]:         192.168.122.1  
IP4.DNS[2]:         208.67.222.222    &amp;lt;-- Will show your DNS2 server
IP4.DNS[3]:         208.67.220.220    &amp;lt;-- Will show your DNS3 server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The kernel routing tables:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# netstat -rn
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
0.0.0.0         192.168.122.1   0.0.0.0         UG        0 0          0 ens3
192.168.122.0   0.0.0.0         255.255.255.0   U         0 0          0 ens3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# route -e
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
default         gateway         0.0.0.0         UG        0 0          0 ens3
192.168.122.0   0.0.0.0         255.255.255.0   U         0 0          0 ens3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or with the new tool &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip(8)&lt;/code&gt;, from the iproute2 package (a collection of 
userspace utilities for controlling and monitoring various aspects of 
networking in the Linux kernel):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ip route
default via 192.168.122.1 dev ens3 proto dhcp metric 100 
192.168.122.0/24 dev ens3 proto kernel scope link src 192.168.122.76 metric 100 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /etc/resolv.conf 
# Generated by NetworkManager
search yourdomain.org
nameserver 192.168.122.1
nameserver 208.67.222.222   &amp;lt;-- Will list your nameserver1
nameserver 208.67.220.220   &amp;lt;-- Will list your nameserver2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;virbr0-nic-ethernet-interface-and-tap0-device-are-created-automatically-when-guest-vm-is-running&quot;&gt;virbr0-nic Ethernet Interface and tap0 Device are Created Automatically when Guest VM is Running&lt;/h4&gt;

&lt;p&gt;While the guest VM is running, start another shell on the host.&lt;/p&gt;

&lt;p&gt;On the host system, run the following commands, which show that 
the &lt;strong&gt;tun&lt;/strong&gt; device named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tap0&lt;/code&gt; (a.k.a. network interface of type 
&lt;strong&gt;tun&lt;/strong&gt; - tun mode &lt;strong&gt;tap&lt;/strong&gt; ) is created automatically (as a slave 
of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; bridge) when the guest VM is powered on.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig | egrep -i &quot;virbr|tap&quot;
tap0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
virbr0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig -a | egrep -i &quot;virbr|tap&quot;
tap0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
virbr0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt;  mtu 1500
virbr0-nic: flags=4098&amp;lt;BROADCAST,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection | egrep -i &quot;bridge|tun|tap|type&quot;
NAME    UUID                                  TYPE      DEVICE
virbr0  3216d7f0-124e-4c66-a6de-5b218d18377c  bridge    virbr0
tap0    72e1da4b-5a73-40ec-9cce-c480078f3c68  tun       tap0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show virbr0 | egrep -wi &quot;type|mode|name|master|slave&quot;
connection.type:                    bridge
connection.interface-name:          virbr0
connection.master:                  --
connection.slave-type:              --
ipv6.addr-gen-mode:                 stable-privacy
GENERAL.NAME:                       virbr0
GENERAL.MASTER-PATH:                --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show tap0 | egrep -wi &quot;type|mode|name|master|slave&quot;
connection.type:                    tun
connection.interface-name:          tap0
connection.master:                  virbr0
connection.slave-type:              bridge
bridge-port.hairpin-mode:           no
tun.mode:                           2 (tap)
GENERAL.NAME:                       tap0
GENERAL.MASTER-PATH:                /org/freedesktop/NetworkManager/Devices/6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device | egrep -i &quot;bridge|tun|type&quot;
DEVICE      TYPE      STATE                   CONNECTION
virbr0      bridge    connected (externally)  virbr0
tap0        tun       connected (externally)  tap0
virbr0-nic  tun       unmanaged               --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show virbr0
GENERAL.DEVICE:           virbr0
GENERAL.TYPE:             bridge
[...]
GENERAL.STATE:            100 (connected (externally))
GENERAL.CONNECTION:       virbr0
[...]
IP4.ADDRESS[1]:           192.168.122.1/24
IP4.GATEWAY:              --
IP4.ROUTE[1]:             dst = 192.168.122.0/24, nh = 0.0.0.0, mt = 0
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show virbr0-nic
GENERAL.DEVICE:           virbr0-nic
GENERAL.TYPE:             tun
[...]
GENERAL.STATE:            10 (unmanaged)
GENERAL.CONNECTION:       --
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show tap0
GENERAL.DEVICE:           tap0
GENERAL.TYPE:             tun
[...]
GENERAL.STATE:            100 (connected (externally))
GENERAL.CONNECTION:       tap0
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show
bridge name     bridge id               STP enabled     interfaces
virbr0          8000.525400a7c2ab       yes             tap0
                                                        virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;verification-of-bridge-creation-and-network-connection&quot;&gt;Verification of Bridge Creation and Network Connection&lt;/h4&gt;

&lt;p&gt;Use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip&lt;/code&gt; utility to display the link status of Ethernet devices that 
are ports of the bridge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip link show master virbr0
7: virbr0-nic: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc fq_codel master 
      virbr0 state DOWN mode DEFAULT group default qlen 1000
      link/ether 52:54:00:a7:c2:ab brd ff:ff:ff:ff:ff:ff
33: tap0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc fq_codel master 
      virbr0 state UNKNOWN mode DEFAULT group default qlen 1000
      link/ether fe:0e:7b:05:f6:b1 brd ff:ff:ff:ff:ff:ff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can also use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bridge&lt;/code&gt; utility to display the status of Ethernet 
devices that are ports of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; bridge device.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ bridge link show 
[...]
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 hwmode VEPA 
5: eno2: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 hwmode VEPA 
7: virbr0-nic: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 master virbr0 state disabled 
     priority 32 cost 100 
33: tap0: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 master virbr0 state 
     forwarding priority 32 cost 100
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device show virbr0 | grep -i type
GENERAL.TYPE:                           bridge

$ nmcli device show virbr0-nic | grep -i type
GENERAL.TYPE:                           tun

$ nmcli device show tap0 | grep -i type
GENERAL.TYPE:                           tun
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back in the first shell, in the guest VM, power off the system.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# poweroff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;virbr0-nic-network-interface-and-tap0-device-are-automatically-removed-when-guest-vm-is-powered-down&quot;&gt;virbr0-nic Network Interface and tap0 Device are Automatically Removed when Guest VM is Powered Down&lt;/h4&gt;

&lt;p&gt;Back on the host system, after the VM is powered off, run the following 
set of commands.  They show that the the &lt;strong&gt;tun&lt;/strong&gt; device named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tap0&lt;/code&gt; 
(network interface of type &lt;strong&gt;tun&lt;/strong&gt; - tun mode &lt;strong&gt;tap&lt;/strong&gt; ) is automatically 
removed after the guest VM is powered off.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig | egrep -i &quot;virbr|tap&quot;
virbr0: flags=4099&amp;lt;UP,BROADCAST,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ifconfig -a | egrep -i &quot;virbr|tap&quot;
virbr0: flags=4099&amp;lt;UP,BROADCAST,MULTICAST&amp;gt;  mtu 1500
virbr0-nic: flags=4098&amp;lt;BROADCAST,MULTICAST&amp;gt;  mtu 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection | egrep -i &quot;bridge|tun|tap|type&quot;
NAME    UUID                                  TYPE      DEVICE
virbr0  3216d7f0-124e-4c66-a6de-5b218d18377c  bridge    virbr0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli device | egrep -i &quot;bridge|tun|tap|type&quot;
DEVICE      TYPE      STATE                   CONNECTION
virbr0      bridge    connected (externally)  virbr0
virbr0-nic  tun       unmanaged               --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brctl show
bridge name     bridge id               STP enabled     interfaces
virbr0          8000.525400a7c2ab       yes             virbr0-nic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ip link show master virbr0
7: virbr0-nic: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 qdisc fq_codel master virbr0 
      state DOWN mode DEFAULT group default qlen 1000
      link/ether 52:54:00:a7:c2:ab brd ff:ff:ff:ff:ff:ff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ bridge link show
[...]
4: eno1: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 hwmode VEPA 
5: eno2: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 hwmode VEPA 
7: virbr0-nic: &amp;lt;BROADCAST,MULTICAST&amp;gt; mtu 1500 master virbr0 state disabled 
      priority 32 cost 100 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;appendix&quot;&gt;Appendix&lt;/h2&gt;

&lt;p&gt;This section shows how the guest VM used in the examples was created.&lt;/p&gt;

&lt;h3 id=&quot;create-a-customized-centosrhel-dvd-iso-for-installation-in-text-mode-via-serial-console&quot;&gt;Create a Customized CentOS/RHEL DVD ISO for Installation in Text Mode via Serial Console&lt;/h3&gt;

&lt;p&gt;Download CentOS 7.9 DVD ISO image and verify the SHA256 checksum 
of the ISO image file to ensure its integrity – Verify that the SHA256 
checksum of the downloaded file matches that of the SHA256 checksum listed 
at the CentOS.org official download site.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cd /tmp/

$ wget https://mirror.esecuredata.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Everything-2009.iso

$ wget https://mirror.esecuredata.com/centos/7.9.2009/isos/x86_64/sha256sum.txt

$ ls -lh sha256sum.txt
-rw-rw-r-- 1 dusko dusko 398 Nov  4  2020 sha256sum.txt

$ wc -l sha256sum.txt
4 sha256sum.txt

$ grep -n &apos;CentOS-7-x86_64-Everything-2009.iso&apos; sha256sum.txt
1:689531cce9cf484378481ae762fae362791a9be078fda10e4f6977bf8fa71350  CentOS-7-x86_64-Everything-2009.iso

$ grep CentOS-7-x86_64-Everything-2009.iso sha256sum.txt &amp;gt; /tmp/sha256sum.txt.tmp

$ mv /tmp/sha256sum.txt.tmp /tmp/sha256sum.txt

$ cat /tmp/sha256sum.txt
689531cce9cf484378481ae762fae362791a9be078fda10e4f6977bf8fa71350  CentOS-7-x86_64-Everything-2009.iso

$ sha256sum --check sha256sum.txt
CentOS-7-x86_64-Everything-2009.iso: OK
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Customize the DVD ISO image so that the installer redirects its text output 
to the serial console, specifically to the first serial device (ttyS0), 
with baud rate of 19200. (This is to meet the requirement of the system 
that this VM is going to replicate.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mkdir -p /mnt/{dvd,customdvd}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo \
mount \
-t iso9660 \
/tmp/CentOS-7-x86_64-Everything-2009.iso \
/mnt/dvd/
mount: /mnt/dvd: WARNING: device write-protected, mounted read-only.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo rsync -a /mnt/dvd/ /mnt/customdvd/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh /mnt/customdvd/isolinux/
total 60M
drwxr-xr-x 2 root root  198 Oct 26  2020 .
drwxr-xr-x 8 root root  254 Oct 29  2020 ..
-r--r--r-- 1 root root 2.0K Nov  2  2020 boot.cat
-rw-r--r-- 1 root root   84 Oct 26  2020 boot.msg
-rw-r--r-- 1 root root  281 Oct 26  2020 grub.conf
-rw-r--r-- 1 root root  53M Oct 26  2020 initrd.img
-rw-r--r-- 1 root root  24K Oct 26  2020 isolinux.bin
-rw-r--r-- 1 root root 3.0K Oct 26  2020 isolinux.cfg
-rw-r--r-- 1 root root 187K Nov  5  2016 memtest
-rw-r--r-- 1 root root  186 Sep 30  2015 splash.png
-r--r--r-- 1 root root 2.2K Nov  2  2020 TRANS.TBL
-rw-r--r-- 1 root root 150K Oct 30  2018 vesamenu.c32
-rwxr-xr-x 1 root root 6.5M Oct 19  2020 vmlinuz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat /mnt/customdvd/isolinux/boot.msg


splash.lss

 -  Press the 01&amp;lt;ENTER&amp;gt;07 key to begin the installation process.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Delete the line with ‘splash.lss’ from the ‘boot.msg’.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo sed -i.bkp &apos;/splash.lss/d&apos; /mnt/customdvd/isolinux/boot.msg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ diff \
--unified=0 \
/mnt/customdvd/isolinux/boot.msg.bkp \
/mnt/customdvd/isolinux/boot.msg
--- /mnt/customdvd/isolinux/boot.msg.bkp      2020-10-26 09:25:28.000000000 -0700
+++ /mnt/customdvd/isolinux/boot.msg    2022-04-02 08:09:31.109458847 -0700
@@ -2 +1,0 @@
-splash.lss
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat /mnt/customdvd/isolinux/boot.msg



 -  Press the 01&amp;lt;ENTER&amp;gt;07 key to begin the installation process.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo rm -i /mnt/customdvd/isolinux/boot.msg.bkp
rm: remove regular file &apos;/mnt/customdvd/isolinux/boot.msg.bkp&apos;? y
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Remove ‘boot.cat’. It will be regenerated in a later step.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo rm -i /mnt/customdvd/isolinux/boot.cat
rm: remove regular file &apos;/mnt/customdvd/isolinux/boot.cat&apos;? y
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tell ISOLINUX to use a serial port as the console. “port” is a number
(0 = /dev/ttyS0 = COM1, etc.) or an I/O port address (e.g. 0x3F8)
(&lt;a href=&quot;https://www.syslinux.org/old/faq.php&quot;&gt;https://www.syslinux.org/old/faq.php&lt;/a&gt;,
&lt;a href=&quot;https://wiki.syslinux.org/wiki/index.php?title=SYSLINUX&quot;&gt;https://wiki.syslinux.org/wiki/index.php?title=SYSLINUX&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Here I want to use the port 0 so the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console&lt;/code&gt; statement uses tty0 and ttyS0.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo vi /mnt/customdvd/isolinux/isolinux.cfg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ diff \
--unified=0 \
/mnt/dvd/isolinux/isolinux.cfg \
/mnt/customdvd/isolinux/isolinux.cfg
--- /mnt/dvd/isolinux/isolinux.cfg      2020-10-26 09:25:28.000000000 -0700
+++ /mnt/customdvd/isolinux/isolinux.cfg        2022-04-02 08:12:12.604830661 -0700
@@ -64 +64 @@
-  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 quiet
+  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 quiet console=tty0 console=ttyS0,19200
@@ -70 +70 @@
-  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rd.live.check quiet
+  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rd.live.check quiet console=tty0 console=ttyS0,19200
@@ -86 +86 @@
-  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 xdriver=vesa nomodeset quiet
+  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 xdriver=vesa nomodeset quiet console=tty0 console=ttyS0,19200
@@ -96 +96 @@
-  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rescue quiet
+  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rescue quiet console=tty0 console=ttyS0,19200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -lh /mnt/customdvd/EFI/BOOT/
total 6.0M
-rwxr--r-- 1 root root 978K Jul 31  2020 BOOTIA32.EFI
-rwxr--r-- 1 root root 1.2M Jul 31  2020 BOOTX64.EFI
drwxr-xr-x 2 root root   42 Oct 26  2020 fonts
-rw-r--r-- 1 root root 1.3K Oct 26  2020 grub.cfg
-rwxr--r-- 1 root root 745K Jul 28  2020 grubia32.efi
-rwxr--r-- 1 root root 1.1M Jul 28  2020 grubx64.efi
-rwxr--r-- 1 root root 898K Jul 31  2020 mmia32.efi
-rwxr--r-- 1 root root 1.2M Jul 31  2020 mmx64.efi
-r--r--r-- 1 root root 1.8K Nov  2  2020 TRANS.TBL
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo vi /mnt/customdvd/EFI/BOOT/grub.cfg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ diff --unified=0 /mnt/dvd/EFI/BOOT/grub.cfg /mnt/customdvd/EFI/BOOT/grub.cfg
--- /mnt/dvd/EFI/BOOT/grub.cfg  2020-10-26 09:25:28.000000000 -0700
+++ /mnt/customdvd/EFI/BOOT/grub.cfg    2022-04-02 08:23:17.334493194 -0700
@@ -16,0 +17,4 @@
+serial --unit=0 --speed=19200 --word=8 --parity=no --stop=1
+terminal_input serial console=tty0 console=ttyS0,19200
+terminal_output serial console=tty0 console=ttyS0,19200
+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat /mnt/customdvd/EFI/BOOT/grub.cfg
set default=&quot;1&quot;

function load_video {
  insmod efi_gop
  insmod efi_uga
  insmod video_bochs
  insmod video_cirrus
  insmod all_video
}

load_video
set gfxpayload=keep
insmod gzio
insmod part_gpt
insmod ext2

serial --unit=0 --speed=19200 --word=8 --parity=no --stop=1
terminal_input serial console=tty0 console=ttyS0,19200
terminal_output serial console=tty0 console=ttyS0,19200

set timeout=60
### END /etc/grub.d/00_header ###

search --no-floppy --set=root -l &apos;CentOS 7 x86_64&apos;

### BEGIN /etc/grub.d/10_linux ###
menuentry &apos;Install CentOS 7&apos; --class fedora --class gnu-linux --class gnu --class os {
        linuxefi /images/pxeboot/vmlinuz inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 quiet
        initrdefi /images/pxeboot/initrd.img
}
menuentry &apos;Test this media &amp;amp; install CentOS 7&apos; --class fedora --class gnu-linux --class gnu --class os {
        linuxefi /images/pxeboot/vmlinuz inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rd.live.check quiet
        initrdefi /images/pxeboot/initrd.img
}
submenu &apos;Troubleshooting --&amp;gt;&apos; {
        menuentry &apos;Install CentOS 7 in basic graphics mode&apos; --class fedora --class gnu-linux --class gnu --class os {
                linuxefi /images/pxeboot/vmlinuz inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 xdriver=vesa nomodeset quiet
                initrdefi /images/pxeboot/initrd.img
        }
        menuentry &apos;Rescue a CentOS system&apos; --class fedora --class gnu-linux --class gnu --class os {
                linuxefi /images/pxeboot/vmlinuz inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rescue quiet
                initrdefi /images/pxeboot/initrd.img
        }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ isoinfo -d -i /tmp/CentOS-7-x86_64-Everything-2009.iso | grep &quot;Volume id&quot;
Volume id: CentOS 7 x86_64

$ isoinfo -d -i /tmp/CentOS-7-x86_64-Everything-2009.iso | grep Joliet
Joliet with UCS level 3 found

$ isoinfo -d -i /tmp/CentOS-7-x86_64-Everything-2009.iso | grep prepare
Data preparer id:

$ isoinfo -d -i /tmp/CentOS-7-x86_64-Everything-2009.iso | grep Torito
El Torito VD version 1 found, boot catalog is in sector 1430
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ blkid /tmp/CentOS-7-x86_64-Everything-2009.iso
/tmp/CentOS-7-x86_64-Everything-2009.iso: BLOCK_SIZE=&quot;2048&quot; 
  UUID=&quot;2020-11-02-15-15-23-00&quot; LABEL=&quot;CentOS 7 x86_64&quot; TYPE=&quot;iso9660&quot; 
  PTUUID=&quot;6b8b4567&quot; PTTYPE=&quot;dos&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo \
mkisofs \
-o /tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso \
-b isolinux/isolinux.bin \
-J \
-R \
-l \
-c isolinux/boot.cat \
-no-emul-boot \
-boot-load-size 4 \
-boot-info-table \
-eltorito-alt-boot \
-e images/efiboot.img \
-no-emul-boot \
-graft-points \
-input-charset utf-8 \
-output-charset utf-8 \
-V &quot;CentOS 7 x86_64&quot; \
/mnt/customdvd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo chown dusko:dusko /tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ blkid /tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso
/tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso: BLOCK_SIZE=&quot;2048&quot; 
  UUID=&quot;2022-04-02-08-31-52-00&quot; LABEL=&quot;CentOS 7 x86_64&quot; TYPE=&quot;iso9660&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Implant an MD5 checksum in the ISO image.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ implantisomd5 /tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check an MD5 checksum implanted by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;implantisomd5&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ checkisomd5 --verbose /tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso
[...]
The media check is complete, the result is: PASS.

It is OK to use this media.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create a raw image of 60 GB in size. Using seek option creates 
a sparse file, which saves space.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dd if=/dev/null of=xcatmn.img bs=1M seek=61440
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -lh xcatmn.img
-rw-rw-r-- 1 dusko dusko 60G Mar 2 08:36 xcatmn.img
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ command -V qemu-kvm; type qemu-kvm; which qemu-kvm; whereis qemu-kvm
/usr/bin/command: line 2: command: qemu-kvm: not found
/usr/bin/type: line 2: type: qemu-kvm: not found
qemu-kvm: Command not found.
qemu-kvm: /usr/lib64/qemu-kvm /etc/qemu-kvm /usr/libexec/qemu-kvm 
          /usr/share/qemu-kvm /usr/share/man/man1/qemu-kvm.1.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;install-centos-linux-79-on-qemu-guest-vm-image&quot;&gt;Install CentOS Linux 7.9 on QEMU Guest VM Image&lt;/h3&gt;

&lt;p&gt;Create a QEMU virtual machine with the following properties:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;for the VM’s disk use the 60GB image created in the previous step&lt;/li&gt;
  &lt;li&gt;configure the disk with the physical sector size of 4096 bytes (4 K)
(this is to meet the requirement of the system that this VM is going 
 to replicate)&lt;/li&gt;
  &lt;li&gt;4 GB RAM&lt;/li&gt;
  &lt;li&gt;virtual machine booting on the first serial device (ttyS0)&lt;/li&gt;
  &lt;li&gt;VM booting from the first CD-ROM/DVD drive&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-cdrom /tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso \
-drive format=raw,file=xcatmn.img \
-global ide-hd.physical_block_size=4096 \
-m 4G \
-boot d \
-serial pty \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This opens QEMU monitor (aka QEMU console):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QEMU 4.2.0 monitor - type &apos;help&apos; for more information
(qemu) char device redirected to /dev/pts/1 (label serial0)
(qemu)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Open a new shell and start &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;minicom&lt;/code&gt; to connect to the installer, whose 
output is redirected to the first serial device (ttyS0) to /dev/pts/1. 
(Baud rate of 19200 was configured earlier in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;grub.cfg&lt;/code&gt;, when you 
customized the installation DVD ISO image.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ minicom --baudrate=19200 --ptty=/dev/pts/1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Install CentOS 7.9 Linux.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[  OK  ] Started Media check on /dev/sr0.
[  OK  ] Started Show Plymouth Boot Screen.
[  OK  ] Reached target Paths.
[...]
Starting installer, one moment...
anaconda 21.48.22.159-1 for CentOS 7 started.
 * installation log files are stored in /tmp during the installation
 * shell is available on TTY2
 * when reporting a bug add logs from /tmp as separate text/plain attachments
15:43:19 Not asking for VNC because we don&apos;t have a network
=============================================================================
=============================================================================
Installation

 1) [x] Language settings                 2) [!] Time settings
        (English (United States))                (Timezone is not set.)
 3) [!] Installation source               4) [!] Software selection
        (Processing...)                          (Processing...)
 5) [!] Installation Destination          6) [x] Kdump
        (No disks selected)                      (Kdump is enabled)
 7) [ ] Network configuration             8) [!] Root password
        (Not connected)                          (Password is not set.)
 9) [!] User creation
        (No user will be created)
  Please make your choice from above [&apos;q&apos; to quit | &apos;b&apos; to begin installation |
  &apos;r&apos; to refresh]:

[anaconda] 1:main* 2:shell  3:log  4:storage-lo&amp;gt; Switch tab: Alt+Tab | Help: F1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2: Time settings &amp;gt; America/Vancouver timezone
NTP servers:
ntp1.serverinyourregion.org
ntp2.serverinyourregion.org

4: Software selection &amp;gt; Compute Node

5: Installation Destination
QEMU HARDDISK 60 GiB (sda) &amp;gt; Use All Space &amp;gt; LVM

7: Network configuration
Host name:  xcatmn.yourdomain.org

Wired (ens3)
Device configuration
DHCP
IPv6:  ignore
Nameservers:  208.67.222.222, 208.67.220.220  &amp;lt;&amp;lt;-- Use your nameservers 
[x] Connect automatically after reboot
[x] Apply configuration in installer

8: Root password

9: User creation
Create user
Fullname: dusko
Username: dusko
Use password
[X] Administrator
Groups: wheel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;=============================================================================
=============================================================================
Installation
  
 1) [x] Language settings                 2) [x] Time settings
        (English (United States))                (America/Vancouver timezone)
 3) [x] Installation source               4) [x] Software selection
        (Local media)                            (Compute Node)
 5) [x] Installation Destination          6) [x] Kdump
        (Automatic partitioning                  (Kdump is enabled)
        selected)                         8) [x] Root password
 7) [x] Network configuration                    (Password is set.)
        (Wired (ens3) connected)
 9) [x] User creation
        (Administrator dusko will be
        created)

Please make your choice from above [&apos;q&apos; to quit | &apos;b&apos; to begin installation |
&apos;r&apos; to refresh]:  b

=============================================================================
=============================================================================
Progress
Setting up the installation environment
.
Creating disklabel on /dev/sda
Creating xfs on /dev/sda1
Creating lvmpv on /dev/sda2
Creating swap on /dev/mapper/centos-swap
Creating xfs on /dev/mapper/centos-home
Creating xfs on /dev/mapper/centos-root
.
Running pre-installation scripts
.
Starting package installation process
Preparing transaction from installation source
Installing libgcc (1/483)
[...]
Installing iwl6000g2a-firmware (482/483)
Installing words (483/483)
Performing post-installation setup tasks
Installing boot loader
.
Performing post-installation setup tasks

Configuring installed system
Writing network configuration
Creating users
Configuring addons
Generating initramfs
Running post-installation scripts
.
    Use of this product is subject to the license agreement found at
      /usr/share/centos-release/EULA

     Installation complete.  Press return to quit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Press Ctr+b 2&lt;/p&gt;

&lt;p&gt;Power off the virtual machine.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[anaconda root@localhost ~]# poweroff

[  OK  ] Started Show Plymouth Power Off Screen.
[  OK  ] Stopped Anaconda.
[  OK  ] Stopped target Anaconda System Services.
[...]
[  OK  ] Reached target Shutdown.
dracut Warning: Killing all remaining processes
Powering off.
[ 1909.085711] Power down.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Not shown here:  QEMU console (in the first shell) automatically exits.&lt;/p&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h4&gt;

&lt;p&gt;[¹] IP Forwarding and libvirt Networking&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;libvirt’s default network configures an isolated bridge device to be
used by guest domains.  This default bridge creates a private network
for the virtual machines but does not connect that private network to
your physical network.  The simplest way to complete that connection is
to enable IP Forwarding in the kernel.  You can quickly enable IP
Forwarding using sysctl:&lt;/p&gt;

  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sysctl -w net.ipv4.ip_forward=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;[²] A library providing a simple virtualization API - a C toolkit to 
interact with the virtualization capabilities of Linux. It includes the 
libvrtd server exporting the virtualization support.&lt;/p&gt;

&lt;p&gt;[³]  From &lt;a href=&quot;https://www.qemu.org/2018/05/31/nic-parameter/&quot;&gt;QEMU’s new -nic command line option&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;The legacy -net option&lt;/p&gt;

  &lt;p&gt;QEMU’s initial way of configuring the network for the guest was the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net&lt;/code&gt;
option.  The emulated NIC hardware can be chosen with the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net nic,model=xyz,...&lt;/code&gt; parameter, and the host back-end with the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net &amp;lt;backend&amp;gt;,...&lt;/code&gt; parameter (e.g. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net user&lt;/code&gt; for the SLIRP back-end).
However, the emulated NIC and the host back-end are &lt;em&gt;not directly connected&lt;/em&gt;.
They are rather both connected to an emulated &lt;strong&gt;hub&lt;/strong&gt; (called “vlan” in older
versions of QEMU).  Therefore, if you start QEMU with
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-net nic,model=e1000 -net user -net nic,model=virtio -net tap&lt;/code&gt; for example,
you get a setup where all the front-ends and back-ends are connected
together via a hub.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;References:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;(All references retrieved on Apr 2, 2022)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://unix.stackexchange.com/questions/523245/whats-the-function-of-virbr0-and-virbr0-nic&quot;&gt;What’s the function of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;virbr0-nic&lt;/code&gt;?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://listman.redhat.com/archives/libvirt-users/2012-September/msg00038.html&quot;&gt;[libvirt-users] virtual networking - virbr0-nic interface&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://unix.stackexchange.com/questions/378264/what-is-virtual-bridge-with-nic-in-the-end-of-name/444863#444863&quot;&gt;What is virtual bridge with -nic in the end of name&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://code.lardcave.net/2019/07/20/1/&quot;&gt;Bridged networking with qemu on Linux&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wiki.archlinux.org/title/Network_bridge&quot;&gt;Network bridge - Arch Wiki&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wiki.linuxfoundation.org/networking/bridge&quot;&gt;Bridge - The Linux Foundation Wiki&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://bsdwiki.reedmedia.net/wiki/networking_qemu_virtual_bsd_systems.html&quot;&gt;Networking QEMU Virtual BSD Systems&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.christophersmart.com/2016/08/31/configuring-qemu-bridge-helper-after-access-denied-by-acl-file-error/&quot;&gt;Configuring QEMU bridge helper after “access denied by acl file” error&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.linux-kvm.org/page/Networking&quot;&gt;Configuring Guest Networking - KVM&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Guest (VM) networking in kvm is the same as in qemu, so it is possible 
to refer to other documentation about networking in qemu.  This page will 
try to explain how to configure the most frequent types of networking needed.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://www.qemu.org/2018/05/31/nic-parameter/&quot;&gt;QEMU’s new -nic command line option&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.cyberciti.biz/faq/centos-8-add-network-bridge-br0-with-nmcli-command/&quot;&gt;CentOS 8 add network bridge (br0) with nmcli command&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.cyberciti.biz/faq/how-to-add-network-bridge-with-nmcli-networkmanager-on-linux/&quot;&gt;How to add network bridge with nmcli (NetworkManager) on Linux&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://access.redhat.com/discussions/5996181&quot;&gt;Qemu bridge/tap adapter - Red Hat Customer Portal&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/configuring-virtual-machine-network-connections_configuring-and-managing-virtualization#virtual-networking-bridged-mode_types-of-virtual-machine-network-connections&quot;&gt;Virtual networking in bridged mode&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_networking/configuring-a-network-bridge_configuring-and-managing-networking#configuring-a-network-bridge-using-nmcli-commands_configuring-a-network-bridge&quot;&gt;Configuring a network bridge using nmcli commands&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/extremecoders-re/e8fd8a67a515fee0c873dcafc81d811c&quot;&gt;Setting up Qemu with a tap interface&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bbs.archlinux.org/viewtopic.php?id=261207&quot;&gt;[SOLVED] KVM/QEMU - Ethernet will not bridge&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://ahelpme.com/linux/howto-do-qemu-full-virtualization-with-bridged-networking/&quot;&gt;Howto do QEMU full virtualization with bridged networking&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://qemu.readthedocs.io/en/latest/system/devices/net.html&quot;&gt;Network emulation - QEMU Documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://stty.io/2019/05/13/qemu-vm-wireguard-vpn-tun-tap-networking/&quot;&gt;Setting up TUN/TAP networking for QEMU VM’s (and bonus wireguard)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.linux-kvm.org/page/Networking&quot;&gt;Configuring Guest Networking - KVM Documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.kaizou.org/2018/06/qemu-bridge.html&quot;&gt;Bridging two Qemu guests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://lists.gnu.org/archive/html/qemu-discuss/2014-06/msg00059.html&quot;&gt;[Qemu-discuss] Using multiple network interfaces on a guest&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sat, 02 Apr 2022 08:11:22 -0700</pubDate>
        <link>http://localhost:4000/howto/virtualization/rs232serial/cli/terminal/shell/console/sysadmin/server/hardware/networking/2022/04/02/qemu-networking.html</link>
        <guid isPermaLink="true">http://localhost:4000/howto/virtualization/rs232serial/cli/terminal/shell/console/sysadmin/server/hardware/networking/2022/04/02/qemu-networking.html</guid>
        
        
        <category>howto</category>
        
        <category>virtualization</category>
        
        <category>rs232serial</category>
        
        <category>cli</category>
        
        <category>terminal</category>
        
        <category>shell</category>
        
        <category>console</category>
        
        <category>sysadmin</category>
        
        <category>server</category>
        
        <category>hardware</category>
        
        <category>networking</category>
        
      </item>
    
      <item>
        <title>Configure IP Addressing with NetworkManager (nmcli) in RHEL 8/CentOS 8</title>
        <description>&lt;p&gt;OS: RHEL 8 &lt;br /&gt;
Shell:  bash&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;static-addressing&quot;&gt;Static Addressing&lt;/h3&gt;

&lt;p&gt;For example, create a new connection named ‘eno1’. &lt;br /&gt;
Specify a name for the connection profile (con-name), the interface the 
profile should be applied to (ifname), the IP address (ip4) and optionally, 
the gateway (gw4). The IP address must be specified with the network prefix. 
The connection profile name can match the interface name. 
The connection will be activated as soon as it is created.&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection add \
con-name eno1 ifname eno1 type ethernet \
ip4 123.12.23.34/24 gw4 123.12.23.254
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Set up DNS servers. For example, use recursive nameservers by OpenDNS, 
208.67.222.222, 208.67.220.220.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection modify eno1 \ 
ipv4.dns &quot;208.67.222.222,208.67.220.220&quot; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NOTE:  Some other options that you can use for your DNS resolver:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Cloudflare’s public DNS server 1.1.1.1&lt;/li&gt;
  &lt;li&gt;Google’s DNS servers 4.4.8.8, 4.4.4.4, 8.8.8.8&lt;/li&gt;
  &lt;li&gt;In Canada, &lt;a href=&quot;https://www.cira.ca/cybersecurity-services/canadian-shield&quot;&gt;CIRA Canada Shield&lt;/a&gt;:
    &lt;ul&gt;
      &lt;li&gt;Private - DNS resolution only: 149.112.121.10, 149.112.122.10&lt;/li&gt;
      &lt;li&gt;Protected - Malware and phishing protection: 149.112.121.20, 149.112.122.20&lt;/li&gt;
      &lt;li&gt;Family - Protected + blocking offensive content: 149.112.121.30, 149.112.122.30&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection modify eno1 ipv4.method manual
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli connection reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ nmcli connection show
NAME  UUID               TYPE      DEVICE 
eno1  4d928341-........  ethernet  eno1   
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirm the system is using NetworkManager.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl restart NetworkManager.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl status NetworkManager.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo nmcli networking connectivity check
full
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

</description>
        <pubDate>Sun, 27 Mar 2022 09:48:33 -0700</pubDate>
        <link>http://localhost:4000/rhel/centos/linux/networking/howto/2022/03/27/rhel8-centos8-linux-setup-static-ip-address.html</link>
        <guid isPermaLink="true">http://localhost:4000/rhel/centos/linux/networking/howto/2022/03/27/rhel8-centos8-linux-setup-static-ip-address.html</guid>
        
        
        <category>rhel</category>
        
        <category>centos</category>
        
        <category>linux</category>
        
        <category>networking</category>
        
        <category>howto</category>
        
      </item>
    
      <item>
        <title>HPC with xCAT, PBS/TORQUE, Gaussian and WebMO</title>
        <description>&lt;p&gt;High Performance Computing (HPC) with xCAT (Extreme Cloud Administration 
Toolkit), PBS (Portable Batch System) with TORQUE (Terascale Open-source 
Resource and QUEue Manager), using Gaussian software package via WebMO&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Add  merging  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/passwd&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/shadow&lt;/code&gt;,
                          &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/group&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/gshadow&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;em&gt;About xCAT&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;xCAT is a collection of mostly script based tools to build, configure, 
administer, and maintain computing clusters.&lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;http://xcat.org/index.html#quickstart&quot;&gt;xCAT.org&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;xCAT is an open-source tool for automating deployment, scaling, and 
management of bare metal servers and virtual machines developed by IBM.&lt;/p&gt;

  &lt;p&gt;xCAT is an official IBM High Performance Computing (HPC) cluster
management tool.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;em&gt;Scenario:&lt;/em&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;New server hardware, Lenovo ThinkSystem SR530 - 7X08 (1U rack server),
has just been installed in the existing cluster environment.&lt;/li&gt;
  &lt;li&gt;The existing cluster consists of 28 CNs (compute nodes).&lt;/li&gt;
  &lt;li&gt;The cluster is on a private Ethernet network.  The address space is 
non-routable (unroutable) so the compute nodes are “hidden” from 
a routable network, allowing you to separate your cluster logically 
from a public network.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;em&gt;About the cluster environment in this scenario:&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;All of the nodes use the same hardware and the same operating system.&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;em&gt;Tasks:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;On the new Lenovo server:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Create a guest VM to be used as the new MN (management node)
    &lt;ul&gt;
      &lt;li&gt;On the guest VM (that is, the new MN):
        &lt;ul&gt;
          &lt;li&gt;Install the latest xCAT version&lt;/li&gt;
          &lt;li&gt;Show examples of managing IBM Blade Center&lt;/li&gt;
          &lt;li&gt;Show examples of related xCAT tables for the configuration&lt;/li&gt;
          &lt;li&gt;Remotely upgrade the OS on all CNs (computing nodes)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;em&gt;Where:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Computer cluster = a set of computers that work together so they can be 
viewed as a single system.  Computer clusters have each node (computer
used as a server) set to perform the same task.&lt;/p&gt;

&lt;p&gt;MN   = Management Node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;) 
(aka head node, master node or controller node) &lt;br /&gt;
HN   = Head Node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus.mydomain.com&lt;/code&gt;)  &lt;br /&gt;
CN   = Compute Node&lt;br /&gt;
xCAT = Extreme Cluster Administration Toolkit &lt;br /&gt;
HPC  = High Performance Computing &lt;br /&gt;
BMC  = Baseboard Management Controller  &lt;br /&gt;
IMM  = Integrated Management Module - aka as only MM (Management Module) &lt;br /&gt;
AMM  = Advanced Management Module &lt;br /&gt;
IPMI = Intelligent Platform Management Interface &lt;br /&gt;
SNMP = Simple Network Management Protocol &lt;br /&gt;
BC   = BladeCenter (IBM BladeCenter line of servers)  &lt;br /&gt;
SoL (also SOL) = Serial over LAN&lt;br /&gt;
RM   = Resource Manager (also called a job scheduler)  &lt;br /&gt;
PBS =  Portable Batch System &lt;br /&gt;
Fast Ethernet = 100 Mbps  &lt;br /&gt;
Gigabit Ethernet (GbE or 1 GigE) = 1,000 Mbps (1 Gbps; that is Gigabit per second)&lt;/p&gt;

&lt;p&gt;F1 Setup = IBM BladeCenter BIOS Setup (a.k.a. System/UEFI F1
Setup) - For example:
&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.hs21.doc/hs21_install_ug.pdf&quot;&gt;BladeCenter HS21 Installation and User’s Guide&lt;/a&gt;, page 39 (Retrieved on Mar 20, 2022): “Using the Configuration/Setup Utility program”:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;When the Configuration/Setup utility message appears, press F1.  […]&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;em&gt;Operating systems and shells:&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;MN: RHEL 8.5  (Red Hat Enterprise Linux release 8.5 (Ootpa)), Shell: tcsh&lt;/li&gt;
  &lt;li&gt;CNs: Upgrading from CentOS 5.2 to CentOS Linux 7.9, Shell: bash&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; &lt;br /&gt;
In the following examples, IP addresses of network interfaces 
connected to the public network/Internet are from network subnet
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123.12.23.0&lt;/code&gt;.  Replace those IP addresses with IP addresses of 
external interfaces in your environment.  Similarly, replace 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123.12.23.254&lt;/code&gt; with the broadcast address for external network 
interfaces in your environment.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;em&gt;Configuration:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Here is the hardware configuration in the environment:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;2 x IBM BladeCenter H Chassis
    &lt;ul&gt;
      &lt;li&gt;Each chassis has 14 x IBM HS21 Blade Servers (Blades) - total
of 28 compute nodes&lt;/li&gt;
      &lt;li&gt;Each chassis has the IBM BladeCenter Advanced Management Module (AMM)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;1 x IBM x3550 xServer (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xmgmt.mydomain.com&lt;/code&gt;, old MN, kept temporary)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Newly installed server hardware: &lt;a href=&quot;https://datacentersupport.lenovo.com/de/en/products/servers/thinksystem/sr530/7x08&quot;&gt;Lenovo ThinkSystem SR530 - Type (Model) 7X08 - Product Home Page&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Here is the network configuration in the environment:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;eno1: Public-facing NIC.  External network (aka public VLAN): &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123.12.23.x&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;eno2: Cluster-facing NIC.  Internal network (aka xCAT VLAN):  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.x&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Management VLAN: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.x&lt;/code&gt; (BC MM, BC AMM, BC LAN switches)&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;content&quot;&gt;Content:&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Create a QEMU VM Guest&lt;/li&gt;
  &lt;li&gt;Configure the Guest with Two NICs in Two Separate Networks Connected 
to Two Bridges on Host&lt;/li&gt;
  &lt;li&gt;Prepare the Management Node (MN)&lt;/li&gt;
  &lt;li&gt;Install and Configure xCAT (on the MN)&lt;/li&gt;
  &lt;li&gt;Stage 1: Add Your First Node and Control It with Out-Of-Band BMC Interface&lt;/li&gt;
  &lt;li&gt;Stage 2: Add Your Second Node and Configure It for SOL (Serial Over LAN) 
Operation (aka Text Mode Console)&lt;/li&gt;
  &lt;li&gt;Stage 3: Prepare Postscripts and Postbootscripts&lt;/li&gt;
  &lt;li&gt;Tests
    &lt;ul&gt;
      &lt;li&gt;Submit a Test Job to a Specific Node (Compute Node)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Setup NFS Server on the Head Node (HN) Running CentOS 8/RHEL 8
    &lt;ul&gt;
      &lt;li&gt;Configure Firewall Rules for NFS Server on CentOS 8/RHEL 8&lt;/li&gt;
      &lt;li&gt;Set Up NFS Client on Compute Nodes&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;create-a-qemu-vm-guest&quot;&gt;Create a QEMU VM Guest&lt;/h2&gt;

&lt;p&gt;This VM will be the xCAT MN (management node).&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Create QEMU VM guest on the new Lenovo server hardware&lt;/strong&gt; &lt;br /&gt;
  (This VM will be the new &lt;strong&gt;MN&lt;/strong&gt;)  &lt;br /&gt;
&lt;strong&gt;Note:&lt;/strong&gt;  I previously installed RHEL 8.5 on the new Lenovo server&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Install the most recent CentOS Linux version on the QEMU VM guest&lt;/strong&gt;&lt;br /&gt;
  (At the time of this writing:  CentOS 7.9 Linux)
    &lt;ul&gt;
      &lt;li&gt;Download and use CentOS DVD ISO image with everything &lt;br /&gt;
(file name: CentOS-7-x86_64-Everything-2009.iso)&lt;/li&gt;
      &lt;li&gt;Install CentOS 7.9 Linux in &lt;strong&gt;text mode&lt;/strong&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In order to conserve the limited bandwidth available, ISO images are not 
downloadable from mirror.centos.org.  To find a mirror closest to you in 
your region, visit the CentOS Project’s website, 
&lt;a href=&quot;https://centos.org/&quot;&gt;https://centos.org/&lt;/a&gt;.  Navigate to
Download &amp;gt; CentOS LInux &amp;gt; 7-2009 &amp;gt; x86_64.  For my region, the first listed 
mirror wtth the ISO images available was:&lt;br /&gt;
http://mirror.esecuredata.com/centos/7.9.2009/isos/x86_64/.&lt;/p&gt;

&lt;p&gt;Follow these instructions: 
&lt;a href=&quot;/howto/virtualization/rs232serial/cli/terminal/shell/console/sysadmin/server/hardware/2022/03/12/centos-rhel-dvd-iso-customization-testing-with-qemu.html&quot;&gt;Customize CentOS/RHEL DVD ISO for Installation in Text Mode via Serial Console and Test the Image with QEMU&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Changes that you need to make in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;isolinux.cfg&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;grub.cfg&lt;/code&gt; are shown below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ diff \
--unified=0 \
/mnt/dvd/isolinux/isolinux.cfg \
/mnt/customdvd/isolinux/isolinux.cfg
--- /mnt/dvd/isolinux/isolinux.cfg      2020-10-26 09:25:28.000000000 -0700
+++ /mnt/customdvd/isolinux/isolinux.cfg        2022-03-20 08:59:36.911058507 -0700
@@ -64 +64 @@
-  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 quiet
+  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 quiet console=tty0 console=ttyS0,19200
@@ -70 +70 @@
-  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rd.live.check quiet
+  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rd.live.check quiet console=tty0 console=ttyS0,19200
@@ -86 +86 @@
-  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 xdriver=vesa nomodeset quiet
+  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 xdriver=vesa nomodeset quiet console=tty0 console=ttyS0,19200
@@ -96 +96 @@
-  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rescue quiet
+  append initrd=initrd.img inst.stage2=hd:LABEL=CentOS\x207\x20x86_64 rescue quiet console=tty0 console=ttyS0,19200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ diff \
--unified=0 \
/mnt/dvd/EFI/BOOT/grub.cfg \
/mnt/customdvd/EFI/BOOT/grub.cfg
--- /mnt/dvd/EFI/BOOT/grub.cfg  2020-10-26 09:25:28.000000000 -0700
+++ /mnt/customdvd/EFI/BOOT/grub.cfg    2022-03-20 09:05:58.348907158 -0700
@@ -16,0 +17,4 @@
+serial --unit=0 --speed=19200 --word=8 --parity=no --stop=1
+terminal_input serial console=tty0 console=ttyS0,19200
+terminal_output serial console=tty0 console=ttyS0,19200
+
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Continue following the instructions on the same page
(&lt;a href=&quot;/howto/virtualization/rs232serial/cli/terminal/shell/console/sysadmin/server/hardware/2022/03/12/centos-rhel-dvd-iso-customization-testing-with-qemu.html&quot;&gt;Customize CentOS/RHEL DVD ISO for Installation in Text Mode via Serial Console and Test the Image with QEMU&lt;/a&gt;) up to the point of creating a raw image.
Then, instead of creating an image with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;truncate&lt;/code&gt; of 272 GB in size
(as in instructions on that page), create a raw image of 80 GB in size. 
Using seek option creates a sparse file, which saves space.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dd if=/dev/null of=xcatmn.img bs=1M seek=81920
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start CentOS 7.9 Linux installation with this command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-cdrom /tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso \
-drive format=raw,file=xcatmn.img \
-global ide-hd.physical_block_size=4096 \
-m 4G \
-boot d \
-enable-kvm \
-serial pty \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QEMU 4.2.0 monitor - type &apos;help&apos; for more information
(qemu) char device redirected to /dev/pts/2 (label serial0)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From QEMU monitor’s output above, note where qemu redirected char
device.  In this case: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dev/pts/2&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Open another shell instance, start &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;minicom&lt;/code&gt; and connect to the first 
serial device where QEMU redirected char device (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dev/pts/2&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ minicom --baudrate=19200 --ptty=/dev/pts/2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Install CentOS Linux 7.9.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==========================================================================
==========================================================================
Installation

 1) [x] Language settings                 2) [!] Time settings
        (English (United States))                (Timezone is not set.)
 3) [!] Installation source               4) [!] Software selection
        (Processing...)                          (Processing...)
 5) [!] Installation Destination          6) [x] Kdump
        (No disks selected)                      (Kdump is enabled)
 7) [ ] Network configuration             8) [!] Root password
        (Not connected)                          (Password is not set.)
 9) [!] User creation
        (No user will be created)
  Please make your choice from above [&apos;q&apos; to quit | &apos;b&apos; to begin installation |
  &apos;r&apos; to refresh]: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;2) Time settings &amp;gt; Set timezone &amp;gt; America &amp;gt; Vancouver  &amp;lt;-- Use your timezone
2) Time settings &amp;gt; Configure NTP servers &amp;gt; 
     Add NTP server &amp;gt; ntp1.serverinyourregion.org
     Add NTP server &amp;gt; ntp2.serverinyourregion.org   
4) Software selection &amp;gt; 3) Infrastructure Server
5) Installation Destination &amp;gt; QEMU HARDDISK: 80 GiB (sda) &amp;gt; Use All Space &amp;gt; LVM
7) Network configuration &amp;gt; 
     Set host name &amp;gt; xcatmn.mydomain.com
     Configure device ens3 &amp;gt;
        IPv4 address or &quot;dhcp&quot; for DHCP &amp;gt; dhcp
     IPv6 address &amp;gt; ignore
     Nameservers &amp;gt; 208.67.222.222,208.67.220.220  &amp;lt;-- Will list your nameservers
     Connect automatically after reboot
     Apply configuration in installer
8) Root password &amp;gt; 
     Password: 
     Password (confirm): 
9) User creation &amp;gt; 
     Create user &amp;gt; 
     Fullname &amp;gt;                                   &amp;lt;-- Enter your name 
     Username &amp;gt;                                   &amp;lt;-- Enter your username 
     Use password &amp;gt;
     Password &amp;gt;
       Password:
       Password (confirm):
     [X] Administrator &amp;gt; Groups wheel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;==========================================================================
==========================================================================
Installation

 1) [x] Language settings                 2) [x] Time settings
        (English (United States))                (America/Vancouver timezone)
 3) [x] Installation source               4) [x] Software selection
        (Local media)                            (Infrastructure Server)
 5) [x] Installation Destination          6) [x] Kdump
        (Automatic partitioning                  (Kdump is enabled)
        selected)                         8) [x] Root password
 7) [x] Network configuration                    (Password is set.)
        (Wired (ens3) connected)
 9) [x] User creation
        (Administrator dusko will be
        created)
  Please make your choice from above [&apos;q&apos; to quit | &apos;b&apos; to begin installation |
  &apos;r&apos; to refresh]: b
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Progress
Setting up the installation environment
[...]
Installing libgcc (1/483)
Installing grub2-common (2/483)
Installing centos-release (3/483)
Installing setup (4/483)
Installing filesystem (5/483)
[...]

   Installation complete.  Press return to quit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the CentOS 7.9 Linux installer, to switch to an interactive shell 
prompt with root privileges, press &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl+b&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt; (two characters: 
ctrl-b, and ‘2’).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[anaconda root@localhost ~]#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Power off the VM.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[anaconda root@localhost ~]# poweroff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;** &lt;strong&gt;TIP:&lt;/strong&gt; **  If you cannot exit &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;minicom&lt;/code&gt; with CTRL-X, first press Esc
                and then CTRL-X.&lt;/p&gt;

&lt;p&gt;To test and to confirm that the installed CentOS Linux 
really uses the first serial device ttyS0 (COM1) for a console,
start the QEMU guest VM by specifying the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-serial pty&lt;/code&gt; option.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-enable-kvm \
-serial pty \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;QEMU 4.2.0 monitor - type &apos;help&apos; for more information
(qemu) char device redirected to /dev/pts/2 (label serial0)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Open another shell instance, start &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;minicom&lt;/code&gt; and connect to the first 
serial device where QEMU redirected char device, in this case, /dev/pts/2.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ minicom --baudrate=19200 --ptty=/dev/pts/2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you see early boot messages/kernel log messages? If yes, that confirms
that the installed CentOS Linux uses the first serial device ttyS0 (COM1)
for a console.&lt;/p&gt;

&lt;p&gt;Log in to the guest virtual machine.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]
CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

xcatmn login: root
Password:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At this point (in addition to the virtual loopback adapter
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lo0&lt;/code&gt; &lt;a href=&quot;#footnotes&quot;&gt;²&lt;/a&gt; &lt;a href=&quot;#footnotes&quot;&gt;³&lt;/a&gt;), the guest VM has one Ethernet 
adapter, a.k.a. NIC (network interface controller or network interface 
card).  The name of that NIC that the OS (CentOS Linux) gave it to in 
this case is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ens3&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli device status
DEVICE  TYPE      STATE      CONNECTION
ens3    ethernet  connected  ens3
lo      loopback  unmanaged  --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli connection show
NAME  UUID                                  TYPE      DEVICE
ens3  0bb2148d-...........................  ethernet  ens3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here, the guest is connected to the host via SLiRP (user networking), 
where the assigned IP address starts from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.0.2.15&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ip -4 address show | grep inet
inet 127.0.0.1/8 scope host lo
inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic ens3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Show table routes (display the kernel routing tables):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ip route
default via 10.0.2.2 dev ens3 proto dhcp metric 100 
10.0.2.0/24 dev ens3 proto kernel scope link src 10.0.2.15 metric 100 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Alternatively, you can display the routing tables with the legacy
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;netstat(8)&lt;/code&gt; tool:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# netstat -r
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
default         gateway         0.0.0.0         UG        0 0          0 ens3
10.0.2.0        0.0.0.0         255.255.255.0   U         0 0          0 ens3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Power off the guest VM.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# poweroff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;configure-the-qemu-guest-vm-with-two-nics-in-two-separate-networks-connected-to-two-bridges-on-host&quot;&gt;Configure the QEMU Guest VM with Two NICs in Two Separate Networks Connected to Two Bridges on Host&lt;/h2&gt;

&lt;p&gt;Start the guest VM. 
This time don’t use the serial device for console; rather, use only the 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-nographic&lt;/code&gt; option.&lt;/p&gt;

&lt;p&gt;The host is connected to a public network &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123.12.23.x&lt;/code&gt; (the network
contains a DHCP server).  The guest VM is connected to that network via
the first bridge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br0&lt;/code&gt; and obtains a dynamic IP address.&lt;/p&gt;

&lt;p&gt;The host is also connected to another, private, cluster-facing
network, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.x&lt;/code&gt;.  The guest VM is connected to that
network via the second bridge &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;br1&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br0&quot;,id=hn0 \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br1&quot;,id=hn1 \
-device virtio-net-pci,netdev=hn0 \
-device virtio-net-pci,netdev=hn1 \
-nographic
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log into the guest OS.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

xcatmn login: root
Password: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli device status
DEVICE  TYPE      STATE                                  CONNECTION         
eth0    ethernet  connected                              Wired connection 1 
eth1    ethernet  connecting (getting IP configuration)  Wired connection 2 
lo      loopback  unmanaged                              --                 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli connection show 
NAME                UUID                                  TYPE      DEVICE 
Wired connection 2  7ef26cf9-...........................  ethernet  eth1   
Wired connection 1  a9f5c51d-...........................  ethernet  eth0   
ens3                687a79e8-...........................  ethernet  --     
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ip -4 address show | grep inet
inet 127.0.0.1/8 scope host lo
inet 123.12.23.235/24 brd 123.12.23.255 scope global noprefixroute dynamic eth0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ip route
default via 123.12.23.254 dev eth0 proto dhcp metric 100
123.12.23.0/24 dev eth0 proto kernel scope link src 123.12.23.235 metric 100
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# netstat -r
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
default         gateway         0.0.0.0         UG        0 0          0 eth0
123.12.23.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The name given by the OS (CentOS Linux) to the network interface 
controller/network interface card (NIC) connected to the &lt;strong&gt;internal&lt;/strong&gt; 
(private/cluster-facing/xCAT, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.x&lt;/code&gt;) network is  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eth1&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Set the IP address of that NIC to &lt;strong&gt;static&lt;/strong&gt; and assign it an IP address
from within &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.x&lt;/code&gt; network.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli connection show &apos;Wired connection 2&apos; | grep &apos;ipv4.method&apos;
ipv4.method:                            auto
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli \
connection modify &apos;Wired connection 2&apos; \
ip4 192.168.80.220/24 \
ipv4.method manual
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The name given by the OS (CentOS Linux) to the network interface 
controller/network interface card (NIC) connected to the &lt;strong&gt;public&lt;/strong&gt; 
(external/internet-facing, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123.12.23.x&lt;/code&gt;) network is  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eth0&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Set the IP address of that NIC to &lt;strong&gt;static&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli connection show &apos;Wired connection 1&apos; | grep &apos;ipv4.method&apos;
ipv4.method:                            auto
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;&lt;br /&gt;
In the next command, replace IP addresses in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmcli&lt;/code&gt; connection’s
properties &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip4&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gw4&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ipv4.dns&lt;/code&gt; with IP addresses for those
properties in your environment.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli \
connection modify &apos;Wired connection 1&apos; \
ip4 123.12.23.235/24 gw4 123.12.23.254 \ 
ipv4.dns &apos;208.67.222.222,208.67.220.220&apos; \   &amp;lt;-- Use your DNS servers
ipv4.method manual
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli \
connection modify &apos;Wired connection 1&apos; \
connection.id eth0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli \
connection modify &apos;Wired connection 2&apos; \
connection.id eth1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Restart NetworkManager service.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart NetworkManager.service 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If that doesn’t refresh routing, use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmcli(1)&lt;/code&gt; to restart networking.
The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;networking off&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;networking on&lt;/code&gt; disables and then enables
networking control by NetworkManager.  All interfaces managed by
NetworkManager are deactivated when networking is disabled.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli networking off
# nmcli networking on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check network connectivity state. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;check&lt;/code&gt; argument tells
NetworkManager to re-check the connectivity.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli networking connectivity check
full
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ip route
default via 123.12.23.254 dev eth0 proto static metric 100
123.12.23.0/24 dev eth0 proto kernel scope link src 123.12.23.235 metric 100
192.168.80.0/24 dev eth1 proto kernel scope link src 192.168.80.220 metric 101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli device status
DEVICE  TYPE      STATE      CONNECTION 
eth0    ethernet  connected  eth0       
eth1    ethernet  connected  eth1       
lo      loopback  unmanaged  --         
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmcli connection show
NAME  UUID                                  TYPE      DEVICE 
eth0  a9f5c51d-...........................  ethernet  eth0   
eth1  7ef26cf9-...........................  ethernet  eth1   
ens3  687a79e8-...........................  ethernet  --     
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test connection to a public host.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ping -c2 freebsd.org
PING freebsd.org (96.47.72.84) 56(84) bytes of data.
64 bytes from wfe0.nyi.freebsd.org (96.47.72.84): icmp_seq=1 ttl=50 time=76.1 ms
64 bytes from wfe0.nyi.freebsd.org (96.47.72.84): icmp_seq=2 ttl=50 time=76.1 ms
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test internal network connection.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ping -c2 192.168.80.210
PING 192.168.80.210 (192.168.80.210) 56(84) bytes of data.
64 bytes from 192.168.80.210: icmp_seq=1 ttl=64 time=0.477 ms
64 bytes from 192.168.80.210: icmp_seq=2 ttl=64 time=0.303 ms
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Install &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dnf(8)&lt;/code&gt;. (From its man page:  DNF  is  the  next upcoming major 
version of YUM, a package manager for RPM-based Linux distributions.
It roughly maintains CLI compatibility with YUM and defines a strict API
for extensions and plugins.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# yum install dnf dnf-data dnf-plugins-core
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  &lt;br /&gt;
In case of a bit older IBM blade servers, instead of &lt;strong&gt;AMM&lt;/strong&gt;
(Advanced Management Module), chassis for older IBM blade servers
would have &lt;strong&gt;MM&lt;/strong&gt; (Management Module).  In that case you would need
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;telnet&lt;/code&gt; to access the &lt;strong&gt;MM&lt;/strong&gt; and you would need to install it:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# dnf install telnet
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;prepare-the-management-node-mn&quot;&gt;Prepare the Management Node (MN)&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  After the real cluster setup is finished,
change references to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xmgmt&lt;/code&gt; (with IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.200&lt;/code&gt;) 
to the new(ly) installed server (with IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.210&lt;/code&gt;):&lt;/p&gt;

&lt;p&gt;The cluster was partially upgraded in summer of 2021, and here’s the list 
of those upgrades:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The WebMO server hardware was replaced.  It was an IBM blade server (HS20)
in a separate IBM chassis. &lt;br /&gt;
The new server hardware is Lenovo ThinkSystem
SR530 - Type (Model) 7X08, with hostname &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus.mydomain.com&lt;/code&gt;, while the
“internal” hostname (for PBS software, TORQUE Resource Manager) is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mgmt&lt;/code&gt;,
and the IP address on the cluster-facing network is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.210&lt;/code&gt;.
    &lt;ul&gt;
      &lt;li&gt;This server has multiple roles:
        &lt;ul&gt;
          &lt;li&gt;webserver (for running WebMO)&lt;/li&gt;
          &lt;li&gt;storage server, with a shared directory across the nodes (via NFS)&lt;/li&gt;
          &lt;li&gt;host for the majority of MN software (everything except DHCP server)
            &lt;ul&gt;
              &lt;li&gt;&lt;strong&gt;Note:&lt;/strong&gt; will move DHCP server to the new Lenove server later&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;The OS on this server (“WebMO server”) was updated from RHEL 5.2 to RHEL 8.4.&lt;/li&gt;
  &lt;li&gt;The storage server a.k.a. NFS server (named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xmgmtnfs.mydomain.com&lt;/code&gt;) 
was moved from a separate legacy IBM SAN array to the new Lenovo server 
(Lenovo ThinkSystem SR530 - 7X08).  The new storage is a 6TB ZFS shared 
to CNs (compute nodes) via NFS.  The old hostname &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xmgmtnfs.mydomain.com&lt;/code&gt; 
was retired.&lt;/li&gt;
  &lt;li&gt;All PBS &lt;strong&gt;managment&lt;/strong&gt; software and the both PBS management services
(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbs_server&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbs_sched&lt;/code&gt;) were moved to the new server.
    &lt;ul&gt;
      &lt;li&gt;The old xCAT (on the old MN, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xmgmt.mydomain.com&lt;/code&gt;) was temporarily kept
for managing BMC (two IBM chassis with 14 blades in each so 28 blades
in total)&lt;/li&gt;
      &lt;li&gt;The old MN (hostname: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xmgmt.mydomain.com&lt;/code&gt;, IP address on the
cluster-facing network: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.200&lt;/code&gt;) is kept and temporarily
used as a DHCP server.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;configure-dns-settings&quot;&gt;Configure DNS Settings&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; The hostname was set during the OS installation on the guest VM.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# hostname
xcatmn.mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /etc/hostname 
xcatmn.mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Update your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/resolv.conf&lt;/code&gt; with DNS settings and make sure that the 
node can visit &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;github&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcat&lt;/code&gt; official website.&lt;/p&gt;

&lt;p&gt;Configure any domain search strings and nameservers in 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/resolv.conf&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /etc/resolv.conf 
# Generated by NetworkManager
search xcatmn.mydomain mydomain.com 
nameserver 208.67.222.222   &amp;lt;-- Will show your DNS server 1
nameserver 208.67.220.220   &amp;lt;-- Will show your DNS server 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Verify that your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; file contains entries for all of your
management node interfaces.  Manually add any that are missing.&lt;/p&gt;

&lt;p&gt;Add &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn&lt;/code&gt; into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# printf %s\\n &quot;192.168.80.220 xcatmn&quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.80.220 xcatmn xcatmn.mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Power off the guest virtual machine.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# poweroff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start and run the guest VM in the background by using QEMU’s
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-daemonize&lt;/code&gt; option.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br0&quot;,id=hn0 \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br1&quot;,id=hn1 \
-device virtio-net-pci,netdev=hn0 \
-device virtio-net-pci,netdev=hn1 \
-daemonize
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ps aux | grep -v grep | grep qemu
dusko     681555 94.6  2.1 4809628 678648 ?      Sl   15:39   0:21 /usr/libexec/qemu-kvm -drive format=raw,file=xcatmn.img -m 4G -netdev tap,helper=/usr/libexec/qemu-bridge-helper --br=br0,id=hn0 -netdev tap,helper=/usr/libexec/qemu-bridge-helper --br=br1,id=hn1 -device virtio-net-pci,netdev=hn0 -device virtio-net-pci,netdev=hn1 -daemonize
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;disable-selinux&quot;&gt;Disable SELinux&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sed -i.bkp &apos;s/^SELINUX=.*$/SELINUX=disabled/&apos; /etc/selinux/config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# diff \
--unified=0 \
/etc/selinux/config.bkp \
/etc/selinux/config
--- /etc/selinux/config.bkp     2022-03-30 20:40:36.167508553 -0700
+++ /etc/selinux/config 2022-03-03 20:43:28.580246360 -0700
@@ -7 +7 @@
-SELINUX=enforcing
+SELINUX=disabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A reboot is the most convenient way to make the disabling of SELinux 
take effect so if you want, you can now reboot and log in again.&lt;/p&gt;

&lt;h2 id=&quot;install-and-configure-xcat&quot;&gt;Install and Configure xCAT&lt;/h2&gt;

&lt;p&gt;Based on &lt;a href=&quot;https://xcat-docs.readthedocs.io/en/latest/guides/get-started/quick_start.html&quot;&gt;xCAT Quick Start Guide&lt;/a&gt; (retrieved on Mar 20, 2022) and then slightly modified.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Prerequisites and Assumptions&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Assume there are two servers named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt; and 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101.mydomain.com&lt;/code&gt;.  The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt; is going 
to be the MN (management node) [you can proably call it an 
“xCAT server” as well].  The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101.mydomain.com&lt;/code&gt; will 
be a compute node you will be provisioning.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;They are in the same subnet &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.0&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101.mydomain.com&lt;/code&gt; is a CN (compute node), which is one of 14 blades in
 an IBM chassis.  The IBM chassis and the 14 included blades are managed
 by BMC, which the MN (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;) can access.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt; has RHEL 8 installed, and uses an IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt; has access to internet.&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;For the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101.mydomain.com&lt;/code&gt; compute node: BMC in the chassis that hosts this blade server, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101.mydomain.com&lt;/code&gt; (and other 13 blades running compute nodes on them), has an IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.135&lt;/code&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Prepare a full DVD for OS provision, and not a Live CD ISO.  &lt;br /&gt;
For this example, I use a &lt;strong&gt;customized&lt;/strong&gt;
CentOS-7-x86_64-Everything-2009.iso DVD.
(See steps above.)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;BMC&lt;/strong&gt;&lt;br /&gt;
MM1: 192.168.80.135 &lt;br /&gt;
MM2: empty&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;IBM BladeCenter Enclosure (Chassis)&lt;/strong&gt; &lt;br /&gt;
Product Group: BladeCenter &lt;br /&gt;
Type:  IBM BladeCenter E Type-8677&lt;br /&gt;
Part no.: 39R8561 &lt;br /&gt;
FRU no.: 39R8563 &lt;br /&gt;
MM slots: 2 &lt;br /&gt;
Blade slots: 14 &lt;br /&gt;
I/O Module slots: 4 &lt;br /&gt;
Power Module slots: 4 &lt;br /&gt;
Blower slots: 2&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;14 blades&lt;/strong&gt; (14 blade servers)&lt;br /&gt;
14 x IBM 8853-AC1 HS21 Bladeserver&lt;br /&gt;
(Each blade is Machine Type: 8853, PID: 8853AC1)&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  After successul setup/test, add the info for the other chassis.&lt;/p&gt;

&lt;p&gt;All the following steps should be executed in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# wget \
https://raw.githubusercontent.com/xcat2/xcat-core/master/xCAT-server/share/xcat/tools/go-xcat \
-O - &amp;gt; \
/tmp/go-xcat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod +x /tmp/go-xcat
# /tmp/go-xcat install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]
If you are installing/updating xCAT-genesis-base separately, not as part
of installing/updating all of xCAT, run &apos;mknb &amp;lt;arch&amp;gt;&apos; manually
[...]
Created symlink from /etc/systemd/system/multi-user.target.wants/xcatd.service
to /usr/lib/systemd/system/xcatd.service.

[...]
xCAT has been installed!
========================

If this is the very first time xCAT has been installed, run one of the
following commands to set the environment variables.

For sh:
    source /etc/profile.d/xcat.sh

For csh:
    source /etc/profile.d/xcat.csh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For choosing whether to run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;For sh&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;For csh&lt;/code&gt; command (script): &lt;br /&gt;
The guest VM’s shell is bash, which is intended to be compatible with the
original UNIX Bourne Shell (/bin/sh).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ps $$
  PID TTY      STAT   TIME COMMAND
 1532 pts/0    Ss     0:00 -bash

# printf %s\\n &quot;$SHELL&quot;
/bin/bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So run the command &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;For sh&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# source /etc/profile.d/xcat.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Verify xCAT installation.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsxcatd -a 
Version 2.16.3 (git commit d6c76ae5f66566409c3416c0836660e655632194, 
  built Wed Nov 10 09:58:20 EST 2021)
This is a Management Node
dbengine=SQLite
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check xCAT service status.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl status xcatd.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;xCAT creates the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;networks&lt;/code&gt; table automatically.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site
[...]

# tabdump networks
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Configure the system password for the &lt;strong&gt;root&lt;/strong&gt; user on the
&lt;strong&gt;compute nodes&lt;/strong&gt;.  For example, if you wanted to set the password
to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abc!!123(??)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab key=system passwd.username=root passwd.password=&apos;abc!!123(??)&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump passwd
#key,username,password,cryptmethod,authdomain,comments,disable
&quot;system&quot;,&quot;root&quot;,&quot;abc!!123(??)&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;stage-1-add-your-first-node-and-control-it-with-out-of-band-bmc-interface&quot;&gt;Stage 1: Add Your First Node and Control It with Out-Of-Band BMC Interface&lt;/h2&gt;

&lt;p&gt;To get a list of data object types that are supported by xCAT:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef --help 
[...]
The following data object types are supported by xCAT:

auditlog boottarget eventlog firmware group kit kitcomponent kitrepo
monitoring network node notification osdistro osdistroupdate osimage
pdu policy rack route site taskstate zone zvmivp
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To get a list of valid attribute names for each object type, use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkdef&lt;/code&gt;
with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-h&lt;/code&gt; option together with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t &amp;lt;object-types&amp;gt;&lt;/code&gt; option.
For example, to get a list of valid attribute names for object type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node | grep ^ip
ip:    The IP address of the node. This is only used in makehosts.
The rest of xCAT uses system name resolution to resolve node names
to IP addresses.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node | grep ^mac
mac:    The mac address or addresses for which xCAT will manage static
bindings for this node.    &amp;lt;-- a.k.a. MAC address of the node
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node | grep -w ^bmc
bmc:    The hostname of the BMC adapter.  &amp;lt;-- Or the BMC&apos;s IP address
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To get the MAC address of the node with IP address 192.168.80.1:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ping -c2 192.168.80.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# arp -a | grep &apos;192.168.80.1&apos;
? (192.168.80.1) at 00:11:22:33:44:55 [ether] on eth1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; If you don’t have network connection with this node, you can
obtain its MAC address by logging in to the &lt;strong&gt;AMM&lt;/strong&gt;/&lt;strong&gt;MM&lt;/strong&gt; (&lt;strong&gt;BMC&lt;/strong&gt;).
From Prerequisites (assumptions) above, you already know that
the BMC IP address is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.135&lt;/code&gt;.)&lt;/p&gt;

&lt;h3 id=&quot;connecting-to-cli-on-mm-amm&quot;&gt;Connecting to CLI on MM (AMM)&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# telnet 192.168.80.135
Trying 192.168.80.135...
Connected to 192.168.80.135.
Escape character is &apos;^]&apos;.

username: YOUR_BMC_USERID
password: YOUR_BMC_PASSWORD
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The CLI command prompt is displayed:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;system&amp;gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt; Is it now &lt;strong&gt;AMM&lt;/strong&gt; (advanced management module) because the BMC
was replaced on 2022-06-13?&lt;/p&gt;

&lt;p&gt;You can now enter commands for the &lt;strong&gt;AMM&lt;/strong&gt; (advanced management 
module)/&lt;strong&gt;MM&lt;/strong&gt; (management module) [depending on whether your chassis 
uses &lt;strong&gt;AMM&lt;/strong&gt; or &lt;strong&gt;MM&lt;/strong&gt;].&lt;/p&gt;

&lt;p&gt;Display information on the first blade in the blade chassis.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  Don’t type &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system&amp;gt;&lt;/code&gt;&lt;/strong&gt; &lt;br /&gt;
It’s a BMC CLI prompt, and it’s shown here to indicate that you are 
using the AMM (or MM).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;system&amp;gt; info -T system:blade[1]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;** &lt;strong&gt;TIP:&lt;/strong&gt; **  You can shorten &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-T system:blade[1]&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-T blade[1]&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;system&amp;gt; info -T blade[1]
[...]
MAC Address 1: 00:21:5E:2C:0E:D2
MAC Address 2: 00:21:5E:2C:0E:D4
MAC Address 3: Not Available
MAC Address 4: Not Available
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log off from the AMM CLI (or MM CLI).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;system&amp;gt; exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back in the guest VM:&lt;br /&gt;
(&lt;strong&gt;Note:&lt;/strong&gt; This is optional; just to show where you can get information 
about node attributes.)&lt;/p&gt;

&lt;p&gt;List information about &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmcusername&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmcpassword&lt;/code&gt; attributes for 
object type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node | grep ^bmcusername
bmcusername:    The BMC userid.  If not specified, the key=ipmi row
in the passwd table is used as the default.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node | grep ^bmcpassword
bmcpassword:    The BMC password.  If not specified, the key=ipmi row
in the passwd table is used as the default.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--template&lt;/code&gt; option of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lsdef(1)&lt;/code&gt; command to display
the object definition templates shipped in xCAT.&lt;/p&gt;

&lt;p&gt;To list all the object definition templates:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef --template 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Continuing with the setup: &lt;br /&gt;
Create an xCAT data object definition for this node (name it &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;).&lt;br /&gt;
Explanation: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip&lt;/code&gt; = IP address of the node; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mac&lt;/code&gt; = MAC address of
the node; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmc&lt;/code&gt; = IP address of the MM (BMC); &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmcusername&lt;/code&gt; = username of
BMC (MM) account; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmcpassword&lt;/code&gt; = password for BMC (MM) user.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef \
-t node abacus101 \
--template x86_64-template \
ip=192.168.80.1 \
mac=00:11:22:33:44:55 \
bmc=192.168.80.135 \
bmcusername=YOUR_BMC_USERID \
bmcpassword=YOUR_BMC_PASSWORD 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The domain of the xCAT node must be provided in an xCAT network definition
or the xCAT site definition.  Otherwise, two commands in the subsequent
steps for configuring DNS (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makehosts abacus101&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedns -n&lt;/code&gt;) will
not work.&lt;/p&gt;

&lt;p&gt;Currently, the domain is not defined in site table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep domain
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;domain&lt;/code&gt; key and value (in this example &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mydomain.com)&lt;/code&gt; to
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab key=domain site.value=mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; &lt;br /&gt;
Alternatively, instead of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chtab(8)&lt;/code&gt; command, you could use the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chdef(1)&lt;/code&gt; command to add the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;domain&lt;/code&gt; key (and value) to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef -t site domain=mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Update the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; file with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makehosts(8)&lt;/code&gt; command to only 
replace the lines in the file that correspond to the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makehosts abacus101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The node’s IP address and hostname are added to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tail -1 /etc/hosts
192.168.80.1 abacus101 abacus101.mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Complete DNS setup by updating DNS records with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedns(8)&lt;/code&gt; command.
(This also restarts &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;named&lt;/code&gt; service.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedns -n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus101
Object name: abacus101
    arch=x86_64
    bmc=192.168.80.135
    bmcpassword=YOUR_BMC_USERID
    bmcusername=YOUR_BMC_PASSWORD
    cons=ipmi
    getmac=ipmi
    groups=all
    ip=192.168.80.1
    mac=00:11:22:33:44:55
    mgt=ipmi
    netboot=xnba
    postbootscripts=otherpkgs
    postscripts=syslog,remoteshell,syncfiles
    serialport=0
    serialspeed=115200
    usercomment=the system X node definition
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To get the list of data object types supported by xCAT:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef --help
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]
The following data object types are supported by xCAT:
  auditlog boottarget eventlog firmware group kit kitcomponent kitrepo 
  monitoring network node notification osdistro osdistroupdate osimage 
  pdu policy rack route site taskstate zone zvmivp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To get a list of valid attribute names for each object type, use the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkdef(1)&lt;/code&gt; command with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-h&lt;/code&gt; option together with the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t &amp;lt;object-types&amp;gt;&lt;/code&gt; option.&lt;/p&gt;

&lt;p&gt;For example, to get a list of valid attribute names for object type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;fix-for-blade---aka-touchup-for-blade&quot;&gt;Fix for Blade - aka Touchup for Blade&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node | grep -w ^mgt 
mgt:    The method to use to do general hardware management of the node.
This attribute is used as the default if power or getmac is not set.  
Valid values: openbmc, ipmi, blade, hmc, ivm, fsp, bpa, kvm, esx, rhevm.  
See the power attribute for more details.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef -h -t node | grep -w ^cons
cons:    The console method. If nodehm.serialport is set, this will default
to the nodehm.mgt setting, otherwise it defaults to unused.
Valid values: cyclades, mrv, or the values valid for the mgt attribute.

# mkdef -h -t node | grep -w ^serialport
serialport:    The serial port for this node, in the linux numbering style 
(0=COM1/ttyS0, 1=COM2/ttyS1).  For SOL on IBM blades, this is typically 1.
For rackmount IBM servers, this is typically 0.

# mkdef -h -t node | grep -w ^serialspeed
serialspeed:    The speed of the serial port for this node.  
For SOL this is typically 19200.

# mkdef -h -t node | grep -w ^power
power:    The method to use to control the power of the node. If not set,
the mgt attribute will be used.  Valid values: ipmi, blade, hmc, ivm, fsp,
kvm, esx, rhevm.  If &quot;ipmi&quot;, xCAT will search for this node in the ipmi
table for more info.  If &quot;blade&quot;, xCAT will search for this node in the
mp table.  If &quot;hmc&quot;, &quot;ivm&quot;, or &quot;fsp&quot;, xCAT will search for this node in
the ppc table.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As this is a blade server, you need to change the following attributes
for the node object &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;:&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mgmt&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getmac&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cons&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;In addition, this particular blade model, IBM &lt;strong&gt;HS21&lt;/strong&gt;, does &lt;strong&gt;not&lt;/strong&gt;
support &lt;strong&gt;IPMI&lt;/strong&gt;:&lt;/p&gt;

&lt;p&gt;Per 
&lt;a href=&quot;https://ipmitool-devel.narkive.com/gWukmQ01/ibm-gear&quot;&gt;[Ipmitool-devel] IBM gear&lt;/a&gt; (Retrieved on Mar 20, 2022):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Unfortunately, the IBM Bladecenter does not expose IPMI over LAN. This
comes from effort to maintain backwards compatibility with the days before
IPMI existed and trying to make the POWER and x86 systems all act the same
when in a chassis. Implementing remote management for CLI/scripting use
can be done either by:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;Scripting the CLI (not bad if you set up ssh keys). […]&lt;/li&gt;
    &lt;li&gt;Using SNMP.&lt;/li&gt;
    &lt;li&gt;Using some higher level software that knows how to speak IPMI and IBM
Blade (requires extra setup).  For example with xCAT:&lt;/li&gt;
  &lt;/ul&gt;

  &lt;p&gt;Power state of a KVM guest:&lt;/p&gt;

  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower vmgt state
vmgt: on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;p&gt;Power state of a blade:&lt;/p&gt;

  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower h01 state
h01: on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;Also see:&lt;br /&gt;
&lt;a href=&quot;https://www.mail-archive.com/ipmitool-devel@lists.sourceforge.net/msg00951.html&quot;&gt;Re: [Ipmitool-devel] ‘ipmitool sol info’ yields ‘Invalid command’&lt;/a&gt; (Retrieved on Mar 20, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;While the blades do communicate with the management module in a blade
chassis using IPMI, they don’t support doing SOL the way other platforms
do.  Instead, to access the serial console you need to telnet to the
 management module (MM or AMM), log in and then issue this command:&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sourceforge.net/p/xcat/mailman/message/24363746/&quot;&gt;Re: [xcat-user] HS21 blade BMC&lt;/a&gt; (Retrieved on Mar 20, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;The BMC IP address on all shipped IBM Blades to date is not useful for
what you’d expect. The IPMI aspect of the service processor terminates
within the chassis and the AMM will aggressively change the IP
configuration of the BMCs via the dedicated management bus. For IBM
BladeCenter, IPMI is only accessible via in-band methods. All
out-of-band management is done either via SMASH CLP, SNMP (xCAT uses
SNMP to implement IBM blade support), a BladeCenter CLI via telnet or
SSH, a web interface, or IBM proprietary protocols that IBM Director uses.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://communities.vmware.com/t5/vMotion-Resource-Management/IBM-BladeCenter-H-and-IPMI/td-p/278986&quot;&gt;IBM BladeCenter H and IPMI&lt;/a&gt;
(Retrieved on Mar 20, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Instructions in this section do not apply to IBM BladeCenters.
IBM BladeCenter do not have IPMI remote access to the BMC on a Blade
(the BMC IP address is not available outside of the BladeCenter).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Continuing with the setup: &lt;br /&gt;
Instead of IPMI, for remote control of this type of blade I use the
serial port so these two attributes need to be changed as well:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;serialport&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;serialspeed&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus101 -i cons,mgt,getmac,serialport,serialspeed
Object name: abacus101
    cons=ipmi
    getmac=ipmi
    mgt=ipmi
    serialport=0
    serialspeed=115200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Change xCAT data object definition for this node with the specified values
for attributes &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cons&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;getmac&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mgt&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;serialport&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;serialspeed&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef \
-t node \
-o abacus101 \
cons=blade mgt=blade getmac=blade serialport=1 serialspeed=19200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus101 -i cons,mgt,getmac,serialport,serialspeed
Object name: abacus101
    cons=blade
    getmac=blade
    mgt=blade
    serialport=1
    serialspeed=19200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus101
Object name: abacus101
    arch=x86_64
    cons=blade
    getmac=blade
    groups=all
    ip=192.168.80.1
    mac=00:11:22:33:44:55
    mgt=blade
    netboot=xnba
    postbootscripts=otherpkgs
    postscripts=syslog,remoteshell,syncfiles
    serialport=1
    serialspeed=19200
    usercomment=the system X node definition
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; hardware control. &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; power management:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower abacus101 state
no mpa defined for node abacus101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;the-mpa-table&quot;&gt;The mpa Table&lt;/h3&gt;

&lt;p&gt;This table is where you put the information for a BladeCenter management
module (&lt;strong&gt;MM&lt;/strong&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# man mpa
NAME
       mpa - a table in the xCAT database.

SYNOPSIS
       mpa Attributes:  mpa, username, password, displayname, slots, urlpath,
       comments, disable

DESCRIPTION
       Contains info about each Management Module and how to access it.
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# man mp
NAME
       mp - a table in the xCAT database.

SYNOPSIS
       mp Attributes:  node, mpa, id, nodetype, comments, disable

DESCRIPTION
       Contains the hardware control info specific to blades.  This table also
       refers to the mpa table, which contains info about each Management
       Module.
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add username and password for &lt;strong&gt;MM&lt;/strong&gt; (&lt;strong&gt;BMC&lt;/strong&gt;) to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; table. &lt;br /&gt;
(This is the MM from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmcusername&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmcpassword&lt;/code&gt; in the above
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lsdef abacus101 [...]&lt;/code&gt; command.  The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; attribute in the command
below is that MM’s hostname, which in this case is: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xbcmm1n&lt;/code&gt;.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
mpa=xbcmm1n \
mpa.username=YOUR_BMC_USERID \
mpa.password=YOUR_BMC_PASSWORD
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mpa 
#mpa,username,password,displayname,slots,urlpath,comments,disable
&quot;xbcmm1n&quot;,&quot;YOUR_BMC_USERID&quot;,&quot;YOUR_BMC_PASSW0RD&quot;,,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add the BMC (MM) node to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table.
As the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table refers to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; table, add the attribute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; to
the table &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=xbcmm1n \
mp.mpa=xbcmm1n \
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similarly, add attributes of the newly added node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;) to the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table: add the node’s name (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node=abacus101&lt;/code&gt;) and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id&lt;/code&gt; (it’s best to make
this number the same as the node name so in this case it’s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=abacus101 \
mp.mpa=xbcmm1n \
mp.id=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mp
#node,mpa,id,nodetype,comments,disable
&quot;xbcmm1n&quot;,&quot;xbcmm1n&quot;,,,,
&quot;abacus101&quot;,&quot;xbcmm1n&quot;,&quot;1&quot;,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; attribute is now defined for node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus101 | grep mpa
    mpa=xbcmm1n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; &lt;br /&gt;
Alternatively, you can display only attributes you are interested in by
using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-i comma-separated-attr-list&lt;/code&gt; option:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus101 -i mpa
Object name: abacus101
    mpa=xbcmm1n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus101
Object name: abacus101
    arch=x86_64
    cons=blade
    getmac=blade
    groups=all
    id=14
    ip=192.168.80.14
    mac=00:21:5E:2C:0A:AC
    mgt=blade
    mpa=xbcmm1n
    netboot=xnba
    postbootscripts=otherpkgs
    postscripts=syslog,remoteshell,syncfiles
    serialport=1
    serialspeed=19200
    usercomment=the system X node definition
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump passwd
#key,username,password,cryptmethod,authdomain,comments,disable
&quot;system&quot;,&quot;root&quot;,&quot;abc!!123(??)&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add username and password for &lt;strong&gt;MM&lt;/strong&gt; (&lt;strong&gt;BMC&lt;/strong&gt;) to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passwd&lt;/code&gt; table.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
key=blade \
passwd.username=YOUR_BMC_USERID \
passwd.password=YOUR_BMC_PASSWORD
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump passwd
#key,username,password,cryptmethod,authdomain,comments,disable
&quot;system&quot;,&quot;root&quot;,&quot;abc!!123(??)&quot;,,,,
&quot;blade&quot;,&quot;YOUR_BMC_USERID&quot;,&quot;YOUR_BMC_PASSWORD&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Verify that your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; file contains entries for all of your
management node interfaces.  Manually add any that are missing.&lt;/p&gt;

&lt;p&gt;Add &lt;strong&gt;MM&lt;/strong&gt; (&lt;strong&gt;BMC&lt;/strong&gt;) hostname (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xbcmm1n&lt;/code&gt;) and its IP address
to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# printf %s\\n &quot;192.168.80.135 xbcmm1n&quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; hardware control. &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; power management:&lt;/p&gt;

&lt;p&gt;If there’s an “Unsupported security level” error like the one shown below,
you need to add the MM (BMC) to xCAT database and to register it.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower abacus101 state
abacus101: [xcatmn]: Error: Unsupported security level
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To fix it, first check whether you can communicate with the MM (BMC):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n snmpdest
Error: Invalid nodes and/or groups in noderange: xbcmm1n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This particular MM (BMC) has not been added to xCAT database.
For now, xCAT has only one node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodels
abacus101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef xbcmm1n
Error: [xcatmn]: Could not find an object named &apos;xbcmm1n&apos; of type &apos;node&apos;.
No object definitions have been found
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Discover all networked services information &lt;strong&gt;within the cluster subnet&lt;/strong&gt;
(connected via the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eth1&lt;/code&gt; network adapter with IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;)
and write output to xCAT database:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ip -4 address show eth1 | grep inet
    inet 192.168.80.220/24 brd 192.168.80.255 scope global noprefixroute eth1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsslp -i 192.168.80.220 -w
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodels
Server--SNYK123456E1AB
abacus101
xbcmm1n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef xbcmm1n
Object name: xbcmm1n
    groups=mm,all
    id=0
    mgt=blade
    mpa=xbcmm1n
    postbootscripts=otherpkgs
    postscripts=syslog,remoteshell,syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If a request for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snmpdest&lt;/code&gt; from the MM (BMC) is empty as shown here:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n snmpdest
xbcmm1n: SP SNMP Destination 1: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;enable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snmpcfg&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sshcfg&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n snmpcfg=enable sshcfg=enable
xbcmm1n: SNMP enable: OK
xbcmm1n: SSH enable: OK
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that, request for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snmpdest&lt;/code&gt; gets answered:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n snmpdest
xbcmm1n: SP SNMP Destination 1: 0.0.0.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n snmpcfg
xbcmm1n: SNMP: enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n sshcfg 
xbcmm1n: SSH: enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While you are here, rename the &lt;strong&gt;MM&lt;/strong&gt; (&lt;strong&gt;BMC&lt;/strong&gt;) Server–SNYK123456E1AB 
(BMC on the other chassis) node to xbcmm2:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef \
-t node \
-o Server--SNYK123456E1AB \
-n xbcmm2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add username and password for &lt;strong&gt;MM&lt;/strong&gt; (&lt;strong&gt;BMC&lt;/strong&gt;) to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; table.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
mpa=xbcmm2 \
mpa.username=YOUR_BMC_USERNAME \
mpa.password=YOUR_BMC_PASSWORD
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the same &lt;strong&gt;MM&lt;/strong&gt; (&lt;strong&gt;BMC&lt;/strong&gt;) node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xbcmm2&lt;/code&gt;, change the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; attribute in
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table (set it to be the same as the node name, that is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xbcmm2&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab
node=xbcmm2 \
mp.mpa=xbcmm2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Verify that your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; file contains entries for all of your
management node interfaces.  Manually add any that are missing.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# printf %s\\n &quot;192.168.80.127 xbcmm2&quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back to continuing the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; provisioning:&lt;/p&gt;

&lt;p&gt;Hardware control check for power management for node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;
works now:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower abacus101 state
abacus101: on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; firmware information:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rinv abacus101 all
abacus101: Machine Type/Model: 8853AC1
abacus101: Serial Number: KQCCXBT
abacus101: MAC Address 1: 00:21:5E:2C:0E:D2
abacus101: MAC Address 2: 00:21:5E:2C:0E:D4
abacus101: Management Module firmware: 36 (BPET36M 07-02-08)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;provision-a-node-and-manage-it-with-parallel-shell&quot;&gt;Provision a Node and Manage It with Parallel Shell&lt;/h3&gt;

&lt;h4 id=&quot;configure-dhcp&quot;&gt;Configure DHCP&lt;/h4&gt;

&lt;p&gt;In order to PXE boot, you need a DHCP server to hand out IP addresses
and direct the booting system to the TFTP server where it can download
the network boot files.&lt;/p&gt;

&lt;p&gt;Which networks &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcpd&lt;/code&gt; (dhcp daemon) should listen on can be controlled
by the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcpinterfaces&lt;/code&gt; attribute in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site(5)&lt;/code&gt; table.
Add this attribute and set it to listen to only the
internal/private/cluster-facing network, which is connected to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;eth1&lt;/code&gt; NIC.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep dhcp
&quot;dhcplease&quot;,&quot;43200&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcpinterfaces&lt;/code&gt; attribute to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab key=dhcpinterfaces site.value=eth1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep dhcp
&quot;dhcplease&quot;,&quot;43200&quot;,,
&quot;dhcpinterfaces&quot;,&quot;eth1&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A new dhcp configuration file is created by the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedhcp(8)&lt;/code&gt; command.
It requires that the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;networks(5)&lt;/code&gt; table is filled out properly.
Check the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;networks(5)&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump networks
#netname,net,mask,mgtifname,gateway,dhcpserver,tftpserver,nameservers,ntpservers,logservers,dynamicrange,staticrange,staticrangeincrement,nodehostname,ddnsdomain,vlanid,domain,mtu,comments,disable
&quot;123_12_23_0-255_255_255_0&quot;,&quot;123.12.23.0&quot;,&quot;255.255.255.0&quot;,&quot;eth0&quot;,&quot;123.12.23.254&quot;,,&quot;&amp;lt;xcatmaster&amp;gt;&quot;,,,,,,,,,,,&quot;1500&quot;,,
&quot;192_168_80_0-255_255_255_0&quot;,&quot;192.168.80.0&quot;,&quot;255.255.255.0&quot;,&quot;eth1&quot;,&quot;&amp;lt;xcatmaster&amp;gt;&quot;,,&quot;&amp;lt;xcatmaster&amp;gt;&quot;,,,,,,,,,,,&quot;1500&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While you are here, change the name of the cluster’s network:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
net=192.168.80.0 \
networks.netname=abacusnet
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that before running the next command (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedhcp -n&lt;/code&gt;), 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcpd&lt;/code&gt; (dhcp daemon) service is not running:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-active dhcpd.service
inactive
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create a new dhcp configuration file with a network statement for each
network the dhcp daemon should listen on. &lt;br /&gt;
The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedhcp(8)&lt;/code&gt; command will automatically restart the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcpd&lt;/code&gt; 
(dhcp daemon) after this operation.  &lt;br /&gt;
The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-n&lt;/code&gt; option of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedhcp(8)&lt;/code&gt; command replaces any existing 
configuration file, making a backup of it first.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedhcp -n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Renamed existing dhcp configuration file to  /etc/dhcp/dhcpd.conf.xcatbak

Warning: [xcatmn]: No dynamic range specified for 192.168.80.0. 
If hardware discovery is being used, a dynamic range is required.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As I’m not using hardware discovery, I don’t need to specify the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dynamicrange&lt;/code&gt;
attribute in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;networks&lt;/code&gt; table so I don’t have to address the warning above.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ls -lhrt /etc/dhcp/dhcpd.conf*
-rw-r--r-- 1 root root  117 Oct  1  2020 /etc/dhcp/dhcpd.conf.xcatbak
-rw------- 1 root root 5.4K Mar 20 19:50 /etc/dhcp/dhcpd.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep range /etc/dhcp/dhcpd.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep -n subnet /etc/dhcp/dhcpd.conf
35:  subnet 192.168.80.0 netmask 255.255.255.0 {
78:  } # 192.168.80.0/255.255.255.0 subnet_end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-active dhcpd.service
active
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Continuing with the setup, next two &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedhcp(8)&lt;/code&gt; requirements have
already beeen met; see above.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Get the node IP addresses and MACs defined in the xCAT database.
    &lt;ul&gt;
      &lt;li&gt;Already done:&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus101 | grep -w ip
    ip=192.168.80.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mac
#node,interface,mac,comments,disable
&quot;abacus101&quot;,,&quot;00:11:22:33:44:55&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Get the hostnames and IP addresses pushed to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; and do DNS.
    &lt;ul&gt;
      &lt;li&gt;Already done with:  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makehosts(8)&lt;/code&gt; and with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedns(8)&lt;/code&gt;.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedhcp(8)&lt;/code&gt; with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;noderange&lt;/code&gt; option.  This injects configuration data
pertinent to the specified nodes into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcpd&lt;/code&gt;.  The configuration information
takes effect immediately without a restart of DHCP.&lt;/p&gt;

&lt;p&gt;So far, I’ve configured one compute node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodels
[...]       &amp;lt;-- The rest of the nodes are MM nodes (not CNs)
abacus101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For now, add only one node to the DHCP server configuration.
The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dhcpd&lt;/code&gt; (dhcp daemon) does not have to be restarted after this.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedhcp abacus101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Query the node entries from the DHCP server configuration to confirm that
only one node is configured for now:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedhcp -q abacus101
abacus101: ip-address = 192.168.80.1, hardware-address = 00:11:22:33:44:55 

# makedhcp -q all 
abacus101: ip-address = 192.168.80.1, hardware-address = 00:11:22:33:44:55 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Copy the customized CentOS Linux 7.9 DVD ISO to the xCAT server:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# scp dusko@192.168.80.210:/tmp/CentOS-7-x86_64-Everything-CUSTOM-2009.iso .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Copy the CentOS 7.9 Linux DVD ISO to the xCAT &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/install&lt;/code&gt; directory.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# copycds CentOS-7-x86_64-Everything-CUSTOM-2009.iso
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;copycds(8)&lt;/code&gt;, the corresponding basic &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;osimage&lt;/code&gt; will be generated
automatically.  Then you can list the new osimage name here.  You can refer
to xCAT documentation on how to customize the package list or postscript
for target compute nodes. For now just use the default one:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t osimage
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;centos7.9-x86_64-install-compute  (osimage)
centos7.9-x86_64-netboot-compute  (osimage)
centos7.9-x86_64-statelite-compute  (osimage)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatprobe&lt;/code&gt; to precheck whether the xCAT &lt;strong&gt;MN&lt;/strong&gt; (&lt;strong&gt;management node&lt;/strong&gt;)
is ready for OS provision (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-i&lt;/code&gt; option: install NIC, specifying the network
interface name of provision network on MN (management node).  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-w&lt;/code&gt; option:
show each line completely; by default long lines are truncated):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xcatprobe -w xcatmn -i eth1
[mn]: Checking all xCAT daemons are running...                          [ OK ]
[mn]: Checking xcatd can receive command request...                     [ OK ]
[mn]: Checking &apos;site&apos; table is configured...                            [ OK ]
[mn]: Checking provision network is configured...                       [ OK ]
[mn]: Checking &apos;passwd&apos; table is configured...                          [ OK ]
[mn]: Checking important directories(installdir,tftpdir) are configured [ OK ]
[mn]: Checking SELinux is disabled...                                   [ OK ]
[mn]: Checking HTTP service is configured...                            [ OK ]
[mn]: Checking TFTP service is configured...                            [ OK ]
[mn]: Checking DNS service is configured...                             [WARN]
[mn]: DNS nameserver can not be reached
[mn]: Checking DHCP service is configured...                            [ OK ]
[mn]: Checking NTP service is configured...                             [ OK ]
[mn]: Checking rsyslog service is configured...                         [ OK ]
[mn]: Checking firewall is disabled...                                  [ OK ]
[mn]: Checking minimum disk space for xCAT [&apos;/var&apos; needs 1GB;&apos;/install&apos;
        needs 10GB;&apos;/tmp&apos; needs 1GB]...                                 [ OK ]
[mn]: Checking Linux ulimits configuration...                           [ OK ]
[mn]: Checking network kernel parameter configuration...                [ OK ]
[mn]: Checking xCAT daemon attributes configuration...                  [ OK ]
[mn]: Checking xCAT log is stored in /var/log/xcat/cluster.log...       [ OK ]
[mn]: Checking xCAT management node IP: &amp;lt;192.168.80.220&amp;gt; is configured
        to static...                                                    [ OK ]
[mn]: Checking dhcpd.leases file is less than 100M...                   [ OK ]
[mn]: Checking DB packages installation...                              [ OK ]
=================================== SUMMARY ==================================
[MN]: Checking on MN...                                                 [ OK ]
    Checking DNS service is configured...                               [WARN]
        DNS nameserver can not be reached
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; Don’t worry about DNS warning.  That warning is expected
          because the DNS nameserver for the cluster is within 
	  private network 192.168.80.0/24.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; To get usage information of xcatprobe: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatprobe -h&lt;/code&gt;. &lt;br /&gt;
To list all valid sub commands for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatprobe&lt;/code&gt;, run: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatprobe -l&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;perform-the-diskful-os-deployment-scripted-install-clone&quot;&gt;Perform the Diskful OS Deployment (Scripted Install, Clone)&lt;/h3&gt;
&lt;h3 id=&quot;aka-build-nodes&quot;&gt;a.k.a Build Nodes&lt;/h3&gt;

&lt;p&gt;Begin OS provision on the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; with the specified &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;osimage&lt;/code&gt;.
Earlier, from the output of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lsdef -t osimage&lt;/code&gt;, one of the images was
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;centos7.9-x86_64-install-compute&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t osimage centos7.9-x86_64-install-compute
Object name: centos7.9-x86_64-install-compute
    imagetype=linux
    osarch=x86_64
    osdistroname=centos7.9-x86_64
    osname=Linux
    osvers=centos7.9
    otherpkgdir=/install/post/otherpkgs/centos7.9/x86_64
    pkgdir=/install/centos7.9/x86_64
    pkglist=/opt/xcat/share/xcat/install/centos/compute.centos7.pkglist
    profile=compute
    provmethod=install
    template=/opt/xcat/share/xcat/install/centos/compute.centos7.tmpl
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  Before starting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rinstall(8)&lt;/code&gt;, make sure that the node’s boot
order is configured so that the first boot device is &lt;strong&gt;network&lt;/strong&gt;
(or &lt;strong&gt;PXE network&lt;/strong&gt;).  As the HS21 blade server is BIOS-based 
(not UEFI-based), check the BIOS settings, and if needed, adjust the 
settings as needed. &lt;a href=&quot;#footnotes&quot;&gt;⁶&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; &lt;br /&gt;
Alternatively, you can use xCAT’s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq(1)&lt;/code&gt;, which permanently sets
the order of boot devices for BMC-based servers, or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsetboot(1)&lt;/code&gt; command,
which sets the boot device to be used for BMC-based servers for the next
boot only.&lt;/p&gt;

&lt;p&gt;However, note that on IBM BladeCenter (which is the case here), you only
have &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq&lt;/code&gt; and not &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsetboot&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.mail-archive.com/xcat-user@lists.sourceforge.net/msg05290.html&quot;&gt;Re: [xcat-user] Problem with rsetboot: unable to identify plugin&lt;/a&gt;
(Retrieved on Mar 20, 2022):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;On BladeCenter, you have &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq&lt;/code&gt;.  I know, a bit peculiar, but the AMM
supports boot sequence control rather than next one time boot device
[which is controlled by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsetboot&lt;/code&gt;].&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rbootseq abacus101 list
abacus101: net,cdrom,hd0,none
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If it’s not configured to boot from the Ethernet (net) device, you can change it with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq(1)&lt;/code&gt; command: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq abacus101 net,hd0,none,none&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower abacus101 bmcstate
abacus101: on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=abacus101 \
nodehm.consoleenabled=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The MM (Management Module), a.k.a. BMC (Baseboard Management 
Controller), hosting this compute node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;) is named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xbcmm1n&lt;/code&gt;.
Its vitals and network settings are:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rvitals xbcmm1n all 
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n network
xbcmm1n: MM IP: 192.168.80.135
xbcmm1n: MM Hostname: xbcmm1n
xbcmm1n: Gateway: 0.0.0.0
xbcmm1n: Subnet Mask: 255.255.255.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If needed, change the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;forwarders&lt;/code&gt; attribute in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table.&lt;/p&gt;

&lt;p&gt;From the manual page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site(5)&lt;/code&gt; table:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;forwarders&lt;/code&gt;: &lt;br /&gt;
The DNS servers at your site that can provide names &lt;strong&gt;outside&lt;/strong&gt; of
the &lt;strong&gt;cluster&lt;/strong&gt;.  The makedns command will configure the DNS on the
management node to forward requests it does not know to these servers.
Note that the DNS servers on the service nodes will ignore this value
and always be configured to forward to the management node.&lt;/p&gt;

  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nameservers&lt;/code&gt;: &lt;br /&gt;
A comma delimited list of DNS servers that each node in the cluster should
use. This value will end up in the nameserver settings of the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/resolv.conf&lt;/code&gt; &lt;strong&gt;on each node&lt;/strong&gt;. It is common (but not required) to set
this attribute value to the IP address of the xCAT management node, if
you have set up the DNS on the management node by running makedns.
In a hierarchical cluster, you can also set this attribute to
“&lt;strong&gt;&amp;lt;xcatmaster&lt;/strong&gt;&amp;gt;” to mean the DNS server for each node should be the
node that is managing it (either its service node or the management
node).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Also, from the man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;networks(5)&lt;/code&gt;:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gateway&lt;/code&gt;  The network gateway. It can be set to an ip address or the
keyword &lt;strong&gt;&amp;lt;xcatmaster&lt;/strong&gt;&amp;gt;.  The keyword &amp;lt;xcatmaster&amp;gt; indicates the
&lt;strong&gt;cluster-facing&lt;/strong&gt; ip address configured on this management node or
service node.  Leaving this field blank means that there is no gateway
for this network.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep forwarders 
&quot;forwarders&quot;,&quot;208.67.222.222,208.67.220.220&quot;,,  &amp;lt;- Should list your DNS servers
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If it hasn’t been correctly set up, you can update the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;forwarders&lt;/code&gt;
attribute now with the following command.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab key=forwarders site.value=208.67.222.222,208.67.220.220
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep forwarders
&quot;forwarders&quot;,&quot;208.67.222.222,208.67.220.220&quot; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep nameservers
&quot;nameservers&quot;,&quot;192.168.80.220&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If it hasn’t been correctly set up, you can now update the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nameservers&lt;/code&gt;
attribute with the following command.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab key=nameservers site.value=192.168.80.220
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep nameservers
&quot;nameservers&quot;,&quot;192.168.80.220&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Does the trio &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedhcp -n&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makehosts&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedns -n&lt;/code&gt;
            need to be run here?&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedhcp -n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makehosts 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedns -n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makegocons -D abacus101
[...]
Starting goconserver service ...
abacus101: Created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the node is registered for an instance of the console (serial console)
session with the command &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makegocons -D abacus101&lt;/code&gt; above,
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;consoleenabled&lt;/code&gt; attribute has been added and set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; for the node
(in this case, node named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus101 | grep cons
    cons=blade
    consoleenabled=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-active goconserver.service 
active
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl status goconserver.service 
  goconserver.service - goconserver console daemon
   Loaded: loaded (/usr/lib/systemd/system/goconserver.service; enabled; vendor preset: disabled)
   Active: active (running) since Sun 2022-03-20 15:42:08 PDT; 1min ago
     Docs: https://github.com/xcat2/goconserver
 Main PID: 12517 (goconserver)
   CGroup: /system.slice/goconserver.service
           |-12517 /usr/bin/goconserver
           +-1253 ssh -t YOUR_BMC_USERNAME@xbcmm1n console -o -T blade[1]

Mar 20 15:42:08 xcatmn.mydomain.com systemd[1]: Started goconserver console daemon.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makegocons -q abacus101
NODE                             SERVER                           STATE
abacus101                        xcatmn.mydomain.com              connected
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Connect to the newly provisioned node (compute node):&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  For the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rcons&lt;/code&gt; to work, the node’s BIOS must be configured 
for SOL (Serial Over LAN), a.k.a. Text Mode Console. &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rcons abacus101
[Enter `^Ec?&apos; for help]
goconserver(2022-03-20T20:44:12-07:00): Hello 192.168.80.220:32998,
  welcome to the session of abacus101

CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

abacus101 login: root
Password: 
[root@abacus101 ~]# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log off from the compute node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The OS login banner appears.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

abacus101 login: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  &lt;br /&gt;
&lt;strong&gt;To exit the console session, enter: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl-e&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;c&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.&lt;/code&gt;
(3 characters: Ctrl-e, ‘c’ and ‘.’)&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Disconnected]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Display the OS and network interface status (On or Off status) for compute
nodes which are managed by the current xCAT &lt;strong&gt;MN&lt;/strong&gt; (&lt;strong&gt;Management Node&lt;/strong&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xcatstat
# Hostname:Status:Network-Interfaces:
abacus101:1:enp4s0-1:enp6s0-2 :
xbcmm1n:1:127 :
xbcmm2:1:127 :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start the diskful OS deployment:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rinstall abacus101 osimage=centos7.9-x86_64-install-compute
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rinstall&lt;/code&gt; command works even though it raises this error:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rinstall abacus101 osimage=centos7.9-x86_64-install-compute
Provision node(s): abacus101
Error: [xcatmn]: rinstall plugin bug, pid 18475, process description:
  &apos;xcatd SSL: rinstall to abacus101 for root@localhost: rinstall instance&apos;
  with error &apos;Died at /opt/xcat/sbin/xcatd line 2104.&apos;
  while trying to fulfill request for the following nodes: abacus101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This error is raised because this node is a &lt;strong&gt;&lt;em&gt;blade&lt;/em&gt;&lt;/strong&gt; node, while
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rinstall&lt;/code&gt; command is supposed to support only IPMI based node:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.mail-archive.com/xcat-user@lists.sourceforge.net/msg05288.html&quot;&gt;Re: [xcat-user] Problem with rsetboot: unable to identify plugin&lt;/a&gt;  &lt;br /&gt;
(Retrieved on Mar 20, 2022):&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Your node is a &lt;em&gt;blade&lt;/em&gt; node. &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rinstall&lt;/code&gt; command only supports ipmi based node.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;You can monitor installation process:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rcons abacus101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After 5-10 minutes verify that provision status is booted:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus101 -i status
Object name: abacus101
    status=booted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xdsh(1)&lt;/code&gt; to check the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; OS version and whether OS provision
was successful:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus101 more /etc/*release
abacus101: ::::::::::::::
abacus101: /etc/centos-release
abacus101: ::::::::::::::
abacus101: CentOS Linux release 7.9.2009 (Core)
abacus101: ::::::::::::::
abacus101: /etc/os-release
abacus101: ::::::::::::::
abacus101: NAME=&quot;CentOS Linux&quot;
abacus101: VERSION=&quot;7 (Core)&quot;
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  If you get a ‘Permission denied’ error:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus101 &apos;cat /etc/redhat-release&apos;
[xcatmn]: abacus101: Permission denied (publickey,gssapi-keyex,
gssapi-with-mic,password).
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;you can fix it by updating the security keys for this compute node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus101 -k
The ssh keys will be updated for &apos;root&apos; on the node(s).
Password:
abacus101: Setup ssh keys has completed.
abacus101: =============updatenode starting====================
abacus101: /tmp/FlNrhJh5uy.dsh: line 62: /var/log/xcat/xcat.log: No such file or directory
abacus101: trying to download postscripts...
abacus101: /tmp/FlNrhJh5uy.dsh: line 62: /var/log/xcat/xcat.log: No such file or directory

^C
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;** &lt;strong&gt;TIP:&lt;/strong&gt; **  If there are monitor probing errors in the console,
                showing approximately every ten seconds similar to&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;drm:radeon_vga_detect [radeon]] *ERROR* VGA-1: probed a monitor
  but no|invalid EDID
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;you can remove them by adding &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nomodeset&lt;/code&gt; kernel boot line option as
explained in Footnotes at the bottom of this page &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;11&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;See also:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.dell.com/support/kbdoc/en-ca/000123893/manual-nomodeset-kernel-boot-line-option-for-linux-booting&quot;&gt;Manual “nomodeset” Kernel Boot Line Option for Linux Booting&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://serverfault.com/questions/708400/radeon-dvi-errors-filling-logs&quot;&gt;Radeon DVI errors filling logs&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Back to continuing with the setup:&lt;/p&gt;

&lt;p&gt;Test ssh passwordless login to the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh root@abacus101
Last login: Sun Mar 20 16:37:45 2022

# hostname
abacus101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log off from the node (compute node).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# exit
logout
Connection to abacus101 closed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;stage-2-add-your-second-node-and-configure-it-for-sol-serial-over-lan-operation-aka-text-mode-console&quot;&gt;Stage 2: Add Your Second Node and Configure It for SOL (Serial Over LAN) Operation (aka Text Mode Console)&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  &lt;br /&gt;
You could continue with your first node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus101&lt;/code&gt; and 
perform these steps on it but I want to show how to enable SOL 
(Serial Over LAN) operation (a.k.a. text mode console) on a compute 
node running CentOS Linux 5, and a different node is perfect for that 
since its OS hasn’t been upgraded yet (it’s still CentOS Linux 5.2).&lt;/p&gt;

&lt;p&gt;To prepare the IBM HS21 blade server for supporting serial console,
you need to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;enable &lt;strong&gt;SOL (Serial Over LAN)&lt;/strong&gt; &lt;a href=&quot;#footnotes&quot;&gt;⁴&lt;/a&gt; in the &lt;strong&gt;BIOS&lt;/strong&gt;, and&lt;/li&gt;
  &lt;li&gt;configure the &lt;strong&gt;operating system&lt;/strong&gt; for SOL operation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Assumptions:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Hostname of the node you are provisioning: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102.mydomain.com&lt;/code&gt; (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.2&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;It’s a blade server in a slot number 2 in an IBM chassis, holding (housing) a total of 14 blades (blade servers).&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;configure-ibm-hs21-blade-bios-for-sol-serial-over-lan&quot;&gt;Configure IBM HS21 Blade BIOS for SOL (Serial Over LAN)&lt;/h3&gt;

&lt;p&gt;The IBM BladeCenter HS21 blade is a &lt;strong&gt;BIOS&lt;/strong&gt;-based server (it doesn’t
support &lt;strong&gt;UEFI&lt;/strong&gt;).&lt;/p&gt;

&lt;p&gt;This example shows how to use the IBM &lt;strong&gt;Advanced Settings Utility (ASU)&lt;/strong&gt;
&lt;a href=&quot;#footnotes&quot;&gt;⁵&lt;/a&gt; tool to &lt;strong&gt;remotely&lt;/strong&gt; modify basic input/output system
&lt;strong&gt;(BIOS) CMOS&lt;/strong&gt; settings.  Specifically, for SOL (Serial Over LAN) to work on this server model, the following six settings need to be changed in the BIOS:
Serial Port A, Serial Port B, Remote Console Active, Remote
Console COM Port, Remote Console After Boot, Remote Console Flow Control.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; &lt;br /&gt;
Alternatively, you can use xCAT’s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq(1)&lt;/code&gt;, which permanently sets
the order of boot devices for BMC-based servers, or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsetboot(1)&lt;/code&gt; command,
which sets the boot device to be used for BMC-based servers for the next
boot only.&lt;/p&gt;

&lt;h3 id=&quot;download-and-install-advanced-settings-utility-asu&quot;&gt;Download and Install Advanced Settings Utility (ASU)&lt;/h3&gt;

&lt;p&gt;Using your web browser, navigate from the &lt;a href=&quot;https://www.ibm.com/&quot;&gt;IBM home page&lt;/a&gt;
to the &lt;a href=&quot;https://www.ibm.com/support/home/?lnk=msu_usen&quot;&gt;Support page&lt;/a&gt;
and then to
(under section “Downloads, fixes &amp;amp; updates”) &lt;a href=&quot;https://www.ibm.com/support/fixcentral&quot;&gt;Fix Central&lt;/a&gt;.
Under “&lt;em&gt;Find product&lt;/em&gt;”, in the “&lt;em&gt;Product selector:&lt;/em&gt;” box, type “HS21”
(without quotes) to access a list of product choices.  From the list of
choices, select &lt;strong&gt;BladeCenter HS21&lt;/strong&gt;.  From the “&lt;em&gt;Product:&lt;/em&gt;” drop-down,
select &lt;strong&gt;8853&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;In the &lt;em&gt;Operating system&lt;/em&gt;, select “All”.  Click &lt;em&gt;Continue&lt;/em&gt;.
Select the 64-bit version of IBM Advanced Settings Utility (ASU) for Linux
(name: ibm_utl_asu_asut79n-9.30_linux_x86-64_rpm).&lt;/p&gt;

&lt;p&gt;The downloaded file name is H29456300.iso.  Copy this file to the xCAT
server, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt; (in this example, with the IP address
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;123.12.23.235&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ scp H29456300.iso username@123.12.23.235:/tmp/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log into the xCAT server.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh username@123.12.23.235
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Mount the ISO image.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /mnt/ASUISO
# mount -t iso9660 /tmp/H29456300.iso /mnt/ASUISO
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ls /mnt/ASUISO/
ibm_utl_asu_asut79n-9.30_anyos_i686.chg
ibm_utl_asu_asut79n-9.30_linux_x86-64.rpm
ibm_utl_asu_asut79n-9.30_linux_x86-64.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create a directory for the ASU and copy all files from the
ASU ISO image to it.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /opt/asu
# cp -i /mnt/ASUISO/ibm_utl_asu_asut79n-* /opt/asu/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unmount the ASU ISO image.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# umount /mnt/ASUISO/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Copy the ASU RPM installation file to the node (this node’s IP address
is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.2&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# scp \
/opt/asu/ibm_utl_asu_asut79n-9.30_linux_x86-64.rpm \
root@192.168.80.2:/tmp/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log into this node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh root@192.168.80.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Install the ASU from the RPM package.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /tmp
# rpm -ivh ibm_utl_asu_asut79n-9.30_linux_x86-64.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;List all installed packages on the system and confirm that the ASU
is installed:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpm -qa | grep asu
ibm_utl_asu-9.30-asut79N
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Find where the ASU’s RPM installs the files:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpm -qpl ibm_utl_asu_asut79n-9.30_linux_x86-64.rpm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/opt/ibm/toolscenter/asu/asu64
/opt/ibm/toolscenter/asu/cdc_interface.sh
/opt/ibm/toolscenter/asu/lic_en.txt
/opt/ibm/toolscenter/asu/rdcli-x86_64/rdmount
/opt/ibm/toolscenter/asu/rdcli-x86_64/rdumount
/opt/ibm/toolscenter/asu/savestat.def
/opt/ibm/toolscenter/asu/template.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To get help for ASU:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 --help
IBM Advanced Settings Utility version 9.30.79N
[...]
Usage: ./asu [apps] &amp;lt;cmds&amp;gt; [&amp;lt;cmd_mod&amp;gt; | &amp;lt;class&amp;gt;] [&amp;lt;options&amp;gt;] [&amp;lt;connect_opts&amp;gt;]

  Note: Full description of an app:     ./asu &amp;lt;app_name&amp;gt; --help
        Full description of a command:  ./asu &amp;lt;cmds&amp;gt; --help

[apps]
  savestat [app_cmd]   - Tool Kit Store System Install State
  immcfg [app_cmd]     - Configure IMM LAN over USB (IMM-based servers only)
  fodcfg [app_cmd]     - Configure Feature on Demand(FoD)
  cmmcfg [app_cmd]     - Configure the CMM
  immapp [app_cmd]     - Immapp Configuration

&amp;lt;cmds&amp;gt;:
   --license        encrypt       patchadd       replicate  showdefault
   batch            export        patchextract   resetrsa   showgroups
   createuuid       generate      patchlist      restore    showlocation
   comparedefault   help          patchremove    save       showvalues
   delete           import        rebootimm      set        version
   deletecert       loaddefault   rebootbmc      setenc     readraw
   dump             nodes         rebootrsa      show       writeraw

*** The ASU User&apos;s Guide provides detailed command description and operation.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Show names of variable classes on the system.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 showgroups
bios
bmc
rsa
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Show the possible values for the specified setting.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 showvalues 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Show the default value for the specified setting.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 showdefault
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Show the current value for one or all settings.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 show
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Syntax:
    show [&amp;lt;setting&amp;gt;][&amp;lt;cmdmod&amp;gt;] [&amp;lt;options&amp;gt;] [&amp;lt;connect_opts&amp;gt;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To prepare the IBM HS21 blade server to support serial console, you need
to enable SOL (Serial Over LAN) in BIOS.  That’s done by changing values
of six BIOS settings (names of the six settings are listed at the beginning
of this section above).&lt;/p&gt;

&lt;p&gt;Change values for the six BIOS settings:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 set CMOS_SerialA &quot;Auto-configure&quot;
# /opt/ibm/toolscenter/asu/asu64 set CMOS_SerialB &quot;Auto-configure&quot;
# /opt/ibm/toolscenter/asu/asu64 set CMOS_RemoteConsoleEnable Enabled
# /opt/ibm/toolscenter/asu/asu64 set CMOS_RemoteConsoleComPort &quot;COM 2&quot;
# /opt/ibm/toolscenter/asu/asu64 set CMOS_RemoteConsoleBootEnable Enabled
# /opt/ibm/toolscenter/asu/asu64 set CMOS_RemoteConsoleFlowCtrl Hardware 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reference:&lt;br /&gt;
&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.advmgtmod.doc/kp1bd_pdf.pdf&quot;&gt;BladeCenter SOL (Serial over LAN) Setup Guide - IBM Corporation, Twelfth Edition (November 2009)&lt;/a&gt; (retrieved on Mar 22, 2022):
Chapter 2. General configuration &amp;gt; Updating and configuring the blade server BIOS&lt;/p&gt;

&lt;h4 id=&quot;configure-rhel-based-linux-distribution-for-serial-console-text-console&quot;&gt;Configure RHEL-Based Linux Distribution for Serial Console (Text Console)&lt;/h4&gt;

&lt;p&gt;In this example the operating system on the node is CentOS
Linux &lt;strong&gt;5.2&lt;/strong&gt; (64-bit).&lt;/p&gt;

&lt;p&gt;To configure Linux for SOL operation, you must configure it to expose
the Linux initialization (booting) process.  This enables users to
log in to the Linux console using an SOL session and directs Linux output
to the serial console.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; This procedure is based on a default installation of
&lt;strong&gt;RHEL 5.2&lt;/strong&gt;
(Red Hat Enterprise Linux 5.2).  The file names, structures, and commands
might be different for other versions of RHEL-based Linux distributions.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Hardware flow control prevents character loss during communication over a
serial connection.  You must enable it when using a Linux operating system.
Add the following line to the end of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;# Run gettys in standard runlevels&lt;/code&gt;
section of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/inittab&lt;/code&gt; file.  This enables hardware flow control and
enables users to log in through the SOL console.
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;7:2345:respawn:/sbin/agetty -h ttyS1 19200 vt102&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Add the following line at the bottom of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/securetty&lt;/code&gt; file to
enable a user to log in as the root user through the SOL console: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ttyS1&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;grub-configuration&quot;&gt;GRUB Configuration&lt;/h4&gt;

&lt;p&gt;Complete the following steps to modify the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/boot/grub/grub.conf&lt;/code&gt; file:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Comment out the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;splashimage=...&lt;/code&gt; line by adding a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;#&lt;/code&gt; at the beginning of this line.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Add the following line before the first &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;title ...&lt;/code&gt; line:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;# This will allow you to only monitor the OS boot via SOL&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Add the following text to the end of first &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;title ...&lt;/code&gt; line:  &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SOL Monitor&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Add the following text to the end of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kernel /...&lt;/code&gt; line of
the first &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;title ...&lt;/code&gt; section: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console=ttyS1,19200 console=tty1&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Add the following lines after the frst &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;title ...&lt;/code&gt; section:&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# This will allow you to interact with the OS boot via SOL
title CentOS (2.6.18-92.el5) SOL Interactive
    root (hd0,0)
    kernel /boot/vmlinuz-2.6.18-92.el5 ro root=LABEL=/ rhgb quiet console=tty1
console=ttyS1,19200
    initrd /boot/initrd-2.6.18-92.el5.img
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  The entry beginning with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kernel /boot/vmlinuz...&lt;/code&gt; is shown with a line break
after &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console=tty1&lt;/code&gt;.  In your file, the entire entry must all be on one line.&lt;/p&gt;

&lt;p&gt;Modified &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/boot/grub/grub.conf&lt;/code&gt; contents:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grub.conf generated by anaconda
#
# Note that you do not have to rerun grub after making changes to this file
# NOTICE:  You do not have a /boot partition.  This means that
#          all kernel and initrd paths are relative to /, eg.
#          root (hd0,0)
#          kernel /boot/vmlinuz-version ro root=/dev/sda1
#          initrd /boot/initrd-version.img
#boot=/dev/sda
default=0
timeout=5
#splashimage=(hd0,0)/boot/grub/splash.xpm.gz
hiddenmenu
# This will allow you to only monitor the OS boot via SOL
title CentOS (2.6.18-92.el5) SOL Monitor
    root (hd0,0)
    kernel /boot/vmlinuz-2.6.18-92.el5 ro root=LABEL=/ rhgb quiet
console=ttyS1,19200 console=tty1
    initrd /boot/initrd-2.6.18-92.el5.img

# This will allow you to interact with the OS boot via SOL
title CentOS (2.6.18-92.el5) SOL Interactive
    root (hd0,0)
    kernel /boot/vmlinuz-2.6.18-92.el5 ro root=LABEL=/ rhgb quiet
console=tty1 console=ttyS1,19200
    initrd /boot/initrd-2.6.18-92.el5.img
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  The entries beginning with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kernel /boot/vmlinuz...&lt;/code&gt; are shown
with a line break.  In the actual &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;grub.conf&lt;/code&gt; file, the both entries are
actually on one line.&lt;/p&gt;

&lt;p&gt;You must reboot the Linux operating system after completing these
procedures for the changes to take effect and to enable SOL.
However, instead of doing it from the OS, I want to confirm that the SOL
setup worked by performing a test with establishing a SOL connection to
the command console of this blade server.  Steps listed below show how to
do that.&lt;/p&gt;

&lt;p&gt;Log on to the management module (&lt;strong&gt;MM&lt;/strong&gt;) via the CLI (command line
interface) by following instructions listed
above (&lt;a href=&quot;#connecting-to-cli-on-mm&quot;&gt;“Connecting to CLI on MM”&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Power cycle this blade server, blade 2 (which is in a blade chassis,
holding a total of 14 blades) to command console.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-cycle&lt;/code&gt; option: power off, then on.  The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-c&lt;/code&gt; option: enter &lt;strong&gt;console&lt;/strong&gt;
mode at power on (used on blades with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-on&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-cycle&lt;/code&gt;).  The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-T&lt;/code&gt; option:
target (in this case blade number 2).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;system&amp;gt; power -cycle -c -T system:blade[2]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you see output similar to the following, the SOL setup works:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;IPMI kcs interface initialized

                                             CP: 17RN50 200m/200e DDR1 BIOS


IBM BIOS - (c) Copyright IBM Corporation 2008                       CP: 28
Symmetric Multiprocessing System$
Intel(R) Xeon(R) CPU E5430 @ 2.66GHz$
2 Processor Packages Installed$

16384 MB Installed Memory


Press F1 for Configuration/Setup
Press F2 for Diagnostics
Press F12 for Boot Device Selection Menu


&amp;gt;&amp;gt; BIOS Version 1.15 &amp;lt;&amp;lt;

[...]

Press any key to enter the menu

Booting CentOS (2.6.18-92.el5) SOL Monitor in 1 seconds...

[...]

CentOS release 5.2 (Final)
Kernel 2.6.18-92.el5 on an x86_64

abacus102 login: root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  If you loose communication over the serial connection,
you can re-establish it with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console&lt;/code&gt; command:
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;console -T system:blade[2]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;To &lt;strong&gt;exit&lt;/strong&gt; the SOL session and to return to the CLI on the &lt;strong&gt;MM&lt;/strong&gt;,
press Esc followed by an open parenthesis: 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Esc (&lt;/code&gt;  (two characters: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Esc&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Shift-9&lt;/code&gt; [on US keyboards])&lt;/p&gt;

&lt;p&gt;To return to the OS, in the CLI prompt of the &lt;strong&gt;MM&lt;/strong&gt;, type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exit&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Back in the OS:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ping -c2 192.168.80.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To get the MAC address of the node with IP address 192.168.80.2:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# arp -a | grep &apos;192.168.80.2&apos;
? (192.168.80.2) at 01:02:03:04:05:0e [ether] on eth1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; If you don’t have network connection with this node, you can
obtain its MAC address by logging in to the &lt;strong&gt;MM&lt;/strong&gt; (&lt;strong&gt;BMC&lt;/strong&gt;).&lt;/p&gt;

&lt;p&gt;Log on to the management module (&lt;strong&gt;MM&lt;/strong&gt;) via the CLI (command line
interface) by following instructions listed
above (&lt;a href=&quot;#connecting-to-cli-on-mm&quot;&gt;“Connecting to CLI on MM”&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;In the BMC CLI prompt:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;system&amp;gt; info -T blade[2]
[...]
MAC Address 1: 00:11:22:[...]
MAC Address 2: 00:11:22:[...]
MAC Address 3: Not Available
MAC Address 4: Not Available
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create an xCAT data object definition for this node 
(name the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  I had to create this data object in two steps:
The attribute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmc&lt;/code&gt; must be specified but when I used &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmc&lt;/code&gt; with
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mgt=blade&lt;/code&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkdef&lt;/code&gt; returned an error: &lt;em&gt;“Cannot set the attr=’bmc’
attribute unless mgt value is ipmi or openbmc”&lt;/em&gt; so in this first step
I skipped setting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmc&lt;/code&gt; attribute and then changed it in the next step.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef \
-t node abacus102 \
id=2 \
--template x86_64-template \
ip=192.168.80.2 \
mac=01:02:03:04:05:0e \
bmc=192.168.80.135 \
mpa=xbcmm1n \
getmac=blade \
cons=blade \
serialport=1 \
serialspeed=19200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef -t node -o abacus102 mgt=blade
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus102 
Object name: abacus102
    arch=x86_64
    cons=blade
    getmac=blade
    groups=all
    id=2
    ip=192.168.80.2
    mac=01:02:03:04:05:0e
    mgt=blade
    mpa=xbcmm1n
    netboot=xnba
    postbootscripts=otherpkgs
    postscripts=syslog,remoteshell,syncfiles
    serialport=1
    serialspeed=19200
    usercomment=the system X node definition
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mpa
#mpa,username,password,displayname,slots,urlpath,comments,disable
&quot;xbcmm1n&quot;,&quot;YOUR_BMC_USERID&quot;,&quot;YOUR_BMC_PASSW0RD&quot;,,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mp
#node,mpa,id,nodetype,comments,disable
&quot;bcmgmt1&quot;,&quot;bcmgmt1&quot;,&quot;0&quot;,,,
&quot;bcmgmt2&quot;,&quot;bcmgmt2&quot;,&quot;0&quot;,,,
[...]
&quot;xbcmm1n&quot;,&quot;xbcmm1n&quot;,,,,
&quot;abacus101&quot;,&quot;xbcmm1n&quot;,&quot;1&quot;,,,
&quot;abacus102&quot;,&quot;xbcmm1n&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Change &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id&lt;/code&gt; in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node=abacus102&lt;/code&gt; row in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table setting with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id=2&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=abacus102 \
mp.id=2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mp
#node,mpa,id,nodetype,comments,disable
&quot;bcmgmt1&quot;,&quot;bcmgmt1&quot;,&quot;0&quot;,,,
&quot;bcmgmt2&quot;,&quot;bcmgmt2&quot;,&quot;0&quot;,,,
[...]
&quot;xbcmm1n&quot;,&quot;xbcmm1n&quot;,,,,
&quot;abacus101&quot;,&quot;xbcmm1n&quot;,&quot;1&quot;,,,
&quot;abacus102&quot;,&quot;xbcmm1n&quot;,&quot;2&quot;,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt; hardware control:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower abacus102 state
abacus102: on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rinv -V abacus102 all
20220320.21:48:23 (3057) rinv:start deal with SNMP session.
abacus102: Machine Type/Model: 8853AC1
abacus102: Serial Number: KQCCXBF
abacus102: MAC Address 1: 01:02:03:04:05:0e
abacus102: MAC Address 2: 01:02:03:04:05:0f
abacus102: Management Module firmware: 16 (BRET86S 10-12-09)
20220320.21:48:24 (3057) rinv:SNMP session completed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Configure DNS.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makehosts abacus102 
Warning: [xcatmn]: No domain can be determined for node &apos;abacus102&apos;. 
  The domain of the xCAT node must be provided in an xCAT network
  definition or the xCAT site definition.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedns -n
Error: [xcatmn]: domain not defined in site table
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To fix this error, add the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;domain&lt;/code&gt; attribute as explained further below.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tabdump&lt;/code&gt; command displays the header and all the rows of the specified
table in CSV (comma separated values) format.  To show descriptions of the
tables, instead of the contents of the tables, use the option &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-d&lt;/code&gt;.
If a table name is also specified, descriptions of the columns
(attributes) of the table will be displayed.  Otherwise, a summary of each
table will be displayed.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump -d
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table is specific and different from all the other tables.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump -d | grep -n site
115:site:  Global settings for the whole cluster.  This table is different from

# tabdump -d | sed -n 115,121p
site:  Global settings for the whole cluster.  This table is different from
the other tables in that each attribute is just named in the key column,
rather than having a separate column for each attribute. The following is
a list of attributes currently used by xCAT organized into categories.


statelite: The location on an NFS server where a nodes persistent files
are stored.  Any file marked persistent in t.
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To show how &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table is differently laid out, let’s compare it to,
for example, table &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passwd&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump passwd
#key,username,password,cryptmethod,authdomain,comments,disable
&quot;system&quot;,&quot;root&quot;,&quot;PASSWORDHERE&quot;,,,,
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site
#key,value,comments,disable
[...]
&quot;master&quot;,&quot;192.168.80.220&quot;,,
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This means that with all tables except the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table, you specifty attribute
by first giving the table name. For example, in case of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passwd&lt;/code&gt; table
(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passwd.username&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;passwd.password&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab key=system passwd.username=root passwd.password=&apos;abc!!123(??)&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In contrast, for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table, after the table name (that is, after
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt;), you always use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.value&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab key=nameservers site.value=192.168.80.220
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back to fixing the error raised above (with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makehosts abacus102&lt;/code&gt; and
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedns -n&lt;/code&gt;) where the warning was that the domain of the xCAT node 
must be provided in an xCAT network definition or the xCAT site definition.&lt;/p&gt;

&lt;p&gt;Description of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;networks&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump -d | grep networks
networks:       Describes the networks in the cluster and info necessary to
set up nodes on that network.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Description of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;domain&lt;/code&gt; attribute:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump -d site | grep -w domain 
 domain:  The DNS domain name used for the cluster.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table doesn’t have the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;domain&lt;/code&gt; key:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep -i domain
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To add the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;domain&lt;/code&gt; key and value (in this example &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mydomain.com&lt;/code&gt;) to the
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab key=domain site.value=mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After this, both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makehosts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedns&lt;/code&gt; work:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makehosts abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tail -1 /etc/hosts
192.168.80.2 abacus102 abacus102.mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedns -n 
Handling xbcmm1n in /etc/hosts.
Handling abacus102 in /etc/hosts.
Handling localhost in /etc/hosts.
Handling localhost in /etc/hosts.
Handling xcatmn in /etc/hosts.
Getting reverse zones, this may take several minutes for a large cluster.
Completed getting reverse zones.
Updating zones.
Completed updating zones.
Restarting named
Restarting named complete
Updating DNS records, this may take several minutes for a large cluster.
Completed updating DNS records.
DNS setup is completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reference:&lt;br /&gt;
&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.advmgtmod.doc/kp1bd_pdf.pdf&quot;&gt;BladeCenter SOL (Serial over LAN) Setup Guide - IBM Corporation, Twelfth Edition (November 2009)&lt;/a&gt; (retrieved on Mar 22, 2022):
Chapter 3. Operating system configuration &amp;gt; Linux configuration &amp;gt; Red Hat Enterprise Linux ES 2.1 configuration&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;create-a-qemu-image-snapshot-backup&quot;&gt;Create a QEMU Image Snapshot Backup&lt;/h2&gt;

&lt;p&gt;Power off the guest VM.&lt;/p&gt;

&lt;p&gt;Run the following commands on the host.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ qemu-img info xcatmn.img
image: xcatmn.img
file format: raw
virtual size: 80 GiB (85899345920 bytes)
disk size: 21.6 GiB
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;List all snapshots in the image.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ qemu-img snapshot -l xcatmn.img
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So currently the image doesn’t have any snapshots.&lt;/p&gt;

&lt;p&gt;Convert image format from raw to qcow2.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ qemu-img \
convert \
-f raw \
-O qcow2 \
xcatmn.img \
xcatmn.qcow2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -lh xcatmn.img
-rw-rw-r-- 1 dusko dusko 80G Mar 20 20:03 xcatmn.img

$ ls -lh xcatmn.qcow2
-rw-r--r-- 1 dusko dusko 24G Mar 20 20:04 xcatmn.qcow2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create the snapshot.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ qemu-img snapshot -c xcat_configured_bkp xcatmn.qcow2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;List all snapshots in the image.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ qemu-img snapshot -l xcatmn.qcow2
Snapshot list:
ID        TAG                 VM SIZE                DATE       VM CLOCK
1         xcat_configured_bkp     0 B 2022-03-20 20:04:13   00:00:00.000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;stage-3-prepare-postscripts-and-postbootscripts&quot;&gt;Stage 3: Prepare Postscripts and Postbootscripts&lt;/h2&gt;

&lt;p&gt;For this installation, I wrote the following two custom scripts:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute_custom_post&lt;/code&gt;: post-&lt;strong&gt;installation&lt;/strong&gt; script for all CNs
                       (compute nodes)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus_custom_postboot&lt;/code&gt;: post-&lt;strong&gt;boot&lt;/strong&gt; script for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus&lt;/code&gt; cluster’s 
                          CNs (compute nodes)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;while &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setupntp&lt;/code&gt;, the next required post-&lt;strong&gt;installation&lt;/strong&gt; script for all 
CNs (compute nodes) &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setupntp&lt;/code&gt;, was already preinstalled by xCAT.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Assumptions:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Hostname of the compute node that I’m using in this 
example: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102.mydomain.com&lt;/code&gt; (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.2&lt;/code&gt;). 
It’s a blade server in a slot number 2 in an IBM chassis, 
holding (housing) a total of 14 blades (blade servers).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Start the xCAT QEMU VM (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;, with 
IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br0&quot;,id=hn0 \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br1&quot;,id=hn1 \
-device virtio-net-pci,netdev=hn0 \
-device virtio-net-pci,netdev=hn1 \
-daemonize
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log into the QEMU virtual machine; that is, the xCAT MN (management node):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh root@192.168.80.220
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The execution of post-installation and post-boot scripts is configured
with the xCAT postscripts table.  Post-installation and post-boot scripts,
including custom scripts, are placed in /install/postscripts.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts
#node,postscripts,postbootscripts,comments,disable
&quot;xcatdefaults&quot;,&quot;syslog,remoteshell,syncfiles&quot;,&quot;otherpkgs&quot;,,
&quot;service&quot;,&quot;servicenode&quot;,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 cat /etc/redhat-release
abacus102: CentOS Linux release 7.9.2009 (Core)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;example-use-case--pbs-scheduling-software-with-webmo-as-front-end&quot;&gt;Example Use Case:  PBS Scheduling Software with WebMO as Front-End&lt;/h3&gt;

&lt;p&gt;Scheduling software lets you run your cluster like a batch system,
allowing you to allocate cluster resources, such as CPU time and memory,
on a job-by-job basis.  Jobs are queued and run as resources become
available, subject to the priorities you establish.  Your users will be
able to add and remove jobs from the job queue as well as track the
progress of their jobs.  As the administrator, you will be able to
establish priorities and manage the queue.&lt;/p&gt;

&lt;p&gt;There are several freely available scheduling systems.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  This is an example of setting up &lt;strong&gt;PBS&lt;/strong&gt; (&lt;strong&gt;Portable Batch 
System&lt;/strong&gt;), specifically &lt;strong&gt;TORQUE&lt;/strong&gt; (Terascale Open-source Resource 
and QUEue Manager),&lt;/p&gt;

&lt;p&gt;From &lt;em&gt;Distributed Computing with Python&lt;/em&gt; by Francesco Pierfederici &lt;br /&gt;
Packt Publishing, April 2016&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The Portable Batch System (PBS) was developed for NASA in the beginning
of the 90s.  It now exists in three variants:  OpenPBS, Torque, and
PBS Pro.  These are all forks of the original codebase, and have a very
similar look and feel from the user perspective.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Here, I look at &lt;strong&gt;Torque&lt;/strong&gt; HPC Resource Manager.&lt;/p&gt;

&lt;h3 id=&quot;torque-resource-manager&quot;&gt;Torque Resource Manager&lt;/h3&gt;

&lt;p&gt;TORQUE v 2.3.6, thanks to &lt;a href=&quot;https://archive.org/&quot;&gt;The Internet Archive&lt;/a&gt;: &lt;br /&gt;
&lt;a href=&quot;https://web.archive.org/web/20090123185628/http://clusterresources.com/downloads/torque/torque-2.3.6.tar.gz&quot;&gt;https://web.archive.org/web/20090123185628/http://clusterresources.com/downloads/torque/torque-2.3.6.tar.gz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From the README for TORQUE v 2.3.6:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat README.torque
#
# TORQUE 2.3.6 README (released Dec, 23 2008)
[...]

OVERVIEW --------------------

  TORQUE (Terascale Open-source Resource and QUEue manager) is an open source
project based on the original PBS* resource manager developed by NASA,
LLNL, and MRJ.  It possesses a large number of enhancements contributed by
organizations such as OSC, NCSA, TeraGrid, the U.S Dept of Energy, USC, 
and many, many others. [...] It may be utilized, modified, and distributed
subject to the constraints of the license located in the PBS_License.txt file. 
[...]
* TORQUE is not endorsed by nor affiliated with Altair.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbs_mom(8)&lt;/code&gt; command starts a pbs batch &lt;strong&gt;Machine Oriented Mini-server&lt;/strong&gt;
(&lt;strong&gt;MOM&lt;/strong&gt;) on a local host (on a compute node).  Typically, on systems with
traditional SysV init scripts, this command will be in a local boot file
such as /etc/rc.local.&lt;/p&gt;

&lt;p&gt;List the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;torque&lt;/code&gt; directory content on the storage server 
(IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.210&lt;/code&gt;), which is configured with 
a shared directory across the nodes (via NFS). 
(This is the new server that replaced the old one in summer
of 2021. You can call it a “head node” as in addition to being 
the storage server, it’s also hosting a front-end WebMO, running 
with Apache webserver.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh -t dusko@192.168.80.210 ls -lh /opt/torque/
dusko@192.168.80.210&apos;s password:
total 4.0K
drwxr-xr-x 2 root root 4.0K May 16  2009 bin
drwxr-xr-x 2 root root   92 May 16  2009 include
drwxr-xr-x 2 root root  113 May 16  2009 lib
drwxr-xr-x 6 root root   54 May 16  2009 man
drwxr-xr-x 2 root root  147 May 16  2009 sbin
drwxr-xr-x 3 root root   19 May 16  2009 var
Connection to 192.168.80.210 closed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While you are sill logged in the &lt;strong&gt;MN&lt;/strong&gt; (&lt;strong&gt;Management Node&lt;/strong&gt;),
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt; (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;), tar and 
copy the PBS &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;torque&lt;/code&gt; directory from an existing &lt;strong&gt;compute node&lt;/strong&gt; 
(for example, from a compute node with IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.6&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh -t root@192.168.80.6 ls -lh /opt/torque/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh -t root@192.168.80.6 \
&apos;cd /opt; tar czf torque.tar.gz torque; mv torque.tar.gz /tmp&apos;
root@192.168.80.6&apos;s password: 
Connection to 192.168.80.6 closed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Copy the content of the PBS &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;torque&lt;/code&gt; directory from the compute node 
(using the already mentioned node at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.6&lt;/code&gt;) temporarily to 
the MN (management node).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# scp root@192.168.80.6:/tmp/torque.tar.gz .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The tarred PBS &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;torque&lt;/code&gt; directory on the compute node can be deleted:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh -t root@192.168.80.6 rm -i /tmp/torque.tar.gz 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The PBS &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;torque&lt;/code&gt; directory now can be copied to from the MN 
(management node) to the compute node that you are provisioning:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# scp torque.tar.gz root@192.168.80.2:/opt/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log out from the MN (management node).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# exit
logout
Connection to 192.168.80.220 closed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You are now back in the compute node that you are provisioning 
(named: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;).  If not, you can log into it with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ssh abacus102&lt;/code&gt; 
since you’ve already configured it for passwordless ssh.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# hostname
abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /opt
# tar xf torque.tar.gz
# rm -i torque.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ls -lh /opt/torque/
total 4.0K
drwxr-xr-x 2 root root 4.0K May 16  2009 bin
drwxr-xr-x 2 root root   92 May 16  2009 include
drwxr-xr-x 2 root root  113 May 16  2009 lib
drwxr-xr-x 6 root root   54 May 16  2009 man
drwxr-xr-x 2 root root  147 May 16  2009 sbin
drwxr-xr-x 3 root root   19 May 16  2009 var
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Version of the TORQUE that I copied to the compute node is 2.3.6:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep ^version /opt/torque/bin/pbs-config
version=&quot;2.3.6&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Remove an old &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mom.lock&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rm -i /opt/torque/var/spool/mom_priv/mom.lock
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;convert-traditional-sysv-system-v-init-script-aka-sysvinit-for-pbs_mom-service-to-systemd-unit-file&quot;&gt;Convert Traditional SysV (System V) Init Script (aka SysVinit) for pbs_mom Service to systemd Unit File&lt;/h3&gt;

&lt;p&gt;At the beginning of the previous section above (titled &lt;em&gt;Torque Resource 
Manager&lt;/em&gt;), I downloaded the source for TORQUE v 2.3.6.  I untarred the tar 
file and located the traditional SysV init script at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;contrib/init.d/pbs_mom&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# diff --unified=0 pbs_mom.ORIG pbs_mom
--- pbs_mom.ORIG      2022-03-20 10:24:36.586238000 -0700
+++ pbs_mom    2022-03-20 10:24:59.884424000 -0700
@@ -12,2 +12,4 @@
-PBS_DAEMON=/usr/local/sbin/pbs_mom
-PBS_HOME=/var/spool/torque
+#PBS_DAEMON=/usr/local/sbin/pbs_mom
+#PBS_HOME=/var/spool/torque
+PBS_DAEMON=/opt/torque/sbin/pbs_mom
+PBS_HOME=/opt/torque/var/spool
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# vi /etc/systemd/system/pbs_mom.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /etc/systemd/system/pbs_mom.service
[Unit]
Description=PBS Mom service

[Service]
ExecStart=/opt/torque/sbin/pbs_mom
Type=forking

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl daemon-reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Find out (confirm) the TORQUE server name.  In this example, it’s &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mgmt&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ls -lh /opt/torque/var/spool/server_name
-rw-r--r-- 1 root root 5 May 16  2009 /opt/torque/var/spool/server_name

# cat /opt/torque/var/spool/server_name
mgmt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  This sample configuration includes
&lt;a href=&quot;https://www.webmo.net/&quot;&gt;WebMO&lt;/a&gt; as a front-end:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;WebMO is a web-based interface to computational chemistry packages.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;While still on the compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;, add
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IP_address canonical_hostname&lt;/code&gt; pairs to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;
file &lt;a href=&quot;#footnotes&quot;&gt;⁷&lt;/a&gt; for the following hosts:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;: this compute node&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mgmt&lt;/code&gt;: MN (management node)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus.mydomain.com&lt;/code&gt;: the WebMO server&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# printf %s\\n &quot;192.168.80.2 abacus102&quot; &amp;gt;&amp;gt; /etc/hosts
# printf %s\\n &quot;192.168.80.210 mgmt&quot; &amp;gt;&amp;gt; /etc/hosts
# printf %s\\n &quot;192.168.80.100 abacus.mydomain.com&quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-enabled pbs_mom.service
disabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl enable pbs_mom.service
Created symlink from /etc/systemd/system/multi-user.target.wants/pbs_mom.service to
  /etc/systemd/system/pbs_mom.service.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-enabled pbs_mom.service
enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl start pbs_mom.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-active pbs_mom.service
active
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;submit-a-test-job-to-a-specific-node&quot;&gt;Submit a Test Job to a Specific Node&lt;/h3&gt;

&lt;p&gt;As the compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt; has already been configured 
(with passwordless ssh), you can log into it:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[root@xcatmn ~]# ssh abacus102
Last login: Sun Mar 30 16:30:21 2022 from xcatmn.mydomain.com

[root@abacus102 ~]# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On the compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# find /opt/torque/ -iname &apos;*qstat*&apos;
/opt/torque/bin/qstat
/opt/torque/man/man1/qstat.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The manpage for qstat(1B) from the PBS software package (Torque):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# man /opt/torque/man/man1/qstat.1 

qstat(1B)                   PBS                  qstat(1B)

NAME
       qstat - show status of pbs batch jobs

---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exit the compute node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# exit
logout
Connection to abacus102 closed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log in to the head node (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.210&lt;/code&gt;), 
a.k.a. the webserver (for WebMO). 
&lt;strong&gt;NOTE:&lt;/strong&gt;  This is &lt;strong&gt;not&lt;/strong&gt; the xCAT MN (management node), 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt; (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh root@192.168.80.210
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# command -v qstat; type -a qstat; whereis qstat; which qstat
/global/software/torque/x86_64/bin/qstat
qstat is /global/software/torque/x86_64/bin/qstat
qstat is /global/software/torque/x86_64/bin/qstat
qstat: /opt/torque/bin/qstat /global/software/torque/x86_64/bin/qstat /usr/share/man/man1p/qstat.1p.gz
/global/software/torque/x86_64/bin/qstat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt; the different manpage for the qstat(1P) from the POSIX 
Programmer’s Manual than the one above (for qstat(1B) [from the PBS 
software package (Torque)]:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# man qstat

QSTAT(1P)                   POSIX Programmer&apos;s Manual   QSTAT(1P)

PROLOG
       This manual page is part of the POSIX Programmer&apos;s Manual. 
       The Linux implementation of this interface may differ (consult the 
       corresponding Linux manual page for details of Linux behavior), 
       or the interface may not be implemented on Linux.

NAME
       qstat - show status of batch jobs

---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Without any options or arguments, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;qstat&lt;/code&gt; requests for status of all 
jobs (in all queues at the default server):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# qstat 
Job id      Name         User  Time Use S Queue
----------- ------------ ----- -------- - -----
290398.mgmt WebMO_285069 webmo  2:17:56 R abacus 
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While still at the head node (remember, this is &lt;strong&gt;not&lt;/strong&gt; the xCAT 
MN &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;), first use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbsnodes(8)&lt;/code&gt;
&lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;8&lt;/a&gt;&lt;/sup&gt; to check whether the node’s state is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# pbsnodes -l all abacus102
abacus102            offline
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the node is in OFFLINE state, the fix is to clear OFFLINE from the node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# pbsnodes -c abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the node is in DOWN state, try fixing it by restarting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbs_mom&lt;/code&gt; 
service on the node – remember that you need to run the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xdsh(1)&lt;/code&gt; command from the xCAT MN (Management Node) so you first need to log into the xCAT MN:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh root@192.168.80.220
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the xCAT MN (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;), run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xdsh(1)&lt;/code&gt; command to 
restart the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbs_mom&lt;/code&gt; service on the compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 systemctl restart pbs_mom.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exit the xCAT MN (Management Node).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back on the head node (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.210&lt;/code&gt;), restart 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbs_server&lt;/code&gt; service.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl restart pbs_server.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirm that the status of the node is now &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# pbsnodes -l all abacus102
abacus102            free
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While still on the head node (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.210&lt;/code&gt;), create 
a test job (a.k.a. batch job) that will be submitted to run specifically 
on the compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# vi test_abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat test_abacus102
#
#
#PBS -l nodes=1:abacus102
#
sleep 120
hostname
date
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Submit a test job to compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# qsub test_abacus102
290405.mgmt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You’ll notice that the PBS Torque returned a job number, 
which is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;290405.mgmt&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# qstat -a

mgmt: 
                                                       Req&apos;d Req&apos;d   Elap
Job ID      User Queue  Jobname         SessID NDS TSK Mem   Time  S Time
----------- ---- ------ --------------  ------ --- --- ----- ----- - ----
[...]
290405.mgmt root abacus test_abacus102  28382    1  --   --  120:0 R  --
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log into the compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt; to confirm whether the submitted test
job is running on this node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh root@abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# find /opt/torque/ -name &apos;*290405*&apos;
/opt/torque/var/spool/mom_priv/jobs/290405.mgmt.SC
/opt/torque/var/spool/mom_priv/jobs/290405.mgmt.TK
/opt/torque/var/spool/mom_priv/jobs/290405.mgmt.JB
/opt/torque/var/spool/aux/290405.mgmt
/opt/torque/var/spool/spool/290405.mgmt.OU
/opt/torque/var/spool/spool/290405.mgmt.ER
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /opt/torque/var/spool/mom_priv/jobs/290405.mgmt.SC
#
#
#PBS -l nodes=1:abacus102
#
sleep 120
hostname
date
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /opt/torque/var/spool/aux/290405.mgmt
abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log out from the compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# exit
logout
Connection to abacus102 closed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back on the head node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# qstat 
Job id      Name           User Time Use S Queue
----------- -------------- ---- -------- - -----
[...]
290405.mgmt test_abacus102 root 00:00:00 R abacus
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After 120 seconds:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# qstat 
Job id      Name           User Time Use S Queue
----------- -------------- ---- -------- - -----
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;setup-nfs-server-on-the-head-node-hn-running-centos-8rhel-8&quot;&gt;Setup NFS Server on the Head Node (HN) Running CentOS 8/RHEL 8&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; &lt;br /&gt;
The following steps are performed on the head node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus.mydomain.com&lt;/code&gt; (IP address:  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.210&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  The head node has been previously configured as an NFS server 
so the needed NFS server package (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nfs-utils&lt;/code&gt;) is already installed:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo dnf list --installed | grep nfs-utils
nfs-utils.x86_64    1:2.3.3-46.el8    @rhel-8-for-x86_64-baseos-rpms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Verify the version of nfs protocol that is running.  The version is
indicated by the second column in the output below.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ rpcinfo -p | grep nfs
    100003    3   tcp   2049  nfs
    100003    4   tcp   2049  nfs
    100227    3   tcp   2049  nfs_acl
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For additional configuration of the NFS server, you can find the
configuration files at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nfs.conf&lt;/code&gt;, which is the NFS daemon config file
and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/nfsmount.conf&lt;/code&gt;, which is the configuration file for the NFS mount.
In this example, these two files haven’t been customized:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ grep -v \# /etc/nfs.conf
# /etc/nfs.conf
[general]
[exportfs]
[gssd]
use-gss-proxy=1
[lockd]
[mountd]
[nfsdcld]
[nfsdcltrack]
[nfsd]
[statd]
[sm-notify]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ grep -v \# /etc/nfsmount.conf
[ NFSMount_Global_Options ]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file system that is shared from the NFS server to NFS client systems:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ showmount -e
Export list for mgmt:
/export   abacus214,abacus213, [...], abacus102,abacus101,mgmt
/global   abacus214,abacus213, [...], abacus102,abacus101,mgmt
/home     abacus214,abacus213, [...], abacus102,abacus101,mgmt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Directory ownership and permissions:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -ld /global
drwxr-xr-x 3 root root 3 Aug  3  2021 /global
[
$ ls -ld /home
drwxr-xr-x. 33 root root 34 Jun 21  2021 /home
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All the compute nodes are allowed access to the NFS share:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat /etc/exports
/home mgmt(rw,sync,no_root_squash) abacus101(rw,sync,no_root_squash) abacus102(rw,sync,no_root_squash) [...] abacus213(rw,sync,no_root_squash) abacus214(rw,sync,no_root_squash) 
/global mgmt(rw,sync,no_root_squash) abacus101(rw,sync,no_root_squash) abacus102(rw,sync,no_root_squash) [...] abacus213(rw,sync,no_root_squash) abacus214(rw,sync,no_root_squash)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Explanation:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rw&lt;/code&gt;: Allow NFS clients read/write permissions to the NFS share.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sync&lt;/code&gt;: Require the writing of the changes on the disk first before
        any other operation can be carried out.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;no_root_squash&lt;/code&gt;: Allow access to files inside directories to
                  which only root has access.
    &lt;ul&gt;
      &lt;li&gt;From the man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exports(5)&lt;/code&gt;: “Very  often, it is
not desirable that the root user on a client machine is also treated
as root when accessing files on the NFS server.  To this end, UID 0 is
normally mapped to a different ID: the so-called anonymous or nobody UID.
This mode of operation (called ‘root squashing’) is the default, and can
be turned off with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;no_root_squash&lt;/code&gt;.”  In other words, do &lt;em&gt;not&lt;/em&gt; map
requests from the root user on the client-side to an anonymous UID/GID.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;configure-the-firewall-rules-for-nfs-server-on-centos-8rhel-8&quot;&gt;Configure the Firewall Rules for NFS Server on CentOS 8/RHEL 8&lt;/h3&gt;

&lt;p&gt;While still on the head node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus.mydomain.com&lt;/code&gt; 
(IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.210&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl start firewalld.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl is-active firewalld.service
active
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl enable firewalld.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl is-enabled firewalld.service
enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo firewall-cmd --permanent --add-service=nfs
$ sudo firewall-cmd --permanent --add-service=rpc-bind
$ sudo firewall-cmd --permanent --add-service=mountd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo grep -n PORT /opt/torque/include/pbs_ifl.h
[...]
392:#define PBS_BATCH_SERVICE_PORT  15001
[...]
398:#define PBS_BATCH_SERVICE_PORT_DIS 15001  /* new DIS port   */
[...]
404:#define PBS_MOM_SERVICE_PORT  15002
[...]
410:#define PBS_MANAGER_SERVICE_PORT 15003
[...]
416:#define PBS_SCHEDULER_SERVICE_PORT 15004
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo firewall-cmd --list-ports
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo firewall-cmd --permanent --add-port=15001-15004/tcp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo firewall-cmd --reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo systemctl restart firewalld
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo firewall-cmd --list-ports
15001-15004/tcp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo firewall-cmd --list-all
public (active)
  target: default
  [...] 
  interfaces: br0 br1 eno1 eno2
  [...] 
  services: cockpit dhcpv6-client http https mountd nfs rpc-bind ssh
  ports: 15001-15004/tcp
  [...] 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;set-up-nfs-client-on-compute-node&quot;&gt;Set Up NFS Client on Compute Node&lt;/h3&gt;

&lt;p&gt;Log in to the compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh root@abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# printf %s\\n &quot;mgmt:/home    /home    nfs  defaults  1 2&quot; &amp;gt;&amp;gt; /etc/fstab
# printf %s\\n &quot;mgmt:/global  /global  nfs  defaults  1 2&quot; &amp;gt;&amp;gt; /etc/fstab
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /global
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mount -a
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# df -hT /home
Filesystem     Type  Size  Used Avail Use% Mounted on
mgmt:/home     nfs4  5.0T  1.8T  3.3T  36% /home

# df -hT /global
Filesystem     Type  Size  Used Avail Use% Mounted on
mgmt:/global   nfs4  3.9T  637G  3.3T  17% /global
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# printf %s\\n Test &amp;gt; /home/testfile

# ls -lh /home/testfile
-rw-r--r-- 1 root root 5 Mar 20 19:59 /home/testfile

# cat /home/testfile
Test

# rm -i /home/testfile
rm: remove regular file ‘/home/testfile’? y

# ls -lh /home/testfile
ls: cannot access /home/testfile: No such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;: Complete this section&lt;/p&gt;

&lt;h3 id=&quot;postscripts-setup&quot;&gt;Postscripts Setup&lt;/h3&gt;

&lt;p&gt;The following steps need to be run on the management node, 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt; (IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /install/custom
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cd /install/custom/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Copy the content that your postscript will need. In this example, 
I prepared the torque directory on another compute node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus106&lt;/code&gt;, 
with the IP address: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.6&lt;/code&gt;) that I previously configured manually.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# scp root@192.168.80.6:/tmp/torque.tar.gz .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You don’t need the tarred content on the other compute node so you can 
delete it from there:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh -t root@192.168.80.6 rm -i /tmp/torque.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;synclist&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /install/custom/install/centos/compute.centos7.x86_64.synclist
/install/custom/torque/* -&amp;gt; /opt/torque/

/install/custom/group_cn_common -&amp;gt; /etc/group
/install/custom/gshadow_cn_common -&amp;gt; /etc/gshadow
/install/custom/passwd_cn_common -&amp;gt; /etc/passwd
/install/custom/shadow_cn_common -&amp;gt; /etc/shadow
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirm that the object &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;osimage&lt;/code&gt; now has the attribute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;synclists&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t osimage -i synclists
Object name: centos7.9-x86_64-install-compute
    synclists=/install/custom/install/centos/compute.centos7.x86_64.synclist
Object name: centos7.9-x86_64-netboot-compute
    synclists=
Object name: centos7.9-x86_64-statelite-compute
    synclists=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since it’s included in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;osimage&lt;/code&gt; object, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;syncfiles&lt;/code&gt; has been addeed 
to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; attribute of the compute node that you’re configuring 
(&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus102 -i postscripts
Object name: abacus102
    postscripts=syslog,remoteshell,syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /install/postscripts/compute_custom_post 
#!/bin/sh
#
# This is a postscript to configure compute nodes as NFS clients.
#
# This script is supposed to be located at
# /install/postscripts/compute_custom_post
#
# In order for it to be run after nodes are installed, compute_custom_post
# should be included in the postscripts field of the postscripts xCAT table.
# E.g.: nodegrpch compute postscripts.postscripts=compute_custom_post

MN_IP=&quot;192.168.80.210&quot;
MN_HOST=&quot;mgmt&quot;

cp /etc/fstab /etc/fstab.ORIG

printf %s\\n &quot;$MN_IP $MN_HOST&quot; &amp;gt;&amp;gt; /etc/hosts

mkdir /etc/xcat
mkdir /global
 
printf %s\\n &quot;$MN_HOST:/home    /home    nfs  defaults  1 2&quot; &amp;gt;&amp;gt; /etc/fstab
printf %s\\n &quot;$MN_HOST:/global  /global  nfs  defaults  1 2&quot; &amp;gt;&amp;gt; /etc/fstab

mount -a
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod 0755 /install/postscripts/compute_custom_post  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The next required postscripts script, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setupntp&lt;/code&gt;, was already preinstalled 
by xCAT:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ls -lh /install/postscripts/setupntp
-rwxr-xr-x 1 root root 7.4K Nov 10  2021 /install/postscripts/setupntp

# wc -l /install/postscripts/setupntp
328 /install/postscripts/setupntp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# head /install/postscripts/setupntp
#!/bin/bash
#
# setupchrony - Set up chrony
#
# Copyright (C) 2018 International Business Machines
# Eclipse Public License, Version 1.0 (EPL-1.0)
#     &amp;lt;http://www.eclipse.org/legal/epl-v10.html&amp;gt;
#
# 2018-07-11 GONG Jie &amp;lt;gongjie@linux.vnet.ibm.com&amp;gt;
#     - Draft
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /install/postscripts/abacus_custom_postboot
#!/bin/sh
#
# This is a postbootscript to perform postboot configuration on the
# compute nodes.  (&quot;postboot&quot; means after the reboot that occurs after
# installation has completed)
#
# This script is supposed to be located at
# /install/postscripts/abacus_custom_postboot
#
# In order for it to be run after nodes are installed and rebooted,
# abacus_custom_postboot
# should be included in the postbootscripts field of the postscripts xCAT table.
# E.g.:  nodegrpch compute postscripts.postbootscripts=abacus_custom_postboot

PBS_MOM_SERVICE_LOC=&quot;/etc/systemd/system/pbs_mom.service&quot;

printf %s\\n &apos;[Unit]&apos; &amp;gt; $PBS_MOM_SERVICE_LOC
printf %s\\n &apos;Description=PBS Mom service&apos; &amp;gt;&amp;gt; $PBS_MOM_SERVICE_LOC
printf %s\\n &amp;gt;&amp;gt; $PBS_MOM_SERVICE_LOC
printf %s\\n &apos;[Service]&apos; &amp;gt;&amp;gt; $PBS_MOM_SERVICE_LOC
printf %s\\n &apos;ExecStart=/opt/torque/sbin/pbs_mom&apos; &amp;gt;&amp;gt; $PBS_MOM_SERVICE_LOC
printf %s\\n &apos;Type=forking&apos; &amp;gt;&amp;gt; $PBS_MOM_SERVICE_LOC
printf %s\\n &amp;gt;&amp;gt; $PBS_MOM_SERVICE_LOC
printf %s\\n &apos;[Install]&apos; &amp;gt;&amp;gt; $PBS_MOM_SERVICE_LOC
printf %s\\n &apos;WantedBy=multi-user.target&apos; &amp;gt;&amp;gt; $PBS_MOM_SERVICE_LOC

systemctl daemon-reload
systemctl start pbs_mom.service
systemctl enable pbs_mom.service

rm /root/.ssh/id_rsa.pub
rm /root/.ssh/id_rsa

chmod 0600 /etc/ssh/ssh_host_ed25519_key
chmod 0600 /etc/ssh/ssh_host_ecdsa_key
chmod 0600 /etc/ssh/ssh_host_rsa_key
chmod 0600 /etc/ssh/ssh_host_dsa_key

systemctl restart sshd.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chmod 0755 /install/postscripts/abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus102 | grep provmethod
    provmethod=centos7.9-x86_64-install-compute

# lsdef abacus102 | grep -w -i os
    os=centos7.9

# nodels abacus102 nodetype | grep profile
abacus102: nodetype.profile: compute

# tabdump nodetype
#node,os,arch,profile,provmethod,supportedarchs,nodetype,comments,disable
---- snip ----
&quot;abacus102&quot;,&quot;centos7.9&quot;,&quot;x86_64&quot;,&quot;compute&quot;,&quot;centos7.9-x86_64-install-compute&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As of now, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; attribute for the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt; has not 
been updated with the required scripts.  From the definition of the object 
type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node&lt;/code&gt;, for the object &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;, display the attribute postscripts. 
You’ll notice that both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setupntp&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute_custom_post&lt;/code&gt; have not been 
appended to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; line:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus102 -i postscripts
Object name: abacus102
    postscripts=syslog,remoteshell,syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similarly, when you ask for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; attribute of the 
node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus_custom_postboot&lt;/code&gt; script is missing from 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; line:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus102 -i postbootscripts
Object name: abacus102
    postbootscripts=otherpkgs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Upgrade the group &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute&lt;/code&gt; with the required &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; and 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; script files:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodegrpch compute postscripts.postscripts=setupntp,compute_custom_post
# nodegrpch compute postscripts.postbootscripts=abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirm that it’s been done:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts
#node,postscripts,postbootscripts,comments,disabl
---- snip ----
&quot;compute&quot;,&quot;setupntp,compute_custom_post&quot;,&quot;abacus_custom_postboot&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, you’ll see that the compute node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;) has not been added 
to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts | grep abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add the required &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; script files to the 
node by updating it with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chtab(8)&lt;/code&gt; command.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=abacus102 \
postscripts.postscripts=setupntp,compute_custom_post \
postscripts.postbootscripts=abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To confirm that the needed postscripts are now included with the node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus102 | grep postscripts 
    postscripts=syslog,remoteshell,syncfiles,setupntp,compute_custom_post
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus102 | grep postbootscripts
    postbootscripts=otherpkgs,abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts
#node,postscripts,postbootscripts,comments,disable
---- snip ----
&quot;abacus102&quot;,&quot;setupntp,compute_custom_post&quot;,&quot;abacus_custom_postboot&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts | grep abacus102
&quot;abacus102&quot;,&quot;setupntp,compute_custom_post&quot;,&quot;abacus_custom_postboot&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Continuing with the setup, confirm that the node’s profile is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute&lt;/code&gt; 
as that’s the name of the whole group you modified earlier above.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodels abacus102 nodetype
abacus102: nodetype.arch: x86_64
abacus102: nodetype.node: abacus102
abacus102: nodetype.os: centos7.9
abacus102: nodetype.profile: compute
abacus102: nodetype.provmethod: centos7.9-x86_64-install-compute
abacus102: nodetype.supportedarchs: 
abacus102: nodetype.comments: 
abacus102: nodetype.nodetype: 
abacus102: nodetype.disable: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump nodetype
#node,os,arch,profile,provmethod,supportedarchs,nodetype,comments,disable
---- snip ----
&quot;abacus102&quot;,&quot;centos7.9&quot;,&quot;x86_64&quot;,&quot;compute&quot;,&quot;centos7.9-x86_64-install-compute&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus102 -i postscripts
Object name: abacus102
    postscripts=syslog,remoteshell,syncfiles,setupntp,compute_custom_post
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus102 -i postbootscripts
Object name: abacus102
    postbootscripts=otherpkgs,abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatdebugmode&lt;/code&gt; in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef -t site xcatdebugmode=2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Push &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;syncfiles&lt;/code&gt; to the node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus102 -P syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus102 -F -V
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log in to the compute node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt;):&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  For the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rcons&lt;/code&gt; to work, the node’s BIOS must be configured
for SOL (Serial Over LAN), a.k.a. Text Mode Console. &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rcons abacus102
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

abacus102 login: root
Password:

[root@abacus102 ~]#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Run the following command (&lt;strong&gt;note:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt; is the IP address of the managment node (MN), &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;, and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3001&lt;/code&gt; is xCAT port).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# USEOPENSSLFORXCAT=1 \
XCATSERVER=192.168.80.220:3001 \
/xcatpost/startsyncfiles.awk -v RCP=/usr/bin/rsync
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exit the compute node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The CentOS Linux login banner appears.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

abacus102 login:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Press &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl-e&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;c&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.&lt;/code&gt; (three characters: Ctrl-e, ‘c’ and ‘.’) to disconnect 
from the node by closing the session with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makegocons&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Back in the management node, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdcp abacus102 -F /install/custom/install/centos/compute.centos7.x86_64.synclist
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Update the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt; but limit it to only run the scripts:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus102 -P
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check whether the run of the scripts worked.&lt;/p&gt;

&lt;p&gt;Yeah, it worked for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;synclist&lt;/code&gt;; that is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute.centos7.x86_64.synclist&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 ls -lh /opt/torque/ 
abacus102: total 4.0K
abacus102: drwxr-xr-x. 2 root root 4.0K May 16  2009 bin
abacus102: drwxr-xr-x. 2 root root   92 May 16  2009 include
abacus102: drwxr-xr-x. 2 root root  113 May 16  2009 lib
abacus102: drwxr-xr-x. 6 root root   54 May 16  2009 man
abacus102: drwxr-xr-x. 2 root root  147 May 16  2009 sbin
abacus102: drwxr-xr-x. 3 root root   19 May 16  2009 var

# xdsh abacus102 du -chs /opt/torque/ 
abacus102: 108M /opt/torque/
abacus102: 108M total
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 cat /etc/passwd 
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 cat /etc/group
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It also worked for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute_custom_post&lt;/code&gt; script run:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 cat /etc/fstab
---- snip ----
abacus102: mgmt:/home    /home    nfs  defaults  1 2
abacus102: mgmt:/global  /global  nfs  defaults  1 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 df -hT 
abacus102: Filesystem              Type      Size  Used Avail Use% Mounted on
---- snip ---
abacus102: mgmt:/home              nfs4      5.0T  1.8T  3.3T  36% /home
abacus102: mgmt:/global            nfs4      3.9T  637G  3.3T  17% /global
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 cat /etc/hosts
---- snip ----
abacus102: 192.168.80.210 mgmt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setupntp&lt;/code&gt; script run worked too:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 systemctl is-active chronyd.service
abacus102: active
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 systemctl status chronyd.service
abacus102: * chronyd.service - NTP client/server
abacus102:    Loaded: loaded (/usr/lib/systemd/system/chronyd.service; enabled; vendor preset: enabled)
abacus102:    Active: active (running) since Fri 2022-03-20 18:53:38 PDT; 2min ago
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yep, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus_custom_postboot&lt;/code&gt; script run worked as well:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 systemctl is-active pbs_mom.service
abacus102: active

# xdsh abacus102 systemctl status pbs_mom.service
abacus102: * pbs_mom.service - PBS Mom service
abacus102: Loaded: loaded (/etc/systemd/system/pbs_mom.service; enabled; vendor preset: disabled)
abacus102: Active: active (running) since Fri 2022-03-20 18:53:39 PDT; 2min ago
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus102 --verify ls -lh /
abacus102: total 28K
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; &lt;br /&gt;
If the above &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;updatenode abacus102 -P&lt;/code&gt; does not work, you can try fixing 
it by the following sequence of commands:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus102 -P syncfiles
# updatenode abacus102 -P &quot;confignetwork -s&quot;
# updatenode abacus102 -P
# updatenode abacus102 -P -F -V
# updatenode abacus102 -P syncfiles -P &quot;confignics -s&quot;
# updatenode abacus102 -P syncfiles -F -V
# xdsh abacus102 shutdown -r now
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Explanation:&lt;/em&gt;  &lt;br /&gt;
If you want to run all the customization scripts that have been designated 
for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus102&lt;/code&gt; node (in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; 
attributes), the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-P&lt;/code&gt; option (i.e, the command: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;updatenode abacus102 -P&lt;/code&gt;) 
will not work after install.  Instead, after install use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-F&lt;/code&gt; option 
for file synchronization (including synchronization of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; 
and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; attributes).&lt;/p&gt;

&lt;p&gt;From the man page for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;updatenode(1)&lt;/code&gt; command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-F|--sync     Specifies that file synchronization should be performed on the
              nodes.  rsync/scp and ssh must be installed and configured on
              the nodes.
[...]
-P|--scripts  Specifies that postscripts and postbootscripts should be run on
              the nodes.  File sync with updatenode -P syncfiles is not
              supported.  The syncfiles postscript can only be run during
              install.  You should use updatenode -F instead.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;provision-a-node-and-manage-it-with-parallel-shell---aka-create-add-a-new-compute-node-cn-in-xcat---full-example&quot;&gt;Provision a Node and Manage It with Parallel Shell - aka Create (Add) a New Compute Node (CN) in xCAT - FULL EXAMPLE&lt;/h2&gt;

&lt;p&gt;Assumptions:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;You are configuring the new compute node on a blade server.&lt;/li&gt;
  &lt;li&gt;BMC (Baseboard Management Controller) in the blade chassis that hosts 
the blade server has already been configured so you can communicate with 
the BMC.&lt;/li&gt;
  &lt;li&gt;BMC’s IP address:  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.135&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;BMC’s username:  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xadmin&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;The chassis holds 14 blade servers.&lt;/li&gt;
  &lt;li&gt;You are configuring blade in bay number 9 (9th blade server).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Log into the xCAT management node (xCAT MN).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh root@192.168.80.220
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;configure-mm-management-module---aka-bmc-baseboard-management-controller&quot;&gt;Configure MM (Management Module) - a.k.a. BMC (Baseboard Management Controller)&lt;/h3&gt;

&lt;p&gt;Run the discovery on IP address of the xCAT MN (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;) and list 
all discovered MM (Management Node) &lt;strong&gt;service types&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsslp -s MM -i 192.168.80.220
---- snip ----
device  type-model  serial-number  side  ip-addresses    hostname
---- snip ----
mm      8852HC1     KQABCDE              192.168.80.135  Server--SNYK123456789A 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Rename the MM node to a more human-friendly name (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xbcmm1n&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef \
-t node \
-o Server--SNYK123456789A \ 
-n xbcmm1n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add the BMC (MM) node to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table.&lt;/p&gt;

&lt;p&gt;In other words, you are updating rows &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;username&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;password&lt;/code&gt; 
in the table &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt;.  From the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chtab(8)&lt;/code&gt; command’s usage:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;keycolname=keyvalue&lt;/code&gt;   a column name-and-value pair that identifies the 
                        rows in a table to be changed.&lt;/p&gt;

  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tablename.colname=newvalue&lt;/code&gt;    the new value for the specified row and 
                                column of the table.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mpa
#mpa,username,password,displayname,slots,urlpath,comments,disable
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;keycolname&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; with value being the name of the 
node that you’ll give to this BMC (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xbcmm1n&lt;/code&gt;), while the 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tablename.colname=newvalue&lt;/code&gt; are 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa.username=xadmin&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa.password=YOUR_BMC_PASSWORD&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;After this explanation, run the actual command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
mpa=xbcmm1n \
mpa.username=xadmin \
mpa.password=YOUR_BMC_PASSWORD
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table refers to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mp
#node,mpa,id,nodetype,comments,disable
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;add the attribute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; to the table &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=xbcmm1n \
mp.mpa=xbcmm1n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This MM (Management Module) node now includes the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; attributes 
in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump mp
#node,mpa,id,nodetype,comments,disable
---- snip ----
&quot;xbcmm1n&quot;,&quot;xbcmm1n&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add the attribute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;id&lt;/code&gt;. This is a MM (Management Module) and since 
it’s customary to give value &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt; (zero) to MMs, assign &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt; to it:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=xbcmm1n \
mp.id=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add this MM (Management Module) node’s IP address to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; file.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# printf %s\\n &quot;192.168.80.135 xbcmm1n&quot; &amp;gt;&amp;gt; /etc/hosts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check if you can communicate with the MM node.  For example, test whether 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rspconfig(1)&lt;/code&gt; can run without errors:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n snmpdest
xbcmm1n: SP SNMP Destination 1: 192.168.11.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  It would’ve been good even if returned value was 
empty (without an IP address); at this point you just want to make 
sure there are no errors.&lt;/p&gt;

&lt;p&gt;Now you can setup new ssh keys (a.k.a. enable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;snmp&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ssh&lt;/code&gt;) 
on this Management Module (named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xbcmm1n&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rspconfig xbcmm1n snmpcfg=enable sshcfg=enable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;xbcmm1n: SNMP enable: OK
xbcmm1n: SSH enable: OK
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can now check remote hardware vitals for the MM node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rvitals xbcmm1n
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can also check its hardware inventory:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rinv xbcmm1n
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The passwordless ssh login to the MM node works:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh xadmin@xbcmm1n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output (with BMC CLI prompt indicated with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system&amp;gt;&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Static IP address:     192.168.80.135
---- snip ----
system&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;provision-new-node-compute-node&quot;&gt;Provision New Node (Compute Node)&lt;/h3&gt;

&lt;p&gt;After you’ve setup the MM (Management Module) node, you are ready to 
start provisioning a new compute node.&lt;/p&gt;

&lt;p&gt;Find out the compute node’s MAC address by logging in to the MM (AMM) and 
obtaining it from there:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ssh xadmin@192.168.80.135
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  Don’t type &lt;strong&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;system&amp;gt;&lt;/code&gt;&lt;/strong&gt; .  It’s a BMC CLI prompt and it’s 
shown here to indicate that you are using the MM.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;system&amp;gt; info -T blade[9]
---- snip ----
MAC Address 1: 00:11:22:33:44:55 
MAC Address 2: 00:11:22:33:44:56
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note down the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MAC Address 1&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Exit the BMC’s CLI.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;system&amp;gt; exit
Connection to 192.168.80.135 closed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create an xCAT data object definition for this node (name it &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt;).&lt;br /&gt;
Explanation: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip&lt;/code&gt; = IP address of the node; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mac&lt;/code&gt; = MAC address of
the node; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmc&lt;/code&gt; = IP address of the MM/AMM (BMC); &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmcusername&lt;/code&gt; = username of
BMC (MM) account; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bmcpassword&lt;/code&gt; = password for BMC (MM) user, 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t&lt;/code&gt; = object &lt;strong&gt;t&lt;/strong&gt;ype, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--template&lt;/code&gt; = name of the xCAT shipped object 
definition template or an existing object, from which the new object 
definition will be created.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  For the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mac&lt;/code&gt; attribute, use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MAC Address 1&lt;/code&gt; you obtained above.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdef \
-t node \
abacus109 \
--template x86_64-template \
ip=192.168.80.9 \
mac=00:11:22:33:44:55 \
bmc=192.168.80.135 \
bmcusername=xadmin \
bmcpassword=yourBMCpassword
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;“Fix for Blade”&lt;/strong&gt; &lt;br /&gt;
Since it’s on a blade server, you have to adjust this compute node’s 
xCAT definition and make it blade-specific.  Also, while you are 
already making changes, modify serial port settings that this 
particular blade model (IBM HS21) requires for SOL (Serial Over LAN) 
to work; specfically, it asks it to be the second serial device 
(in Unix/BSD/Linux numbering style it starts with zero so the second 
device will be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt;) with serial speed of 19200:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef \
-t node \
-o abacus109 \
cons=blade mgt=blade getmac=blade serialport=1 serialspeed=19200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  The domain of the xCAT node must be provided in an xCAT 
network definition or the xCAT site definition.  Otherwise, two commands 
in the subsequent steps for configuring DNS (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makehosts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedns -n&lt;/code&gt;) 
will not work.  In this example, an assumption is that you’ve alredy 
defined the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;domain&lt;/code&gt; attribute in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site | grep domain
&quot;domain&quot;,&quot;mydomain.com&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Continuing with the setup:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makehosts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This adds the compute node being created to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt;. Specifically, 
this line is added to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; file: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.9 abacus109 abacus109.mydomain.com&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Update DNS records with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makedns(8)&lt;/code&gt; command.&lt;br /&gt;
(This also restarts &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;named&lt;/code&gt; service.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedns -n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedhcp abacus109
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can confirm that it worked by using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-q&lt;/code&gt; option:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedhcp -q abacus109
abacus109: ip-address = 192.168.80.9, hardware-address = 00:11:22:33:44:55
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This updates &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/dhcp/dhcpd.conf&lt;/code&gt; file with a line:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#definition for host abacus109 aka host abacus109 can be found in the 
dhcpd.leases file (typically /var/lib/dhcpd/dhcpd.leases)`
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and if you check the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/lib/dhcpd/dhcpd.leases&lt;/code&gt; file, the compute 
node’s  dhcp definition is there:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep -n abacus109 /var/lib/dhcpd/dhcpd.leases
106:host abacus109 {
111:        supersede server.ddns-hostname = &quot;abacus109&quot;;
112:        supersede host-name = &quot;abacus109&quot;;
117:                                &quot;http://${next-server}:80/tftpboot/xcat
/xnba/nodes/abacus109&quot;;
121:                                &quot;http://${next-server}:80/tftpboot/xcat
/xnba/nodes/abacus109.uefi&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add the new compute node to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table. &lt;br /&gt;
(The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpa&lt;/code&gt; table has already been defined and linked to the 
 BMC (named &lt;em&gt;xbcmm1n&lt;/em&gt;) in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mp&lt;/code&gt; table.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=abacus109 \
mp.mpa=xbcmm1n \
mp.id=9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t osimage -i synclists
Object name: centos7.9-x86_64-install-compute
    synclists=/install/custom/install/centos/compute.centos7.x86_64.synclist
Object name: centos7.9-x86_64-netboot-compute
    synclists=
Object name: centos7.9-x86_64-statelite-compute
    synclists=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Explanation for options: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t&lt;/code&gt;: type, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-o&lt;/code&gt;: object, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-i&lt;/code&gt;: information/inquire.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus109 -i postscripts
Object name: abacus109
    postscripts=syslog,remoteshell,syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 -i postscripts,postbootscripts
Object name: abacus109
    postbootscripts=otherpkgs
    postscripts=syslog,remoteshell,syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So you need to add the necessary (for this particular configuration; 
that is, configuration of this example) scripts (both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; 
and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt;) to the compute node that is being provisioned.
In other words, you are updating rows &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; 
in the table &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt;. From the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chtab(8)&lt;/code&gt; command’s usage:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;keycolname=keyvalue&lt;/code&gt;   a column name-and-value pair that identifies the 
                        rows in a table to be changed.&lt;/p&gt;

  &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tablename.colname=newvalue&lt;/code&gt;    the new value for the specified row and 
                                column of the table.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts
#node,postscripts,postbootscripts,comments,disable
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;keycolname&lt;/code&gt; is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node&lt;/code&gt; with value being the name of the 
node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt;), while the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tablename.colname=newvalue&lt;/code&gt; are 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts.postscripts=setupntp,compute_custom_post&lt;/code&gt; and 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts.postbootscripts=abacus_custom_postboot&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;After this (long) explanation, run the actual command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=abacus109 \
postscripts.postscripts=setupntp,compute_custom_post \
postscripts.postbootscripts=abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now the node includes all the needed scripts:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 -i postscripts,postbootscripts
Object name: abacus109
    postbootscripts=otherpkgs,abacus_custom_postboot
    postscripts=syslog,remoteshell,syncfiles,setupntp,compute_custom_post
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt; hardware control.  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt; power management:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower abacus109 state
abacus109: on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similarly, you can check communication with the node with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rinv(1)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rinv abacus109 all
abacus109: Machine Type/Model: 8853AC1
abacus109: Serial Number: ThisBlade&apos;sSerialNumberHere
abacus109: MAC Address 1: 00:11:22:33:44:55 
abacus109: MAC Address 2: 00:11:22:33:44:56 
abacus109: Management Module firmware: 62 (BPET62C 06/23/2011)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The newly added compute node now appears in the nodes list:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodels
---- snip ----
abacus109
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check boot order on the node and whether it’sa configured to boot from 
the Ethernet (net) device.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; On IBM BladeCenter (which is the case here), you only have
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq&lt;/code&gt; and not &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsetboot&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.mail-archive.com/xcat-user@lists.sourceforge.net/msg05290.html&quot;&gt;Re: [xcat-user] Problem with rsetboot: unable to identify plugin&lt;/a&gt;
(Retrieved on Mar 20, 2022):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;On BladeCenter, you [only] have &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq&lt;/code&gt;.  …&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rbootseq abacus109 list
abacus109: hd0,cdrom,none,none
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case, the blade was not configured to boot from the Ethernet (net) 
device so you need to change it with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rbootseq(1)&lt;/code&gt; command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rbootseq abacus109 net,hd0,cdrom,none
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirm that the boot order has been changed:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rbootseq abacus109 list
abacus109: net,hd0,cdrom,none
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Make sure that &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;goconserver.service&lt;/code&gt; is running.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# systemctl is-active goconserver.service
active
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Register the node for an instance of the console (serial console) session:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makegocons -D abacus109
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the node is registered for an instance of the console session , 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;consoleenabled&lt;/code&gt; attribute has been added and set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; for the node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 | grep console
    consoleenabled=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ensure that the node’s status is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;connected&lt;/code&gt; by querying its 
console connection state.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makegocons -q abacus109
NODE                       SERVER                     STATE
abacus109                  xcatmn.mydomain.com        connected
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start provisioning the node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xcatprobe osdeploy -n abacus109
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xcatprobe osdeploy -n abacus109
The install NIC in current server is eth1                             [INFO]
All nodes to be deployed are valid                                    [ OK ]
-------------------------------------------------------------
Start capturing every message during OS provision process....
-------------------------------------------------------------
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Launch a separate shell session and in there (a.k.a. the second terminal), 
start installation process.  (The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nodeset(8)&lt;/code&gt; command sets the boot 
state for a node or node range.)&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;osimage=imagename&lt;/code&gt; option (from the manual page for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nodeset(8)&lt;/code&gt; 
command):  &lt;br /&gt;
“Prepare server for installing a node using the specified os
image. The os image is defined in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;osimage&lt;/code&gt; table and
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linuximage&lt;/code&gt; table.”&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump osimage
#imagename,groups,profile,imagetype,description,provmethod,rootfstype,osdistroname,osupdatename,cfmdir,osname,osvers,osarch,synclists,postscripts,postbootscripts,serverrole,isdeletable,kitcomponents,environvar,comments,disable
&quot;centos7.9-x86_64-install-compute&quot;,,&quot;compute&quot;,&quot;linux&quot;,,&quot;install&quot;,,&quot;centos7.9-x86_64&quot;,,,&quot;Linux&quot;,&quot;centos7.9&quot;,&quot;x86_64&quot;,&quot;/install/custom/install/centos/compute.centos7.x86_64.synclist&quot;,,,,,,,,
&quot;centos7.9-x86_64-netboot-compute&quot;,,&quot;compute&quot;,&quot;linux&quot;,,&quot;netboot&quot;,,&quot;centos7.9-x86_64&quot;,,,&quot;Linux&quot;,&quot;centos7.9&quot;,&quot;x86_64&quot;,,,,,,,,,
&quot;centos7.9-x86_64-statelite-compute&quot;,,&quot;compute&quot;,&quot;linux&quot;,,&quot;statelite&quot;,,&quot;centos7.9-x86_64&quot;,,,&quot;Linux&quot;,&quot;centos7.9&quot;,&quot;x86_64&quot;,,,,,,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodeset abacus109 osimage=centos7.9-x86_64-install-compute
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;fix-for-rpower-nodename-boot&quot;&gt;Fix for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower &amp;lt;nodename&amp;gt; boot&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;Back in the second terminal, as per the message above, to reboot the 
compute node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt; you would normally use this &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower&lt;/code&gt; 
command here: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower abacus109 boot&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;However, at least in this setup, I’ve found it inconsistent because when 
running that command, the compute node would power off &lt;strong&gt;but&lt;/strong&gt; would not 
power back on; that is, it wouldn’t actually restart.  (Even though the 
man page for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower(8)&lt;/code&gt; command says for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;boot&lt;/code&gt; option: 
“&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;boot&lt;/code&gt;:  If off, then power on.  If on, then hard reset.  This option 
is &lt;strong&gt;recommended&lt;/strong&gt; (&lt;em&gt;emphasis mine&lt;/em&gt;) over &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cycle&lt;/code&gt; [option].&lt;/p&gt;

&lt;p&gt;I had to add the following options to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower(8)&lt;/code&gt; command to make 
the installation work; that is, to turn the node off and then on. 
(Alternitavely, you could first manually turn the node off: 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower abacus109 off&lt;/code&gt;, and then on:  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower abacus109 on&lt;/code&gt;.)&lt;/p&gt;

&lt;p&gt;Explanation for the options used in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower(8)&lt;/code&gt; command below
(from the manpage for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower(8)&lt;/code&gt; command):&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;”&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-r retrycount&lt;/code&gt;
specify the number of retries that the monitoring process will
perform before declaring the failure. The default value is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;3&lt;/code&gt;.
Setting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;retrycount&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt; means only monitoring the os
installation progress and will not re-initiate the installation if
the node status has not been changed to the expected value after
timeout.  This flag &lt;strong&gt;must&lt;/strong&gt; (&lt;em&gt;emphasis mine&lt;/em&gt;) be used with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m&lt;/code&gt; flag.”&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;”&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m table.column==expectedstatus -m table.column=~expectedstatus&lt;/code&gt;
Use one or multiple &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m&lt;/code&gt; flags to specify the node attributes and the
expected status for the node installation monitoring and automatic
retry mechanism.  The operators &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;==&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;!=&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;=~&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;!~&lt;/code&gt; are valid. 
This flag &lt;strong&gt;must&lt;/strong&gt; (&lt;em&gt;emphasis mine&lt;/em&gt;) be used with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t&lt;/code&gt; flag.”&lt;/p&gt;

    &lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  While &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;powering-on&lt;/code&gt; is not listed as one of valid values 
of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;status&lt;/code&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nodelist.status&lt;/code&gt;) in the manpage for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node(7)&lt;/code&gt; 
or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nodelist(5)&lt;/code&gt;, in my tests it worked more reliable than using 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m nodelist.status==booting&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m nodelist.status==installing&lt;/code&gt;.
&lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;9&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;”&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t timeout&lt;/code&gt;
Specify the timeout, in minutes, to wait for the expectedstatus
specified by &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m&lt;/code&gt; flag. This is a &lt;strong&gt;required&lt;/strong&gt; (&lt;em&gt;emphasis mine&lt;/em&gt;) flag if 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m&lt;/code&gt; flag is specified.  Power off, then on.”&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In the second terminal, run the following command.
(&lt;strong&gt;Note:&lt;/strong&gt;  You need to use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;==&lt;/code&gt; (double equal sign), 
 a.k.a. &lt;em&gt;comparison operator&lt;/em&gt; when testing for the expected status 
 with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m&lt;/code&gt; option.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rpower \
abacus109 \
boot \
-r 0 \
-m nodelist.status==powering-on \
-t 5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first terminal updates with the following:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[abacus109] 19:37:29 Use command rpower to reboot node abacus109
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then in less than ten seconds, the first terminal displays another line:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[abacus109] 19:37:36 Node status is changed to powering-on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Launch yet another separate shell session and in there (let’s call it 
the third terminal), check and monitor provisioning process. (&lt;strong&gt;NOTE:&lt;/strong&gt; 
For the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rcons&lt;/code&gt; to work, the node’s BIOS must be configured  for 
SOL (Serial Over LAN), a.k.a. Text Mode Console. &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rcons abacus109
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output shows that the node is booting up:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[Enter `^Ec?&apos; for help]
goconserver(2022-08-11T20:06:46-07:00): Hello 192.168.80.220:58102, 
welcome to the session of abacus109
&amp;gt;&amp;gt; BIOS Version 1.15 &amp;lt;&amp;lt;

Press F1 for Configuration/Setup
Press F2 for Diagnosticsbacus109
Press F12 for Boot Device Selection Menu

Broadcom NetXtreme II Ethernet Boot Agent v3.4.8
Copyright (C) 2000-2007 Broadcom Corporation
All rights reserved.

---- snip ----

Initializing../ 

---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After 5-10 minutes, output in the third terminal shows that 
the OS installation is finishing.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Installing boot loader
.
Performing post-installation setup tasks
.

Configuring installed system
.
Writing network configuration
.
Creating users
.
Configuring addons
.
Generating initramfs
.
Running post-installation scripts

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can check the provision status in/from the second terminal:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 -i status
Object name: abacus109
    status=installing
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After post-installation scripts are done, the node will reboot (run this 
in the second terminal again):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 -i status
Object name: abacus109
    status=booting
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Again in the second terminal after a couple of minutes:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 -i status
Object name: abacus109
    status=failed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, in the third terminal; it shows that the OS booted fine, and 
even logged in fine:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

abacus109 login: root 
Password:

[root@abacus109 ~]#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check the provision status in the first terminal, where the output is 
now long and most likely has been completed:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---- snip ----
[abacus109] 20:24:39 INFO done
[abacus109] 20:24:39 INFO ready
[abacus109] 20:24:39 INFO done
[abacus109] 20:24:39 Node status is changed to failed
All nodes specified to monitor, have finished OS provision process    [ OK ]
======================  Summary  =====================
There is 1 node provision failures
abacus109 : stop at stage &apos;booting&apos;                                   [FAIL]
   postscript end...: syncfiles return with 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case, there was an issue with postscripts and that’ll need to be fixed.&lt;/p&gt;

&lt;p&gt;Also, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xdsh&lt;/code&gt; check worked:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 more /etc/*release
abacus109: ::::::::::::::
abacus109: /etc/centos-release
abacus109: ::::::::::::::
abacus109: CentOS Linux release 7.9.2009 (Core)
abacus109: ::::::::::::::
abacus109: /etc/os-release
abacus109: ::::::::::::::
abacus109: NAME=&quot;CentOS Linux&quot;
abacus109: VERSION=&quot;7 (Core)&quot;
abacus109: ID=&quot;centos&quot;
abacus109: ID_LIKE=&quot;rhel fedora&quot;
abacus109: VERSION_ID=&quot;7&quot;
abacus109: PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If there are remnants from a previous node setup, the host key has been 
changed and you’ll receive a warning about it:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[xcatmn]: abacus109: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
abacus109: @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
abacus109: @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
---- snip ---
abacus109: It is also possible that a host key has just been changed.
abacus109: The fingerprint for the ED25519 key sent by the remote host is
abacus109: SHA256:I04c7IX......
---- snip ---
abacus109: Add correct host key in /root/.ssh/known_hosts to get rid of this message.
abacus109: Offending ECDSA key in /root/.ssh/known_hosts:19
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To fix the warning about the host key, remove the line in question:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sed -i.bkp &apos;19d&apos; /root/.ssh/known_hosts
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The xdsh now works without the warning:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 more /etc/*release
abacus109: ::::::::::::::
abacus109: /etc/centos-release
abacus109: ::::::::::::::
abacus109: CentOS Linux release 7.9.2009 (Core)
---- snip ----
[xcatmn]: abacus109: Warning: Permanently added &apos;abacus109,192.168.80.9&apos; (ED25519) to the list of known hosts.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you want, you can remove backed up &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;known_hosts&lt;/code&gt; file now:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rm -i ~/.ssh/known_hosts.bkp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check whether the run of the scripts worked.&lt;/p&gt;

&lt;p&gt;Yeah, it worked for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;synclist&lt;/code&gt;; that is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute.centos7.x86_64.synclist&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 ls -lh /opt/torque/ 
abacus109: total 4.0K
abacus109: drwxr-xr-x. 2 root root 4.0K May 16  2009 bin
abacus109: drwxr-xr-x. 2 root root   92 May 16  2009 include
abacus109: drwxr-xr-x. 2 root root  113 May 16  2009 lib
abacus109: drwxr-xr-x. 6 root root   54 May 16  2009 man
abacus109: drwxr-xr-x. 2 root root  147 May 16  2009 sbin
abacus109: drwxr-xr-x. 3 root root   19 May 16  2009 var

# xdsh abacus109 du -chs /opt/torque/ 
abacus109: 108M /opt/torque/
abacus109: 108M total
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 cat /etc/passwd 
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 cat /etc/group
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It also worked for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute_custom_post&lt;/code&gt; script run:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 cat /etc/fstab
---- snip ----
abacus109: mgmt:/home    /home    nfs  defaults  1 2
abacus109: mgmt:/global  /global  nfs  defaults  1 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 df -hT 
abacus109: Filesystem              Type      Size  Used Avail Use% Mounted on
---- snip ---
abacus109: mgmt:/home              nfs4      5.0T  1.8T  3.3T  36% /home
abacus109: mgmt:/global            nfs4      3.9T  637G  3.3T  17% /global
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 cat /etc/hosts
---- snip ----
abacus109: 192.168.80.210 mgmt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setupntp&lt;/code&gt; script run worked too:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 systemctl is-active chronyd.service
abacus109: active
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 systemctl status chronyd.service
abacus109: * chronyd.service - NTP client/server
abacus109:    Loaded: loaded (/usr/lib/systemd/system/chronyd.service; enabled; vendor preset: enabled)
abacus109:    Active: active (running) since Fri 2022-03-20 18:53:38 PDT; 2min ago
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yep, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus_custom_postboot&lt;/code&gt; script run worked as well:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 systemctl is-active pbs_mom.service
abacus109: active

# xdsh abacus109 systemctl status pbs_mom.service
abacus109: * pbs_mom.service - PBS Mom service
abacus109: Loaded: loaded (/etc/systemd/system/pbs_mom.service; enabled; vendor preset: disabled)
abacus109: Active: active (running) since Fri 2022-03-20 18:53:39 PDT; 2min ago
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 --verify ls -lh /
abacus109: total 28K
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The only thing left is to run a test job as explained above, under 
&lt;a href=&quot;#submit-a-test-job-to-a-specific-node&quot;&gt;Submit a Test Job to a Specific Node&lt;/a&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Temporary/currently: no systemd for pbs_server and pbs_sched so
for now starting them manually:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo /etc/rc.d/init.d/pbs_server start&lt;/code&gt; and&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo /etc/rc.d/init.d/pbs_sched start&lt;/code&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Migrate network restart with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;at&lt;/code&gt; to Appendix.&lt;/p&gt;

&lt;p&gt;Restart networking and see if network interfaces are in the routing table.&lt;/p&gt;

&lt;p&gt;If you are not logged in to the server directly via console; for example,
if you are logged in via ssh, use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;at(1)&lt;/code&gt; utility, with the sequence 
of commands below.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;
To end input, generate the &lt;em&gt;end-of-file&lt;/em&gt; (EOF) character &lt;a href=&quot;#footnotes&quot;&gt;¹&lt;/a&gt;
(aka &lt;em&gt;eof command&lt;/em&gt;) by pressing &lt;strong&gt;Ctrl D&lt;/strong&gt; (usually abbreviated &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;^D&lt;/code&gt;)
on an empty line.
For additional details, refer to the man page for the current shell,
in this case &lt;strong&gt;csh&lt;/strong&gt;/&lt;strong&gt;tcsh&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo at now+3min
warning: commands will be executed using /bin/sh
at&amp;gt; sudo systemctl stop NetworkManager
at&amp;gt; sleep 5
at&amp;gt; sudo systemctl start NetworkManager
at&amp;gt; &amp;lt;EOT&amp;gt;
job 1 at Thu Mar 20 15:01:00 2022
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can check terminal line settings for EOF with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;stty(1)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ stty --all | wc -l

$ stty --all | grep -i EOF
intr = ^C; quit = ^\; erase = ^H; kill = ^U; eof = ^D; eol = &amp;lt;undef&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ stty --help | grep &apos;eof CHAR&apos;
   eof CHAR      CHAR will send an end of file (terminate the input)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the man page for stty(1):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[...]
Special characters:
[...]
    eof CHAR
           CHAR will send an end of file (terminate the input)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ netstat -rn
Kernel IP routing table
Destination     Gateway        Genmask        Flags  MSS Window irtt Iface
0.0.0.0         123.12.23.254  0.0.0.0        UG       0 0         0 eno1
123.12.23.0     0.0.0.0        255.255.255.0  U        0 0         0 eno1
192.168.80.0    0.0.0.0        255.255.255.0  U        0 0         0 eno2
192.168.122.0   0.0.0.0        255.255.255.0  U        0 0         0 virbr0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Show this as an alternative setup - and move it to Appendix&lt;/p&gt;

&lt;h2 id=&quot;management-node-setup&quot;&gt;Management Node Setup&lt;/h2&gt;

&lt;p&gt;All the following steps should be executed on the server with the 
management node role.&lt;/p&gt;

&lt;h3 id=&quot;create-local-centos-packages-repository&quot;&gt;Create Local CentOS Packages Repository&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo dnf clean metadata
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo dnf update  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The CentOS 7 DVD ISO image has been transferred to /tmp when the content 
of the image was customized: 
&lt;a href=&quot;/howto/virtualization/rs232serial/cli/terminal/shell/console/sysadmin/server/hardware/2022/03/12/centos-rhel-dvd-iso-customization-testing-with-qemu.html&quot;&gt;Customize CentOS/RHEL DVD ISO for Installation in Text Mode via Serial Console and Test the Image with QEMU&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Check if the link above will work on GitHub Pages&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mkdir -p /install/isos/centos7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Place the ISO to the following directory:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mv /tmp/CentOS-7-x86_64-DVD-2009-HS21.iso /install/isos/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mkdir -p /mnt/dvd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Mount the ISO as follows.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo \
mount -o loop \
/install/isos/CentOS-7-x86_64-DVD-2009-HS21.iso \
/mnt/dvd/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ df -hT | grep iso9660
/dev/loop0            iso9660   4.5G  4.5G     0 100% /mnt/dvd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo \
cp -a \
/mnt/dvd/* \
/install/isos/centos7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo umount /mnt/dvd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create the CentOS repo file for the local repository.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo vi /etc/yum.repos.d/centos7-local.repo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat /etc/yum.repos.d/centos7-local.repo
[centos]
name=CentOS $releasever - $basearch
baseurl=file:///install/isos/centos7
enabled=1
gpgcheck=0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirm that the repo is enabled:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dnf repolist --all | grep centos
centos                CentOS 8 - x86_64    enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Install createrepo package.&lt;/p&gt;

&lt;p&gt;This utility generates a common metadata repository from a directory 
of RPM packages.&lt;/p&gt;

&lt;p&gt;It defines the RPM-metadata (&lt;strong&gt;repodata&lt;/strong&gt;) format and maintains one of 
the programs (&lt;strong&gt;createrepo&lt;/strong&gt;) which create this format from existing RPMs 
and other sources.&lt;/p&gt;

&lt;p&gt;Project’s URI/URL: &lt;a href=&quot;http://createrepo.baseurl.org/&quot;&gt;http://createrepo.baseurl.org/&lt;/a&gt;: &lt;br /&gt;
(Retrieved on Mar 20, 2022)&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The files break down as follows:&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;
      &lt;p&gt;repomd.xml this is the file that describes the other metadata files. 
It is like an index file to point to the other files. It contains 
timestamps and checksums for the other files. This lets a client 
download this one, small file and know if anything else has changed. 
This also means that cryptographically (ex: gpg) signing this one file 
can ensure repository integrity.&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;primary.xml.[gz] this file stores the primary metadata information. 
This includes information such as:
      &lt;ul&gt;
        &lt;li&gt;name, epoch, version, release, architecture&lt;/li&gt;
        &lt;li&gt;file size, file location, description, summary, format, 
checksums header byte-ranges, etc.&lt;/li&gt;
        &lt;li&gt;dependencies, provides, conflicts, obsoletes, suggests, recommends&lt;/li&gt;
        &lt;li&gt;file lists for the package for CERTAIN files - specifically files 
matching: /etc&lt;em&gt;, *bin/&lt;/em&gt;, /usr/lib/sendmail [1]&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
    &lt;li&gt;filelists.xml.[gz] this file stores the complete file and directory 
listings for the packages. The package is identified by: name, epoch, 
version, release, architecture and package checksum id.&lt;/li&gt;
    &lt;li&gt;other.xml.[gz] this file currently only stores the changelog data 
from packages. However, this file could be used for any other 
additional metadata that could be useful for clients.&lt;/li&gt;
    &lt;li&gt;groups.xml.[gz] this file is tentatively described. The intention is 
for a common package-groups specification as well. There is still 
some sections for this format that need to be fleshed out.&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo dnf install createrepo
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mkdir -p /install/centos7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The createrepo requires an argument which is the directory in which you 
would like to generate the repository data.  Since the packages directory 
will be in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/install/centos7&lt;/code&gt;, run the following:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo createrepo /install/centos7
Directory walk started
Directory walk done - 0 packages
Temporary output repo path: /install/centos7/.repodata/
Preparing sqlite DBs
Pool started (with 5 workers)
Pool finished
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -lh /install/centos7/repodata/
total 28K
-rw-r--r-- 1 root root 1.4K Mar 20 15:22 19699a08[...]87e3-primary.sqlite.bz2
-rw-r--r-- 1 root root  134 Mar 20 15:22 1cb61ea9[...]d7d8bcae-primary.xml.gz
-rw-r--r-- 1 root root  609 Mar 20 15:22 878c2f1d[...]b9-filelists.sqlite.bz2
-rw-r--r-- 1 root root  123 Mar 20 15:22 95a4415d[...]fb2a5f-filelists.xml.gz
-rw-r--r-- 1 root root  123 Mar 20 15:22 ef3e2069[...]9e070aaab6-other.xml.gz
-rw-r--r-- 1 root root  571 Mar 20 15:22 f660753f[...]78d966-other.sqlite.bz2
-rw-r--r-- 1 root root 3.0K Mar 20 15:22 repomd.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo dnf clean all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;xcat-backup---todo---move-it-to-appendix&quot;&gt;xCAT Backup   &lt;strong&gt;[TODO]&lt;/strong&gt;  &amp;lt;– Move it to Appendix&lt;/h4&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mkdir /tmp/xcatsnapdirbkp
$ sudo /opt/xcat/sbin/xcatsnap -d /tmp/xcatsnapdirbkp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# mkdir /tmp/xCAT_Backup
# dumpxCATdb -a -p /tmp/xCAT_Backup
# restorexCATdb -p /tmp/xCAT_Backup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;   Change the title - and migrate it to Troubleshooting section
(after first creating the Troubleshooting section)&lt;/p&gt;

&lt;h3 id=&quot;if-you-encounter-a-certificate-error&quot;&gt;If You Encounter a Certificate Error&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ lsxcatd -a
Unable to open socket connection to xcatd daemon on localhost:3001.
Verify that the xcatd daemon is running and that your SSL setup is correct.
Connection failure: SSL connect attempt failed error:0407008A:rsa 
  routines:RSA_padding_check_PKCS1_type_1:invalid padding 
  error:04067072:rsa routines:rsa_ossl_public_decrypt:padding check failed 
  error:0D0C5006:asn1 encoding routines:ASN1_item_verify:EVP 
  lib error:1416F086:SSL 
  routines:tls_process_server_certificate:certificate verify failed at 
  /opt/xcat/lib/perl/xCAT/Client.pm line 282.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Set the environment variable &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;XCATBYPASS&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Y&lt;/code&gt; and 
keep using it until you fix this certificate error.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo &quot;XCATBYPASS=Y&quot; csh -c &apos;lsxcatd -a&apos;
Version 2.16.3 (git commit d6c76ae5f66566409c3416c0836660e655632194, 
  built Wed Nov 10 09:58:20 EST 2021)
  This is a Management Node
dbengine=SQLite
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo &quot;XCATBYPASS=Y&quot; csh -c &apos;tabdump site&apos;
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;lsslp-todo-expand-on-lsslp-and-possibly-put-it-in-a-separate-section&quot;&gt;lsslp &lt;strong&gt;[TODO]&lt;/strong&gt; Expand on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lsslp&lt;/code&gt; and possibly put it in a separate section&lt;/h3&gt;

&lt;p&gt;The nodes which the user wants to discover.&lt;/p&gt;

&lt;p&gt;Use the lsslp command to discover &lt;strong&gt;selected&lt;/strong&gt; networked services 
information within the same subnet.  The request is sent out all 
available network adapters.&lt;/p&gt;

&lt;p&gt;If the user specifies the noderange, lsslp will just return the nodes in 
the node range.&lt;/p&gt;

&lt;p&gt;Which means it will help to add the new nodes to the xCAT database 
without modifying the existed definitions.&lt;/p&gt;

&lt;p&gt;But the nodes’ name specified in noderange should be defined in database 
in advance.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;appendix&quot;&gt;Appendix&lt;/h2&gt;

&lt;h3 id=&quot;running-qemu-guest-in-the-background&quot;&gt;Running QEMU Guest in the Background&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/libexec/qemu-kvm \
-drive format=raw,file=xcatmn.img \
-m 4G \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br0&quot;,id=hn0 \
-netdev tap,helper=&quot;/usr/libexec/qemu-bridge-helper --br=br1&quot;,id=hn1 \
-device virtio-net-pci,netdev=hn0 \
-device virtio-net-pci,netdev=hn1 \
-daemonize
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-nographic&lt;/code&gt; cannot be used with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-daemonize&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Then, connect (log into) the guest OS:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ssh root@123.12.23.235
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;how-to-change-node-name-withfromin-xcat&quot;&gt;How To Change Node Name with/from/in xCAT&lt;/h3&gt;

&lt;p&gt;Change node name from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cn14&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus14&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef \
-t node \
-o cn14 \
-n abacus14
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makehosts abacus14
# makedns -n
# makedhcp -n
# makehosts abacus14
# makehosts -n
# makedhcp abacus14
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# makedhcp -q all 
abacus14: ip-address = 192.168.80.114, hardware-address = 00:21:5e:2c:0a:ac
cn13: ip-address = 192.168.80.113, hardware-address = 00:21:5e:2c:15:a4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;troubleshooting-postscripts-and-postbootscripts&quot;&gt;Troubleshooting Postscripts and Postbootscripts&lt;/h3&gt;

&lt;p&gt;The following steps need to be run on the management 
node, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Confirm that the object &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;osimage&lt;/code&gt; has the attribute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;synclists&lt;/code&gt;.
(Options: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t&lt;/code&gt;: type, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-i&lt;/code&gt;: information/inquire).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t osimage -i synclists
Object name: centos7.9-x86_64-install-compute
    synclists=/install/custom/install/centos/compute.centos7.x86_64.synclist
Object name: centos7.9-x86_64-netboot-compute
    synclists=
Object name: centos7.9-x86_64-statelite-compute
    synclists=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since it’s included in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;osimage&lt;/code&gt; object, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;syncfiles&lt;/code&gt; has been 
addeed to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; attribute of the compute node that you’re 
configuring (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt;).
(Options: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-t&lt;/code&gt;: type, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-o&lt;/code&gt;: object, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-i&lt;/code&gt;: information/inquire).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus109 -i postscripts
Object name: abacus109
    postscripts=syslog,remoteshell,syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 | grep profile
    profile=compute
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 | grep provmethod 
    provmethod=centos7.9-x86_64-install-compute
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 | grep -w -i os 
    os=centos7.9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodels abacus109 nodetype | grep profile
abacus109: nodetype.profile: compute
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump nodetype
#node,os,arch,profile,provmethod,supportedarchs,nodetype,comments,disable
---- snip ----
&quot;abacus109&quot;,&quot;centos7.9&quot;,&quot;x86_64&quot;,&quot;compute&quot;,&quot;centos7.9-x86_64-install-compute&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As of now, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; attribute for the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt; has not 
been updated with the required scripts.  From the definition of the object 
type &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node&lt;/code&gt;, for the object &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt;, display the attribute &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt;. 
You’ll notice that  both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setupntp&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute_custom_post&lt;/code&gt; have not 
been appended to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; line:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus109 -i postscripts
Object name: abacus109
    postscripts=syslog,remoteshell,syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similarly, when you ask for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; attribute of the node 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus_custom_postboot&lt;/code&gt; script is missing from 
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; line:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus109 -i postbootscripts
Object name: abacus109
    postbootscripts=otherpkgs
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  The following two &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nodegrpch&lt;/code&gt; commands do not need to be run 
if you’ve already setup &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; for the 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute&lt;/code&gt; group.&lt;/p&gt;

&lt;p&gt;Upgrade the group &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute&lt;/code&gt; with the required &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; 
and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; script files:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodegrpch compute postscripts.postscripts=setupntp,compute_custom_post
# nodegrpch compute postscripts.postbootscripts=abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirm that it’s been done:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts
#node,postscripts,postbootscripts,comments,disabl
---- snip ----
&quot;compute&quot;,&quot;setupntp,compute_custom_post&quot;,&quot;abacus_custom_postboot&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, you’ll see that the compute node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt;) has not been added 
to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; table:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts | grep abacus109
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Update the node by adding the required &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; 
script files to it:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chtab \
node=abacus109 \
postscripts.postscripts=setupntp,compute_custom_post \
postscripts.postbootscripts=abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To confirm that the needed postscripts are now included with the node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 | grep postscripts 
    postscripts=syslog,remoteshell,syncfiles,setupntp,compute_custom_post
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef abacus109 | grep postbootscripts
    postbootscripts=otherpkgs,abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts
#node,postscripts,postbootscripts,comments,disable
---- snip ----
&quot;abacus109&quot;,&quot;setupntp,compute_custom_post&quot;,&quot;abacus_custom_postboot&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump postscripts | grep abacus109
&quot;abacus109&quot;,&quot;setupntp,compute_custom_post&quot;,&quot;abacus_custom_postboot&quot;,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Continuing with the setup, confirm that the node’s profile is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute&lt;/code&gt; 
as that’s the name of the whole group you modified earlier above.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodels abacus109 nodetype
abacus109: nodetype.arch: x86_64
abacus109: nodetype.node: abacus109
abacus109: nodetype.os: centos7.9
abacus109: nodetype.profile: compute
abacus109: nodetype.provmethod: centos7.9-x86_64-install-compute
abacus109: nodetype.supportedarchs: 
abacus109: nodetype.comments: 
abacus109: nodetype.nodetype: 
abacus109: nodetype.disable: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump nodetype
#node,os,arch,profile,provmethod,supportedarchs,nodetype,comments,disable
---- snip ----
&quot;abacus109&quot;,&quot;centos7.9&quot;,&quot;x86_64&quot;,&quot;compute&quot;,&quot;centos7.9-x86_64-install-compute&quot;,,,,
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus109 -i postscripts
Object name: abacus109
    postscripts=syslog,remoteshell,syncfiles,setupntp,compute_custom_post
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsdef -t node -o abacus109 -i postbootscripts
Object name: abacus109
    postbootscripts=otherpkgs,abacus_custom_postboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatdebugmode&lt;/code&gt; in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;site&lt;/code&gt; table to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# chdef -t site xcatdebugmode=2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Push &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;syncfiles&lt;/code&gt; to the node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus109 -P syncfiles
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus109 -F -V
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log in to the compute node (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  For the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rcons&lt;/code&gt; to work, the node’s BIOS must be configured
for SOL (Serial Over LAN), a.k.a. Text Mode Console. &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;10&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rcons abacus109
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

abacus109 login: root
Password:

[root@abacus109 ~]#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Run the following command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# USEOPENSSLFORXCAT=1 \
XCATSERVER=192.168.80.220:3001 \
/xcatpost/startsyncfiles.awk -v RCP=/usr/bin/rsync
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exit the compute node.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;CentOS Linux 7 (Core)
Kernel 3.10.0-1160.el7.x86_64 on an x86_64

abacus109 login:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Press &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Ctrl-e&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;c&lt;/code&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.&lt;/code&gt; (three characters: Ctrl-e, ‘c’ and ‘.’) to 
disconnect by closing the session with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;makegocons&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Back in the management node, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdcp abacus109 -F /install/custom/install/centos/compute.centos7.x86_64.synclist
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Update the node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt; but limit it to only run the scripts.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus109 -P
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check whether the run of the scripts worked.&lt;/p&gt;

&lt;p&gt;Yeah, it worked for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;synclist&lt;/code&gt;; that is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute.centos7.x86_64.synclist&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 ls -lh /opt/torque/ 
abacus109: total 4.0K
abacus109: drwxr-xr-x. 2 root root 4.0K May 16  2009 bin
abacus109: drwxr-xr-x. 2 root root   92 May 16  2009 include
abacus109: drwxr-xr-x. 2 root root  113 May 16  2009 lib
abacus109: drwxr-xr-x. 6 root root   54 May 16  2009 man
abacus109: drwxr-xr-x. 2 root root  147 May 16  2009 sbin
abacus109: drwxr-xr-x. 3 root root   19 May 16  2009 var

# xdsh abacus109 du -chs /opt/torque/ 
abacus109: 108M /opt/torque/
abacus109: 108M total
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 cat /etc/passwd 
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 cat /etc/group
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It also worked for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;compute_custom_post&lt;/code&gt; script run:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 cat /etc/fstab
---- snip ----
abacus109: mgmt:/home    /home    nfs  defaults  1 2
abacus109: mgmt:/global  /global  nfs  defaults  1 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 df -hT 
abacus109: Filesystem              Type      Size  Used Avail Use% Mounted on
---- snip ---
abacus109: mgmt:/home              nfs4      5.0T  1.8T  3.3T  36% /home
abacus109: mgmt:/global            nfs4      3.9T  637G  3.3T  17% /global
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 cat /etc/hosts
---- snip ----
abacus109: 192.168.80.210 mgmt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;setupntp&lt;/code&gt; script run worked too:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 systemctl is-active chronyd.service
abacus109: active
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 systemctl status chronyd.service
abacus109: * chronyd.service - NTP client/server
abacus109:    Loaded: loaded (/usr/lib/systemd/system/chronyd.service; enabled; vendor preset: enabled)
abacus109:    Active: active (running) since Fri 2022-03-20 18:53:38 PDT; 2min ago
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yep, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus_custom_postboot&lt;/code&gt; script run worked as well:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 systemctl is-active pbs_mom.service 
abacus109: active

# xdsh abacus109 systemctl status pbs_mom.service 
abacus109: * pbs_mom.service - PBS Mom service
abacus109: Loaded: loaded (/etc/systemd/system/pbs_mom.service; enabled; vendor preset: disabled)
abacus109: Active: active (running) since Fri 2022-03-20 18:53:39 PDT; 2min ago
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus109 --verify ls -lh /
abacus109: total 28K
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; &lt;br /&gt;
If the above &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;updatenode abacus109 -P&lt;/code&gt; does not work, you can try fixing 
it by the following sequence of commands:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# updatenode abacus109 -P syncfiles
# updatenode abacus109 -P &quot;confignetwork -s&quot;
# updatenode abacus109 -P
# updatenode abacus109 -P -F -V
# updatenode abacus109 -P syncfiles -P &quot;confignics -s&quot;
# updatenode abacus109 -P syncfiles -F -V
# xdsh abacus109 shutdown -r now
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;Explanation:&lt;/em&gt;  &lt;br /&gt;
If you want to run all the customization scripts that have been designated for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus109&lt;/code&gt; node (in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; attributes), the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-P&lt;/code&gt; option (i.e, the command: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;updatenode abacus109 -P&lt;/code&gt;) will not work after install.  Instead, after install use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-F&lt;/code&gt; option for file synchronization (including synchronization of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postscripts&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;postbootscripts&lt;/code&gt; attributes).&lt;/p&gt;

&lt;p&gt;From the man page for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;updatenode(1)&lt;/code&gt; command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;-F|--sync     Specifies that file synchronization should be performed on the
              nodes.  rsync/scp and ssh must be installed and configured on
              the nodes.
[...]
-P|--scripts  Specifies that postscripts and postbootscripts should be run on
              the nodes.  File sync with updatenode -P syncfiles is not
              supported.  The syncfiles postscript can only be run during
              install.  You should use updatenode -F instead.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;usefultypicall-first-commands-in-the-guest-vm-with-xcat-on-it&quot;&gt;Useful/Typicall (First) Commands in the Guest VM with xCAT on It&lt;/h3&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# uptime
# hostname
# ifconfig
# ifconfig -1
# ip address show
# ip -d address show       (ip -d a s)
# ip link show
# ip neigh                 (ip neighbour, ip neighbor) 
# nmcli device status
# nmcli connection show
# netstat -rn
# netstat -r
# ip route
# cat /etc/resolv.conf
# cat /etc/hosts
# ping -c2 freebsd.org
# ping -c2 192.168.80.210   &amp;lt;-- forwarder (DNS server)
# ping -c2 192.168.80.220   &amp;lt;-- nameserver
# rpower cn14 state         &amp;lt;-- cn14 is a (compute) node
# rinv -V cn14 firm -all
# tabdump site
# tabdump networks
# tabdump mpa
# tabdump mp
# tabdump passwd
# tabdump postscripts
# tabdump prescripts
# tabdump ppc
# rpower cn13 state         &amp;lt;-- cn13 is a (compute) node

# nodels
# nodestat

# ipmitool-xcat

# rspconfig

# rbootseq

# rpower
# rvitals 
# rinv

# xdsh 
# psh

# tabdump ipmi
# tabdump hosts
# tabdump mac
# tabdump nodehm
# tabdump nodelist
# tabdump noderes
# tabdump nodetype
# tabdump linuximage
# tabdump chain
# tabdump discoverydata
# tabdump osdistro
# tabdump osimage
# tabdump policy

mkdef, chtab, lsdef

nodech 
nodeadd
nodegrpch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsslp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;List nodes defined in database but can’t be discovered:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsslp -I
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-I&lt;/code&gt;    Give the warning message for the nodes in database which have no
        SLP responses.  Note that this flag can only be used after the
        database migration finished successfully.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# lsslp -z
# lsslp -x
# lsslp -w       &amp;lt;--  Writes output to xCAT database
# rscan cn13
# rscan -z cn13
# rscan -x cn13
# rscan -x cn13  &amp;lt;-- Writes output to xCAT database
# hwclock --show
# lsxcatd -a
# makehosts
# makedns
# makedhcp -n
# dumpxCATdb -a -p /tmp/xCAT_Backup
# restorexCATdb -p /tmp/xCAT_Backup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;the-fundamentals-of-building-an-hpc-cluster&quot;&gt;The Fundamentals of Building an HPC Cluster&lt;/h3&gt;

&lt;p&gt;Adapted from &lt;a href=&quot;https://www.admin-magazine.com/HPC/Articles/Building-an-HPC-Cluster&quot;&gt;The Fundamentals of Building an HPC Cluster&lt;/a&gt; (retrieved on Mar 20, 2022):&lt;/p&gt;

&lt;p&gt;Architecture &lt;br /&gt;
The cluster is on a &lt;strong&gt;private Ethernet network&lt;/strong&gt;. 
The address space is &lt;strong&gt;unroutable&lt;/strong&gt; so the compute nodes are “hidden” from 
a routable network, allowing you to separate your cluster logically from 
a public network.&lt;/p&gt;

&lt;p&gt;To log in to the cluster from a public network you need to add a second 
network interface controller (NIC) to the managment node (master node). 
This NIC has a public IP address that allows you to log in to the cluster. 
Only the master node should have the public IP address because there is 
no reason for compute nodes to have two addresses. (You want them to 
be private.)&lt;/p&gt;

&lt;p&gt;Another key feature of a basic cluster architecture is a shared directory 
across the nodes.  Strictly speaking this isn’t required but without it 
some MPI (message-passing interface) applications would not run. 
Therefore, it is a good idea simply to use a shared filesystem in 
the cluster.  &lt;strong&gt;NFS&lt;/strong&gt; is the easiest to use because both server and 
client are in the kernel, and the distribution should have the tools 
for configuring and monitoring NFS.&lt;/p&gt;

&lt;p&gt;Software Layers&lt;br /&gt;
The first layer is the basic software you need and really nothing extra. 
The second layer adds some administrative tools to make it easier to 
operate the cluster, as well as tools to reduce problems when running 
parallel applications.  The third layer adds more sophisticated cluster 
tools and adds the concept of monitoring, so you can understand 
what’s happening.&lt;/p&gt;

&lt;p&gt;Layer 1: Software Configuration &lt;br /&gt;
The first layer of software only contains the minimum software to run 
parallel applications.  Obviously, the first thing you need is an OS. 
Typical installation options are usually good enough. 
They install most everything you need.&lt;/p&gt;

&lt;p&gt;The next thing you need is a set of MPI libraries such as 
&lt;a href=&quot;https://www.open-mpi.org/&quot;&gt;Open MPI&lt;/a&gt; or &lt;a href=&quot;https://www.mpich.org/&quot;&gt;MPICH&lt;/a&gt;. 
These are the libraries you will use for creating parallel applications 
and running them on your cluster.  You can find details on how to build 
and install them on their respective websites.
&lt;strong&gt;Note:&lt;/strong&gt;  This cluster configuration uses PBS (Portable Batch System) 
scheduling software in its &lt;a href=&quot;https://web.archive.org/web/20090123185628/http://clusterresources.com/downloads/torque/torque-2.3.6.tar.gz&quot;&gt;TORQUE (Terascale Open-source Resource and QUEue manager&lt;/a&gt; variant, &lt;strong&gt;without&lt;/strong&gt; interfacing with Message Passing MPI (Message Passing Interface) libraries – As per 
&lt;a href=&quot;https://docs.adaptivecomputing.com/torque/3-0-5/index.php&quot;&gt;TORQUE™ Administrator Guide&lt;/a&gt;, section 7.0 Interfacing with Message Passing and &lt;a href=&quot;https://docs.adaptivecomputing.com/torque/3-0-5/7.1mpi.php&quot;&gt;7.1 MPI (Message Passing Interface) Support&lt;/a&gt; “A message passing library is used by parallel jobs to 
&lt;strong&gt;augment&lt;/strong&gt; (&lt;em&gt;emphasis mine&lt;/em&gt;) communication between the tasks distributed 
across the cluster.  TORQUE can run with any message passing library and 
provides limited integration with some MPI libraries.”&lt;/p&gt;

&lt;p&gt;The next, and actually last, piece of software you need is SSH. 
More specifically, you need to be able to SSH to and from each node 
without a password, allowing you to run the MPI applications easily. 
Make sure, however, that you set up SSH after you have NFS working 
across the cluster and each node has mounted the exported directory.&lt;/p&gt;

&lt;p&gt;Layer 2: Architecture and Tools &lt;br /&gt;
The next layer of software adds tools to help reduce cluster problems and 
make it easier to administer.  Using the basic software mentioned in the 
previous section, you can run parallel applications, but you might run 
into difficulties as you scale your system, including:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Running commands on each node (parallel shell) &lt;br /&gt;
Configuring identical nodes (package skew) &lt;br /&gt;
Keeping the same time on each node (NTP) &lt;br /&gt;
Running more than one job (job scheduler/resource manager)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The last issue to address is the job scheduler (also called a resource 
manager).  This is a key element of HPC and can be used even for small 
clusters.  Roughly speaking, a job scheduler will run jobs (applications) 
on your behalf when the resources are available on the cluster so you 
don’t have to sit around and wait for the cluster to be free before you 
run applications.  Rather, you can write a few lines of script and submit 
it to the job scheduler.  When the resources are available, it will run 
your job on your behalf.&lt;/p&gt;

&lt;p&gt;In the script, you specify the resources you need, such as the number of 
nodes or number of cores, and you give the job scheduler the command that 
runs your application, such as:  &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mpirun -np 4 &amp;lt;executable&amp;gt;&lt;/code&gt;   REPLACE w/TORQUE&lt;/p&gt;

&lt;p&gt;Among the resource managers available, many are open source. 
Examples of resource managers include:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://adaptivecomputing.com/cherry-services/torque-resource-manager/&quot;&gt;Torque&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://slurm.schedmd.com/&quot;&gt;Slurm&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://sourceforge.net/projects/gridengine/&quot;&gt;SGE&lt;/a&gt; – Son of Grid Engine&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://gridscheduler.sourceforge.net/&quot;&gt;OGE&lt;/a&gt; – Open Grid Engine&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With these issues addressed, you now have a pretty reasonable cluster with some administrative tools. Although it’s not perfect, it’s most definitely workable.&lt;/p&gt;

&lt;p&gt;Layer 3: Deep Administration &lt;br /&gt;
The third level of tools gets you deeper into HPC administration and begins 
to gather more information about the cluster so you can find problems 
before they happen.  The tools I will discuss briefly are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Cluster management tools&lt;/li&gt;
  &lt;li&gt;Monitoring tools (how are the nodes doing)&lt;/li&gt;
  &lt;li&gt;Environment Modules&lt;/li&gt;
  &lt;li&gt;Multiple networks&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;A cluster management tool is really a toolkit to automate the configuration, 
launching, and management of compute nodes from the master node. 
In some cases, the toolkit will even install the master node for you. 
A number of open source cluster management tools are available, including:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://xcat.org/&quot;&gt;xCAT&lt;/a&gt;, also: &lt;a href=&quot;https://github.com/xcat2&quot;&gt;https://github.com/xcat2&lt;/a&gt;, &lt;a href=&quot;https://sourceforge.net/p/xcat/wiki/Main_Page/&quot;&gt;https://sourceforge.net/p/xcat/wiki/Main_Page/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://warewulf.lbl.gov/&quot;&gt;Warewulf&lt;/a&gt;, also &lt;a href=&quot;https://github.com/warewulf/warewulf3&quot;&gt;https://github.com/warewulf/warewulf3&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://oscar-cluster.github.io/oscar/&quot;&gt;OSCAR&lt;/a&gt; - Open Source Cluster Application Resource, also &lt;a href=&quot;https://github.com/oscar-cluster/oscar&quot;&gt;OSCAR on GitHub&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://onesis.org/&quot;&gt;oneSIS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The tools vary in their approach but they typically allow you to create 
compute nodes that are part of the cluster.  This can be done via images, 
in which a complete image is pushed to the compute node, or via packages, 
in which specific packages are installed on the compute nodes.&lt;/p&gt;

&lt;p&gt;Many of the cluster management tools also include tools for monitoring 
the cluster.  Several monitoring tools are appropriate for HPC clusters 
but a universal tool is Ganglia.  Some of the cluster tools come 
pre-configured with Ganglia, and some don’t, requiring 
an &lt;a href=&quot;http://www.admin-magazine.com/HPC/Articles/Monitoring-HPC-Systems&quot;&gt;installation&lt;/a&gt;.
By default Ganglia comes with some pre-defined metrics but the tool is 
very flexible and allows you to write simple code to attain specific 
metrics from your nodes.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Review all footnotes, including the order and whether some
            footnotes are missing&lt;/p&gt;

&lt;h3 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h3&gt;

&lt;p&gt;[1]  More specifically, when you press &lt;strong&gt;Ctrl D&lt;/strong&gt;, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;at(1)&lt;/code&gt; 
displays &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;EOT&amp;gt;&lt;/code&gt;, which stands for End Of Transmission:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ man ascii
[...]
       The following table contains the 128 ASCII characters.

       C program &apos;\X&apos; escapes are noted.

       Oct   Dec   Hex   Char                        Oct   Dec   Hex   Char
       ────────────────────────────────────────────────────────────────────────
       000   0     00    NUL &apos;\0&apos; (null character)   100   64    40    @
       001   1     01    SOH (start of heading)      101   65    41    A
       002   2     02    STX (start of text)         102   66    42    B
       003   3     03    ETX (end of text)           103   67    43    C
       004   4     04    EOT (end of transmission)   104   68    44    D
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[2] The loopback interface is a virtual interface that is always up and 
available after it has been configured.&lt;/p&gt;

&lt;p&gt;Per Solaris(TM) Operating Environment Boot Camp by David Rhodes, 
Dominic Butler - Pearson Publishing -  September 2002:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;All systems have a “loopback” interface, regardless of whether they are 
connected to the network or not.  This is not a true network interface, 
but acts as one to allow some network-aware programs (such as RPC) to be
able to connect to both the remote and local host in the same way.&lt;/p&gt;

  &lt;p&gt;You don’t need to be concerned with configuring it, as this is performed 
by the operating system, but we do need to make certain that the local 
host address remains in the host file.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;[3] Per Networking Bible by
Barrie Sosinsky - John Wiley &amp;amp; Sons, Inc. - September 2009:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;One important example of a logical network interface (also called 
a virtual interface) is the loopback adapter.  The loopback adapter 
is a software routine that emulates an internal NIC card that can accept
system requests and reply to those requests.  The loopback adapter is 
used to test whether network functions are operating correctly.&lt;/p&gt;

  &lt;p&gt;For IP version 4, the loopback adapter is found at &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;127.0.0.1&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;[4] SOL (Serial over LAN) &lt;br /&gt;
&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.advmgtmod.doc/kp1bd_pdf.pdf&quot;&gt;BladeCenter SOL (Serial over LAN) Setup Guide - IBM Corporation, Twelfth Edition (November 2009)&lt;/a&gt; (Retrieved on Mar 22, 2022):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Chapter 1. Introduction&lt;/p&gt;

  &lt;p&gt;Serial over LAN (SOL) provides a means to manage servers remotely by
using a command-line interface (CLI) over a Telnet or Secure Shell (SSH)
connection.  SOL is required to manage servers that do not have
keyboard/video/mouse (KVM) support […]&lt;/p&gt;

  &lt;p&gt;[…]&lt;/p&gt;

  &lt;p&gt;SOL (Serial Over LAN) provides console redirection for both BIOS and the
blade server operating system.  The SOL feature redirects server
serial-connection data over a LAN without the need for special cabling.
The SOL connection enables blade servers to be managed from any remote
location with network access.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;[5] IBM Advanced Settings Utility (ASU)  &lt;br /&gt;
&lt;a href=&quot;https://www.ibm.com/support/pages/ibm-advanced-settings-utility-asu&quot;&gt;IBM Advanced Settings Utility (ASU)&lt;/a&gt;
(Retrieved on Mar 20, 2022)&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://toolscenter.lenovofiles.com/help/topic/asu/asu_guide.pdf&quot;&gt;IBM Advanced Settings Utility (ASU) Version 3.60 User’s Guide&lt;/a&gt;
(Retrieved on Mar 20, 2022)&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;You can use the IBM Advanced Settings Utility (&lt;strong&gt;ASU&lt;/strong&gt;) to modify
firmware settings from the command line on multiple operating-system
platforms.  You can perform the following tasks by using the utility:&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;Modify selected basic input/output system &lt;strong&gt;(BIOS) CMOS&lt;/strong&gt; settings
  without the need to restart the system to access F1 settings.&lt;/li&gt;
    &lt;li&gt;Modify selected &lt;strong&gt;BMC&lt;/strong&gt; (Baseboard Management Controller) setup settings. &lt;br /&gt;
[…]&lt;/li&gt;
    &lt;li&gt;Modify selected settings in &lt;strong&gt;Integrated Management Module (IMM)&lt;/strong&gt;-based
servers for the &lt;strong&gt;IMM&lt;/strong&gt; firmware and IBM System x Server Firmware. 
The IMM replaces the Remote Supervisor Adapter and &lt;strong&gt;Baseboard Management
Controller (BMC)&lt;/strong&gt; functions on IMM-based servers.  IBM System x Server
Firmware is the IBM implementation of &lt;strong&gt;Unified Extensible Firmware
Interface (UEFI)&lt;/strong&gt;.  The &lt;em&gt;UEFI&lt;/em&gt; replaces the basic input/output system
&lt;em&gt;(BIOS)&lt;/em&gt; and defines a standard interface between the operating system,
platform firmware, and external devices.  &lt;br /&gt;
[…]&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;[6] Configure &lt;strong&gt;Boot Order&lt;/strong&gt; in &lt;strong&gt;BIOS&lt;/strong&gt; via the &lt;strong&gt;ASU&lt;/strong&gt; Tool&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 save BIOS.TXT --group all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# wc -l BIOS.TXT
88 BIOS.TXT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep -i boot BIOS.TXT
CMOS_AlternateBootDevice4=Hard Disk 0
CMOS_AlternateBootDevice3=CD ROM
CMOS_AlternateBootDevice2=Diskette Drive 0
CMOS_AlternateBootDevice1=Network
CMOS_PostBootFailRequired=Enabled
CMOS_PCIBootPriority=Planar SAS
CMOS_RemoteConsoleBootEnable=Enabled
BMC_PrimaryBootDevice1=HDD0
BMC_PrimaryBootDevice2=CD-ROM
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 showvalues --setlist \
BMC_PrimaryBootDevice1 \
BMC_PrimaryBootDevice2 \
BMC_PrimaryBootDevice3 \
BMC_PrimaryBootDevice4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;BMC_PrimaryBootDevice1=Floppy Drive=iSCSI=iSCSI Critical=Network=HDD0=HDD1=HDD2=HDD3=CD-ROM
BMC_PrimaryBootDevice2=Floppy Drive=iSCSI=iSCSI Critical=Network=HDD0=HDD1=HDD2=HDD3=CD-ROM
BMC_PrimaryBootDevice3=Floppy Drive=iSCSI=iSCSI Critical=Network=HDD0=HDD1=HDD2=HDD3=CD-ROM
BMC_PrimaryBootDevice4=Floppy Drive=iSCSI=iSCSI Critical=Network=HDD0=HDD1=HDD2=HDD3=CD-ROM
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 set BMC_PrimaryBootDevice1 Network
# /opt/ibm/toolscenter/asu/asu64 set BMC_PrimaryBootDevice2 CD-ROM
# /opt/ibm/toolscenter/asu/asu64 set BMC_PrimaryBootDevice3 HDD0 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/ibm/toolscenter/asu/asu64 save BIOS_NEW.TXT --group all 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# wc -l BIOS_NEW.TXT
89 BIOS_NEW.TXT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep -i boot BIOS_NEW.TXT
CMOS_AlternateBootDevice4=Hard Disk 0
CMOS_AlternateBootDevice3=CD ROM
CMOS_AlternateBootDevice2=Diskette Drive 0
CMOS_AlternateBootDevice1=Network
CMOS_PostBootFailRequired=Enabled
CMOS_PCIBootPriority=Planar SAS
CMOS_RemoteConsoleBootEnable=Enabled
BMC_PrimaryBootDevice1=Network
BMC_PrimaryBootDevice2=CD-ROM
BMC_PrimaryBootDevice3=HDD0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[7] From the manual page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hosts(5)&lt;/code&gt; on RHEL 5.x:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;hosts - The static table lookup for host names  &lt;br /&gt;
This file is a simple text file that associates IP addresses with
hostnames, one line per IP address. For each host a single line should
be present with the following information:
   &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IP_address canonical_hostname [aliases...]&lt;/code&gt;&lt;/p&gt;

  &lt;p&gt;Fields of the entry are separated by any number of blanks and/or tab
characters.  Text from a “#” character until the end of the line is a
comment, and is ignored.  Host names may contain only alphanumeric
characters, minus signs (“-“), and periods (“.”).  They must begin with
an alphabetic character and end with an alphanumeric character.
Optional aliases provide for name changes, alternate spellings, shorter
hostnames, or generic hostnames (for example, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;localhost&lt;/code&gt;).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;[8] From the manual page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbsnodes(8)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;DESCRIPTION
    The pbsnodes command is used to mark nodes down, free or offline. 
    It can also be used to list nodes and their state.  Node information
    is obtained by sending a request to the PBS job server.  Sets of 
    nodes can be operated on at once by specifying a node property 
    prefixed by a colon.
    Nodes do not exist in a single state, but actually have a set 
    of states.  For example, a node can be simultaneously &quot;busy&quot; and 
    &quot;offline&quot;.  The &quot;free&quot; state is the absence of all other states and 
    so is never combined with other states.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[9] From the manual page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;node(7)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    The current status of this node.  This attribute will be set by
    xCAT software.  Valid values: defined, booting, netbooting,
    booted, discovering, configuring, installing, alive, standingby,
    powering-off, unreachable. If blank, defined is assumed. The
    possible status change sequences are: For installation:
    defined-&amp;gt;[discovering]-&amp;gt;[configuring]-&amp;gt;[standingby]-&amp;gt;installing-&amp;gt;booting-&amp;gt;[postbooting]-&amp;gt;booted-&amp;gt;[alive],
    For diskless deployment:
    defined-&amp;gt;[discovering]-&amp;gt;[configuring]-&amp;gt;[standingby]-&amp;gt;netbooting-&amp;gt;[postbooting]-&amp;gt;booted-&amp;gt;[alive],
    For booting:
    [alive/unreachable]-&amp;gt;booting-&amp;gt;[postbooting]-&amp;gt;booted-&amp;gt;[alive],
    For powering off: [alive]-&amp;gt;powering-off-&amp;gt;[unreachable], For
    monitoring: alive-&amp;gt;unreachable. Discovering and configuring are
    for x Series discovery process. Alive and unreachable are set
    only when there is a monitoring plug-in start monitor the node
    status for xCAT. Note that the status values will not reflect the
    real node status if you change the state of the node from outside
    of xCAT (i.e. power off the node using HMC GUI).
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, when I used
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m nodelist.status==booting&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-m nodelist.status==installing&lt;/code&gt; 
with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower boot&lt;/code&gt;, the node would sometimes got stuck in powered off state, 
and the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rcons &amp;lt;nodename&amp;gt;&lt;/code&gt; would display:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;         DESTINATION BLADE IS IN POWER OFF STATE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As the output of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatprobe osdeploy -n &amp;lt;nodename&amp;gt;&lt;/code&gt; command in the first terminal; in this case, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatprobe osdeploy -n abacus109&lt;/code&gt; (after &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rpower abacus109 boot&lt;/code&gt; in the second terminal) indicated&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;... Node status is changed to powering-on
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;search for &lt;em&gt;powering-on&lt;/em&gt; returned:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep -r -n &apos;powering-on&apos; /opt/xcat/
/opt/xcat/lib/perl/xCAT/GlobalDef.pm:52:$::STATUS_POWERING_ON  = &quot;powering-on&quot;;
/opt/xcat/lib/perl/xCAT_plugin/openbmc.pm:49:$::POWER_STATE_POWERING_ON  = &quot;powering-on&quot;;
/opt/xcat/probe/lib/perl/xCAT/GlobalDef.pm:52:$::STATUS_POWERING_ON  = &quot;powering-on&quot;;
/opt/xcat/probe/subcmds/osdeploy:1209:                } elsif ($status eq &quot;powering-on&quot;) {
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For example, looking into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GlobalDef.pm&lt;/code&gt; revealed even more valid values 
for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;status&lt;/code&gt; (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nodelist.status&lt;/code&gt;).  One of them is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;powering-on&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sed -n 43,63p /opt/xcat/lib/perl/xCAT/GlobalDef.pm
# valid values for nodelist.status columns or other status
$::STATUS_ACTIVE       = &quot;alive&quot;;
$::STATUS_INACTIVE     = &quot;unreachable&quot;;
$::STATUS_INSTALLING   = &quot;installing&quot;;
$::STATUS_INSTALLED    = &quot;installed&quot;;
$::STATUS_BOOTING      = &quot;booting&quot;;
$::STATUS_POSTBOOTING  = &quot;postbooting&quot;;
$::STATUS_NETBOOTING   = &quot;netbooting&quot;;
$::STATUS_BOOTED       = &quot;booted&quot;;
$::STATUS_POWERING_ON  = &quot;powering-on&quot;;
$::STATUS_POWERING_OFF = &quot;powering-off&quot;;
$::STATUS_DISCOVERING  = &quot;discovering&quot;;
$::STATUS_DISCOVERED   = &quot;discovered&quot;;
$::STATUS_CONFIGURING  = &quot;configuring&quot;;
$::STATUS_CONFIGURED   = &quot;configured&quot;;
$::STATUS_STANDING_BY  = &quot;standingby&quot;;
$::STATUS_SHELL        = &quot;shell&quot;;
$::STATUS_DEFINED      = &quot;defined&quot;;
$::STATUS_UNKNOWN      = &quot;unknown&quot;;
$::STATUS_FAILED       = &quot;failed&quot;;
$::STATUS_BMCREADY     = &quot;bmcready&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[10] In this example, the blade server is &lt;strong&gt;IBM HS21&lt;/strong&gt;, whose BIOS needs 
to be setup with the following in order for SOL (Serial Over LAN) to work:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Serial Port A: Auto-configure&lt;/li&gt;
  &lt;li&gt;Serial Port B: Auto-configure&lt;/li&gt;
  &lt;li&gt;Remote Console Active: Enabled&lt;/li&gt;
  &lt;li&gt;Remote Console COM Port: COM 2&lt;/li&gt;
  &lt;li&gt;Remote Console Active After Boot: Enabled&lt;/li&gt;
  &lt;li&gt;Remote Console Flow Control: Hardware&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;[11] The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nomodeset&lt;/code&gt; fix for the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;no | invalid EDID&lt;/code&gt; messages in the console:&lt;/p&gt;

&lt;p&gt;For example, if the EDID issue is happening on a node named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus211&lt;/code&gt;,
to fix it run the the following commands on the xCAT MN (Management Node), 
which in the examples on this page has an IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.80.220&lt;/code&gt;
(hostname &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;).  (&lt;strong&gt;Note:&lt;/strong&gt; The OS on the compute 
node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus214&lt;/code&gt; is CentOS 7 so the grub version on it is grub2.)&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# scp root@abacus211:/etc/default/grub /tmp/grubabacus211.ORIG
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cp -i /tmp/grubabacus211.ORIG /tmp/grubabacus211.NEW
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep -n CMDLINE /tmp/grubabacus211.NEW
7:GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=xcatvg/root console=ttyS1,19200&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# grep -n &apos;ttyS1,19200&apos; /tmp/grubabacus211.NEW
7:GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=xcatvg/root console=ttyS1,19200&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sed -n &apos;/ttyS1,19200/p&apos; /tmp/grubabacus211.NEW
GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=xcatvg/root console=ttyS1,19200&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sed -n &apos;/ttyS1,19200/=&apos; /tmp/grubabacus211.NEW
7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# sed -i.bkp &apos;s/ttyS1,19200/ttyS1,19200 nomodeset/&apos; /tmp/grubabacus211.NEW
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# diff \
--unified=0 \
/tmp/grubabacus211.NEW.bkp \
/tmp/grubabacus211.NEW
--- /tmp/grubabacus211.NEW.bkp 2022-03-20 20:59:04.966346023 -0700
+++ /tmp/grubabacus211.NEW     2022-03-20 21:00:25.710970506 -0700
@@ -7 +7 @@
-GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=xcatvg/root console=ttyS1,19200&quot;
+GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=xcatvg/root console=ttyS1,19200 nomodeset&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus211 cp /etc/default/grub /tmp/grub.ORIG
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# scp /tmp/grubabacus211.NEW root@abacus211:/etc/default/grub
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus211 cat /etc/default/grub
abacus211: GRUB_TIMEOUT=5
abacus211: GRUB_DISTRIBUTOR=&quot;$(sed &apos;s, release .*$,,g&apos; /etc/system-release)&quot;
abacus211: GRUB_DEFAULT=saved
abacus211: GRUB_DISABLE_SUBMENU=true
abacus211: GRUB_TERMINAL=&quot;serial console&quot;
abacus211: GRUB_SERIAL_COMMAND=&quot;serial --unit=1 --speed=19200&quot;
abacus211: GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=xcatvg/root console=ttyS1,19200 nomodeset&quot;
abacus211: GRUB_DISABLE_RECOVERY=&quot;true&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus211 grub2-mkconfig -o /boot/grub2/grub.cfg
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus211 reboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# rcons abacus211
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;   Do I need to mention this method (order)?:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.mail-archive.com/xcat-user@lists.sourceforge.net/msg05288.html&quot;&gt;Re: [xcat-user] Problem with rsetboot: unable to identify plugin&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;You should do the OS deployment by following three steps:
1. nodeset &amp;lt;node&amp;gt; osimage=&amp;lt;image name&amp;gt;
2. rbootseq &amp;lt;node&amp;gt; net,hd
3. rpower &amp;lt;node&amp;gt; boot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Probably add something about &lt;strong&gt;Gaussian&lt;/strong&gt; (and &lt;strong&gt;GaussView&lt;/strong&gt;).&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Should I go into IPMI via ASU (NOT tested yet)?:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://serverfault.com/questions/60358/communicating-via-command-mode-with-ibm-hs22-imm-via-amm&quot;&gt;Communicating via Command Mode with IBM HS22 IMM via AMM&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;SUMMARY&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Should I sanitize this section, e.g.: MAC addresses?&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Optional:&lt;/em&gt;  Pre-Review:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# tabdump site
# lsdef -t site -l
# lsdef -t group -l
# lsdef -t osimage -l
# lsdef -t node -l
# rpower all stat
# nodestat all
# nodels all groups

# rinv all all
# rvitals all all

# monls -a
# lsvm all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodels
[...]               &amp;lt;-- The rest of the nodes are MM nodes (not CNs)
abacus102
abacus103
abacus105
xbcmm1n
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nodestat all
[...]               &amp;lt;-- The rest of the nodes are MM nodes (not CNs)
abacus102: noping
abacus103: pbs,sshd
abacus105: noping
xbcmm1n: sshd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  Add &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ping&lt;/code&gt; when it works.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ping -c2 192.168.80.6
PING 192.168.80.6 (192.168.80.6) 56(84) bytes of data.
From 192.168.80.220 icmp_seq=1 Destination Host Unreachable
From 192.168.80.220 icmp_seq=2 Destination Host Unreachable

--- 192.168.80.6 ping statistics ---
2 packets transmitted, 0 received, +2 errors, 100% packet loss, time 999ms
pipe 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;  TEST JOBS   - Clean and Complete&lt;/p&gt;

&lt;p&gt;Run two test jobs, one from the CLI and the other one from WebMO.&lt;/p&gt;

&lt;p&gt;TEST JOB 1&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# cat /home/webmo/qsub_test_abacus104
#
#
#PBS -l nodes=1:abacus104
#
sleep 120
hostname
date
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /global/software/torque/x86_64/bin/qsub /home/webmo/qsub_test_abacus104
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[NOTE]&lt;/strong&gt;  &lt;br /&gt;
If you receive a “Not enough nodes available”, as shown here:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /home/webmo/bin/qsort
JobID  Jobname              User  Status  Ncpus  C_Time  CPU%  hosts
==============================================================================
[...]
290585 WebMO_285222         webmo    R      1                  abacus-203
290591 qsub_test_abacus104  root     Q                         Not enough
                                                               nodes available
==============================================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;check the node’s state by using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbsnodes(8B)&lt;/code&gt; command:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /global/software/torque/x86_64/bin/pbsnodes -l all abacus104
abacus104            offline
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the node is in OFFLINE state, the fix is to clear OFFLINE from the node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /global/software/torque/x86_64/bin/pbsnodes -c abacus104
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the node is in DOWN state, try fixing it by restarting &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbs_mom&lt;/code&gt; service on the node:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus104 systemctl restart pbs_mom.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  If you are still not getting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;free&lt;/code&gt; status for the compute 
           node, most likely you need to retart the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbs_server&lt;/code&gt; service 
	   on the head node; that is, on the head node:
           &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;systemctl restart pbs_server.service&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt;   If no state is specified with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-l&lt;/code&gt; option in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pbsnodes&lt;/code&gt;
            command, it only lists nodes in the DOWN, OFFLINE, or UNKNOWN
	    states.  Specifying a state string acts as an output
            filter.   Valid  state  strings  are  “active”,   “all”,
            “busy”, “down”, “free”, “offline”, “unknown”, and “up”.&lt;/p&gt;

&lt;p&gt;Most likely you’ll need to delete the job&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# qdel 290591 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and re-submit it:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /global/software/torque/x86_64/bin/qsub /home/webmo/qsub_test_abacus104
290592.mgmt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;:  Add the useful (currently, as of Jul 4, 2022, to be run from
             &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus.mydomain.com&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /opt/torque/sbin/momctl -f /etc/hosts -d 3

# /opt/torque/sbin/momctl -h abacus104 -d 3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Back on the MN (management node), &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xcatmn.mydomain.com&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus104 find /opt/torque/ -name &apos;*290592*&apos;
abacus104: /opt/torque/var/spool/aux/290592.mgmt
abacus104: /opt/torque/var/spool/mom_priv/jobs/290592.mgmt.SC
abacus104: /opt/torque/var/spool/mom_priv/jobs/290592.mgmt.TK
abacus104: /opt/torque/var/spool/mom_priv/jobs/290592.mgmt.JB
abacus104: /opt/torque/var/spool/spool/290592.mgmt.OU
abacus104: /opt/torque/var/spool/spool/290592.mgmt.ER
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus104 cat /opt/torque/var/spool/aux/290592.mgmt
abacus104: abacus104
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xdsh abacus104 cat /opt/torque/var/spool/mom_priv/jobs/290592.mgmt.SC
abacus104: #
abacus104: #
abacus104: #PBS -l nodes=1:abacus104
abacus104: #
abacus104: sleep 120
abacus104: hostname
abacus104: date
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Go back to the PBS server machine, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus.mydomain.com&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /home/webmo/bin/qsort
JobID  Jobname              User  Status  Ncpus  C_Time  CPU%  hosts
=========================================================================
[...]
290585 WebMO_285222         webmo    R      1                  abacus-203
290592 qsub_test_abacus104  root     R      1    00:00    0%   abacus-104
=========================================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After 120 seconds:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /home/webmo/bin/qsort
JobID  Jobname              User  Status  Ncpus  C_Time  CPU%  hosts
=========================================================================
[...]
290585 WebMO_285222         webmo    R      1                  abacus-203
=========================================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;TEST JOB 2&lt;/p&gt;

&lt;p&gt;Log into WebMO (via Canvas: All Courses &amp;gt; CHEM WEBMO &amp;gt; Student View &amp;gt; Abacus).&lt;/p&gt;

&lt;p&gt;In WebMO Job Manager: New Job &amp;gt; Create New Job&lt;/p&gt;

&lt;p&gt;Create a simple job; for example, with seven connected C atoms.&lt;/p&gt;

&lt;p&gt;Specify a job execution node &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus104&lt;/code&gt;: select Advanced tab:&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Nodes : PPN : Node Type&lt;/code&gt;   &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1: 1: abacus104&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Submit the job.&lt;/p&gt;

&lt;p&gt;Go back to the PBS server machine, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;abacus.mydomain.com&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /home/webmo/bin/qsort
JobID  Jobname              User  Status  Ncpus  C_Time  CPU%  hosts
=========================================================================
[...]
290585 WebMO_285222         webmo    R      1                  abacus-203
290593 WebMO_285228         webmo    R      1    00:00    0%   abacus-104
=========================================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On this cluster, this job completes in 5.3 seconds.&lt;/p&gt;

&lt;p&gt;After six seconds:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# /home/webmo/bin/qsort
JobID  Jobname              User  Status  Ncpus  C_Time  CPU%  hosts
=========================================================================
[...]
290585 WebMO_285222         webmo    R      1                  abacus-203
=========================================================================
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;[TODO]&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# man xcatprobe 
No manual entry for xcatprobe

# find /opt/xcat/ -iname &apos;*xcatprobe*&apos;
/opt/xcat/bin/xcatprobe
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xcatprobe -h
Usage:
xcatprobe -h
xcatprobe -l
xcatprobe [-V] &amp;lt;subcommand&amp;gt;  &amp;lt;attrbute_to_subcommand&amp;gt;

Options:
    -h : get usage information of xcatprobe
    -l : list all valid sub commands
    -V : print verbose information of xcatprobe
    -w : show each line completely. By default long lines are truncated.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xcatprobe -l
Supported sub commands are:
detect_dhcpd     detect_dhcpd can be used to detect the dhcp server in a network
                 for a specific mac address. Before using this command, install
                 &apos;tcpdump&apos; command. The operating system supported are RedHat,
                 SLES and Ubuntu.
osdeploy         Probe operating system provision process. Supports two modes -
                 &apos;Realtime monitor&apos; and &apos;Replay history&apos;.
nodecheck        Use this command to check node defintions in xCAT DB.
xcatmn           After xcat installation, use this command to check if xcat has
                 been installed correctly and is ready for use. Before using
                 this command, install &apos;tftp&apos;, &apos;nslookup&apos; and &apos;wget&apos; commands.
                 Supported platforms are RedHat, SLES and Ubuntu.
osimagecheck     Use this command to check osimage defintions in xCAT DB.
discovery        Probe for discovery process, including pre-check for required
                 configuration and realtime monitor of discovery process.
image            Use this command to check if specified diskless nodes have the
                 same images installed or if nodes are installed with the same
                 image as defined on the management node.
clusterstatus    Use this command to get node summary in the cluster.
switch_macmap    To retrieve MAC address mapping for the specified switch, or
                 all the switches defined in &apos;switches&apos; table in xCAT db.
                 Currently, this command does not support hierarchy.
code_template    This isn&apos;t a probe tool, this is just a template for sub
                 command coding. Use it to develop sub command which need to
                 cover hierarchical cluster
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# command -v tcpdump; type -a tcpdump; whereis tcpdump; which tcpdump
/usr/sbin/tcpdump
tcpdump is /usr/sbin/tcpdump
tcpdump: /usr/sbin/tcpdump /usr/share/man/man8/tcpdump.8.gz
/usr/sbin/tcpdump
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# command -v tftp; type -a tftp; whereis tftp; which tftp 
/usr/bin/tftp
tftp is /usr/bin/tftp
tftp: /usr/bin/tftp /usr/share/man/man1/tftp.1.gz
/usr/bin/tftp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# command -v nslookup; type -a nslookup; whereis nslookup; which nslookup
/usr/bin/nslookup
nslookup is /usr/bin/nslookup
nslookup: /usr/bin/nslookup /usr/share/man/man1/nslookup.1.gz
/usr/bin/nslookup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# command -v wget; type -a wget; whereis wget; which wget 
/usr/bin/wget
wget is /usr/bin/wget
wget: /usr/bin/wget /usr/share/man/man1/wget.1.gz
/usr/bin/wget
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# xcatprobe detect_dhcpd -h
[...]

# xcatprobe osdeploy -h
[...]

# xcatprobe nodecheck -h
[...]

# xcatprobe xcatmn -h
[...]

# xcatprobe osimagecheck -h
[...]

# xcatprobe discovery -h
[...]

# xcatprobe image -h
[...]

# xcatprobe clusterstatus -h
[...]

# xcatprobe switch_macmap -h
[...]

# xcatprobe code_template -h
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;strong&gt;REFERENCES:&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;(All references retrieved on Mar 20, 2022.)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://xcat-docs.readthedocs.io/en/latest/guides/admin-guides/manage_clusters/x86_64/index.html&quot;&gt;xCAT Documentation: Docs &amp;gt; Admin Guide &amp;gt; Manage Clusters &amp;gt; x86_64&lt;/a&gt;:  &lt;br /&gt;
“This section is not available at this time.&lt;br /&gt;
Refer to xCAT Documentation on SourceForge for information on System X servers”: &lt;br /&gt;
&lt;a href=&quot;https://sourceforge.net/p/xcat/wiki/XCAT_Documentation/&quot;&gt;https://sourceforge.net/p/xcat/wiki/XCAT_Documentation/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sourceforge.net/p/xcat/wiki/IBM_Blade_Center_HowTo/&quot;&gt;IBM BladeCenter HOWTO - xCAT Wiki on Sourceforg&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://download.lenovo.com/servers/mig/systems/support/system_x_pdf/installation_and_service_guide_15b_00wa645.pdf&quot;&gt;Intelligent Clusters - Installation and Service Guide&lt;/a&gt;  &amp;lt;– Has information about hardware
configuration, cabling and similar.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/xcat2/xcat-core/issues/5797&quot;&gt;Connection failure: SSL connect attempt failed with unknown error error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake failure at /opt/xcat/lib/perl/xCAT/Client.pm line 281. #5797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sourceforge.net/p/xcat/wiki/IBM_Blade_Center_HowTo/&quot;&gt;IBM Blade Center HOWTO (incomplete)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sourceforge.net/p/xcat/wiki/XCAT_Cluster_with_IBM_BladeCenter/&quot;&gt;XCAT Cluster with IBM BladeCenter&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sourceforge.net/p/xcat/wiki/XCAT_BladeCenter_Linux_Cluster/&quot;&gt;XCAT BladeCenter Linux Cluster&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://xcat.org/files/xcat/repos/yum/xcat-dep/&quot;&gt;XCAT Dependency Packages (xcat-dep) - RPM Packages List (RHEL and SLES)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sourceforge.net/p/xcat/wiki/Intro_to_xCAT_Tables/#xcat-tables-descriptions&quot;&gt;A Brief Introduction to some commonly used xCAT tables - xCAT Tables Descriptions&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://xcat-docs.readthedocs.io/en/latest/guides/admin-guides/references/man5/xcatdb.5.html&quot;&gt;A Complete List of xCAT Tables and Their Descriptions (An overview of the xCAT database)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sense.net/~egan/xcat/doc/xcat-mini-HOWTO.html&quot;&gt;xCAT Mini HOWTO (WIP)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sense.net/~egan/xcat/doc/xcat-HOWTO.html&quot;&gt;xCAT HOWTO for Red Hat Linux&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sense.net/~egan/xcat/doc/susemgtnode-HOWTO.html&quot;&gt;xCAT susemgtnode-HOWTO for SuSE Linux&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sense.net/~egan/xcat/doc/stage1-HOWTO.html&quot;&gt;xCAT Stage1 HOWTO (WIP)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://sense.net/~egan/xcat/doc/nodeinstall-HOWTO.html&quot;&gt;xCAT Node Installation HOWTO (WIP)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sourceforge.net/p/xcat/wiki/The_location_of_synclist_file_for_updatenode_and_install_process/&quot;&gt;The location of synclist file for updatenode and install process - xCAT Wiki on SourceForge&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.redbooks.ibm.com/redbooks/pdfs/sg247034.pdf&quot;&gt;IBM E server BladeCenter, Linux, and Open Source (IBM Redbooks)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.ibm.com/support/pages/node/821662&quot;&gt;Installation and User’s Guide - IBM BladeCenter HS21&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://toolscenter.lenovofiles.com/help/index.jsp?topic=%2Ftoolsctr%2Fasu_main.html&quot;&gt;Advanced Settings Utility - Lenovo ToolCenter&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.hs21.doc/hs21_install_ug.pdf&quot;&gt;IBM BladeCenter HS21 - Installation and User’s Guide&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/index.jsp?topic=%2Fcom.lenovo.bladecenter.hs21.doc%2Fbls_hs21_product_page.html&amp;amp;cp=0_6_2&quot;&gt;IBM BladeCenter HS21 Documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.hs21.doc/hs21_pdguide.pdf&quot;&gt;Troubleshooting the HS21 Blade Server - BladeCenter HS21 Problem Determination and Service Guide&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.mgtmod.doc/mgt_mod_product_page.html?cp=0_5_2&quot;&gt;IBM Management Module Documentation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.mgtmod.doc/d3sdems4.pdf&quot;&gt;IBM BladeCenter Management Module Installation Guide&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.mgtmod.doc/44R5370.pdf&quot;&gt;IBM BladeCenter Management Module User’s Guide&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.mgtmod.doc/44R5372.pdf&quot;&gt;IBM BladeCenter Management Module Command-Line Interface Reference Guide&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bladecenter.lenovofiles.com/help/topic/com.lenovo.bladecenter.advmgtmod.doc/kp1bd_pdf.pdf&quot;&gt;BladeCenter SOL (Serial over LAN) Setup Guide - IBM Corporation, Twelfth Edition (November 2009)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/openpbs/openpbs&quot;&gt;OpenPBS Open Source - Source Code on GitHub&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://openpbs.org/&quot;&gt;OpenPBS Open Source Project&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/TORQUE&quot;&gt;TORQUE (a.k.a. TORQUE Resource Manager)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Job_scheduler&quot;&gt;Job scheduler - Batch queuing for HPC clusters (Job scheduler)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Job_queue&quot;&gt;Job queue&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.ibm.com/docs/en/i/7.1?topic=concepts-job-queues&quot;&gt;Job queues (www.ibm.com - IBM Docs)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.redhat.com/en/blog/converting-traditional-sysv-init-scripts-red-hat-enterprise-linux-7-systemd-unit-files&quot;&gt;Converting traditional sysV init scripts to Red Hat Enterprise Linux 7 systemd unit files - RedHat Blog&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wiki.archlinux.org/title/SysVinit&quot;&gt;SysVinit - archlinux Wiki&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.webmo.net/&quot;&gt;WebMO&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://access.redhat.com/solutions/1543343&quot;&gt;PolicyKit failing to start with error: polkit.service: main process exited, code=exited, status=1/FAILURE&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://superuser.com/questions/640338/how-to-reset-a-broken-tty&quot;&gt;How to reset a broken TTY? - Super User&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Computer_cluster&quot;&gt;Computer cluster&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

</description>
        <pubDate>Sun, 20 Mar 2022 09:27:34 -0700</pubDate>
        <link>http://localhost:4000/hpc/server/hardware/sysadmin/automation/configmanagement/howto/2022/03/20/xcat.html</link>
        <guid isPermaLink="true">http://localhost:4000/hpc/server/hardware/sysadmin/automation/configmanagement/howto/2022/03/20/xcat.html</guid>
        
        
        <category>hpc</category>
        
        <category>server</category>
        
        <category>hardware</category>
        
        <category>sysadmin</category>
        
        <category>automation</category>
        
        <category>configmanagement</category>
        
        <category>howto</category>
        
      </item>
    
      <item>
        <title>How to Setup an External GELI Encrypted USB Hard Drive as a ZFS Backup Disk in FreeBSD</title>
        <description>&lt;ul&gt;
  &lt;li&gt;OS:  FreeBSD 13.0&lt;/li&gt;
  &lt;li&gt;Shell:  csh&lt;/li&gt;
  &lt;li&gt;External hard disk drive: WD (WesternDigital) Easystore 14TB USB 3.0 Desktop External Hard Drive, Model:  &lt;a href=&quot;https://www.bestbuy.ca/en-ca/product/wd-easystore-14tb-usb-3-0-desktop-external-hard-drive-wdbama0140hbk-nese-black-only-at-best-buy/14936770&quot;&gt;WDBAMA0140HBK-NESE&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;Possibly, a variation of a model &lt;a href=&quot;https://www.westerndigital.com/products/portable-drives/wd-easystore-desktop-usb-3-0-hdd#WDBAMA0140HBK-NESN&quot;&gt;WDBAMA0140HBK-NESN&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;preparation&quot;&gt;Preparation&lt;/h2&gt;

&lt;p&gt;Install packages &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zxfer&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfstools&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo pkg install zxfer zfstools
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The zfstools package has the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs-auto-snapshot&lt;/code&gt; tool that creates and 
manages ZFS snapshots.&lt;/p&gt;

&lt;p&gt;The zxfer package is a shell script that uses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs-send(8)&lt;/code&gt; for sending 
snapshots and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs-receive(8)&lt;/code&gt; for receiving them in the external USB hard 
disk drive.&lt;/p&gt;

&lt;h2 id=&quot;enabling-automatic-zfs-filesystem-snapshotting&quot;&gt;Enabling Automatic ZFS Filesystem Snapshotting&lt;/h2&gt;

&lt;p&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs list&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zpool list&lt;/code&gt; to check the ZFS filesystems in your pool.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list
NAME                 USED  AVAIL     REFER  MOUNTPOINT
zroot                189G   710G       88K  /zroot
zroot/ROOT          58.5G   710G       88K  none
zroot/ROOT/default  58.5G   710G     52.6G  /
zroot/tmp           24.4G   710G     24.4G  /tmp
zroot/usr            101G   710G       88K  /usr
zroot/usr/home       101G   710G      101G  /usr/home
zroot/usr/ports       88K   710G       88K  /usr/ports
zroot/usr/src         88K   710G       88K  /usr/src
zroot/var           2.81M   710G       88K  /var
zroot/var/audit       88K   710G       88K  /var/audit
zroot/var/crash       88K   710G       88K  /var/crash
zroot/var/log       1.47M   710G     1.47M  /var/log
zroot/var/mail       144K   710G      144K  /var/mail
zroot/var/tmp        964K   710G      964K  /var/tmp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list
NAME   SIZE  ALLOC  FREE CKPOINT EXPANDSZ  FRAG  CAP DEDUP  HEALTH  ALTROOT
zroot  928G   189G  739G       -        -    6%  20% 1.00x  ONLINE  -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The default ZFS layout with a fresh FreeBSD 13 sets up the 
following filesystems in the pool (not counting zroot, zroot/ROOT, 
zroot/usr, and zroot/var, which are containers for children filesystems, 
not used directly for data storage):&lt;/p&gt;

&lt;p&gt;zroot/ROOT/default &lt;br /&gt;
zroot/tmp &lt;br /&gt;
zroot/usr/home &lt;br /&gt;
zroot/usr/ports &lt;br /&gt;
zroot/usr/src &lt;br /&gt;
zroot/var/audit &lt;br /&gt;
zroot/var/crash &lt;br /&gt;
zroot/var/log &lt;br /&gt;
zroot/var/mail &lt;br /&gt;
zroot/var/tmp&lt;/p&gt;

&lt;p&gt;Filesystems and their content: &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;zroot/ROOT/default: Configurations and root’s home directory.&lt;/li&gt;
  &lt;li&gt;zroot/usr/home: User home directory.&lt;/li&gt;
  &lt;li&gt;zroot/var/log: System log files.&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;zroot/var/mail: Mail spools for your user account and root.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;zroot/tmp: Temporary files, which are usually not preserved across 
           a system reboot.&lt;/li&gt;
  &lt;li&gt;zroot/usr/ports: FreeBSD Ports Collection.&lt;/li&gt;
  &lt;li&gt;zroot/usr/src:   FreeBSD source code for both the kernel and the userland.&lt;/li&gt;
  &lt;li&gt;zroot/var/audit: Audit logging not enabled by default.&lt;/li&gt;
  &lt;li&gt;zroot/var/crash: Kernel core dumps.&lt;/li&gt;
  &lt;li&gt;zroot/var/tmp: Temporary files, which are usually preserved across 
               a system reboot, unless /var is a memory-based file system.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Based on that, I chose to snapshot:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;zroot/ROOT/default&lt;/li&gt;
  &lt;li&gt;zroot/usr/home&lt;/li&gt;
  &lt;li&gt;zroot/var/log&lt;/li&gt;
  &lt;li&gt;zroot/var/mail&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Zfstools looks at the ZFS user property &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.sun:auto-snapshot&lt;/code&gt; to 
determine whether to snapshot a filesystem or not.  On a new 
system, this property is unset, neither true nor false, neither 
local nor inherited.&lt;/p&gt;

&lt;p&gt;From the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/local/share/doc/zfstools/README.md&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#### Dataset setup

Only datasets with the `com.sun:auto-snapshot` property set to `true` will 
be snapshotted.

    zfs set com.sun:auto-snapshot=true DATASET
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs get com.sun:autosnapshot&lt;/code&gt; to see its status for all ZFS 
filesystems.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs get -r com.sun:auto-snapshot zroot
NAME                     PROPERTY               VALUE   SOURCE
zroot                    com.sun:auto-snapshot  -       -
zroot/ROOT               com.sun:auto-snapshot  -       -
zroot/ROOT/default       com.sun:auto-snapshot  -       -
zroot/tmp                com.sun:auto-snapshot  -       -
zroot/usr                com.sun:auto-snapshot  -       -
zroot/usr/home           com.sun:auto-snapshot  -       -
zroot/usr/ports          com.sun:auto-snapshot  -       -
zroot/usr/src            com.sun:auto-snapshot  -       -
zroot/var                com.sun:auto-snapshot  -       -
zroot/var/audit          com.sun:auto-snapshot  -       -
zroot/var/crash          com.sun:auto-snapshot  -       -
zroot/var/log            com.sun:auto-snapshot  -       -
zroot/var/mail           com.sun:auto-snapshot  -       -
zroot/var/tmp            com.sun:auto-snapshot  -       -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Set the ZFS property &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.sun:auto-snapshot&lt;/code&gt; to false on ZFS filesystems 
that you don’t want &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfstools&lt;/code&gt; to snapshot.  In this example, 
the command is:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zfs set \
com.sun:auto-snapshot=false \
zroot/tmp \
zroot/usr/ports \
zroot/usr/src \
zroot/var/audit \
zroot/var/crash \
zroot/var/tmp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs-set(8)&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs-inherit(8)&lt;/code&gt;, and the “User Properties” section 
of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfsprops(8)&lt;/code&gt; for details.&lt;/p&gt;

&lt;p&gt;Next, turn on snapshotting for the rest of the pool:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zfs set com.sun:auto-snapshot=true zroot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.sun:autosnapshot&lt;/code&gt; property for all ZFS filesystems looks like this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs get -r com.sun:auto-snapshot zroot
NAME                     PROPERTY               VALUE   SOURCE
zroot                    com.sun:auto-snapshot  true    local
zroot/ROOT               com.sun:auto-snapshot  true    inherited from zroot
zroot/ROOT/default       com.sun:auto-snapshot  true    inherited from zroot
zroot/tmp                com.sun:auto-snapshot  false   local
zroot/usr                com.sun:auto-snapshot  true    inherited from zroot
zroot/usr/home           com.sun:auto-snapshot  true    inherited from zroot
zroot/usr/ports          com.sun:auto-snapshot  false   local
zroot/usr/src            com.sun:auto-snapshot  false   local
zroot/var                com.sun:auto-snapshot  true    inherited from zroot
zroot/var/audit          com.sun:auto-snapshot  false   local
zroot/var/crash          com.sun:auto-snapshot  false   local
zroot/var/log            com.sun:auto-snapshot  true    inherited from zroot
zroot/var/mail           com.sun:auto-snapshot  true    inherited from zroot
zroot/var/tmp            com.sun:auto-snapshot  false   local
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfstools&lt;/code&gt; relies on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs-auto-snapshot&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs-cleanup-snapshots&lt;/code&gt;, 
which are located in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/local/sbin/&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ command -v zfs-auto-snapshot; type zfs-auto-snapshot; \
whereis zfs-auto-snapshot; which zfs-auto-snapshot
/usr/local/sbin/zfs-auto-snapshot
zfs-auto-snapshot is /usr/local/sbin/zfs-auto-snapshot
zfs-auto-snapshot: /usr/local/sbin/zfs-auto-snapshot
/usr/local/sbin/zfs-auto-snapshot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ command -v zfs-cleanup-snapshots; type zfs-cleanup-snapshots \
? whereis zfs-cleanup-snapshots; which zfs-cleanup-snapshots
/usr/local/sbin/zfs-cleanup-snapshots
zfs-cleanup-snapshots is /usr/local/sbin/zfs-cleanup-snapshots
whereis is /usr/bin/whereis
zfs-cleanup-snapshots is a tracked alias for /usr/local/sbin/zfs-cleanup-snapshots
/usr/local/sbin/zfs-cleanup-snapshots
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To get a brief usage message for these two tools:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/local/sbin/zfs-auto-snapshot usage
Usage: /usr/local/sbin/zfs-auto-snapshot [-dknpuv] &amp;lt;INTERVAL&amp;gt; &amp;lt;KEEP&amp;gt;
    -d              Show debug output.
    -k              Keep zero-sized snapshots.
    -n              Do a dry-run. Nothing is committed. Only show what would be done.
    -p              Create snapshots in parallel.
    -P pool         Act only on the specified pool.
    -u              Use UTC for snapshots.
    -v              Show what is being done.
    INTERVAL        The interval to snapshot.
    KEEP            How many snapshots to keep.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ /usr/local/sbin/zfs-cleanup-snapshots usage
Usage: /usr/local/sbin/zfs-cleanup-snapshots [-dnv]
    -d              Show debug output.
    -n              Do a dry-run. Nothing is committed. Only show what would be done.
    -p              Create snapshots in parallel.
    -P pool         Act only on the specified pool.
    -v              Show what is being done.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The pkg-message for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfstools&lt;/code&gt; gives an example for enabling automatic 
snapshots by placing a set of cron commands into &lt;strong&gt;/etc/crontab&lt;/strong&gt;, which 
is the system crontab.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ pkg info --pkg-message --regex zfstools
zfstools-0.3.6_2:
On install:
To enable automatic snapshots, place lines such as these into /etc/crontab:

    PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin
    15,30,45 * * * * root /usr/local/sbin/zfs-auto-snapshot frequent  4
    0        * * * * root /usr/local/sbin/zfs-auto-snapshot hourly   24
    7        0 * * * root /usr/local/sbin/zfs-auto-snapshot daily     7
    14       0 * * 7 root /usr/local/sbin/zfs-auto-snapshot weekly    4
    28       0 1 * * root /usr/local/sbin/zfs-auto-snapshot monthly  12

This will keep 4 15-minutely snapshots, 24 hourly snapshots, 7 daily snapshots,
4 weekly snapshots and 12 monthly snapshots. Any resulting zero-sized snapshots
will be automatically cleaned up.

Enable snapshotting on a dataset or top-level pool with:

    zfs set com.sun:auto-snapshot=true DATASET

Children datasets can be disabled for snapshot with:

    zfs set com.sun:auto-snapshot=false DATASET

Or for specific intervals:

    zfs set com.sun:auto-snapshot:frequent=false DATASET

See website and command usage output for further details.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The FreeBSD Handbook, Section &lt;a href=&quot;https://docs.freebsd.org/en/books/handbook/config/#configtuning-cron&quot;&gt;12.3. Configuring cron(8)&lt;/a&gt; (retrieved on Mar 19, 2022) advises against modifying the system crontab.  Instead, it recommends using user crontabs.&lt;/p&gt;

&lt;p&gt;Order of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;crontab&lt;/code&gt; fields (also see &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;man 5 crontab&lt;/code&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ grep command /etc/crontab
#minute hour    mday    month   wday    who     command
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;
From the FreeBSD Handbook:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;The format of the system crontab, &lt;strong&gt;/etc/crontab&lt;/strong&gt; includes a &lt;strong&gt;who&lt;/strong&gt; column 
which does not exist in user crontabs.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Create a user crontab for the root user.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo crontab -e -u root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check the root user crontab schedule:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo crontab -l
SHELL=/bin/sh
PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

#minute  hour mday month wday command
15,30,45 *    *    *     *    /usr/local/sbin/zfs-auto-snapshot frequent  4
0        *    *    *     *    /usr/local/sbin/zfs-auto-snapshot hourly   24
7        0    *    *     *    /usr/local/sbin/zfs-auto-snapshot daily     7
14       0    *    *     7    /usr/local/sbin/zfs-auto-snapshot weekly    4
28       0    1    *     *    /usr/local/sbin/zfs-auto-snapshot monthly  12
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;preparing-the-backup-drive&quot;&gt;Preparing the Backup Drive&lt;/h2&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ freebsd-version
13.0-RELEASE-p7
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Connect one end of the USB cable to your system and the other end to 
the hard drive.&lt;/p&gt;

&lt;p&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dmseg&lt;/code&gt; to find the external drive’s device node name (in this 
example, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;da0&lt;/code&gt;) and use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpart destroy&lt;/code&gt; to remove any old partition 
table that might be on the drive.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dmesg | tail -25
[...]
ugen0.4: &amp;lt;Western Digital easystore 264D&amp;gt; at usbus0
umass0 on uhub0
umass0: &amp;lt;Western Digital easystore 264D, class 0/0, rev 3.10/30.12, addr 58&amp;gt; on usbus0
umass0:  SCSI over Bulk-Only; quirks = 0xc001
umass0:7:0: Attached to scbus7
da0 at umass-sim0 bus 0 scbus7 target 0 lun 0
da0: &amp;lt;WD easystore 264D 3012&amp;gt; Fixed Direct Access SPC-4 SCSI device
da0: Serial Number 123D45678901234B
da0: 400.000MB/s transfers
da0: 13351936MB (27344764928 512 byte sectors)
da0: quirks=0x2&amp;lt;NO_6_BYTE&amp;gt;
ses1 at umass-sim0 bus 0 scbus7 target 0 lun 1
ses1: &amp;lt;WD SES Device 3012&amp;gt; Fixed Enclosure Services SPC-4 SCSI device
ses1: Serial Number 123D45678901234B
ses1: 400.000MB/s transfers
ses1: SES Device
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dmesg | grep -i easy | grep -i store
ugen0.4: &amp;lt;Western Digital easystore 264D&amp;gt; at usbus0
umass0: &amp;lt;Western Digital easystore 264D, class 0/0, rev 3.10/30.12, addr 3&amp;gt; on usbus0
da0: &amp;lt;WD easystore 264D 3012&amp;gt; Fixed Direct Access SPC-4 SCSI device
ugen0.4: &amp;lt;Western Digital easystore 264D&amp;gt; at usbus0
umass0: &amp;lt;Western Digital easystore 264D, class 0/0, rev 3.10/30.12, addr 3&amp;gt; on usbus0
da0: &amp;lt;WD easystore 264D 3012&amp;gt; Fixed Direct Access SPC-4 SCSI device
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo usbconfig show_ifdrv | grep umass0
ugen0.4.0: umass0: &amp;lt;Western Digital easystore 264D, class 0/0, rev 3.10/30.12, addr 58&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo usbconfig dump_info | grep ugen0.4
ugen0.4: &amp;lt;Western Digital easystore 264D&amp;gt; at usbus0, cfg=0 md=HOST spd=SUPER (5 Gbps) pwr=ON (2mA)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo usbconfig list | grep ugen0.4
ugen0.4: &amp;lt;Western Digital easystore 264D&amp;gt; at usbus0, cfg=0 md=HOST spd=SUPER (5 Gbps) pwr=ON (2mA)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo camcontrol devlist
---- snip ----
&amp;lt;WD easystore 264D 3012&amp;gt;           at scbus7 target 0 lun 0 (da0,pass3)
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geom disk list
---- snip ----
Geom name: da0
Providers:
1. Name: da0
   Mediasize: 14000519643136 (13T)
   Sectorsize: 512
   Stripesize: 4096
   Stripeoffset: 0
   Mode: r0w0e0
   descr: WD easystore 264D
   lunname: WD      easystore 264D  9MH60Y1K
   lunid: 5000cca290d0d53f
   ident: 394D48363059314B
   rotationrate: 7200
   fwsectors: 63
   fwheads: 255
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart list | grep -w da0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart list da0
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart show | grep -w da0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart show da0
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ glabel list | grep da0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a brand new disk so &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpart list &amp;lt;geom_name&amp;gt;&lt;/code&gt; complains:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ glabel list da0
glabel: Class &apos;LABEL&apos; does not have an instance named &apos;da0&apos;.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similarly, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpart destroy&lt;/code&gt; complains too:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo gpart destroy -F da0
gpart: arg0 &apos;da0&apos;: Invalid argument
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt;  If the disk was previously configured and in use
(that is, it had a partitioning scheme on it),
the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpart destroy -F &amp;lt;geom_name&amp;gt;&lt;/code&gt; command 
would destroy the geom and report &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;geom_name&amp;gt; destroyed&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; &lt;br /&gt;
Q: Why the use of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpart destroy -F &amp;lt;geom_name&amp;gt;&lt;/code&gt; command? &lt;br /&gt;
A: From the manpage for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpart(8)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Rather than deleting each partition and then destroying the partitioning
scheme, the -F option can be given with destroy to delete all of the
partitions before destroying the partitioning scheme.  This is equivalent
to the previous example:
  
      /sbin/gpart destroy -F da0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpart destroy&lt;/code&gt; (or with a brand new hard disk drive):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart show da0
gpart: No such geom: da0.
 
$ gpart list da0
gpart: Class &apos;PART&apos; does not have an instance named &apos;da0&apos;.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First, create a GPT partition table (partition table with &lt;strong&gt;gpt&lt;/strong&gt; partitioning 
scheme) on disk &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;da0&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo gpart create -s gpt da0
da0 created
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart show da0
=&amp;gt;         40  27344764848  da0  GPT  (13T)
           40  27344764848       - free -  (13T)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart list da0 | wc -l
      17
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart list da0
Geom name: da0
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Having created a partitioning scheme on the disk, you now can create 
a new ZFS partition (on disk &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;da0&lt;/code&gt;, on 1MB boundaries).  In this example, 
I decided to use a label named &lt;strong&gt;external&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo gpart add -a 1m -l external -t freebsd-zfs da0
da0p1 added
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Explanation:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;The FreeBSD Handbook, Section &lt;a href=&quot;https://docs.freebsd.org/en/books/handbook/disks/#disks-adding&quot;&gt;18.2. Adding Disks&lt;/a&gt; (retrieved on Mar 19, 2022) recommends alignment on 1MB boundaries:&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;To improve performance on newer disks with larger hardware block sizes, 
the partition is aligned to one megabyte boundaries.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;From the manpage for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpart(8)&lt;/code&gt;, under section PARTITION TYPES:&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;freebsd-zfs:    A FreeBSD partition that contains a ZFS volume.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart show da0
=&amp;gt;         40  27344764848  da0  GPT  (13T)
           40         2008       - free -  (1.0M)
         2048  27344760832    1  freebsd-zfs  (13T)
  27344762880         2008       - free -  (1.0M)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart list da0 | wc -l
      34
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ gpart list da0
Geom name: da0
---- snip ----
scheme: GPT
Providers:
1. Name: da0p1
   Mediasize: 14000517545984 (13T)
   Sectorsize: 512
   Stripesize: 4096
---- snip ----
   label: external
---- snip -----
   type: freebsd-zfs
---- snip ----
Consumers:
1. Name: da0
   Mediasize: 14000519643136 (13T)
   Sectorsize: 512
   Stripesize: 4096
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -lh /dev/gpt/external
crw-r-----  1 root  operator  0x1dd Mar 19 15:53 /dev/gpt/external 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ date
Sat 19 Mar 2022 15:53:28 PDT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;geli(8)&lt;/code&gt; utility, you first need to load the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;GEOM_ELI&lt;/code&gt; module.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo geli load
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To load the GEOM_ELI module at boot time, add the following line to your &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;loader.conf(5)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ printf %s\\n &apos;geom_eli_load=&quot;YES&quot;&apos; | sudo tee -a /boot/loader.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create an encrypted provider (initialize a provider which is going to be 
encrypted with a passphrase) on the disk. &lt;br /&gt;
Use the AES-XTS encryption algorithm (the default and recommended by the 
manpage for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;geli(8)&lt;/code&gt; - here used explicitely for the sake of this example), 
key length of 256, and 4kB sector size.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo geli init -e AES-XTS -l 256 -s 4096 &quot;/dev/gpt/external&quot;
Enter new passphrase:
Reenter new passphrase:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Metadata backup for provider /dev/gpt/external can be found in 
  /var/backups/gpt_external.eli
and can be restored with the following command:

        # geli restore /var/backups/gpt_external.eli /dev/gpt/external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attach the provider (in this example, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dev/gpt/external&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo geli attach /dev/gpt/external
Enter passphrase:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
            Name  Status  Components
gpt/external.eli  ACTIVE  gpt/external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;List all available ZFS pools on the system before adding a new zpool:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list
NAME    SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
zroot   928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create a new zpool in the geli partition called &lt;strong&gt;external&lt;/strong&gt;. 
Name the new pool &lt;strong&gt;external&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool create external gpt/external.eli
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s possible to use the pool named &lt;strong&gt;external&lt;/strong&gt; as the destination for 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zxfer&lt;/code&gt; directly; however, in this example create a new dataset inside 
the pool, and name it after the source machine’s hostname.  This will 
help identify backup data and allow multiple hosts to back up to the 
same drive.  Since the source machine’s hostname in this example 
is &lt;strong&gt;fbsd1&lt;/strong&gt;, the backup destination for zxfer will be &lt;strong&gt;backup/fbsd1&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ hostname
fbsd1.mydomain.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Trim off any domain information from the printed name of the current host:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ hostname -s
fbsd1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The list of all available ZFS pools on the system now includes the new 
zpool (named &lt;strong&gt;external&lt;/strong&gt;):&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list
NAME       SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
external  12.7T   468K  12.7T        -         -     0%     0%  1.00x    ONLINE  -
zroot      928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list
NAME                 USED  AVAIL     REFER  MOUNTPOINT
external             372K  12.3T       96K  /external
zroot                176G   723G       88K  /zroot
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Create a ZFS dataset (file system) named &lt;strong&gt;external/fbsd1&lt;/strong&gt;. &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zfs create external/fbsd1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list
NAME                 USED  AVAIL     REFER  MOUNTPOINT
external             504K  12.3T       96K  /external
external/fbsd1        96K  12.3T       96K  /external/fbsd1
zroot                189G   710G       88K  /zroot
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import
no pools available to import
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zpool export&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;geli detach&lt;/code&gt; to simulate the drive removal from 
the system.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool export external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Confirm that the zpool named &lt;strong&gt;external&lt;/strong&gt; has been exported:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list
NAME    SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
zroot   928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import
   pool: external
     id: 1234567890123456789
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        external            ONLINE
          gpt/external.eli  ONLINE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% geli status
            Name  Status  Components
gpt/external.eli  ACTIVE  gpt/external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo geli detach /dev/gpt/external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Disconnect the external drive from the system.&lt;/p&gt;

&lt;h2 id=&quot;performing-the-first-backup&quot;&gt;Performing the First Backup&lt;/h2&gt;

&lt;p&gt;Connect one end of the USB cable to your system and the other end to 
the hard drive.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attach the provider (in this example, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/dev/gpt/external&lt;/code&gt;) with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;geli(8)&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo geli attach /dev/gpt/external
Enter passphrase: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
            Name  Status  Components
gpt/external.eli  ACTIVE  gpt/external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Import the zpool named &lt;strong&gt;external&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import
   pool: external
     id: 1234567890123456789
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        external            ONLINE
          gpt/external.eli  ONLINE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list
NAME       SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
external  12.7T   696K  12.7T        -         -     0%     0%  1.00x    ONLINE  -
zroot      928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list
NAME                 USED  AVAIL     REFER  MOUNTPOINT
external             588K  12.3T       96K  /external
external/fbsd1        96K  12.3T       96K  /external/fbsd1
zroot                189G   710G       88K  /zroot
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh /external/
total 10
drwxr-xr-x   3 root  wheel     3B Mar 19 15:59 .
drwxr-xr-x  21 root  wheel    28B Mar 19 16:06 ..
drwxr-xr-x   2 root  wheel     2B Mar 19 15:59 fbsd1

$ ls -alh /external/fbsd1/
total 1
drwxr-xr-x  2 root  wheel     2B Mar 19 15:59 .
drwxr-xr-x  3 root  wheel     3B Mar 19 15:59 ..
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the manpage for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zxfer(8)&lt;/code&gt;, the first example (&lt;strong&gt;Ex1 - Backup a pool
(including snapshots and properties)&lt;/strong&gt;) offers a use case for replicating
the entire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zroot&lt;/code&gt; pool from the host system to the backup drive.&lt;/p&gt;

&lt;p&gt;Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs list | awk&lt;/code&gt; to confirm that none of the dataset names 
contain spaces. &lt;sup&gt;&lt;a href=&quot;#footnotes&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list -H | \
cut -f1 | \
awk &apos;/[[:space:]]/{printf(&quot;Error! Dataset name contains spaces: %s\n&quot;,$0)}&apos;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Switch to the root user.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ su
Password:
# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The root user’s shell is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;csh&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# ps $$
  PID TT  STAT    TIME COMMAND
17578  4  S    0:00.01 _su (csh)
 
# printf %s\\n &quot;$SHELL&quot;
/bin/csh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, for defining shell variables, you need to use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;set&lt;/code&gt; built-in shell command.&lt;/p&gt;

&lt;p&gt;As per &lt;a href=&quot;https://thornton2.com/unix/freebsd/geli-encrypted-usb-backup.html&quot;&gt;GELI Encrypted USB Backup of ZFS Filesystems in FreeBSD 13&lt;/a&gt; (Retrieved on 
Mar 19, 2022), exclude the following ZFS properties 
(note: I’m not excluding &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.sun:auto-snapshot:015m&lt;/code&gt;).&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# set exclude=&quot;com.sun:auto-snapshot&quot;
# set exclude=&quot;${exclude},objsetid&quot;
# set exclude=&quot;${exclude},keylocation&quot;
# set exclude=&quot;${exclude},keyformat&quot;
# set exclude=&quot;${exclude},pbkdf2iters&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# printf %s\\n &quot;$exclude&quot;
com.sun:auto-snapshot,objsetid,keylocation,keyformat,pbkdf2iters
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;#enabling-automatic-zfs-filesystem-snapshotting&quot;&gt;At the beginning&lt;/a&gt;, 
you set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;com.sun:auto-snapshot&lt;/code&gt; property to true for any dataset that you 
want the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfstools&lt;/code&gt; to snapshot.  When running &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zxfer&lt;/code&gt; to copy snapshots 
to a locally-mounted backup pool, you need to use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-I&lt;/code&gt; option for 
properties that will be ignored in order to prevent that property from 
being copied to the backup data.  If this option is not specified, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zxfer&lt;/code&gt; 
will copy the property to the data in the backup pool and the system will 
begin taking snapshots of the backup data, which can prevent files from 
replicating properly.  This option may not be necessary for replication 
to a remote server or if the backup is only applied to specific datasets 
rather than the entire &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zroot&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Confirm that the file system &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;external/fbsd1&lt;/code&gt; is mounted:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# df -hT
Filesystem      Type       Size    Used   Avail Capacity  Mounted on
[...]
external        zfs        1.8T     96K    1.8T     0%    /external
external/fbsd1  zfs        1.8T     96K    1.8T     0%    /external/fbsd1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Backup the pool &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zroot&lt;/code&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;external/fbsd1&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# zxfer -dFkPv -I $exclude -R zroot external/fbsd1
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the manpage for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zxfer(8)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;     Modifying an example first is a good way to start using the script, as
     there are some options (e.g. -d and -F in normal mode) that are in
     practice always used.

[...]

EXAMPLES
     Note that some of these example commands are lengthy, so be sure to fix
     the line wrapping appropriately. Also if you wonder why zxfer isn&apos;t
     transferring anything, please read the section titled SNAPSHOTS.
  
  Ex1 - Backup a pool (including snapshots and properties)
[...] 

                [-d] deleting stale snapshots that don&apos;t exist on the source
                (e.g. if using a snapshot management script such as
                zfs-snapshot-mgmt(8), snapshots are regularly taken and
                regularly deleted to leave a range of frequencies of snapshots
                at different vintages. If you are regularly backing up to
                another pool which is stored off-site as is highly recommended,
                you may want to delete the stale snapshots on the backup pool
                without having to manage the snapshots there too. This is
                especially true for those pools that are usually not connected
                to a machine, e.g. if you are using HDD as backup media. Note
                that zfs send will also refuse to work if you have newer
                snapshots on destination than the most recent common snapshot
                on both, so it&apos;s easier to just enable it.)

                [-F] forcing a rollback of destination to the most recent
                snapshot. Given even mounting the filesystem will cause a
                change and hence cause zfs receive to fail with an error,
                enabling this is the way to go. Otherwise you would be
                modifying(!) a backup, wanting to keep the changes you are
                making(!?) and also wanting to copy more stuff to the backup
                (hence it&apos;s still being used as a backup)... well if that&apos;s
                what you want then don&apos;t use this option.

                [-k] storing the original filesystem properties in the file
                external/fbsd1/.zxfer_backup_info.zroot

                [-P] copying across the properties of each filesystem

                [-v] seeing lots of output (verbose)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For this example, it took around 35 minutes to complete.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh /external/fbsd1/
total 34
drwxr-xr-x  3 root  wheel     4B Mar 19 16:53 .
drwxr-xr-x  3 root  wheel     3B Mar 19 15:59 ..
-rw-r--r--  1 root  wheel    28K Mar 19 16:53 .zxfer_backup_info.zroot
drwxr-xr-x  7 root  wheel     7B Mar 19 16:53 zroot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list
NAME                                USED  AVAIL     REFER  MOUNTPOINT
external                           37.7G  12.3T       96K  /external
external/fbsd1                     37.7G  12.3T      136K  /external/fbsd1
external/fbsd1/zroot               37.7G  12.3T      152K  /external/fbsd1/zroot
---- snip ----
zroot                               189G   710G       88K  /zroot
zroot/ROOT                         58.5G   710G       88K  none
---- snip ---
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ df -hT
Filesystem                         Type       Size    Used   Avail Capacity  Mounted on
zroot/ROOT/default                 zfs        763G     53G    710G     7%    /
---- snip ----
external                           zfs         12T     96K     12T     0%    /external
external/fbsd1                     zfs         12T    136K     12T     0%    /external/fbsd1
external/fbsd1/zroot               zfs         12T    152K     12T     0%    /external/fbsd1/zroot
---- snip ----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can now scrub the external backup drive to make sure everything is good.
(From the manpage for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zpool-scrub(8)&lt;/code&gt;: for the option &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-w&lt;/code&gt; :  Wait until 
scrub has completed before returning.  This is so you to know when you 
get the shell prompt back that the scrube is done.)  The scrub takes at least 
as long as the first backup because it examines all data in the external 
pool to verify that it checksums correctly.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool scrub -w external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zpool status&lt;/code&gt; command reports the progress of the scrub.
From a separate shell:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool status external
  pool: external
 state: ONLINE
  scan: scrub in progress since Sat Mar 19 19:42:44 2022
        69.2G scanned at 68.2M/s, 32.7G issued at 32.2M/s, 69.2G total
        0B repaired, 47.27% done, 00:19:20 to go
config:

        NAME                STATE     READ WRITE CKSUM
        external            ONLINE       0     0     0
          gpt/external.eli  ONLINE       0     0     0

errors: No known data errors
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list
NAME       SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT
external  12.7T  37.7G  12.7T        -         -     0%     0%  1.00x    ONLINE  -
zroot      928G   189G   739G        -         -     6%    20%  1.00x    ONLINE  -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the scrub is done:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;% zpool status external
  pool: external
 state: ONLINE
  scan: scrub repaired 0B in 00:35:28 with 0 errors on Sat Mar 19 20:18:12 2022
config:

        NAME                STATE     READ WRITE CKSUM
        external            ONLINE       0     0     0
          gpt/external.eli  ONLINE       0     0     0

errors: No known data errors
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;scripting-the-regular-backup&quot;&gt;Scripting the Regular Backup&lt;/h2&gt;

&lt;p&gt;Download the script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;extbackup.sh&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://localhost:4000/assets/txt/extbackup.sh&quot;&gt;extbackup.sh&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Remember to edit the line &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;backupdev=&quot;da0&quot;&lt;/code&gt;, and replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;da0&lt;/code&gt; with the 
drive matching your system.&lt;/p&gt;

&lt;p&gt;Now when it comes time to run a backup, all you have to do is plug in the
external backup drive, get root, and run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;./extbackup.sh&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo ./extbackup.sh
[ OK ]  Attaching external backup drive.
Enter passphrase: 
[ OK ]  Importing external pool.
[ OK ]  Mounting &apos;external/fbsd1&apos;.
[ OK ]  Commencing backup.
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When it’s done, the script also unmounts the external backup drive and 
does geli detach.  After that unplug the external backup drive and put it away.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list | grep external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list | grep external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import
no pools available to import
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ df -hT | grep external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;performing-subsequent-backups&quot;&gt;Performing Subsequent Backups&lt;/h2&gt;

&lt;p&gt;Attach the external hard disk drive to the system.&lt;/p&gt;

&lt;p&gt;Run the external backup script &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;./extbackup.sh&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo ./extbackup.sh
[ OK ]  Attaching external backup drive.
Enter passphrase: 
[ OK ]  Importing external pool.
[ OK ]  Mounting &apos;external/fbsd1&apos;.
[ OK ]  Commencing backup.
[...]
[ OK ]  Backup completed successfully.
[ OK ]  Unmounted &apos;external/fbsd1&apos; cleanly.
[ OK ]  Exporting external pool.
[ OK ]  Detaching external backup drive.
[ OK ]  Done.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;recovering-a-file-from-zfs-snapshot-on-the-external-usb-geli-encrypted-hard-disk-drive&quot;&gt;Recovering a File from ZFS Snapshot on the External USB Geli Encrypted Hard Disk Drive&lt;/h2&gt;

&lt;p&gt;If you now mount a file system on the external USB drive 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;external/fbsd1/somefilesystem&lt;/code&gt; and check a file on this 
filesystem’s snapshot with for example 
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;less /external/fbsd1/somefilesystem/.zfs/snapshot/zfs-auto-snap_hourly-2022-03-19-20h00/somefile&lt;/code&gt;, 
you’ll see the contents of that file if it existed 
in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zroot/somefilesystem&lt;/code&gt; at that time.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo geli attach /dev/gpt/external
Enter passphrase: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
            Name  Status  Components
gpt/external.eli  ACTIVE  gpt/external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import
   pool: external
     id: 12345678901234567890
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        external            ONLINE
          gpt/external.eli  ONLINE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import
no pools available to import
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list | grep external
external                     1.19T  11.1T     1.02T  /external
external/fbsd1                172G  11.1T      172K  /external/fbsd1
external/fbsd1/zroot          172G  11.1T      152K  /external/fbsd1/zroot
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list | grep external
external  12.7T  1.19T  11.5T      -       -    0%    9%  1.00x    ONLINE  -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ df -hT | grep external
external                         zfs   12T   1.0T  11T  8%  /external
external/fbsd1                   zfs   11T   172K  11T  0%  /external/fbsd1
external/fbsd1/zroot             zfs   11T   152K  11T  0%  /external/fbsd1/zroot
external/fbsd1/zroot/usr/ports   zfs   11T    96K  11T  0%  /external/fbsd1/zroot/usr/ports
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh /external/fbsd1/zroot/usr/home/
total 34
drwxr-xr-x   3 root   wheel     3B Dec 26  2021 .
drwxr-xr-x   5 root   wheel     5B Mar 18 19:26 ..
drwxr-xr-x  42 dusko  dusko   112B Mar 19 20:36 dusko
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh /external/fbsd1/zroot/usr/home/.zfs/
total 1
dr-xr-xr-x+  3 root  wheel     3B Dec 24  2021 .
drwxr-xr-x   3 root  wheel     3B Dec 26  2021 ..
dr-xr-xr-x+ 28 root  wheel    28B Mar 19 19:54 snapshot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ ls -alh /external/fbsd1/zroot/usr/home/.zfs/snapshot/
total 13
dr-xr-xr-x+ 28 root wheel 28B Mar 19 19:54 .
dr-xr-xr-x+  3 root wheel  3B Dec 24  2021 ..
drwxr-xr-x   3 root wheel  3B Dec 26  2021 zfs-auto-snap_daily-2022-03-19-20h07
drwxr-xr-x   3 root wheel  3B Dec 26  2021 zfs-auto-snap_frequent-2022-03-19-19h45
[...]
drwxr-xr-x   3 root wheel  3B Dec 26  2021 zfs-auto-snap_hourly-2022-03-19-20h00
[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unmount &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;external/fbsd1&lt;/code&gt; after you’re done with it.&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import
no pools available to import
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list | grep external
external  12.7T  1.19T  11.5T      -       -    0%    9%  1.00x    ONLINE  -
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool export external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zpool list | grep external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo zpool import
   pool: external
     id: 12345678901234567890
  state: ONLINE
 action: The pool can be imported using its name or numeric identifier.
 config:

        external            ONLINE
          gpt/external.eli  ONLINE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ zfs list | grep external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ df -hT | grep external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
            Name  Status  Components
gpt/external.eli  ACTIVE  gpt/external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo geli detach /dev/gpt/external
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ geli status
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;add-a-backup-directory-for-a-new-host-that-you-dont-need-to-snapshot-automatically&quot;&gt;Add a Backup Directory for a New Host that You Don’t Need to Snapshot Automatically&lt;/h2&gt;

&lt;p&gt;Assumptions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The backup drive:
    &lt;ul&gt;
      &lt;li&gt;is big enough for backing up another computer;&lt;/li&gt;
      &lt;li&gt;stays plugged into the first computer;&lt;/li&gt;
      &lt;li&gt;is a destination for archiving regular backups from the second computer, and snapshotting those backups is not necessary.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;The second computer’s name: host2.mydomain.com.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo mkdir /external/host2 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ sudo chown dusko /external/host2/ 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cd /external/host2/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ scp dusko@host2.mydomain.com:/backup/stuff.tar.gz .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;footnotes&quot;&gt;Footnotes&lt;/h2&gt;

&lt;p&gt;[1] For details, refer to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;FreeBSD Handbook, Section &lt;a href=&quot;https://docs.freebsd.org/en/books/handbook/book/#dirstructure&quot;&gt;3.5 Directory Structure&lt;/a&gt; (Retrieved on Mar 19, 2022)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hier(7)&lt;/code&gt; manpage&lt;/li&gt;
  &lt;li&gt;man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bsdinstall(8)&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;From the man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bsdinstall(8)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ZFSBOOT_BEROOT_NAME      Name for the boot environment parent dataset.
                         This is a non-mountable dataset meant to be a
                         parent dataset where different boot environment
                         are going to be created.  Default: &quot;ROOT&quot;

[...]

ZFSBOOT_BOOTFS_NAME      Name for the primary boot environment, which
                         will be the default boot environment for the
                         system.  Default: &quot;default&quot;

[...]

ZFSBOOT_DATASETS         ZFS datasets to be created on the root zpool, it
                         requires the following datasets: /tmp, /var/tmp,
                         /$ZFSBOOT_BEROOT_NAME/$ZFSBOOT_BOOTFS_NAME.  See
                         ZFS DATASETS for more information about who to
                         write this variable and to take a look into the
                         default value of it.

[...]

zfsboot                  Provides a ZFS-only automatic interactive disk
                         partitioner.  Creates a single zpool with
                         separate datasets for /tmp, /usr, /usr/home,
                         /usr/ports, /usr/src, and /var.  Optionally can
                         set up geli(8) to encrypt the disk.

[...]

ZFS DATASETS
  The zfsboot partitioning takes the ZFSBOOT_DATASETS variable to create
  the datasets on the base system.  This variable can get pretty huge if
  the pool contains a lot of datasets.  The default value of the
  ZFSBOOT_DATASETS looks like this:

        # DATASET       OPTIONS (comma or space separated; or both)

        # Boot Environment [BE] root and default boot dataset
        /$ZFSBOOT_BEROOT_NAME                           mountpoint=none
        /$ZFSBOOT_BEROOT_NAME/$ZFSBOOT_BOOTFS_NAME      mountpoint=/

        # Compress /tmp, allow exec but not setuid
        /tmp            mountpoint=/tmp,exec=on,setuid=off

        # Do not mount /usr so that &apos;base&apos; files go to the BEROOT
        /usr            mountpoint=/usr,canmount=off

        # Home directories separated so they are common to all BEs
        /usr/home       # NB: /home is a symlink to /usr/home

        # Ports tree
        /usr/ports      setuid=off

        # Source tree (compressed)
        /usr/src

        # Create /var and friends
        /var            mountpoint=/var,canmount=off
        /var/audit      exec=off,setuid=off
        /var/crash      exec=off,setuid=off
        /var/log        exec=off,setuid=off
        /var/mail       atime=on
        /var/tmp        setuid=off

The first column if the dataset to be created on the top of the
ZFSBOOT_POOL_NAME and the rest of the columns are the options to be set
on each dataset.  The options must be written on a coma or space
separated list, or both.  And everything behind a pound/hash character is
ignored as a comment.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[2] From the man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zfs(8)&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;DESCRIPTION
     The zfs command configures ZFS datasets within a ZFS storage pool, as
     described in zpool(8).  A dataset is identified by a unique path within
     the ZFS namespace.  For example:
             pool/{filesystem,volume,snapshot}
  
     where the maximum length of a dataset name is MAXNAMELEN (256B) and the
     maximum amount of nesting allowed in a path is 50 levels deep.

     A dataset can be one of the following:
  
           file system  Can be mounted within the standard system namespace
                        and behaves like other file systems.  While ZFS file
                        systems are designed to be POSIX-compliant, known
                        issues exist that prevent compliance in some cases.
                        Applications that depend on standards conformance
                        might fail due to non-standard behavior when checking
                        file system free space.
  
           volume       A logical volume exported as a raw or block device.
                        This type of dataset should only be used when a block
                        device is required.  File systems are typically used
                        in most environments.
  
           snapshot     A read-only version of a file system or volume at a
                        given point in time.  It is specified as
                        filesystem@name or volume@name.

           bookmark     Much like a snapshot, but without the hold on on-disk
                        data.  It can be used as the source of a send (but not
                        for a receive).  It is specified as filesystem#name or
                        volume#name.
  
    See zfsconcepts(7) for details.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;[3] From the man page for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;zxfer(8)&lt;/code&gt;:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note that at present, the usage of spaces in zfs(8) filesystem names is
NOT supported. There is no plan to support it without someone else doing
the coding or a good funding proposal coming my way.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;references&quot;&gt;References&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://mwl.io/archives/2140&quot;&gt;FreeBSD ZFS snapshots with zfstools&lt;/a&gt; 
(Posted on Aug 6, 2014) (Retrieved on Mar 19, 2022)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://thornton2.com/unix/freebsd/geli-encrypted-usb-backup.html&quot;&gt;GELI Encrypted USB Backup of ZFS Filesystems in FreeBSD 13&lt;/a&gt; (Posted on Dec 22, 2021 - edited on Dec 23, 2021) (Retrieved on Mar 19, 2022)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.ccammack.com/posts/back-up-zfs-to-a-removable-drive-using-zxfer/&quot;&gt;Back Up ZFS to a Removable Drive Using zxfer&lt;/a&gt;
(Posted on Mar 30, 2020) (Retrieved on Mar 19, 2022)&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Sat, 19 Mar 2022 10:13:21 -0700</pubDate>
        <link>http://localhost:4000/zfs/freebsd/snapshot/backup/2022/03/19/freebsd-geli-encrypted-usb-external-hdd-zfs-freebsd.html</link>
        <guid isPermaLink="true">http://localhost:4000/zfs/freebsd/snapshot/backup/2022/03/19/freebsd-geli-encrypted-usb-external-hdd-zfs-freebsd.html</guid>
        
        
        <category>zfs</category>
        
        <category>freebsd</category>
        
        <category>snapshot</category>
        
        <category>backup</category>
        
      </item>
    
  </channel>
</rss>
